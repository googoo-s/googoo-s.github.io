<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Lua 简介 Lua 是一个小巧的脚本语言。是巴西里约热内卢天主教大学（Pontifical Catholic University of Rio de Janeiro）里的一个研究小组并于 1993 年开发。其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。Lua 由标准 C 编写而成，几乎在所有操作系统和平台上都可以编译、运行。Lua 并没有提供强大的库，这是由它的定位决定的。所以 Lua 不适合作为开发独立应用程序的语言。Lua 有一个同时进行的 JIT 项目，提供在特定平台上的即时编译功能。"><meta property="og:title" content="lua基础"><meta property="og:description" content="Lua 简介 Lua 是一个小巧的脚本语言。是巴西里约热内卢天主教大学（Pontifical Catholic University of Rio de Janeiro）里的一个研究小组并于 1993 年开发。其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。Lua 由标准 C 编写而成，几乎在所有操作系统和平台上都可以编译、运行。Lua 并没有提供强大的库，这是由它的定位决定的。所以 Lua 不适合作为开发独立应用程序的语言。Lua 有一个同时进行的 JIT 项目，提供在特定平台上的即时编译功能。"><meta property="og:type" content="website"><meta property="og:image" content="https://googoo-s.github.io/icon.png"><meta property="og:url" content="https://googoo-s.github.io/lua/lua%E5%9F%BA%E7%A1%80/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content="lua基础"><meta name=twitter:description content="Lua 简介 Lua 是一个小巧的脚本语言。是巴西里约热内卢天主教大学（Pontifical Catholic University of Rio de Janeiro）里的一个研究小组并于 1993 年开发。其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。Lua 由标准 C 编写而成，几乎在所有操作系统和平台上都可以编译、运行。Lua 并没有提供强大的库，这是由它的定位决定的。所以 Lua 不适合作为开发独立应用程序的语言。Lua 有一个同时进行的 JIT 项目，提供在特定平台上的即时编译功能。"><meta name=twitter:image content="https://googoo-s.github.io/icon.png"><title>lua基础</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://googoo-s.github.io//icon.png><link href=https://googoo-s.github.io/styles.19109a40042e9f0e72e952fda4442a34.min.css rel=stylesheet><link href=https://googoo-s.github.io/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://googoo-s.github.io/js/darkmode.953af745b0f9342644d632fc167f3727.min.js></script>
<script src=https://googoo-s.github.io/js/util.00639692264b21bc3ee219733d38a8be.min.js></script>
<link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script defer src=https://googoo-s.github.io/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://googoo-s.github.io/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://googoo-s.github.io/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://googoo-s.github.io/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://googoo-s.github.io/",fetchData=Promise.all([fetch("https://googoo-s.github.io/indices/linkIndex.44e9c4d31a16cfcd2cd4979a97f5cc17.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://googoo-s.github.io/indices/contentIndex.72af593980b1b0715d0a013ec293a10e.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://googoo-s.github.io",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!0;drawGraph("https://googoo-s.github.io",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'’':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/googoo-s.github.io\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=googoo-s.github.io src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://googoo-s.github.io/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://googoo-s.github.io/>googoo-s 😄😸😎</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>lua基础</h1><p class=meta>Last updated
Jul 31, 2023</p><ul class=tags><li><a href=https://googoo-s.github.io/tags/lua/>Lua</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#lua-简介>Lua 简介</a></li><li><a href=#lua-环境搭建>Lua 环境搭建</a><ol><li><a href=#helloworld>Helloworld</a></li></ol></li><li><a href=#基本数据类型>基本数据类型</a><ol><li><a href=#nil>Nil</a></li><li><a href=#boolean-布尔>Boolean (布尔)</a></li><li><a href=#number数字><strong>number（数字）</strong></a></li><li><a href=#string字符串>String（字符串）</a></li><li><a href=#table-表>Table (表)</a></li><li><a href=#function-函数>Function (函数)</a></li></ol></li><li><a href=#表达式>表达式</a><ol><li><a href=#算术运算符>算术运算符</a></li><li><a href=#关系运算符>关系运算符</a></li><li><a href=#逻辑运算符>逻辑运算符</a></li><li><a href=#字符串连接>字符串连接</a></li><li><a href=#优先级>优先级</a></li></ol></li><li><a href=#控制结构>控制结构</a><ol><li><a href=#if-else>If-else</a><ol><li><a href=#单个-if-分支型><strong>单个 if 分支型</strong></a></li><li><a href=#两个分支-if-else-型><strong>两个分支 if-else 型</strong></a></li><li><a href=#多个分支的-if-elseif-else>多个分支的 if-elseif-else</a></li></ol></li><li><a href=#while>While</a></li><li><a href=#repeat>Repeat</a></li><li><a href=#for>For</a><ol><li><a href=#for-数字型><strong>for 数字型</strong></a></li></ol></li><li><a href=#for-泛型>For 泛型</a></li><li><a href=#break>Break</a></li><li><a href=#return>Return</a></li><li><a href=#goto>Goto</a></li></ol></li><li><a href=#函数>函数</a><ol><li><a href=#定义>定义</a></li><li><a href=#参数>参数</a><ol><li><a href=#按值传递>按值传递</a></li><li><a href=#变长参数>变长参数</a></li><li><a href=#具名参数><strong>具名参数</strong></a></li><li><a href=#按引用传递>按引用传递</a></li></ol></li><li><a href=#函数返回值>函数返回值</a></li></ol></li><li><a href=#全动态函数调用>全动态函数调用</a></li><li><a href=#模块>模块</a></li><li><a href=#string>String</a><ol><li><a href=#stringbyte-s--i--j-><strong>string.Byte (s [, i [, j ]])</strong></a></li><li><a href=#string-char-><strong>string. Char (&mldr;)</strong></a></li><li><a href=#stringupper-s><strong>string.Upper (s)</strong></a></li><li><a href=#stringlower-s><strong>string.Lower (s)</strong></a></li><li><a href=#stringlen-s><strong>string.Len (s)</strong></a></li><li><a href=#stringfind-s-p--init--plain><strong>string.Find (s, p [, init [, plain]])</strong></a></li><li><a href=#stringformat-formatstring-><strong>string.Format (formatstring, &mldr;)</strong></a></li><li><a href=#stringmatch-s-p--init><strong>string.Match (s, p [, init])</strong></a></li><li><a href=#stringgmatch-s-p><strong>string.Gmatch (s, p)</strong></a></li><li><a href=#stringrep-s-n><strong>string.Rep (s, n)</strong></a></li><li><a href=#stringsub-s-i--j><strong>string.Sub (s, i [, j])</strong></a></li><li><a href=#stringgsub-s-p-r--n><strong>string.Gsub (s, p, r [, n])</strong></a></li><li><a href=#string-reverse-s><strong>string. Reverse (s)</strong></a></li></ol></li><li><a href=#table>Table</a><ol><li><a href=#下标从-1-开始><strong>下标从 1 开始</strong></a></li><li><a href=#table-getn-获取长度><strong>table. Getn 获取长度</strong></a></li><li><a href=#table-concat-table--sep--i--j---><strong>table. Concat (table [, sep [, i [, j ] ] ])</strong></a></li><li><a href=#table-insert-table-pos--value><strong>table. Insert (table, [pos ,] value)</strong></a></li><li><a href=#table-maxn-table><strong>table. Maxn (table)</strong></a></li><li><a href=#table-remove-table--pos><strong>table. Remove (table [, pos])</strong></a></li><li><a href=#table-sort-table--comp><strong>table. Sort (table [, comp])</strong></a></li><li><a href=#其他>其他</a></li></ol></li><li><a href=#日期时间>日期时间</a><ol><li><a href=#os-time-table><strong>os. Time ([table])</strong></a></li><li><a href=#os-difftime-t-2-t-1><strong>os. Difftime (t 2, t 1)</strong></a></li><li><a href=#os-date-format--time><strong>os. Date ([format [, time]])</strong></a></li></ol></li><li><a href=#数学库>数学库</a></li><li><a href=#文件>文件</a><ol><li><a href=#隐式文件描述><strong>隐式文件描述</strong></a></li><li><a href=#显式文件描述><strong>显式文件描述</strong></a></li><li><a href=#文件操作函数><strong>文件操作函数</strong></a><ol><li></li></ol></li></ol></li></ol></nav></details></aside><a href=#lua-简介><h1 id=lua-简介><span class=hanchor arialabel=Anchor># </span>Lua 简介</h1></a><p>Lua 是一个小巧的脚本语言。是巴西里约热内卢天主教大学（Pontifical Catholic University of Rio de Janeiro）里的一个研究小组并于 1993 年开发。<strong>其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能</strong>。Lua 由标准 C 编写而成，几乎在所有操作系统和平台上都可以编译、运行。Lua 并没有提供强大的库，这是由它的定位决定的。所以 Lua 不适合作为开发独立应用程序的语言。<strong>Lua 有一个同时进行的 JIT 项目，提供在特定平台上的即时编译功能</strong>。</p><ul><li><p><strong>Lua 脚本可以很容易的被 C/C++ 代码调用，也可以反过来调用 C/C++ 的函数，这使得 Lua 在应用程序中可以被广泛应用</strong>。</p></li><li><p><strong>不仅仅作为扩展脚本，也可以作为普通的配置文件，代替 XML、ini 等文件格式，并且更容易理解和维护</strong>。</p></li><li><p>标准 Lua 5.1 解释器由标准 C 编写而成，代码简洁优美，几乎在所有操作系统和平台上都可以编译和运行；</p></li><li><p>一个完整的标准 Lua 5.1 解释器不足 200 KB。而本书推荐使用的 LuaJIT 2 的代码大小也只有不足 500 KB</p></li><li><p>同时也支持大部分常见的体系结构。在目前所有脚本语言引擎中，LuaJIT 2 实现的速度应该算是最快的之一。这一切都决定了 Lua 是作为嵌入式脚本的最佳选择。</p></li></ul><p>Lua 语言的各个版本是不相兼容的。因此本书只介绍 Lua 5.1 语言，这是为标准 Lua 5.1 解释器和 LuaJIT 2 所共同支持的。LuaJIT 支持的对 Lua 5.1 向后兼容的 Lua 5.2 和 Lua 5.3 的特性，我们也会在方便的时候予以介绍。</p><a href=#lua-环境搭建><h1 id=lua-环境搭建><span class=hanchor arialabel=Anchor># </span>Lua 环境搭建</h1></a><p><a href=http://openresty.org/ rel=noopener>http://openresty.org</a></p><a href=#helloworld><h2 id=helloworld><span class=hanchor arialabel=Anchor># </span>Helloworld</h2></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=err>#</span> <span class=nx>cat</span> <span class=nx>hello</span><span class=p>.</span><span class=nx>lua</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>luajit</span> <span class=nx>hello</span><span class=p>.</span><span class=nx>lua</span>
</span></span><span class=line><span class=cl><span class=nx>hello</span> <span class=nx>world</span>
</span></span></code></pre></td></tr></table></div></div><a href=#基本数据类型><h1 id=基本数据类型><span class=hanchor arialabel=Anchor># </span>基本数据类型</h1></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=kd>type</span><span class=p>(</span><span class=s>&#34;helloworld&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=kd>type</span><span class=p>(</span><span class=err>&#39;</span><span class=nx>helloworld</span><span class=err>&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=kd>type</span><span class=p>(</span><span class=err>&#39;</span><span class=kc>true</span><span class=err>&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=kd>type</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=kd>type</span><span class=p>(</span><span class=mf>2.1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=kd>type</span><span class=p>(</span><span class=kc>nil</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nx>function</span> <span class=nf>hello</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=kd>type</span><span class=p>(</span><span class=nx>hello</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>输出</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=nx>number</span>
</span></span><span class=line><span class=cl><span class=nx>number</span>
</span></span><span class=line><span class=cl><span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=nx>function</span>
</span></span></code></pre></td></tr></table></div></div><a href=#nil><h2 id=nil><span class=hanchor arialabel=Anchor># </span>Nil</h2></a><p>Nil 是一种类型，Lua 将 nil 用于表示“无效值”。</p><ul><li><p>一个变量在第一次赋值前的默认值是 nil，</p></li><li><p>将 nil 赋予给一个全局变量就等同于删除它。</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nx>local</span> <span class=nx>num</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>num</span><span class=p>)</span>        <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=kc>nil</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>num</span> <span class=p>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>num</span><span class=p>)</span>        <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=mi>100</span>
</span></span></code></pre></td></tr></table></div></div><a href=#boolean-布尔><h2 id=boolean-布尔><span class=hanchor arialabel=Anchor># </span>Boolean (布尔)</h2></a><p>布尔类型，可选值 true/false；</p><ul><li><p>Lua 中 nil 和 false 为“假”</p></li><li><p>其它所有值均为“真”。比如 0 和空字符串就是“真”；</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nx>local</span> <span class=nx>a</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>b</span> <span class=p>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>c</span> <span class=p>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>a</span> <span class=nx>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>)</span>        <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=nx>a</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;not a&#34;</span><span class=p>)</span>    <span class=o>--</span><span class=nx>这个没有执行</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>b</span> <span class=nx>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;b&#34;</span><span class=p>)</span>        <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=nx>b</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;not b&#34;</span><span class=p>)</span>    <span class=o>--</span><span class=nx>这个没有执行</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>c</span> <span class=nx>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;c&#34;</span><span class=p>)</span>        <span class=o>--</span><span class=nx>这个没有执行</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;not c&#34;</span><span class=p>)</span>    <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=nx>not</span> <span class=nx>c</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span></code></pre></td></tr></table></div></div><a href=#number数字><h2 id=number数字><span class=hanchor arialabel=Anchor># </span><strong>number（数字）</strong></h2></a><p>Number 类型用于表示实数，和 C/C++ 里面的 double 类型很类似。可以使用数学函数 math. Floor（向下取整）和 math. Ceil（向上取整）进行取整操作。</p><p>一般地，Lua 的 number 类型就是用双精度浮点数来实现的。值得一提的是，LuaJIT 支持所谓的“dual-number”（双数）模式，</p><ul><li>即 <strong>LuaJIT 会根据上下文用整型来存储整数，而用双精度浮点数来存放浮点数。</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nx>local</span> <span class=nx>order</span> <span class=p>=</span> <span class=mf>3.99</span>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>score</span> <span class=p>=</span> <span class=mf>98.01</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>math</span><span class=p>.</span><span class=nf>floor</span><span class=p>(</span><span class=nx>order</span><span class=p>))</span>   <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>math</span><span class=p>.</span><span class=nf>ceil</span><span class=p>(</span><span class=nx>score</span><span class=p>))</span>    <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=mi>99</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=mi>9223372036854775807</span><span class=nx>LL</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>  <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=mi>9223372036854775806</span><span class=nx>LL</span>
</span></span></code></pre></td></tr></table></div></div><a href=#string字符串><h2 id=string字符串><span class=hanchor arialabel=Anchor># </span>String（字符串）</h2></a><p>Lua 中有三种方式表示字符串:</p><ol><li><p>使用一对匹配的单引号。例：&lsquo;hello&rsquo;。</p></li><li><p>使用一对匹配的双引号。例：&ldquo;abclua&rdquo;。</p></li><li><p>字符串还可以用一种长括号（即 [<input disabled type=checkbox> ]）括起来的方式定义</p><ol><li><p>我们把两个正的方括号（即[[）间插入 n 个等号定义为第 n 级正长括号。</p></li><li><p>0 级正的长括号写作 [[ ，一级正的长括号写作 [=[</p></li><li><p>反的长括号也作类似定义；举个例子，4 级反的长括号写作 ]====]</p></li><li><p><strong>一个长字符串可以由任何一级的正的长括号开始，而由第一个碰到的同级反的长括号结束</strong>。整个词法分析过程将<strong>不受分行限制，不处理任何转义符，并且忽略掉任何不同级别的长括号</strong></p></li></ol></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>local str1 = &#39;hello world&#39;
</span></span><span class=line><span class=cl>local str2 = &#34;hello lua&#34;
</span></span><span class=line><span class=cl>local str3 = <a class="internal-link broken">&</a>
</span></span><span class=line><span class=cl>local str4 = [=[string have a [[]].]=]
</span></span><span class=line><span class=cl>local str5 = [=[asdfasd]=]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>print(str1)    --&gt;output:hello world
</span></span><span class=line><span class=cl>print(str2)    --&gt;output:hello lua
</span></span><span class=line><span class=cl>print(str3)    --&gt;output:&#34;add\name&#34;,&#39;hello&#39;
</span></span><span class=line><span class=cl>print(str4)    --&gt;output:string have a [[]].
</span></span><span class=line><span class=cl>print(str5)    --&gt;output:asdfasd
</span></span></code></pre></td></tr></table></div></div><p>在 Lua 实现中，Lua 字符串一般都会经历一个“内化”（intern）的过程，<strong>即两个完全一样的 Lua 字符串在 Lua 虚拟机中只会存储一份</strong>。每一个 Lua 字符串在创建时都会<strong>插入到 Lua 虚拟机内部的一个全局的哈希表</strong>中</p><ol><li><p>创建相同的 Lua 字符串并不会引入新的动态内存分配操作，所以相对便宜（但仍有全局哈希表查询的开销），</p></li><li><p>内容相同的 Lua 字符串不会占用多份存储空间，</p></li><li><p>已经创建好的 Lua 字符串之间进行相等性比较时是 <code>O(1)</code> 时间度的开销，而不是通常见到的 <code>O(n)</code>.</p></li></ol><a href=#table-表><h2 id=table-表><span class=hanchor arialabel=Anchor># </span>Table (表)</h2></a><p>Table 类型实现了一种抽象的“关联数组”。“关联数组”是一种具有特殊索引方式的数组，</p><ul><li>索引通常是<strong>字符串（string）或者 number 类型，但也可以是除</strong> <strong><code>nil</code></strong> <strong>以外的任意类型的值</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>corp</span> <span class=p>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>web</span> <span class=p>=</span> <span class=s>&#34;www.google.com&#34;</span><span class=p>,</span>   <span class=o>--</span><span class=nx>索引为字符串</span><span class=err>，</span><span class=nx>key</span> <span class=p>=</span> <span class=s>&#34;web&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=o>--</span>            <span class=nx>value</span> <span class=p>=</span> <span class=s>&#34;www.google.com&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>telephone</span> <span class=p>=</span> <span class=s>&#34;12345678&#34;</span><span class=p>,</span>   <span class=o>--</span><span class=nx>索引为字符串</span>
</span></span><span class=line><span class=cl>    <span class=nx>staff</span> <span class=p>=</span> <span class=p>{</span><span class=s>&#34;Jack&#34;</span><span class=p>,</span> <span class=s>&#34;Scott&#34;</span><span class=p>,</span> <span class=s>&#34;Gary&#34;</span><span class=p>},</span> <span class=o>--</span><span class=nx>索引为字符串</span><span class=err>，</span><span class=nx>值也是一个表</span>
</span></span><span class=line><span class=cl>    <span class=mi>100876</span><span class=p>,</span>              <span class=o>--</span><span class=nx>相当于</span> <span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=p>=</span> <span class=mi>100876</span><span class=err>，</span><span class=nx>此时索引为数字</span>
</span></span><span class=line><span class=cl>    <span class=o>--</span>      <span class=nx>key</span> <span class=p>=</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>value</span> <span class=p>=</span> <span class=mi>100876</span>
</span></span><span class=line><span class=cl>    <span class=mi>100191</span><span class=p>,</span>              <span class=o>--</span><span class=nx>相当于</span> <span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=p>=</span> <span class=mi>100191</span><span class=err>，</span><span class=nx>此时索引为数字</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mi>10</span><span class=p>]</span> <span class=p>=</span> <span class=mi>360</span><span class=p>,</span>          <span class=o>--</span><span class=nx>直接把数字索引给出</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=s>&#34;city&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=s>&#34;Beijing&#34;</span> <span class=o>--</span><span class=nx>索引为字符串</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>corp</span><span class=p>.</span><span class=nx>web</span><span class=p>)</span>               <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=nx>www</span><span class=p>.</span><span class=nx>google</span><span class=p>.</span><span class=nx>com</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>corp</span><span class=p>[</span><span class=s>&#34;web&#34;</span><span class=p>])</span>               <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=nx>www</span><span class=p>.</span><span class=nx>google</span><span class=p>.</span><span class=nx>com</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>corp</span><span class=p>[</span><span class=s>&#34;telephone&#34;</span><span class=p>])</span>      <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=mi>12345678</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>corp</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>                <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=mi>100191</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>corp</span><span class=p>[</span><span class=s>&#34;city&#34;</span><span class=p>])</span>           <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=s>&#34;Beijing&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>corp</span><span class=p>.</span><span class=nx>staff</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>          <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=nx>Jack</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>corp</span><span class=p>[</span><span class=s>&#34;staff&#34;</span><span class=p>][</span><span class=mi>1</span><span class=p>])</span>          <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=nx>Jack</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>corp</span><span class=p>[</span><span class=mi>10</span><span class=p>])</span>               <span class=o>--</span><span class=p>&gt;</span><span class=nx>output</span><span class=p>:</span><span class=mi>360</span>
</span></span></code></pre></td></tr></table></div></div><p>在内部实现上，table 通常实现为一个哈希表、一个数组、或者两者的混合。具体的实现为何种形式，动态依赖于具体的 table 的键分布特点。</p><a href=#function-函数><h2 id=function-函数><span class=hanchor arialabel=Anchor># </span>Function (函数)</h2></a><p>在 Lua 中，<strong>函数</strong> 也是一种数据类型，函数可以存储在变量中，可以通过参数传递给其他函数，还可以作为其他函数的返回值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nx>local</span> <span class=nx>function</span> <span class=nf>foo</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;in the function&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>--</span><span class=nf>dosomething</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>local</span> <span class=nx>x</span> <span class=p>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>    <span class=nx>local</span> <span class=nx>y</span> <span class=p>=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>x</span> <span class=o>+</span> <span class=nx>y</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>a</span> <span class=p>=</span> <span class=nx>foo</span>    <span class=o>--</span><span class=nx>把函数赋给变量</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nf>a</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>--</span><span class=nx>output</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>--</span><span class=nx>in</span> <span class=nx>the</span> <span class=nx>function</span>
</span></span><span class=line><span class=cl><span class=o>--</span><span class=mi>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>function</span> <span class=nf>foo</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span><span class=line><span class=cl><span class=o>--</span><span class=nx>等价于</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>foo</span> <span class=p>=</span> <span class=nf>function</span> <span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>function</span> <span class=nf>foo</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span><span class=line><span class=cl><span class=o>--</span> <span class=nx>等价于</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>foo</span> <span class=p>=</span> <span class=nf>function</span> <span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span></code></pre></td></tr></table></div></div><a href=#表达式><h1 id=表达式><span class=hanchor arialabel=Anchor># </span>表达式</h1></a><a href=#算术运算符><h2 id=算术运算符><span class=hanchor arialabel=Anchor># </span>算术运算符</h2></a><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>算术运算符</td><td>说明</td></tr><tr><td>+</td><td>加法</td></tr><tr><td>-</td><td>减法</td></tr><tr><td>*</td><td>乘法</td></tr><tr><td>/</td><td>除法</td></tr><tr><td>^</td><td>指数</td></tr><tr><td>%</td><td>取模</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=mi>2</span><span class=p>)</span>       <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=mi>5</span> <span class=o>/</span> <span class=mi>10</span><span class=p>)</span>      <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=mf>0.5</span><span class=err>。</span> <span class=nx>这是Lua不同于c语言的</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=mf>5.0</span> <span class=o>/</span> <span class=mi>10</span><span class=p>)</span>    <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=mf>0.5</span><span class=err>。</span> <span class=nx>浮点数相除的结果是浮点数</span>
</span></span><span class=line><span class=cl><span class=o>--</span> <span class=nb>print</span><span class=p>(</span><span class=mi>10</span> <span class=o>/</span> <span class=mi>0</span><span class=p>)</span>   <span class=o>--</span><span class=p>&gt;</span><span class=nx>注意除数不能为0</span><span class=err>，</span><span class=nx>计算的结果会出错</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=mi>2</span> <span class=p>^</span> <span class=mi>10</span><span class=p>)</span>      <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=mi>1024</span><span class=err>。</span> <span class=nx>求2的10次方</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>num</span> <span class=p>=</span> <span class=mi>1357</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>num</span> <span class=o>%</span> <span class=mi>2</span><span class=p>)</span>       <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>((</span><span class=nx>num</span> <span class=o>%</span> <span class=mi>2</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=kc>true</span><span class=err>。</span> <span class=nx>判断num是否为奇数</span>
</span></span></code></pre></td></tr></table></div></div><a href=#关系运算符><h2 id=关系运算符><span class=hanchor arialabel=Anchor># </span>关系运算符</h2></a><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>关系运算符</td><td>说明</td></tr><tr><td>&lt;</td><td>小于</td></tr><tr><td>></td><td>大于</td></tr><tr><td>&lt;=</td><td>小于等于</td></tr><tr><td>>=</td><td>大于等于</td></tr><tr><td>==</td><td>等于</td></tr><tr><td>~=</td><td>不等于</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=mi>1</span> <span class=p>&lt;</span> <span class=mi>2</span><span class=p>)</span>    <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=mi>1</span> <span class=o>==</span> <span class=mi>2</span><span class=p>)</span>   <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=mi>1</span> <span class=err>~</span><span class=p>=</span> <span class=mi>2</span><span class=p>)</span>   <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=p>=</span> <span class=kc>true</span><span class=p>,</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>a</span> <span class=o>==</span> <span class=nx>b</span><span class=p>)</span>  <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=kc>false</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>在使用“==”做等于判断时，要注意对于 table, userdate 和函数， Lua 是作引用比较的。也就是说，只有当两个变量引用同一个对象时，才认为它们相等</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nx>local</span> <span class=nx>a</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>x</span> <span class=p>=</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>y</span> <span class=p>=</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>b</span> <span class=p>=</span> <span class=p>{</span> <span class=nx>x</span> <span class=p>=</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>y</span> <span class=p>=</span> <span class=mi>0</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>a</span> <span class=o>==</span> <span class=nx>b</span> <span class=nx>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;a==b&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;a~=b&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span><span class=line><span class=cl><span class=o>---</span><span class=nx>output</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=nx>a</span><span class=err>~</span><span class=p>=</span><span class=nx>b</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>Lua 字符串总是会被“内化”，即相同内容的字符串只会被保存一份，因此 Lua 字符串之间的相等性比较可以简化为其内部存储地址的比较。</p></li><li><p>这意味着 Lua 字符串的相等性比较总是为 O (1)</p></li></ul><a href=#逻辑运算符><h2 id=逻辑运算符><span class=hanchor arialabel=Anchor># </span>逻辑运算符</h2></a><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>逻辑运算符</td><td>说明</td></tr><tr><td>and</td><td>逻辑与</td></tr><tr><td>or</td><td>逻辑或</td></tr><tr><td>not</td><td>逻辑非</td></tr></tbody></table><p>在 c 语言中，and 和 or 只得到两个值 1 和 0，其中 1 表示真，0 表示假。而 Lua 中 and 的执行过程是这样的：</p><ul><li><p><code>a and b</code> 如果 a 为 nil，则返回 a，否则返回 b;</p></li><li><p><code>a or b</code> 如果 a 为 nil，则返回 b，否则返回 a。</p></li><li><p><strong>所有逻辑操作符将 false 和 nil 视作假，其他任何值视作真，对于 and 和 or，“短路求值”，对于 not，永远只返回 true 或者 false。</strong></p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nx>local</span> <span class=nx>c</span> <span class=p>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>d</span> <span class=p>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>e</span> <span class=p>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>c</span> <span class=nx>and</span> <span class=nx>d</span><span class=p>)</span>  <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>c</span> <span class=nx>and</span> <span class=nx>e</span><span class=p>)</span>  <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>d</span> <span class=nx>and</span> <span class=nx>e</span><span class=p>)</span>  <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>c</span> <span class=nx>or</span> <span class=nx>d</span><span class=p>)</span>   <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>c</span> <span class=nx>or</span> <span class=nx>e</span><span class=p>)</span>   <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>not</span> <span class=nx>c</span><span class=p>)</span>    <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>not</span> <span class=nx>d</span><span class=p>)</span>    <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=kc>false</span>
</span></span></code></pre></td></tr></table></div></div><a href=#字符串连接><h2 id=字符串连接><span class=hanchor arialabel=Anchor># </span>字符串连接</h2></a><p>Lua 中连接两个字符串，可以使用操作符“..”（两个点）</p><ul><li><p>如果其任意一个操作数是数字的话，Lua 会将这个数字转换成字符串。</p></li><li><p>注意，连接操作符只会创建一个新字符串，而不会改变原操作数</p></li><li><p>也可以使用 string 库函数 <code>string.format</code> 连接字符串</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s>&#34;Hello &#34;</span> <span class=p>..</span> <span class=s>&#34;World&#34;</span><span class=p>)</span>    <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=nx>Hello</span> <span class=nf>Worldprint</span><span class=p>(</span><span class=mi>0</span> <span class=p>..</span> <span class=mi>1</span><span class=p>)</span>                 <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=mo>01</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>str1</span> <span class=p>=</span> <span class=kt>string</span><span class=p>.</span><span class=nf>format</span><span class=p>(</span><span class=s>&#34;%s-%s&#34;</span><span class=p>,</span><span class=s>&#34;hello&#34;</span><span class=p>,</span><span class=s>&#34;world&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>str1</span><span class=p>)</span>              <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=nx>hello</span><span class=o>-</span><span class=nx>world</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>str2</span> <span class=p>=</span> <span class=kt>string</span><span class=p>.</span><span class=nf>format</span><span class=p>(</span><span class=s>&#34;%d-%s-%.2f&#34;</span><span class=p>,</span><span class=mi>123</span><span class=p>,</span><span class=s>&#34;world&#34;</span><span class=p>,</span><span class=mf>1.21</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nx>str2</span><span class=p>)</span>              <span class=o>--</span><span class=p>&gt;</span><span class=nx>打印</span> <span class=mi>123</span><span class=o>-</span><span class=nx>world</span><span class=o>-</span><span class=mf>1.21</span>
</span></span></code></pre></td></tr></table></div></div><p>于 Lua 字符串本质上是只读的，<strong>因此字符串连接运算符几乎总会创建一个新的（更大的）字符串</strong>。这意味着如果有很多这样的连接操作（比如在循环中使用 .. 来拼接最终结果），则性能损耗会非常大。在这种情况下，推荐使用 table 和 <code>table.concat()</code> 来进行很多字符串的拼接</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nx>local</span> <span class=nx>pieces</span> <span class=p>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>elem</span> <span class=nx>in</span> <span class=nf>ipairs</span><span class=p>(</span><span class=nx>my_list</span><span class=p>)</span> <span class=nx>do</span>
</span></span><span class=line><span class=cl>    <span class=nx>pieces</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nf>my_process</span><span class=p>(</span><span class=nx>elem</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>res</span> <span class=p>=</span> <span class=nx>table</span><span class=p>.</span><span class=nf>concat</span><span class=p>(</span><span class=nx>pieces</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>上面的例子还可以使用 LuaJIT 独有的 <code>table.new</code> 来恰当地初始化 <code>pieces</code> 表的空间，以避免该表的动态生长。</p><a href=#优先级><h2 id=优先级><span class=hanchor arialabel=Anchor># </span>优先级</h2></a><table><thead><tr><th>f</th><th></th></tr></thead><tbody><tr><td>^</td><td></td></tr><tr><td>not # -</td><td></td></tr><tr><td>* / %</td><td></td></tr><tr><td>+ -</td><td></td></tr><tr><td>..</td><td></td></tr><tr><td>&lt; > &lt;= >= == ~=</td><td></td></tr><tr><td>and</td><td></td></tr><tr><td>or</td><td></td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nx>local</span> <span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=p>=</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>x</span><span class=p>,</span> <span class=nx>y</span> <span class=p>=</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>i</span> <span class=p>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=nx>local</span> <span class=nx>res</span> <span class=p>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=nx>res</span> <span class=p>=</span> <span class=nx>a</span> <span class=o>+</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>b</span><span class=o>/</span><span class=mi>2</span> <span class=o>+</span> <span class=mi>1</span>  <span class=o>--</span><span class=p>&gt;</span><span class=nx>等价于res</span> <span class=p>=</span>  <span class=p>(</span><span class=nx>a</span> <span class=o>+</span> <span class=nx>i</span><span class=p>)</span> <span class=p>&lt;</span> <span class=p>((</span><span class=nx>b</span><span class=o>/</span><span class=mi>2</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>res</span> <span class=p>=</span> <span class=mi>5</span> <span class=o>+</span> <span class=nx>x</span><span class=p>^</span><span class=mi>2</span><span class=o>*</span><span class=mi>8</span>        <span class=o>--</span><span class=p>&gt;</span><span class=nx>等价于res</span> <span class=p>=</span>  <span class=mi>5</span> <span class=o>+</span> <span class=p>((</span><span class=nx>x</span><span class=p>^</span><span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>res</span> <span class=p>=</span> <span class=nx>a</span> <span class=p>&lt;</span> <span class=nx>y</span> <span class=nx>and</span> <span class=nx>y</span> <span class=o>&lt;=</span><span class=nx>x</span>  <span class=o>--</span><span class=p>&gt;</span><span class=nx>等价于res</span> <span class=p>=</span>  <span class=p>(</span><span class=nx>a</span> <span class=p>&lt;</span> <span class=nx>y</span><span class=p>)</span> <span class=nf>and</span> <span class=p>(</span><span class=nx>y</span> <span class=o>&lt;=</span> <span class=nx>x</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><a href=#控制结构><h1 id=控制结构><span class=hanchor arialabel=Anchor># </span>控制结构</h1></a><a href=#if-else><h2 id=if-else><span class=hanchor arialabel=Anchor># </span>If-else</h2></a><a href=#单个-if-分支型><h3 id=单个-if-分支型><span class=hanchor arialabel=Anchor># </span><strong>单个 if 分支型</strong></h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nx>x</span> <span class=p>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>x</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=nx>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;x is a positive number&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span></code></pre></td></tr></table></div></div><a href=#两个分支-if-else-型><h3 id=两个分支-if-else-型><span class=hanchor arialabel=Anchor># </span><strong>两个分支 if-else 型</strong></h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nx>x</span> <span class=p>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>x</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=nx>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;x is a positive number&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;x is a non-positive number&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span></code></pre></td></tr></table></div></div><a href=#多个分支的-if-elseif-else><h3 id=多个分支的-if-elseif-else><span class=hanchor arialabel=Anchor># </span>多个分支的 if-elseif-else</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>score</span> <span class=p>=</span> <span class=mi>90</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>score</span> <span class=o>==</span> <span class=mi>100</span> <span class=nx>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;Very good!Your score is 100&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>elseif</span> <span class=nx>score</span> <span class=o>&gt;=</span> <span class=mi>60</span> <span class=nx>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;Congratulations, you have passed it,your score greater or equal to 60&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>--</span><span class=nx>此处可以添加多个elseif</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;Sorry, you do not pass the exam! &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span></code></pre></td></tr></table></div></div><p>与 C 语言的不同之处是 else 与 if 是连在一起的，若将 else 与 if 写成 &ldquo;else if&rdquo; 则相当于在 else 里嵌套另一个 if 语句，如下代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nx>score</span> <span class=p>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>score</span> <span class=o>==</span> <span class=mi>100</span> <span class=nx>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;Very good!Your score is 100&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>elseif</span> <span class=nx>score</span> <span class=o>&gt;=</span> <span class=mi>60</span> <span class=nx>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s>&#34;Congratulations, you have passed it,your score greater or equal to 60&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>score</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=nx>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s>&#34;Your score is better than 0&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s>&#34;My God, your score turned out to be 0&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>end</span> <span class=o>--</span><span class=nx>与上一示例代码不同的是</span><span class=err>，</span><span class=nx>此处要添加一个end</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span></code></pre></td></tr></table></div></div><a href=#while><h2 id=while><span class=hanchor arialabel=Anchor># </span>While</h2></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Go data-lang=Go><span class=line><span class=cl><span class=nx>while</span> <span class=nx>表达式</span> <span class=nx>do</span>
</span></span><span class=line><span class=cl>    <span class=o>--</span><span class=nx>body</span>
</span></span><span class=line><span class=cl><span class=nx>end</span>
</span></span></code></pre></td></tr></table></div></div><a href=#repeat><h2 id=repeat><span class=hanchor arialabel=Anchor># </span>Repeat</h2></a><p>Lua 中的 repeat 控制结构类似于其他语言（如：C++ 语言）中的 do-while，但是控制方式是刚好相反的。简单点说，<strong>执行 repeat 循环体后，直到 until 的条件为真时才结束</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=c1>-- 以下代码会死循环</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=kr>repeat</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>until</span> <span class=kc>false</span>
</span></span></code></pre></td></tr></table></div></div><a href=#for><h2 id=for><span class=hanchor arialabel=Anchor># </span>For</h2></a><a href=#for-数字型><h3 id=for-数字型><span class=hanchor arialabel=Anchor># </span><strong>for 数字型</strong></h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kr>for</span> <span class=n>var</span> <span class=o>=</span> <span class=n>begin</span><span class=p>,</span> <span class=n>finish</span><span class=p>,</span> <span class=n>step</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>    <span class=c1>--body</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></td></tr></table></div></div><ol><li><p>Var 从 begin 变化到 finish，每次变化都以 step 作为步长递增 var</p></li><li><p>Begin、finish、step 三个表达式只会在循环开始时执行一次</p></li><li><p>第三个表达式 step 是可选的，默认为 1</p></li><li><p>控制变量 var 的作用域仅在 for 循环内，需要在外面控制，则需将值赋给一个新的变量</p></li><li><p>循环过程中不要改变控制变量的值，那样会带来不可预知的影响</p></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kr>for</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>5</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=c1>-- output:</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>for</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>2</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=c1>-- output:</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=mi>9</span>
</span></span></code></pre></td></tr></table></div></div><a href=#for-泛型><h2 id=for-泛型><span class=hanchor arialabel=Anchor># </span>For 泛型</h2></a><p>泛型 for 循环通过一个迭代器（iterator）函数来遍历所有值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=c1>-- 打印数组a的所有值local a = {&#34;a&#34;, &#34;b&#34;, &#34;c&#34;, &#34;d&#34;}</span>
</span></span><span class=line><span class=cl><span class=kr>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>v</span> <span class=kr>in</span> <span class=n>ipairs</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s2>&#34;index:&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=s2>&#34; value:&#34;</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=c1>-- output:</span>
</span></span><span class=line><span class=cl><span class=n>index</span><span class=p>:</span>  <span class=mi>1</span>  <span class=n>value</span><span class=p>:</span> <span class=n>a</span>
</span></span><span class=line><span class=cl><span class=n>index</span><span class=p>:</span>  <span class=mi>2</span>  <span class=n>value</span><span class=p>:</span> <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=n>index</span><span class=p>:</span>  <span class=mi>3</span>  <span class=n>value</span><span class=p>:</span> <span class=n>c</span>
</span></span><span class=line><span class=cl><span class=n>index</span><span class=p>:</span>  <span class=mi>4</span>  <span class=n>value</span><span class=p>:</span> <span class=n>d</span>
</span></span></code></pre></td></tr></table></div></div><p>Lua 的基础库提供了 <strong>ipairs，这是一个用于遍历数组的迭代器函数</strong>。在每次循环中，i 会被赋予一个索引值，同时 v 被赋予一个对应于该索引的数组元素值。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=c1>-- 打印table t中所有的</span>
</span></span><span class=line><span class=cl><span class=n>keyfor</span> <span class=n>k</span> <span class=kr>in</span> <span class=n>pairs</span><span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></td></tr></table></div></div><p>通过不同的迭代器，几乎可以遍历所有的东西，而且写出的代码极具可读性。标准库提供了几种迭代器，包括用于迭代文件中每行的（io. Lines）、迭代 table 元素的（pairs）、迭代数组元素的（ipairs）、迭代字符串中单词的（string. Gmatch）</p><p>泛型 for 循环与数字型 for 循环有两个相同点：</p><ol><li><p>循环变量是循环体的局部变量；</p></li><li><p>决不应该对循环变量作任何赋值。</p></li></ol><p>在 LuaJIT 2.1 中，<strong><code>ipairs()</code></strong> <strong>内建函数是可以被 JIT 编译的，而</strong> <strong><code>pairs()</code></strong> <strong>则只能被解释执行。因此在性能敏感的场景，应当合理安排数据结构，避免对哈希表进行遍历</strong></p><a href=#break><h2 id=break><span class=hanchor arialabel=Anchor># </span>Break</h2></a><p>语句 <code>break</code> 用来终止 <code>while</code>、<code>repeat</code> 和 <code>for</code> 三种循环的执行，并跳出当前循环体，继续执行当前循环之后的语句</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=c1>-- 计算最小的x,使从1到x的所有数相加和大于100</span>
</span></span><span class=line><span class=cl><span class=n>sum</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=kr>while</span> <span class=kc>true</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>    <span class=n>sum</span> <span class=o>=</span> <span class=n>sum</span> <span class=o>+</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>    <span class=kr>if</span> <span class=n>sum</span> <span class=o>&gt;</span> <span class=mi>100</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>        <span class=kr>break</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;The result is &#34;</span> <span class=o>..</span> <span class=n>i</span><span class=p>)</span>  
</span></span><span class=line><span class=cl><span class=c1>--&gt;output:The result is 14</span>
</span></span></code></pre></td></tr></table></div></div><a href=#return><h2 id=return><span class=hanchor arialabel=Anchor># </span>Return</h2></a><p><code>return</code> 主要用于从函数中返回结果，或者用于简单的结束一个函数的执行。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>add</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>x</span> <span class=o>+</span> <span class=n>y</span>
</span></span><span class=line><span class=cl>    <span class=c1>--print(&#34;add: I will return the result &#34; .. (x + y))</span>
</span></span><span class=line><span class=cl>    <span class=c1>--因为前面有个return，若不注释该语句，则会报错</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>is_positive</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>if</span> <span class=n>x</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>        <span class=kr>return</span> <span class=n>x</span> <span class=o>..</span> <span class=s2>&#34; is positive&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kr>else</span>
</span></span><span class=line><span class=cl>        <span class=kr>return</span> <span class=n>x</span> <span class=o>..</span> <span class=s2>&#34; is non-positive&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>--由于return只出现在前面显式的语句块，所以此语句不注释也不会报错</span>
</span></span><span class=line><span class=cl>    <span class=c1>--，但是不会被执行，此处不会产生输出</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s2>&#34;function end!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>sum</span> <span class=o>=</span> <span class=n>add</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;The sum is &#34;</span> <span class=o>..</span> <span class=n>sum</span><span class=p>)</span>  <span class=c1>--&gt;output:The sum is 30</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>answer</span> <span class=o>=</span> <span class=n>is_positive</span><span class=p>(</span><span class=o>-</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>answer</span><span class=p>)</span>                <span class=c1>--&gt;output:-10 is non-positive</span>
</span></span></code></pre></td></tr></table></div></div><a href=#goto><h2 id=goto><span class=hanchor arialabel=Anchor># </span>Goto</h2></a><p>有了 <code>goto</code>，我们可以实现 <code>continue</code> 的功能：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kr>for</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>    <span class=kr>if</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>2</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>        <span class=n>print</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=s2>&#34;yes continue&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=kr>goto</span> <span class=nl>continue</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=s2>&#34; no continue&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>::</span><span class=nl>continue</span><span class=p>::</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s><a class="internal-link broken">i&</a></span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></td></tr></table></div></div><p>输出结果</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=err>$</span> <span class=n>luajit</span> <span class=n>test.lua</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=n>yes</span> <span class=n>continue</span>
</span></span><span class=line><span class=cl><span class=n>i</span><span class=s1>&#39;m end
</span></span></span><span class=line><span class=cl><span class=s1>2   yes continue
</span></span></span><span class=line><span class=cl><span class=s1>i&#39;</span><span class=n>m</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=n>no</span> <span class=n>continue</span>
</span></span><span class=line><span class=cl><span class=n>i</span><span class=s1>&#39;m end
</span></span></span></code></pre></td></tr></table></div></div><a href=#函数><h1 id=函数><span class=hanchor arialabel=Anchor># </span>函数</h1></a><a href=#定义><h2 id=定义><span class=hanchor arialabel=Anchor># </span>定义</h2></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>function_name</span> <span class=p>(</span><span class=n>arc</span><span class=p>)</span>  <span class=c1>-- arc 表示参数列表，函数的参数列表可以为空</span>
</span></span><span class=line><span class=cl>    <span class=c1>-- body</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></td></tr></table></div></div><p>上面的语法定义了一个全局函数，名为 <code>function_name</code>. 全局函数本质上就是函数类型的值赋给了一个全局变量，即上面的语法等价于</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>function_name</span> <span class=o>=</span> <span class=kr>function</span> <span class=p>(</span><span class=n>arc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=c1>-- body</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></td></tr></table></div></div><p>由于全局变量一般会污染全局名字空间，同时也有性能损耗（即查询全局环境表的开销），因此我们应当尽量使用“局部函数”，其记法是类似的，只是开头加上 <code>local</code> 修饰符：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>function_name</span> <span class=p>(</span><span class=n>arc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>-- body</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></td></tr></table></div></div><p>定义函数</p><ol><li><p>利用名字来解释函数、变量的目的，使人通过名字就能看出来函数、变量的作用。</p></li><li><p>每个函数的长度要尽量控制在一个屏幕内，一眼可以看明白。</p></li><li><p>让代码自己说话，不需要注释最好。</p></li></ol><p>由于函数定义等价于变量赋值，我们也可以把函数名替换为某个 Lua 表的某个字段，例如</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>foo</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>foo</span><span class=p>.</span><span class=nf>pr</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s2>&#34;ssss&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>foo.pr</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><a href=#参数><h2 id=参数><span class=hanchor arialabel=Anchor># </span>参数</h2></a><a href=#按值传递><h3 id=按值传递><span class=hanchor arialabel=Anchor># </span>按值传递</h3></a><p><strong>Lua 函数的参数大部分是按值传递的</strong>。<strong>当函数参数是 table 类型时，传递进来的是实际参数的引用</strong></p><p>值传递就是调用函数时，实参把它的值通过赋值运算传递给形参，然后形参的改变和实参就没有关系了。在这个过程中，实参是通过它在参数表中的位置与形参匹配起来的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>swap</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span> <span class=c1>--定义函数swap,函数内部进行交换两个变量的值</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>temp</span> <span class=o>=</span> <span class=n>a</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>temp</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>x</span> <span class=o>=</span> <span class=s2>&#34;hello&#34;</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>y</span> <span class=o>=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>swap</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>    <span class=c1>--调用swap函数</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>   <span class=c1>--调用swap函数后，x和y的值并没有交换</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt;output</span>
</span></span><span class=line><span class=cl><span class=n>hello</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl><span class=mi>20</span>  <span class=n>hello</span>
</span></span><span class=line><span class=cl><span class=n>hello</span> <span class=mi>20</span>
</span></span></code></pre></td></tr></table></div></div><p>在调用函数的时候，<strong>若形参个数和实参个数不同时，Lua 会自动调整实参个数</strong>。调整规则：</p><ul><li><p>若实参个数大于形参个数，从左向右，多余的实参被忽略；</p></li><li><p>若实参个数小于形参个数，从左向右，<strong>没有被实参初始化的形参会被初始化为 nil</strong></p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>fun1</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>       <span class=c1>--两个形参，多余的实参被忽略掉</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>fun2</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>)</span> <span class=c1>--四个形参，没有被实参初始化的形参，用nil初始化</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>,</span> <span class=n>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>y</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>z</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fun1</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>z</span><span class=p>)</span>         <span class=c1>-- z被函数fun1忽略掉了，参数变成 x, y</span>
</span></span><span class=line><span class=cl><span class=n>fun2</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>z</span><span class=p>)</span>         <span class=c1>-- 后面自动加上一个nil，参数变成 x, y, z, nil</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt;output</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=mi>2</span>   <span class=mi>3</span>   <span class=kc>nil</span>
</span></span></code></pre></td></tr></table></div></div><a href=#变长参数><h3 id=变长参数><span class=hanchor arialabel=Anchor># </span>变长参数</h3></a><p>其实 Lua 还支持变长参数。若形参为 <code>...</code>，表示该函数可以接收不同长度的参数。访问参数的时候也要使用 <code>...</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>func</span><span class=p>(</span> <span class=p>...</span> <span class=p>)</span>                <span class=c1>-- 形参为 ... ,表示函数采用变长参数</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>temp</span> <span class=o>=</span> <span class=p>{...}</span>                     <span class=c1>-- 访问的时候也要使用 ...</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>ans</span> <span class=o>=</span> <span class=n>table.concat</span><span class=p>(</span><span class=n>temp</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>)</span>    <span class=c1>-- 使用 table.concat 库函数对数</span>
</span></span><span class=line><span class=cl>    <span class=c1>-- 组内容使用 &#34; &#34; 拼接成字符串。</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>ans</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>func</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>        <span class=c1>-- 传递了两个参数</span>
</span></span><span class=line><span class=cl><span class=n>func</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>  <span class=c1>-- 传递了四个参数</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt;output</span>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=mi>2</span> <span class=mi>3</span> <span class=mi>4</span>
</span></span></code></pre></td></tr></table></div></div><a href=#具名参数><h3 id=具名参数><span class=hanchor arialabel=Anchor># </span><strong>具名参数</strong></h3></a><p>Lua 还支持通过名称来指定实参，这时候要把所有的实参组织到一个 table 中，并将这个 table 作为唯一的实参传给函数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>change</span><span class=p>(</span><span class=n>arg</span><span class=p>)</span> <span class=c1>-- change 函数，改变长方形的长和宽，使其各增长一倍</span>
</span></span><span class=line><span class=cl>  <span class=n>arg.width</span> <span class=o>=</span> <span class=n>arg.width</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>  <span class=n>arg.height</span> <span class=o>=</span> <span class=n>arg.height</span> <span class=o>*</span> <span class=mi>2</span><span class=kr>return</span> <span class=n>arg</span>
</span></span><span class=line><span class=cl><span class=n>endlocal</span> <span class=n>rectangle</span> <span class=o>=</span> <span class=p>{</span> <span class=n>width</span> <span class=o>=</span> <span class=mi>20</span><span class=p>,</span> <span class=n>height</span> <span class=o>=</span> <span class=mi>15</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;before change:&#34;</span><span class=p>,</span> <span class=s2>&#34;width  =&#34;</span><span class=p>,</span> <span class=n>rectangle.width</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;height =&#34;</span><span class=p>,</span> <span class=n>rectangle.height</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>rectangle</span> <span class=o>=</span> <span class=n>change</span><span class=p>(</span><span class=n>rectangle</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;after  change:&#34;</span><span class=p>,</span> <span class=s2>&#34;width  =&#34;</span><span class=p>,</span> <span class=n>rectangle.width</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;height =&#34;</span><span class=p>,</span> <span class=n>rectangle.height</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt;output</span>
</span></span><span class=line><span class=cl><span class=n>before</span> <span class=n>change</span><span class=p>:</span> <span class=n>width</span> <span class=o>=</span> <span class=mi>20</span>  <span class=n>height</span> <span class=o>=</span>  <span class=mi>15</span>
</span></span><span class=line><span class=cl><span class=n>after</span>  <span class=n>change</span><span class=p>:</span> <span class=n>width</span> <span class=o>=</span> <span class=mi>40</span>  <span class=n>height</span> <span class=o>=</span>  <span class=mi>30</span>
</span></span></code></pre></td></tr></table></div></div><a href=#按引用传递><h3 id=按引用传递><span class=hanchor arialabel=Anchor># </span>按引用传递</h3></a><p><strong>当函数参数是 table 类型时，传递进来的是实际参数的引用</strong>，此时在函数内部对该 table 所做的修改，会直接对调用者所传递的实际参数生效，而无需自己返回结果和让调用者进行赋值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>function change(arg) --change函数，改变长方形的长和宽，使其各增长一倍
</span></span><span class=line><span class=cl>  arg.width = arg.width * 2  --表arg不是表rectangle的拷贝，他们是同一个表
</span></span><span class=line><span class=cl>  arg.height = arg.height * 2end                  -- 没有return语句了local rectangle = { width = 20, height = 15 }
</span></span><span class=line><span class=cl>print(&#34;before change:&#34;, &#34;width = &#34;, rectangle.width,
</span></span><span class=line><span class=cl>                        &#34; height = &#34;, rectangle.height)
</span></span><span class=line><span class=cl>change(rectangle)
</span></span><span class=line><span class=cl>print(&#34;after change:&#34;, &#34;width = &#34;, rectangle.width,
</span></span><span class=line><span class=cl>                       &#34; height =&#34;, rectangle.height)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--&gt; output
</span></span><span class=line><span class=cl>before change: width = 20  height = 15
</span></span><span class=line><span class=cl>after  change: width = 40  height = 30
</span></span></code></pre></td></tr></table></div></div><a href=#函数返回值><h2 id=函数返回值><span class=hanchor arialabel=Anchor># </span>函数返回值</h2></a><p>Lua 具有一项与众不同的特性，允许函数返回多个值。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>swap</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>   
</span></span><span class=line><span class=cl>    <span class=c1>-- 定义函数 swap，实现两个变量交换值</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>b</span><span class=p>,</span> <span class=n>a</span>              
</span></span><span class=line><span class=cl>    <span class=c1>-- 按相反顺序返回变量的值</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>y</span> <span class=o>=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl><span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>swap</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>           <span class=c1>-- 调用 swap 函数</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>                 <span class=c1>--&gt; output   20     1</span>
</span></span></code></pre></td></tr></table></div></div><p>当函数返回值的个数和接收返回值的变量的个数不一致时，Lua 也会自动调整参数个数调整规则：</p><ul><li><p>若返回值个数大于接收变量的个数，多余的返回值会被忽略掉；</p></li><li><p>若返回值个数小于参数个数，从左向右，没有被返回值初始化的变量会被初始化为 nil。</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>init</span><span class=p>()</span>             
</span></span><span class=line><span class=cl>    <span class=c1>--init 函数 返回两个值 1 和 &#34;lua&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;lua&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>z</span> <span class=o>=</span> <span class=n>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>z</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--output</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=n>lua</span> <span class=kc>nil</span>
</span></span></code></pre></td></tr></table></div></div><p>当一个函数有一个以上返回值，且函数调用不是一个列表表达式的最后一个元素，那么函数调用只会产生一个返回值, 也就是第一个返回值。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>init</span><span class=p>()</span>       <span class=c1>-- init 函数 返回两个值 1 和 &#34;lua&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;lua&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>z</span> <span class=o>=</span> <span class=n>init</span><span class=p>(),</span> <span class=mi>2</span>   <span class=c1>-- init 函数的位置不在最后，此时只返回 1</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>z</span><span class=p>)</span>              <span class=c1>--&gt;output  1  2  nil</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span> <span class=o>=</span> <span class=mi>2</span><span class=p>,</span> <span class=n>init</span><span class=p>()</span>   <span class=c1>-- init 函数的位置在最后，此时返回 1 和 &#34;lua&#34;</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>)</span>              <span class=c1>--&gt;output  2  1  lua</span>
</span></span></code></pre></td></tr></table></div></div><p>函数调用的实参列表也是一个列表表达式。考虑下面的例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;lua&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>init</span><span class=p>(),</span> <span class=mi>2</span><span class=p>)</span>   <span class=c1>--&gt;output  1  2</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>init</span><span class=p>())</span>   <span class=c1>--&gt;output  2  1  lua</span>
</span></span></code></pre></td></tr></table></div></div><p>如果你确保只取函数返回值的第一个值，可以使用括号运算符</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;lua&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>((</span><span class=n>init</span><span class=p>()),</span> <span class=mi>2</span><span class=p>)</span>   <span class=c1>--&gt;output  1  2</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=p>(</span><span class=n>init</span><span class=p>()))</span>   <span class=c1>--&gt;output  2  1</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>值得一提的是，如果实参列表中某个函数会返回多个值，同时调用者又没有显式地使用括号运算符来筛选和过滤，则这样的表达式是不能被 LuaJIT 2 所 JIT 编译的，而只能被解释执行。</strong></p><a href=#全动态函数调用><h1 id=全动态函数调用><span class=hanchor arialabel=Anchor># </span>全动态函数调用</h1></a><p>调用回调函数，并把一个数组参数作为回调函数的参数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>args</span> <span class=o>=</span> <span class=p>{...}</span> <span class=ow>or</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=n>method_name</span><span class=p>(</span><span class=n>unpack</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>table.maxn</span><span class=p>(</span><span class=n>args</span><span class=p>)))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>run</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s1>&#39;run&#39;</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>attack</span><span class=p>(</span><span class=n>targetId</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s1>&#39;targetId&#39;</span><span class=p>,</span> <span class=n>targetId</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>do_action</span><span class=p>(</span><span class=n>method</span><span class=p>,</span> <span class=p>...)</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>args</span> <span class=o>=</span> <span class=p>{...}</span> <span class=ow>or</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=n>method</span><span class=p>(</span><span class=n>unpack</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>table.maxn</span><span class=p>(</span><span class=n>args</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>do_action</span><span class=p>(</span><span class=n>run</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>         <span class=c1>-- output: run 1 2</span>
</span></span><span class=line><span class=cl><span class=n>do_action</span><span class=p>(</span><span class=n>attack</span><span class=p>,</span> <span class=mi>1111</span><span class=p>)</span>      <span class=c1>-- output: targetId    1111</span>
</span></span></code></pre></td></tr></table></div></div><a href=#模块><h1 id=模块><span class=hanchor arialabel=Anchor># </span>模块</h1></a><p>从 Lua 5.1 语言添加了对模块和包的支持。一<strong>个 Lua 模块的数据结构是用一个 Lua 值（通常是一个 Lua 表或者 Lua 函数）</strong>。<strong>一个 Lua 模块代码就是一个会返回这个 Lua 值的代码块</strong></p><ul><li><p>可以使用内建函数 <code>require()</code> 来加载和缓存模块。</p></li><li><p>简单的说，一个代码模块就是一个程序库，可以通过 <code>require</code> 来加载。<strong>模块加载后的结果通过是一个 Lua table</strong></p></li><li><p><strong>这个表就像是一个命名空间</strong>，其内容就是模块中导出的所有东西，<strong>比如函数和变量</strong>。<code>require</code> 函数会返回 Lua 模块加载后的结果，即用于表示该 Lua 模块的 Lua 值。</p></li></ul><p>Lua 提供了一个名为 <code>require</code> 的函数用来加载模块。<strong>要加载一个模块，只需要简单地调用</strong> <strong><code>require</code></strong> <strong>&ldquo;file&rdquo; 就可以了，file 指模块所在的文件名</strong>。这个调用会返回一个由模块函数组成的 table，并且还会定义一个包含该 table 的全局变量。</p><p>在 Lua 中创建一个模块最简单的方法是：<strong>创建一个 table，并将所有需要导出的函数放入其中，最后返回这个 table 就可以了。相当于将导出的函数作为 table 的一个字段，在 Lua 中函数是第一类值，提供了天然的优势。</strong></p><ul><li>创建 my. Lua</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>_M</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>get_name</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=s2>&#34;Lucy&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>_M</span><span class=p>.</span><span class=nf>greeting</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s2>&#34;hello &#34;</span> <span class=o>..</span> <span class=n>get_name</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>return</span> <span class=n>_M</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>把下面代码保存在文件 main. Lua 中，然后执行 main. Lua，调用上述模块。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>my_module</span> <span class=o>=</span> <span class=n>require</span><span class=p>(</span><span class=s2>&#34;my&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>my_module.greeting</span><span class=p>()</span>     <span class=c1>--&gt;output: hello Lucy</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><ul><li><p>对于需要导出给外部使用的公共模块，处于安全考虑，<strong>是要避免全局变量的出现</strong>。我们可以使用 lj-releng 或 luacheck 工具完成全局变量的检测。至于如何做，到后面再讲。</p></li><li><p>另一个要注意的是，由于在 LuaJIT 中，<strong>require 函数内不能进行上下文切换</strong>，<strong>所以不能够在模块的顶级上下文中调用 cosocket 一类的 API</strong>。否则会报 <code>attempt to yield across C-call boundary</code> 错误。</p></li></ul></blockquote><a href=#string><h1 id=string><span class=hanchor arialabel=Anchor># </span>String</h1></a><p>Lua 字符串总是由字节构成的。Lua 核心并不尝试理解具体的字符集编码（比如 GBK 和 UTF-8 这样的多字节字符编码）</p><p>Lua 字符串内部用来标识各个组成字节的下标是从 1 开始的，这不同于像 C 和 Perl 这样的编程语言。这样数字符串位置的时候再也不用调整，对于非专业的开发者来说可能也是一个好事情，<strong>string.Sub (str, 3, 7) 直接表示从第三个字符开始到第七个字符（含）为止的子串。</strong></p><a href=#stringbyte-s--i--j-><h2 id=stringbyte-s--i--j-><span class=hanchor arialabel=Anchor># </span><strong>string.Byte (s [, i [, j ]])</strong></h2></a><p>返回字符 s[i]、s[i + 1]、s[i + 2]、······、s[j] 所对应的 ASCII 码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.byte</span><span class=p>(</span><span class=s2>&#34;abc&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.byte</span><span class=p>(</span><span class=s2>&#34;abc&#34;</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span> <span class=c1>-- 缺少第三个参数，第三个参数默认与第二个相同，此时为 3</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.byte</span><span class=p>(</span><span class=s2>&#34;abc&#34;</span><span class=p>))</span>    <span class=c1>-- 缺少第二个和第三个参数，此时这两个参数都默认为 1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt;output</span>
</span></span><span class=line><span class=cl><span class=mi>97</span>    <span class=mi>98</span>    <span class=mi>99</span>
</span></span><span class=line><span class=cl><span class=mi>99</span>
</span></span><span class=line><span class=cl><span class=mi>97</span>
</span></span></code></pre></td></tr></table></div></div><a href=#string-char-><h2 id=string-char-><span class=hanchor arialabel=Anchor># </span><strong>string. Char (&mldr;)</strong></h2></a><p>接收 0 个或更多的整数（整数范围：0~255），返回这些整数所对应的 ASCII 码字符组成的字符串。当参数为空时，默认是一个 0。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.char</span><span class=p>(</span><span class=mi>96</span><span class=p>,</span> <span class=mi>97</span><span class=p>,</span> <span class=mi>98</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.char</span><span class=p>())</span>        <span class=c1>-- 参数为空，默认是一个0，-- 你可以用string.byte(string.char())测试一下print(string.char(65, 66))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt; output</span>
</span></span><span class=line><span class=cl><span class=err>`</span><span class=n>ab</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>AB</span>
</span></span></code></pre></td></tr></table></div></div><a href=#stringupper-s><h2 id=stringupper-s><span class=hanchor arialabel=Anchor># </span><strong>string.Upper (s)</strong></h2></a><p>接收一个字符串 s，返回一个把所有小写字母变成大写字母的字符串。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.upper</span><span class=p>(</span><span class=s2>&#34;Hello Lua&#34;</span><span class=p>))</span>  <span class=c1>--&gt;output  HELLO LUA</span>
</span></span></code></pre></td></tr></table></div></div><a href=#stringlower-s><h2 id=stringlower-s><span class=hanchor arialabel=Anchor># </span><strong>string.Lower (s)</strong></h2></a><p>接收一个字符串 s，返回一个把所有大写字母变成小写字母的字符串。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.lower</span><span class=p>(</span><span class=s2>&#34;Hello Lua&#34;</span><span class=p>))</span>  <span class=c1>--&gt;output   hello lua</span>
</span></span></code></pre></td></tr></table></div></div><a href=#stringlen-s><h2 id=stringlen-s><span class=hanchor arialabel=Anchor># </span><strong>string.Len (s)</strong></h2></a><p>接收一个字符串，返回它的长度。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.len</span><span class=p>(</span><span class=s2>&#34;hello lua&#34;</span><span class=p>))</span> <span class=c1>--&gt;output  9</span>
</span></span></code></pre></td></tr></table></div></div><p>使用此函数是不推荐的。应当总是使用 <code>#</code> 运算符来获取 Lua 字符串的长度</p><a href=#stringfind-s-p--init--plain><h2 id=stringfind-s-p--init--plain><span class=hanchor arialabel=Anchor># </span><strong>string.Find (s, p [, init [, plain]])</strong></h2></a><p>在 s 字符串中第一次匹配 p 字符串。若匹配成功，则返回 p 字符串在 s 字符串中出现的开始位置和结束位置；若匹配失败，则返回 nil,</p><p>第三个参数第三个参数 init 默认为 1，并且可以为负整数，</p><p>当 init 为负数时，表示从 s 字符串的 string.Len (s) + init + 1 索引处开始向后匹配字符串 p 。</p><p>第四个参数默认为 false，当其为 true 时，只会把 p 看成一个字符串对待。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>find</span> <span class=o>=</span> <span class=n>string.find</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;abc cba&#34;</span><span class=p>,</span> <span class=s2>&#34;ab&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;abc cba&#34;</span><span class=p>,</span> <span class=s2>&#34;ab&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>     <span class=c1>-- 从索引为2的位置开始匹配字符串：ab</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;abc cba&#34;</span><span class=p>,</span> <span class=s2>&#34;ba&#34;</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>))</span>    <span class=c1>-- 从索引为7的位置开始匹配字符串：ba</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;abc cba&#34;</span><span class=p>,</span> <span class=s2>&#34;ba&#34;</span><span class=p>,</span> <span class=o>-</span><span class=mi>3</span><span class=p>))</span>    <span class=c1>-- 从索引为5的位置开始匹配字符串：ba</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;abc cba&#34;</span><span class=p>,</span> <span class=s2>&#34;(%a+)&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span>  <span class=c1>-- 从索引为1处匹配最长连续且只含字母的字符串</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;abc cba&#34;</span><span class=p>,</span> <span class=s2>&#34;(%a+)&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=kc>true</span><span class=p>))</span> <span class=c1>--从索引为1的位置开始匹配字符串：(%a+)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt;output</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=mi>6</span>   <span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=mi>3</span>   <span class=n>abc</span>
</span></span><span class=line><span class=cl><span class=kc>nil</span>
</span></span></code></pre></td></tr></table></div></div><a href=#stringformat-formatstring-><h2 id=stringformat-formatstring-><span class=hanchor arialabel=Anchor># </span><strong>string.Format (formatstring, &mldr;)</strong></h2></a><p>按照格式化参数 formatstring，返回后面 <code>...</code> 内容的格式化版本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>print(string.format(&#34;%.4f&#34;, 3.1415926))     -- 保留4位小数
</span></span><span class=line><span class=cl>print(string.format(&#34;%d %x %o&#34;, 31, 31, 31))-- 十进制数31转换成不同进制
</span></span><span class=line><span class=cl>d = 29; m = 7; y = 2015                     -- 一行包含几个语句，用；分开
</span></span><span class=line><span class=cl>print(string.format(&#34;%s %02d/%02d/%d&#34;, &#34;today is:&#34;, d, m, y))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--&gt;output
</span></span><span class=line><span class=cl>3.1416
</span></span><span class=line><span class=cl>31 1f 37
</span></span><span class=line><span class=cl>today is: 29/07/2015
</span></span></code></pre></td></tr></table></div></div><a href=#stringmatch-s-p--init><h2 id=stringmatch-s-p--init><span class=hanchor arialabel=Anchor># </span><strong>string.Match (s, p [, init])</strong></h2></a><p>在字符串 s 中匹配（模式）字符串 p，若匹配成功，则返回目标字符串中与模式匹配的子串；否则返回 nil。第三个参数 init 默认为 1，并且可以为负整数，当 init 为负数时，表示从 s 字符串的 string.Len (s) + init + 1 索引处开始向后匹配字符串 p。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.match</span><span class=p>(</span><span class=s2>&#34;hello lua&#34;</span><span class=p>,</span> <span class=s2>&#34;lua&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.match</span><span class=p>(</span><span class=s2>&#34;lua lua&#34;</span><span class=p>,</span> <span class=s2>&#34;lua&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>  <span class=c1>--匹配后面那个luaprint(string.match(&#34;lua lua&#34;, &#34;hello&#34;))</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.match</span><span class=p>(</span><span class=s2>&#34;today is 27/7/2015&#34;</span><span class=p>,</span> <span class=s2>&#34;%d+/%d+/%d+&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt;output</span>
</span></span><span class=line><span class=cl><span class=n>lua</span>
</span></span><span class=line><span class=cl><span class=n>lua</span>
</span></span><span class=line><span class=cl><span class=n>nil27</span><span class=o>/</span><span class=mi>7</span><span class=o>/</span><span class=mi>2015</span>
</span></span></code></pre></td></tr></table></div></div><a href=#stringgmatch-s-p><h2 id=stringgmatch-s-p><span class=hanchor arialabel=Anchor># </span><strong>string.Gmatch (s, p)</strong></h2></a><p>返回一个迭代器函数，通过这个迭代器函数可以遍历到在字符串 s 中出现模式串 p 的所有地方。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=s2>&#34;hello world from Lua&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>for</span> <span class=n>w</span> <span class=kr>in</span> <span class=n>string.gmatch</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=s2>&#34;%a+&#34;</span><span class=p>)</span> <span class=kr>do</span>  <span class=c1>--匹配最长连续且只含字母的字符串</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>w</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt;output</span>
</span></span><span class=line><span class=cl><span class=n>hello</span>
</span></span><span class=line><span class=cl><span class=n>world</span>
</span></span><span class=line><span class=cl><span class=n>from</span>
</span></span><span class=line><span class=cl><span class=n>Lua</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>t</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=s2>&#34;from=world, to=Lua&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=kr>in</span> <span class=n>string.gmatch</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=s2>&#34;(%a+)=(%a+)&#34;</span><span class=p>)</span> <span class=kr>do</span>  <span class=c1>--匹配两个最长连续且只含字母的</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span>                                    <span class=c1>--字符串，它们之间用等号连接</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=kr>in</span> <span class=n>pairs</span><span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span> <span class=p>(</span><span class=n>k</span><span class=p>,</span><span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt;output</span>
</span></span><span class=line><span class=cl><span class=n>to</span>      <span class=n>Lua</span>
</span></span><span class=line><span class=cl><span class=n>from</span>    <span class=n>worl</span>
</span></span></code></pre></td></tr></table></div></div><a href=#stringrep-s-n><h2 id=stringrep-s-n><span class=hanchor arialabel=Anchor># </span><strong>string.Rep (s, n)</strong></h2></a><p>返回字符串 s 的 n 次拷贝。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.rep</span><span class=p>(</span><span class=s2>&#34;abc&#34;</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--拷贝3次&#34;abc&#34;--&gt;output  abcabcabc</span>
</span></span></code></pre></td></tr></table></div></div><a href=#stringsub-s-i--j><h2 id=stringsub-s-i--j><span class=hanchor arialabel=Anchor># </span><strong>string.Sub (s, i [, j])</strong></h2></a><p>返回字符串 s 中，索引 i 到索引 j 之间的子字符串。当 j 缺省时，默认为 -1，也就是字符串 s 的最后位置。I 可以为负数。当索引 i 在字符串 s 的位置在索引 j 的后面时，将返回一个空字符串。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.sub</span><span class=p>(</span><span class=s2>&#34;Hello Lua&#34;</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>7</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.sub</span><span class=p>(</span><span class=s2>&#34;Hello Lua&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.sub</span><span class=p>(</span><span class=s2>&#34;Hello Lua&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span>    <span class=c1>--看到返回什么了吗print(string.sub(&#34;Hello Lua&#34;, -3, -1))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt;output</span>
</span></span><span class=line><span class=cl><span class=n>lo</span> <span class=n>L</span>
</span></span><span class=line><span class=cl><span class=n>ello</span> <span class=n>Lua</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Lua</span>
</span></span></code></pre></td></tr></table></div></div><a href=#stringgsub-s-p-r--n><h2 id=stringgsub-s-p-r--n><span class=hanchor arialabel=Anchor># </span><strong>string.Gsub (s, p, r [, n])</strong></h2></a><p>将目标字符串 s 中所有的子串 p 替换成字符串 r。可选参数 n，表示限制替换次数。返回值有两个，第一个是被替换后的字符串，第二个是替换了多少次。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>print(string.gsub(&#34;Lua Lua Lua&#34;, &#34;Lua&#34;, &#34;hello&#34;))
</span></span><span class=line><span class=cl>print(string.gsub(&#34;Lua Lua Lua&#34;, &#34;Lua&#34;, &#34;hello&#34;, 2)) --指明第四个参数--&gt;output
</span></span><span class=line><span class=cl>hello hello hello   3
</span></span><span class=line><span class=cl>hello hello Lua     2
</span></span></code></pre></td></tr></table></div></div><a href=#string-reverse-s><h2 id=string-reverse-s><span class=hanchor arialabel=Anchor># </span><strong>string. Reverse (s)</strong></h2></a><p>接收一个字符串 s，返回这个字符串的反转</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>string.reverse</span><span class=p>(</span><span class=s2>&#34;Hello Lua&#34;</span><span class=p>))</span>  <span class=c1>--&gt; output: auL olleH</span>
</span></span></code></pre></td></tr></table></div></div><a href=#table><h1 id=table><span class=hanchor arialabel=Anchor># </span>Table</h1></a><a href=#下标从-1-开始><h2 id=下标从-1-开始><span class=hanchor arialabel=Anchor># </span><strong>下标从 1 开始</strong></h2></a><p>数组下标从 1 开始计数。</p><p>而 Lua 最初设计是一种类似 XML 的数据描述语言，所以索引（index）反应的是数据在里面的位置，而不是偏移量。</p><p>在初始化一个数组的时候，<strong>若不显式地用键值对方式赋值，则会默认用数字作为下标</strong>，从 1 开始。由于在 <em>Lua</em> 内部实际采用哈希表和数组分别保存键值对、普通值，所以不推荐混合使用这两种赋值方式</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>color</span><span class=o>=</span><span class=p>{</span><span class=n>first</span><span class=o>=</span><span class=s2>&#34;red&#34;</span><span class=p>,</span> <span class=s2>&#34;blue&#34;</span><span class=p>,</span> <span class=n>third</span><span class=o>=</span><span class=s2>&#34;green&#34;</span><span class=p>,</span> <span class=s2>&#34;yellow&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>color</span><span class=p>[</span><span class=s2>&#34;first&#34;</span><span class=p>])</span>                 <span class=c1>--&gt; output: red</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>color</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>                       <span class=c1>--&gt; output: blue</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>color</span><span class=p>[</span><span class=s2>&#34;third&#34;</span><span class=p>])</span>                 <span class=c1>--&gt; output: green</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>color</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>                       <span class=c1>--&gt; output: yellow</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>color</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span>                       <span class=c1>--&gt; output: nil</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p><strong>当我们把 table 当作栈或者队列使用的时候，容易犯错，追加到 table 的末尾用的是</strong> <strong><code>s[#s+1] = something</code>****, 而不是</strong> <strong><code>s[#s] = something</code></strong></p></li><li><p>而且如果这个 something 是一个 nil 的话**，会导致这一次压栈（或者入队列）没有存入任何东西**， s 的值没有变</p></li><li><p>如果 <code>s = { 1, 2, 3, 4, 5, 6 }</code>，你令 <code>s[4] = nil</code>， s 会令你“匪夷所思”地变成 3。</p></li></ul><a href=#table-getn-获取长度><h2 id=table-getn-获取长度><span class=hanchor arialabel=Anchor># </span><strong>table. Getn 获取长度</strong></h2></a><p>取长度操作符写作一元操作 。字符串的长度是它的字节数（就是以一个字符一个字节计算的字符串长度）</p><ul><li><p>对于常规的数组，里面从 1 到 n 放着一些非空的值的时候，它的长度就精确的为 n，即最后一个值的下标</p></li><li><p>如果数组有一个“空洞”（<strong>就是说，nil 值被夹在非空值之间</strong>），<strong>那么 t 可能是指向任何一个是 nil 值的前一个位置的下标</strong></p></li><li><p>这也就说明对于有“空洞”的情况，table 的长度存在一定的 <strong>不可确定性</strong></p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>tblTest1</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;Test1 &#34;</span> <span class=o>..</span> <span class=n>table.getn</span><span class=p>(</span><span class=n>tblTest1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>tblTest2</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=kc>nil</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;Test2 &#34;</span> <span class=o>..</span> <span class=n>table.getn</span><span class=p>(</span><span class=n>tblTest2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>tblTest3</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>2</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;Test3 &#34;</span> <span class=o>..</span> <span class=n>table.getn</span><span class=p>(</span><span class=n>tblTest3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>tblTest4</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=kc>nil</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;Test4 &#34;</span> <span class=o>..</span> <span class=n>table.getn</span><span class=p>(</span><span class=n>tblTest4</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>tblTest5</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=kc>nil</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;Test5 &#34;</span> <span class=o>..</span> <span class=n>table.getn</span><span class=p>(</span><span class=n>tblTest5</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>tblTest6</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=kc>nil</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;Test6 &#34;</span> <span class=o>..</span> <span class=n>table.getn</span><span class=p>(</span><span class=n>tblTest6</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>我们使用 Lua 5.1 和 LuaJIT 2.1 分别执行这个用例，结果如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=o>#</span> <span class=n>lua</span> <span class=n>test.lua</span>
</span></span><span class=line><span class=cl><span class=n>Test1</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>Test2</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Test3</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>Test4</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Test5</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>Test6</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=o>#</span> <span class=n>luajit</span> <span class=n>test.lua</span>
</span></span><span class=line><span class=cl><span class=n>Test1</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>Test2</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Test3</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Test4</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Test5</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Test6</span> <span class=mi>1</span>
</span></span></code></pre></td></tr></table></div></div><p>不要在 Lua 的 table 中使用 nil 值，<strong>如果一个元素要删除，直接 remove，不要用 nil 去代替</strong>。</p><a href=#table-concat-table--sep--i--j---><h2 id=table-concat-table--sep--i--j---><span class=hanchor arialabel=Anchor># </span><strong>table. Concat (table [, sep [, i [, j ] ] ])</strong></h2></a><p>对于元素是 string 或者 number 类型的表 table，返回 <code>table[i]..sep..table[i+1] ··· sep..table[j]</code> 连接成的字符串。填充字符串 sep 默认为空白字符串。起始索引位置 i 默认为 1，结束索引位置 j 默认是 table 的长度。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>a</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=s2>&#34;hello&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>table.concat</span><span class=p>(</span><span class=n>a</span><span class=p>))</span>              <span class=c1>-- output: 135hello</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>table.concat</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=s2>&#34;|&#34;</span><span class=p>))</span>         <span class=c1>-- output: 1|3|5|hello</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>table.concat</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span>   <span class=c1>-- output:</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>table.concat</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>))</span>   <span class=c1>-- output: 3 5 hello</span>
</span></span></code></pre></td></tr></table></div></div><a href=#table-insert-table-pos--value><h2 id=table-insert-table-pos--value><span class=hanchor arialabel=Anchor># </span><strong>table. Insert (table, [pos ,] value)</strong></h2></a><p>在（数组型）表 table 的 pos 索引位置插入 value，其它元素向后移动到空的地方。Pos 的默认值是表的长度加一，即默认是插在表的最后</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>a</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>8</span><span class=p>}</span>             <span class=c1>--a[1] = 1,a[2] = 8</span>
</span></span><span class=line><span class=cl><span class=n>table.insert</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>   <span class=c1>--在表索引为1处插入3</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>table.insert</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>    <span class=c1>--在表的最后插入10</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt;output</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=mi>1</span>    <span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>    <span class=mi>1</span>    <span class=mi>8</span>    <span class=mi>10</span>
</span></span></code></pre></td></tr></table></div></div><a href=#table-maxn-table><h2 id=table-maxn-table><span class=hanchor arialabel=Anchor># </span><strong>table. Maxn (table)</strong></h2></a><p>返回（数组型）表 table 的最大索引编号；如果此表没有正的索引编号，返回 0。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>a</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>table.maxn</span><span class=p>(</span><span class=n>a</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>table.maxn</span><span class=p>(</span><span class=n>a</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt;output05</span>
</span></span></code></pre></td></tr></table></div></div><a href=#table-remove-table--pos><h2 id=table-remove-table--pos><span class=hanchor arialabel=Anchor># </span><strong>table. Remove (table [, pos])</strong></h2></a><p>在表 table 中删除索引为 pos（pos 只能是 number 型）的元素，并返回这个被删除的元素，它后面所有元素的索引值都会减一。Pos 的默认值是表的长度，即默认是删除表的最后一个元素。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>a</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>table.remove</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span> <span class=c1>--删除速索引为1的元素print(a[1], a[2], a[3], a[4])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>table.remove</span><span class=p>(</span><span class=n>a</span><span class=p>))</span>   <span class=c1>--删除最后一个元素print(a[1], a[2], a[3], a[4])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt;output12    3    4    nil42    3    nil    nil</span>
</span></span></code></pre></td></tr></table></div></div><a href=#table-sort-table--comp><h2 id=table-sort-table--comp><span class=hanchor arialabel=Anchor># </span><strong>table. Sort (table [, comp])</strong></h2></a><p>按照给定的比较函数 comp 给表 table 排序，也就是从 table[1] 到 table[n]，这里 n 表示 table 的长度。比较函数有两个参数，如果希望第一个参数排在第二个的前面，就应该返回 true，否则返回 false。如果比较函数 comp 没有给出，默认从小到大排序。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=kr>function</span> <span class=nf>compare</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=c1>--从大到小排序</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>x</span> <span class=o>&gt;</span> <span class=n>y</span>         <span class=c1>--如果第一个参数大于第二个就返回true，否则返回false</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>a</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>25</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>table.sort</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>           <span class=c1>--默认从小到大排序</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>5</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>table.sort</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>compare</span><span class=p>)</span> <span class=c1>--使用比较函数进行排序</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>5</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>--&gt;output</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>    <span class=mi>3</span>    <span class=mi>4</span>    <span class=mi>7</span>    <span class=mi>25</span>
</span></span><span class=line><span class=cl><span class=mi>25</span>    <span class=mi>7</span>    <span class=mi>4</span>    <span class=mi>3</span>    <span class=mi>1</span>
</span></span></code></pre></td></tr></table></div></div><a href=#其他><h2 id=其他><span class=hanchor arialabel=Anchor># </span>其他</h2></a><p>LuaJIT 2.1 新增加的 <code>table.new</code> 和 <code>table.clear</code> 函数是非常有用的。前者主要用来预分配 Lua table 空间，后者主要用来高效的释放 table 空间，并且它们都是可以被 JIT 编译的</p><a href=#日期时间><h1 id=日期时间><span class=hanchor arialabel=Anchor># </span>日期时间</h1></a><p>函数 time、date 和 difftime 提供了所有的日期和时间功能。</p><p>在 OpenResty 的世界里，不推荐使用这里的标准时间函数，因为这些函数通常会引发不止一个昂贵的系统调用，同时无法为 LuaJIT JIT 编译，对性能造成较大影响。推荐使用 ngx_lua 模块提供的带缓存的时间接口，如 <code>ngx.today</code>, <code>ngx.time</code>, <code>ngx.utctime</code>, <code>ngx.localtime</code>, <code>ngx.now</code>, <code>ngx.http_time</code>，以及 <code>ngx.cookie_time</code> 等。</p><a href=#os-time-table><h2 id=os-time-table><span class=hanchor arialabel=Anchor># </span><strong>os. Time ([table])</strong></h2></a><p>如果不使用参数 table 调用 time 函数，</p><ul><li><p>它会返回当前的时间和日期（它表示从某一时刻到现在的秒数）。</p></li><li><p>如果用 table 参数，它会返回一个数字，表示该 table 中所描述的日期和时间（它表示从某一时刻到 table 中描述日期和时间的秒数）。Table 的字段如下：</p></li></ul><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>字段名称</td><td>取值范围</td></tr><tr><td>year</td><td>四位数字</td></tr><tr><td>month</td><td>1&ndash;12</td></tr><tr><td>day</td><td>1&ndash;31</td></tr><tr><td>hour</td><td>0&ndash;23</td></tr><tr><td>min</td><td>0&ndash;59</td></tr><tr><td>sec</td><td>0&ndash;61</td></tr><tr><td>isdst</td><td>boolean（true 表示夏令时）</td></tr></tbody></table><p>对于 time 函数，如果参数为 table，那么 table 中必须含有 year、month、day 字段。其他字缺省时段默认为中午（12:00:00）。</p><blockquote><p>示例代码：（地点为北京）</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>print(os.time())    --&gt;output  1438243393
</span></span><span class=line><span class=cl>a = { year = 1970, month = 1, day = 1, hour = 8, min = 1 }
</span></span><span class=line><span class=cl>print(os.time(a))   --&gt;output  60
</span></span></code></pre></td></tr></table></div></div><a href=#os-difftime-t-2-t-1><h2 id=os-difftime-t-2-t-1><span class=hanchor arialabel=Anchor># </span><strong>os. Difftime (t 2, t 1)</strong></h2></a><p>返回 t 1 到 t 2 的时间差，单位为秒。</p><blockquote><p>示例代码:</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>local day1 = { year = 2015, month = 7, day = 30 }
</span></span><span class=line><span class=cl>local t1 = os.time(day1)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>local day2 = { year = 2015, month = 7, day = 31 }
</span></span><span class=line><span class=cl>local t2 = os.time(day2)
</span></span><span class=line><span class=cl>print(os.difftime(t2, t1))   --&gt;output  86400
</span></span></code></pre></td></tr></table></div></div><a href=#os-date-format--time><h2 id=os-date-format--time><span class=hanchor arialabel=Anchor># </span><strong>os. Date ([format [, time]])</strong></h2></a><p>把一个表示日期和时间的数值，转换成更高级的表现形式。</p><ul><li><p>其第一个参数 format 是一个格式化字符串，描述了要返回的时间形式。</p></li><li><p>第二个参数 time 就是日期和时间的数字表示，缺省时默认为当前的时间。</p></li><li><p>使用格式字符 &ldquo;*t&rdquo;，创建一个时间表。</p></li></ul><blockquote><p>示例代码：</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>local tab1 = os.date(&#34;*t&#34;)  --返回一个描述当前日期和时间的表
</span></span><span class=line><span class=cl>local ans1 = &#34;{&#34;
</span></span><span class=line><span class=cl>for k, v in pairs(tab1) do  --把tab1转换成一个字符串
</span></span><span class=line><span class=cl>    ans1 = string.format(&#34;%s %s = %s,&#34;, ans1, k, tostring(v))
</span></span><span class=line><span class=cl>end
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ans1 = ans1 .. &#34;}&#34;
</span></span><span class=line><span class=cl>print(&#34;tab1 = &#34;, ans1)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>local tab2 = os.date(&#34;*t&#34;, 360)  --返回一个描述日期和时间数为360秒的表
</span></span><span class=line><span class=cl>local ans2 = &#34;{&#34;
</span></span><span class=line><span class=cl>for k, v in pairs(tab2) do      --把tab2转换成一个字符串
</span></span><span class=line><span class=cl>    ans2 = string.format(&#34;%s %s = %s,&#34;, ans2, k, tostring(v))
</span></span><span class=line><span class=cl>end
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ans2 = ans2 .. &#34;}&#34;
</span></span><span class=line><span class=cl>print(&#34;tab2 = &#34;, ans2)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--&gt;output
</span></span><span class=line><span class=cl>tab1 = { hour = 17, min = 28, wday = 5, day = 30, month = 7, year = 2015, sec = 10, yday = 211, isdst = false,}
</span></span><span class=line><span class=cl>tab2 = { hour = 8, min = 6, wday = 5, day = 1, month = 1, year = 1970, sec = 0, yday = 1, isdst = false,}
</span></span></code></pre></td></tr></table></div></div><p>该表中除了使用到了 time 函数参数 table 的字段外，这还提供了星期（wday，星期天为 1）和一年中的第几天（yday，一月一日为 1）。除了使用 &ldquo;*t&rdquo; 格式字符串外，如果使用带标记（见下表）的特殊字符串，os. Date 函数会将相应的标记位以时间信息进行填充，得到一个包含时间的字符串。表如下：</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>格式字符</td><td>含义</td></tr><tr><td>%a</td><td>一星期中天数的简写（例如：Wed）</td></tr><tr><td>%A</td><td>一星期中天数的全称（例如：Wednesday）</td></tr><tr><td>%b</td><td>月份的简写（例如：Sep）</td></tr><tr><td>%B</td><td>月份的全称（例如：September）</td></tr><tr><td>%c</td><td>日期和时间（例如：07/30/15 16:57:24）</td></tr><tr><td>%d</td><td>一个月中的第几天[01 ~ 31]</td></tr><tr><td>%H</td><td>24 小时制中的小时数[00 ~ 23]</td></tr><tr><td>%I</td><td>12 小时制中的小时数[01 ~ 12]</td></tr><tr><td>%j</td><td>一年中的第几天[001 ~ 366]</td></tr><tr><td>%M</td><td>分钟数[00 ~ 59]</td></tr><tr><td>%m</td><td>月份数[01 ~ 12]</td></tr><tr><td>%p</td><td>“上午（am）”或“下午（pm）”</td></tr><tr><td>%S</td><td>秒数[00 ~ 59]</td></tr><tr><td>%w</td><td>一星期中的第几天[1 ~ 7 = 星期天 ~ 星期六]</td></tr><tr><td>%x</td><td>日期（例如：07/30/15）</td></tr><tr><td>%X</td><td>时间（例如：16:57:24）</td></tr><tr><td>%y</td><td>两位数的年份[00 ~ 99]</td></tr><tr><td>%Y</td><td>完整的年份（例如：2015）</td></tr><tr><td>%%</td><td>字符&rsquo;%&rsquo;</td></tr></tbody></table><blockquote><p>示例代码：</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>print(os.date(&#34;today is %A, in %B&#34;))
</span></span><span class=line><span class=cl>print(os.date(&#34;now is %x %X&#34;))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--&gt;output
</span></span><span class=line><span class=cl>today is Thursday, in July
</span></span><span class=line><span class=cl>now is 07/30/15 17:39:22
</span></span></code></pre></td></tr></table></div></div><a href=#数学库><h1 id=数学库><span class=hanchor arialabel=Anchor># </span>数学库</h1></a><p>Ua 数学库由一组标准的数学函数构成。数学库的引入丰富了 Lua 编程语言的功能，同时也方便了程序的编写。常用数学函数见下表：</p><table><thead><tr><th>asd</th><th>sdfa</th></tr></thead><tbody><tr><td>函数名</td><td>函数功能</td></tr><tr><td>math.Rad (x)</td><td>角度 x 转换成弧度</td></tr><tr><td>math.Deg (x)</td><td>弧度 x 转换成角度</td></tr><tr><td>math.Max (x, &mldr;)</td><td>返回参数中值最大的那个数，参数必须是 number 型</td></tr><tr><td>math.Min (x, &mldr;)</td><td>返回参数中值最小的那个数，参数必须是 number 型</td></tr><tr><td>math. Random ([m [, n]])</td><td>不传入参数时，返回一个在区间[0,1)内均匀分布的伪随机实数；只使用一个整数参数 m 时，返回一个在区间[1, m]内均匀分布的伪随机整数；使用两个整数参数时，返回一个在区间[m, n]内均匀分布的伪随机整数</td></tr><tr><td>math. Randomseed (x)</td><td>为伪随机数生成器设置一个种子 x，相同的种子将会生成相同的数字序列</td></tr><tr><td>math.Abs (x)</td><td>返回 x 的绝对值</td></tr><tr><td>math.Fmod (x, y)</td><td>返回 x 对 y 取余数</td></tr><tr><td>math.Pow (x, y)</td><td>返回 x 的 y 次方</td></tr><tr><td>math.Sqrt (x)</td><td>返回 x 的算术平方根</td></tr><tr><td>math.Exp (x)</td><td>返回自然数 e 的 x 次方</td></tr><tr><td>math.Log (x)</td><td>返回 x 的自然对数</td></tr><tr><td>math. Log 10 (x)</td><td>返回以 10 为底，x 的对数</td></tr><tr><td>math.Floor (x)</td><td>返回最大且不大于 x 的整数</td></tr><tr><td>math.Ceil (x)</td><td>返回最小且不小于 x 的整数</td></tr><tr><td>math. Pi</td><td>圆周率</td></tr><tr><td>math.Sin (x)</td><td>求弧度 x 的正弦值</td></tr><tr><td>math.Cos (x)</td><td>求弧度 x 的余弦值</td></tr><tr><td>math.Tan (x)</td><td>求弧度 x 的正切值</td></tr><tr><td>math.Asin (x)</td><td>求 x 的反正弦值</td></tr><tr><td>math.Acos (x)</td><td>求 x 的反余弦值</td></tr><tr><td>math.Atan (x)</td><td>求 x 的反正切值</td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.pi</span><span class=p>)</span>           <span class=c1>--&gt;output  3.1415926535898</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.rad</span><span class=p>(</span><span class=mi>180</span><span class=p>))</span>     <span class=c1>--&gt;output  3.1415926535898</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.deg</span><span class=p>(</span><span class=n>math.pi</span><span class=p>))</span> <span class=c1>--&gt;output  180</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.sin</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>       <span class=c1>--&gt;output  0.8414709848079</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.cos</span><span class=p>(</span><span class=n>math.pi</span><span class=p>))</span> <span class=c1>--&gt;output  -1</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.tan</span><span class=p>(</span><span class=n>math.pi</span> <span class=o>/</span> <span class=mi>4</span><span class=p>))</span>  <span class=c1>--&gt;output  1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.atan</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>      <span class=c1>--&gt;output  0.78539816339745</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.asin</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>      <span class=c1>--&gt;output  0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.max</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mf>3.6</span><span class=p>,</span> <span class=mf>9.1</span><span class=p>))</span>     <span class=c1>--&gt;output  9.1</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.min</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mf>3.6</span><span class=p>,</span> <span class=mf>9.1</span><span class=p>))</span>     <span class=c1>--&gt;output  -1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.fmod</span><span class=p>(</span><span class=mf>10.1</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span>   <span class=c1>--&gt;output  1.1</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.sqrt</span><span class=p>(</span><span class=mi>360</span><span class=p>))</span>      <span class=c1>--&gt;output  18.97366596101</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.exp</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>         <span class=c1>--&gt;output  2.718281828459</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.log</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span>        <span class=c1>--&gt;output  2.302585092994</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.log10</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span>      <span class=c1>--&gt;output  1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.floor</span><span class=p>(</span><span class=mf>3.1415</span><span class=p>))</span>  <span class=c1>--&gt;output  3</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.ceil</span><span class=p>(</span><span class=mf>7.998</span><span class=p>))</span>    <span class=c1>--&gt;output  8</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 <code>math.random()</code> 函数获得伪随机数时，如果不使用 <code>math.randomseed()</code> 设置伪随机数生成种子或者设置相同的伪随机数生成种子，那么得得到的伪随机数序列是一样的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>math.randomseed</span> <span class=p>(</span><span class=mi>100</span><span class=p>)</span> <span class=c1>--把种子设置为100</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.random</span><span class=p>())</span>         <span class=c1>--&gt;output  0.0012512588885159</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.random</span><span class=p>(</span><span class=mi>100</span><span class=p>))</span>      <span class=c1>--&gt;output  57</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.random</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>360</span><span class=p>))</span> <span class=c1>--&gt;output  150</span>
</span></span></code></pre></td></tr></table></div></div><p>稍等片刻，再次运行上面的代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>math.randomseed</span> <span class=p>(</span><span class=mi>100</span><span class=p>)</span> <span class=c1>--把种子设置为100</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.random</span><span class=p>())</span>         <span class=c1>--&gt;output  0.0012512588885159</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.random</span><span class=p>(</span><span class=mi>100</span><span class=p>))</span>      <span class=c1>--&gt;output  57</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.random</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>360</span><span class=p>))</span> <span class=c1>--&gt;output  150</span>
</span></span></code></pre></td></tr></table></div></div><p>两次运行的结果一样。为了避免每次程序启动时得到的都是相同的伪随机数序列，通常是使用当前时间作为种子。</p><blockquote><p>修改上例中的代码：</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>math.randomseed</span> <span class=p>(</span><span class=n>os.time</span><span class=p>())</span>   <span class=c1>--把100换成os.time()</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.random</span><span class=p>())</span>          <span class=c1>--&gt;output 0.88369396038697</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.random</span><span class=p>(</span><span class=mi>100</span><span class=p>))</span>       <span class=c1>--&gt;output 66</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>math.random</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>360</span><span class=p>))</span>  <span class=c1>--&gt;output 228</span>
</span></span></code></pre></td></tr></table></div></div><p>稍等片刻，再次运行上面的代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>math.randomseed (os.time())   --把100换成os.time()
</span></span><span class=line><span class=cl>print(math.random())          --&gt;output 0.88946195867794
</span></span><span class=line><span class=cl>print(math.random(100))       --&gt;output 68
</span></span><span class=line><span class=cl>print(math.random(100, 360))  --&gt;output 129
</span></span></code></pre></td></tr></table></div></div><a href=#文件><h1 id=文件><span class=hanchor arialabel=Anchor># </span>文件</h1></a><p>Lua I/O 库提供两种不同的方式处理文件：隐式文件描述，显式文件描述。</p><p>这些文件 I/O 操作，<strong>在 OpenResty 的上下文中对事件循环是会产生阻塞效应</strong>。OpenResty 比较擅长的是高并发网络处理，在这个环境中，任何文件的操作，都将阻塞其他并行执行的请求。<strong>实际中的应用，在 OpenResty 项目中应尽可能让网络处理部分、文件 I/0 操作部分相互独立，不要揉和在一起</strong>。</p><a href=#隐式文件描述><h2 id=隐式文件描述><span class=hanchor arialabel=Anchor># </span><strong>隐式文件描述</strong></h2></a><p>设置一个默认的输入或输出文件，然后在这个文件上进行所有的输入或输出操作。所有的操作函数由 io 表提供。</p><blockquote><p>打开已经存在的 <code>test1.txt</code> 文件，并读取里面的内容</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>file = io.input(&#34;test1.txt&#34;)    -- 使用 io.input() 函数打开文件repeat
</span></span><span class=line><span class=cl>    line = io.read()            -- 逐行读取内容，文件结束时返回nil
</span></span><span class=line><span class=cl>    if nil == line then
</span></span><span class=line><span class=cl>        break
</span></span><span class=line><span class=cl>    end
</span></span><span class=line><span class=cl>    print(line)
</span></span><span class=line><span class=cl>until (false)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>io.close(file)                  -- 关闭文件--&gt; output
</span></span><span class=line><span class=cl>my test file
</span></span><span class=line><span class=cl>hello
</span></span><span class=line><span class=cl>lua
</span></span></code></pre></td></tr></table></div></div><blockquote><p>在 <code>test1.txt</code> 文件的最后添加一行 &ldquo;hello world&rdquo;</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>file = io.open(&#34;test1.txt&#34;, &#34;a+&#34;)   -- 使用 io.open() 函数，以添加模式打开文件
</span></span><span class=line><span class=cl>io.output(file)                     -- 使用 io.output() 函数，设置默认输出文件
</span></span><span class=line><span class=cl>io.write(&#34;\nhello world&#34;)           -- 使用 io.write() 函数，把内容写到文件
</span></span><span class=line><span class=cl>io.close(file)
</span></span></code></pre></td></tr></table></div></div><p>在相应目录下打开 <code>test1.txt</code> 文件，查看文件内容发生的变化。</p><a href=#显式文件描述><h2 id=显式文件描述><span class=hanchor arialabel=Anchor># </span><strong>显式文件描述</strong></h2></a><p>使用 file: XXX () 函数方式进行操作, 其中 file 为 io.Open () 返回的文件句柄。</p><blockquote><p>打开已经存在的 test 2. Txt 文件，并读取里面的内容</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>file = io.open(&#34;test2.txt&#34;, &#34;r&#34;)    -- 使用 io.open() 函数，以只读模式打开文件
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>for line in file:lines() do         -- 使用 file:lines() 函数逐行读取文件
</span></span><span class=line><span class=cl>    print(line)
</span></span><span class=line><span class=cl>end
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>file:close()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--&gt;output
</span></span><span class=line><span class=cl>my test2
</span></span><span class=line><span class=cl>hello lua
</span></span></code></pre></td></tr></table></div></div><blockquote><p>在 test 2. Txt 文件的最后添加一行 &ldquo;hello world&rdquo;</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>file = io.open(&#34;test2.txt&#34;, &#34;a&#34;)  -- 使用 io.open() 函数，以添加模式打开文件
</span></span><span class=line><span class=cl>file:write(&#34;\nhello world&#34;)       -- 使用 file:write() 函数，在文件末尾追加内容
</span></span><span class=line><span class=cl>file:close()
</span></span></code></pre></td></tr></table></div></div><p>在相应目录下打开 <code>test2.txt</code> 文件，查看文件内容发生的变化。</p><a href=#文件操作函数><h2 id=文件操作函数><span class=hanchor arialabel=Anchor># </span><strong>文件操作函数</strong></h2></a><a href=#io-open-filename--mode><h4 id=io-open-filename--mode><span class=hanchor arialabel=Anchor># </span><strong>io. Open (filename [, mode])</strong></h4></a><p>按指定的模式 mode，打开一个文件名为 <code>filename</code> 的文件，成功则返回文件句柄，失败则返回 nil 加错误信息。模式：</p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>模式</td><td>含义</td><td>文件不存在时</td></tr><tr><td>&ldquo;r&rdquo;</td><td>读模式 (默认)</td><td>返回 nil 加错误信息</td></tr><tr><td>&ldquo;w&rdquo;</td><td>写模式</td><td>创建文件</td></tr><tr><td>&ldquo;a&rdquo;</td><td>添加模式</td><td>创建文件</td></tr><tr><td>&ldquo;r+&rdquo;</td><td>更新模式，保存之前的数据</td><td>返回 nil 加错误信息</td></tr><tr><td>&ldquo;w+&rdquo;</td><td>更新模式，清除之前的数据</td><td>创建文件</td></tr><tr><td>&ldquo;a+&rdquo;</td><td>添加更新模式，保存之前的数据, 在文件尾进行添加</td><td>创建文件</td></tr></tbody></table><p>模式字符串后面可以有一个 &lsquo;b&rsquo;，用于在某些系统中打开二进制文件。</p><p>注意 &ldquo;w&rdquo; 和 &ldquo;wb&rdquo; 的区别</p><ul><li><p>&ldquo;w&rdquo; 表示文本文件。某些文件系统 (如 Linux 的文件系统)认为 0 x 0 A 为文本文件的换行符，Windows 的文件系统认为 0 x 0 D 0 A 为文本文件的换行符。为了兼容其他文件系统（如从 Linux 拷贝来的文件），Windows 的文件系统在写文件时，会在文件中 0 x 0 A 的前面加上 0 x 0 D。使用 &ldquo;w&rdquo;，其属性要看所在的平台。</p></li><li><p>&ldquo;wb&rdquo; 表示二进制文件。文件系统会按纯粹的二进制格式进行写操作，因此也就不存在格式转换的问题。（Linux 文件系统下 &ldquo;w&rdquo; 和 &ldquo;wb&rdquo; 没有区别）</p></li></ul><a href=#file-close-><h4 id=file-close-><span class=hanchor arialabel=Anchor># </span><strong>file: close ()</strong></h4></a><p>关闭文件。注意：当文件句柄被垃圾收集后，文件将自动关闭。句柄将变为一个不可预知的值。</p><a href=#io-close-file><h4 id=io-close-file><span class=hanchor arialabel=Anchor># </span><strong>io. Close ([file])</strong></h4></a><p>关闭文件，和 file: close () 的作用相同。没有参数 file 时，关闭默认输出文件。</p><a href=#file-flush-><h4 id=file-flush-><span class=hanchor arialabel=Anchor># </span><strong>file: flush ()</strong></h4></a><p>把写入缓冲区的所有数据写入到文件 file 中。</p><a href=#io-flush-><h4 id=io-flush-><span class=hanchor arialabel=Anchor># </span><strong>io. Flush ()</strong></h4></a><p>相当于 file: flush ()，把写入缓冲区的所有数据写入到默认输出文件。</p><a href=#io-input-file><h4 id=io-input-file><span class=hanchor arialabel=Anchor># </span><strong>io. Input ([file])</strong></h4></a><p>当使用一个文件名调用时，打开这个文件（以文本模式），并设置文件句柄为默认输入文件；当使用一个文件句柄调用时，设置此文件句柄为默认输入文件；当不使用参数调用时，返回默认输入文件句柄。</p><a href=#file-lines-><h4 id=file-lines-><span class=hanchor arialabel=Anchor># </span><strong>file: lines ()</strong></h4></a><p>返回一个迭代函数, 每次调用将获得文件中的一行内容, 当到文件尾时，将返回 nil，但不关闭文件。</p><a href=#io-lines-filename><h4 id=io-lines-filename><span class=hanchor arialabel=Anchor># </span><strong>io. Lines ([filename])</strong></h4></a><p>打开指定的文件 filename 为读模式并返回一个迭代函数, 每次调用将获得文件中的一行内容, 当到文件尾时，将返回 nil，并自动关闭文件。若不带参数时 io.Lines () 等价于 io.Input (): lines () 读取默认输入设备的内容，结束时不关闭文件。</p><a href=#io-output-file><h4 id=io-output-file><span class=hanchor arialabel=Anchor># </span><strong>io. Output ([file])</strong></h4></a><p>类似于 io. Input，但操作在默认输出文件上。</p><a href=#file-read-><h4 id=file-read-><span class=hanchor arialabel=Anchor># </span><strong>file: read (&mldr;)</strong></h4></a><p>按指定的格式读取一个文件。按每个格式将返回一个字符串或数字, 如果不能正确读取将返回 nil，若没有指定格式将指默认按行方式进行读取。格式：</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>格式</td><td>含义</td></tr><tr><td>&ldquo;*n&rdquo;</td><td>读取一个数字</td></tr><tr><td>&ldquo;*a&rdquo;</td><td>从当前位置读取整个文件。若当前位置为文件尾，则返回空字符串</td></tr><tr><td>&ldquo;*l&rdquo;</td><td>读取下一行的内容。若为文件尾，则返回 nil。(默认)</td></tr><tr><td>number</td><td>读取指定字节数的字符。若为文件尾，则返回 nil。如果 number 为 0, 则返回空字符串，若为文件尾, 则返回 nil</td></tr></tbody></table><a href=#io-read-><h4 id=io-read-><span class=hanchor arialabel=Anchor># </span><strong>io. Read (&mldr;)</strong></h4></a><p>相当于 io.Input ():read</p><a href=#io-type-obj><h4 id=io-type-obj><span class=hanchor arialabel=Anchor># </span><strong>io. Type (obj)</strong></h4></a><p>检测 obj 是否一个可用的文件句柄。如果 obj 是一个打开的文件句柄，则返回 &ldquo;file&rdquo; 如果 obj 是一个已关闭的文件句柄，则返回 &ldquo;closed file&rdquo; 如果 obj 不是一个文件句柄，则返回 nil。</p><a href=#file-write-><h4 id=file-write-><span class=hanchor arialabel=Anchor># </span><strong>file: write (&mldr;)</strong></h4></a><p>把每一个参数的值写入文件。参数必须为字符串或数字，若要输出其它值，则需通过 tostring 或 string. Format 进行转换。</p><a href=#io-write-><h4 id=io-write-><span class=hanchor arialabel=Anchor># </span><strong>io. Write (&mldr;)</strong></h4></a><p>相当于 io.Output (): write。</p><a href=#file-seek-whence--offset><h4 id=file-seek-whence--offset><span class=hanchor arialabel=Anchor># </span><strong>file: seek ([whence] [, offset])</strong></h4></a><p>设置和获取当前文件位置，成功则返回最终的文件位置 (按字节，相对于文件开头), 失败则返回 nil 加错误信息。缺省时，whence 默认为 &ldquo;cur&rdquo;，offset 默认为 0 。参数 whence：</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>whence</td><td>含义</td></tr><tr><td>&ldquo;set&rdquo;</td><td>文件开始</td></tr><tr><td>&ldquo;cur&rdquo;</td><td>文件当前位置 (默认)</td></tr><tr><td>&ldquo;end&rdquo;</td><td>文件结束</td></tr></tbody></table><a href=#file-setvbuf-mode--size><h4 id=file-setvbuf-mode--size><span class=hanchor arialabel=Anchor># </span><strong>file: setvbuf (mode [, size])</strong></h4></a><p>设置输出文件的缓冲模式。模式：</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>模式</td><td>含义</td></tr><tr><td>&ldquo;no&rdquo;</td><td>没有缓冲，即直接输出</td></tr><tr><td>&ldquo;full&rdquo;</td><td>全缓冲，即当缓冲满后才进行输出操作 (也可调用 flush 马上输出)</td></tr><tr><td>&ldquo;line&rdquo;</td><td>以行为单位，进行输出</td></tr></tbody></table><p>最后两种模式，size 可以指定缓冲的大小（按字节），忽略 size 将自动调整为最佳的大小。</p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://googoo-s.github.io/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by googoo-s using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2023</p><ul><li><a href=https://googoo-s.github.io/>Home</a></li><li><a href=https://github.com/googoo-s>GitHub</a></li></ul></footer></div></div></body></html>