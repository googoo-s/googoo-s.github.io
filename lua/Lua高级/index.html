<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="å…ƒè¡¨ å…ƒè¡¨ (metatable) çš„è¡¨ç°è¡Œä¸ºç±»ä¼¼äº C++ è¯­è¨€ä¸­çš„æ“ä½œç¬¦é‡è½½ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é‡è½½ &ldquo;__add&rdquo; å…ƒæ–¹æ³• (metamethod)ï¼Œæ¥è®¡ç®—ä¸¤ä¸ª Lua æ•°ç»„çš„å¹¶é›†ï¼›æˆ–è€…é‡è½½ &ldquo;__index&rdquo; æ–¹æ³•ï¼Œæ¥å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„ Hash å‡½æ•°ã€‚Lua æä¾›äº†ä¸¤ä¸ªååˆ†é‡è¦çš„ç”¨æ¥å¤„ç†å…ƒè¡¨çš„æ–¹æ³•
  setmetatable(table, metatable)ï¼šæ­¤æ–¹æ³•ç”¨äºä¸ºä¸€ä¸ªè¡¨è®¾ç½®å…ƒè¡¨ã€‚"><meta property="og:title" content="Luaé«˜çº§"><meta property="og:description" content="å…ƒè¡¨ å…ƒè¡¨ (metatable) çš„è¡¨ç°è¡Œä¸ºç±»ä¼¼äº C++ è¯­è¨€ä¸­çš„æ“ä½œç¬¦é‡è½½ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é‡è½½ &ldquo;__add&rdquo; å…ƒæ–¹æ³• (metamethod)ï¼Œæ¥è®¡ç®—ä¸¤ä¸ª Lua æ•°ç»„çš„å¹¶é›†ï¼›æˆ–è€…é‡è½½ &ldquo;__index&rdquo; æ–¹æ³•ï¼Œæ¥å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„ Hash å‡½æ•°ã€‚Lua æä¾›äº†ä¸¤ä¸ªååˆ†é‡è¦çš„ç”¨æ¥å¤„ç†å…ƒè¡¨çš„æ–¹æ³•
  setmetatable(table, metatable)ï¼šæ­¤æ–¹æ³•ç”¨äºä¸ºä¸€ä¸ªè¡¨è®¾ç½®å…ƒè¡¨ã€‚"><meta property="og:type" content="website"><meta property="og:image" content="https://googoo-s.github.io/icon.png"><meta property="og:url" content="https://googoo-s.github.io/lua/Lua%E9%AB%98%E7%BA%A7/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content="Luaé«˜çº§"><meta name=twitter:description content="å…ƒè¡¨ å…ƒè¡¨ (metatable) çš„è¡¨ç°è¡Œä¸ºç±»ä¼¼äº C++ è¯­è¨€ä¸­çš„æ“ä½œç¬¦é‡è½½ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é‡è½½ &ldquo;__add&rdquo; å…ƒæ–¹æ³• (metamethod)ï¼Œæ¥è®¡ç®—ä¸¤ä¸ª Lua æ•°ç»„çš„å¹¶é›†ï¼›æˆ–è€…é‡è½½ &ldquo;__index&rdquo; æ–¹æ³•ï¼Œæ¥å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„ Hash å‡½æ•°ã€‚Lua æä¾›äº†ä¸¤ä¸ªååˆ†é‡è¦çš„ç”¨æ¥å¤„ç†å…ƒè¡¨çš„æ–¹æ³•
  setmetatable(table, metatable)ï¼šæ­¤æ–¹æ³•ç”¨äºä¸ºä¸€ä¸ªè¡¨è®¾ç½®å…ƒè¡¨ã€‚"><meta name=twitter:image content="https://googoo-s.github.io/icon.png"><title>Luaé«˜çº§</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://googoo-s.github.io//icon.png><link href=https://googoo-s.github.io/styles.19109a40042e9f0e72e952fda4442a34.min.css rel=stylesheet><link href=https://googoo-s.github.io/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://googoo-s.github.io/js/darkmode.953af745b0f9342644d632fc167f3727.min.js></script>
<script src=https://googoo-s.github.io/js/util.00639692264b21bc3ee219733d38a8be.min.js></script>
<link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script defer src=https://googoo-s.github.io/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://googoo-s.github.io/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://googoo-s.github.io/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://googoo-s.github.io/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://googoo-s.github.io/",fetchData=Promise.all([fetch("https://googoo-s.github.io/indices/linkIndex.f65387078bd3afa8657e01f74a9355e6.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://googoo-s.github.io/indices/contentIndex.e576b2ae648e555a918c9c8268be8ce3.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://googoo-s.github.io",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!0;drawGraph("https://googoo-s.github.io",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/googoo-s.github.io\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=googoo-s.github.io src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://googoo-s.github.io/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://googoo-s.github.io/>googoo-s ğŸ˜„ğŸ˜¸ğŸ˜</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Luaé«˜çº§</h1><p class=meta>Last updated
Jul 31, 2023</p><ul class=tags><li><a href=https://googoo-s.github.io/tags/lua/>Lua</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#å…ƒè¡¨>å…ƒè¡¨</a><ol><li><a href=#ä¿®æ”¹è¡¨çš„æ“ä½œç¬¦è¡Œä¸º><strong>ä¿®æ”¹è¡¨çš„æ“ä½œç¬¦è¡Œä¸º</strong></a></li><li><a href=#__index-å…ƒæ–¹æ³•><strong>__index å…ƒæ–¹æ³•</strong></a></li><li><a href=#__tostring-å…ƒæ–¹æ³•><strong>__tostring å…ƒæ–¹æ³•</strong></a></li><li><a href=#__call-å…ƒæ–¹æ³•><strong>__call å…ƒæ–¹æ³•</strong></a></li><li><a href=#__metatable-å…ƒæ–¹æ³•><strong>__metatable å…ƒæ–¹æ³•</strong></a></li></ol></li><li><a href=#é¢å‘å¯¹è±¡>é¢å‘å¯¹è±¡</a><ol><li><a href=#ç±»>ç±»</a></li><li><a href=#ç»§æ‰¿>ç»§æ‰¿</a></li><li><a href=#æˆå‘˜ç§æœ‰æ€§>æˆå‘˜ç§æœ‰æ€§</a></li></ol></li><li><a href=#å±€éƒ¨å˜é‡>å±€éƒ¨å˜é‡</a><ol><li><a href=#å®šä¹‰><strong>å®šä¹‰</strong></a></li><li><a href=#ä½œç”¨åŸŸ><strong>ä½œç”¨åŸŸ</strong></a></li><li><a href=#ä½¿ç”¨å±€éƒ¨å˜é‡çš„å¥½å¤„>ä½¿ç”¨å±€éƒ¨å˜é‡çš„å¥½å¤„</a></li><li><a href=#æ£€æµ‹æ¨¡å—çš„å‡½æ•°ä½¿ç”¨å±€éƒ¨å˜é‡>æ£€æµ‹æ¨¡å—çš„å‡½æ•°ä½¿ç”¨å±€éƒ¨å˜é‡</a></li></ol></li><li><a href=#åˆ¤æ–­æ•°ç»„çš„å¤§å°>åˆ¤æ–­æ•°ç»„çš„å¤§å°</a></li><li><a href=#éç©ºåˆ¤æ–­>éç©ºåˆ¤æ–­</a></li><li><a href=#æ­£åˆ™è¡¨è¾¾å¼>æ­£åˆ™è¡¨è¾¾å¼</a><ol><li><ol><li></li></ol></li></ol></li><li><a href=#è™šå˜é‡>è™šå˜é‡</a><ol><li><a href=#è¿”å›å€¼>è¿”å›å€¼</a></li><li><a href=#è¿­ä»£>è¿­ä»£</a></li></ol></li><li><a href=#æŠµåˆ¶ä½¿ç”¨-module-å®šä¹‰æ¨¡å—><strong>æŠµåˆ¶ä½¿ç”¨ module() å®šä¹‰æ¨¡å—</strong></a><ol><li><a href=#è°ƒç”¨å‡½æ•°å‰å…ˆå®šä¹‰å‡½æ•°>è°ƒç”¨å‡½æ•°å‰å…ˆå®šä¹‰å‡½æ•°</a></li></ol></li><li><a href=#ç‚¹å·æ“ä½œç¬¦å’Œå†’å·æ“ä½œç¬¦çš„åŒºåˆ«>ç‚¹å·æ“ä½œç¬¦å’Œå†’å·æ“ä½œç¬¦çš„åŒºåˆ«</a></li><li><a href=#moduleçš„ç¼ºç‚¹>moduleçš„ç¼ºç‚¹</a></li><li><a href=#ffi>FFI</a><ol><li><a href=#ffi-åº“-è¯æ±‡><strong>ffi åº“ è¯æ±‡</strong></a></li><li><a href=#ffi-api><em><em>ffi.</em> API</em>*</a></li></ol></li><li><a href=#jit>JIT</a><ol><li><a href=#å¯ä»¥è¢«-jit-ç¼–è¯‘çš„å…ƒæ“ä½œ><strong>å¯ä»¥è¢« JIT ç¼–è¯‘çš„å…ƒæ“ä½œ</strong></a><ol><li><a href=#åŸºç¡€åº“çš„æ”¯æŒæƒ…å†µ><strong>åŸºç¡€åº“çš„æ”¯æŒæƒ…å†µ</strong></a></li><li><a href=#å­—ç¬¦ä¸²åº“><strong>å­—ç¬¦ä¸²åº“</strong></a></li><li><a href=#è¡¨><strong>è¡¨</strong></a></li><li><a href=#math-åº“><strong>math åº“</strong></a></li></ol></li></ol></li></ol></nav></details></aside><a href=#å…ƒè¡¨><h1 id=å…ƒè¡¨><span class=hanchor arialabel=Anchor># </span>å…ƒè¡¨</h1></a><p>å…ƒè¡¨ <em>(metatable)</em> çš„<strong>è¡¨ç°è¡Œä¸ºç±»ä¼¼äº C++ è¯­è¨€ä¸­çš„æ“ä½œç¬¦é‡è½½</strong>ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é‡è½½ &ldquo;__add&rdquo; å…ƒæ–¹æ³• <em>(metamethod)</em>ï¼Œæ¥è®¡ç®—ä¸¤ä¸ª Lua æ•°ç»„çš„å¹¶é›†ï¼›æˆ–è€…é‡è½½ &ldquo;__index&rdquo; æ–¹æ³•ï¼Œæ¥å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„ Hash å‡½æ•°ã€‚Lua æä¾›äº†ä¸¤ä¸ªååˆ†é‡è¦çš„ç”¨æ¥å¤„ç†å…ƒè¡¨çš„æ–¹æ³•</p><ul><li><p>setmetatable(table, metatable)ï¼šæ­¤æ–¹æ³•ç”¨äºä¸ºä¸€ä¸ªè¡¨è®¾ç½®å…ƒè¡¨ã€‚</p></li><li><p>getmetatable(table)ï¼šæ­¤æ–¹æ³•ç”¨äºè·å–è¡¨çš„å…ƒè¡¨å¯¹è±¡</p></li></ul><p>è®¾ç½®å…ƒè¡¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>mytable</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>mymetatable</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=n>setmetatable</span><span class=p>(</span><span class=n>mytable</span><span class=p>,</span> <span class=n>mymetatable</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><a href=#ä¿®æ”¹è¡¨çš„æ“ä½œç¬¦è¡Œä¸º><h2 id=ä¿®æ”¹è¡¨çš„æ“ä½œç¬¦è¡Œä¸º><span class=hanchor arialabel=Anchor># </span><strong>ä¿®æ”¹è¡¨çš„æ“ä½œç¬¦è¡Œä¸º</strong></h2></a><p>é€šè¿‡é‡è½½ &ldquo;__add&rdquo; å…ƒæ–¹æ³•æ¥è®¡ç®—é›†åˆçš„å¹¶é›†å®ä¾‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>set1</span> <span class=o>=</span> <span class=p>{</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>30</span><span class=p>}</span>   <span class=c1>-- é›†åˆ</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>set2</span> <span class=o>=</span> <span class=p>{</span><span class=mi>20</span><span class=p>,</span> <span class=mi>40</span><span class=p>,</span> <span class=mi>50</span><span class=p>}</span>   <span class=c1>-- é›†åˆ</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- å°†ç”¨äºé‡è½½__addçš„å‡½æ•°ï¼Œæ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯self</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>union</span> <span class=o>=</span> <span class=kr>function</span> <span class=p>(</span><span class=n>self</span><span class=p>,</span> <span class=n>another</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>set</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>result</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>-- åˆ©ç”¨æ•°ç»„æ¥ç¡®ä¿é›†åˆçš„äº’å¼‚æ€§</span>
</span></span><span class=line><span class=cl>    <span class=kr>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span> <span class=kr>in</span> <span class=n>pairs</span><span class=p>(</span><span class=n>self</span><span class=p>)</span> <span class=kr>do</span> <span class=n>set</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=kc>true</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=kr>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span> <span class=kr>in</span> <span class=n>pairs</span><span class=p>(</span><span class=n>another</span><span class=p>)</span> <span class=kr>do</span> <span class=n>set</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=kc>true</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>-- åŠ å…¥ç»“æœé›†åˆ</span>
</span></span><span class=line><span class=cl>    <span class=kr>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span> <span class=kr>in</span> <span class=n>pairs</span><span class=p>(</span><span class=n>set</span><span class=p>)</span> <span class=kr>do</span> <span class=n>table.insert</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>i</span><span class=p>)</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=n>setmetatable</span><span class=p>(</span><span class=n>set1</span><span class=p>,</span> <span class=p>{</span><span class=n>__add</span> <span class=o>=</span> <span class=n>union</span><span class=p>})</span> <span class=c1>-- é‡è½½ set1 è¡¨çš„ __add å…ƒæ–¹æ³•</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>set3</span> <span class=o>=</span> <span class=n>set1</span> <span class=o>+</span> <span class=n>set2</span>
</span></span><span class=line><span class=cl><span class=kr>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>j</span> <span class=kr>in</span> <span class=n>pairs</span><span class=p>(</span><span class=n>set3</span><span class=p>)</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>    <span class=n>io.write</span><span class=p>(</span><span class=n>j</span><span class=o>..</span><span class=s2>&#34; &#34;</span><span class=p>)</span>               <span class=c1>--&gt;outputï¼š30 50 20 40 10</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></td></tr></table></div></div><p>é™¤äº†åŠ æ³•å¯ä»¥è¢«é‡è½½ä¹‹å¤–ï¼ŒLua æä¾›çš„æ‰€æœ‰æ“ä½œç¬¦éƒ½å¯ä»¥è¢«é‡è½½ï¼š</p><table><thead><tr><th>å…ƒæ–¹æ³•</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>&ldquo;__add</td><td>#NAME?</td></tr><tr><td>&ldquo;__sub</td><td>- æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº &ldquo;add&rdquo; æ“ä½œ</td></tr><tr><td>&ldquo;__mul</td><td>* æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº &ldquo;add&rdquo; æ“ä½œ</td></tr><tr><td>&ldquo;__div</td><td>/ æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº &ldquo;add&rdquo; æ“ä½œ</td></tr><tr><td>&ldquo;__mod</td><td>% æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº &ldquo;add&rdquo; æ“ä½œ</td></tr><tr><td>&ldquo;__pow</td><td>^ ï¼ˆå¹‚ï¼‰æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº &ldquo;add&rdquo; æ“ä½œ</td></tr><tr><td>&ldquo;__unm&rdquo;</td><td>ä¸€å…ƒ - æ“ä½œ</td></tr><tr><td>&ldquo;__concat&rdquo;</td><td>.. ï¼ˆå­—ç¬¦ä¸²è¿æ¥ï¼‰æ“ä½œ</td></tr><tr><td>&ldquo;__len&rdquo;</td><td># æ“ä½œ</td></tr><tr><td>&ldquo;__eq&rdquo;</td><td>== æ“ä½œ å‡½æ•° getcomphandler å®šä¹‰äº† Lua æ€æ ·é€‰æ‹©ä¸€ä¸ªå¤„ç†å™¨æ¥ä½œæ¯”è¾ƒæ“ä½œ ä»…åœ¨ä¸¤ä¸ªå¯¹è±¡ç±»å‹ç›¸åŒä¸”æœ‰å¯¹åº”æ“ä½œç›¸åŒçš„å…ƒæ–¹æ³•æ—¶æ‰èµ·æ•ˆ</td></tr><tr><td>&ldquo;__lt&rdquo;</td><td>&lt; æ“ä½œ</td></tr><tr><td>&ldquo;__le&rdquo;</td><td>&lt;= æ“ä½œ</td></tr></tbody></table><p>é™¤äº†æ“ä½œç¬¦ä¹‹å¤–ï¼Œå¦‚ä¸‹å…ƒæ–¹æ³•ä¹Ÿå¯ä»¥è¢«é‡è½½ï¼Œä¸‹é¢ä¼šä¾æ¬¡è§£é‡Šä½¿ç”¨æ–¹æ³•ï¼š</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>å…ƒæ–¹æ³•</td><td>å«ä¹‰</td></tr><tr><td>&ldquo;__index&rdquo;</td><td>å–ä¸‹æ ‡æ“ä½œç”¨äºè®¿é—® table[key]</td></tr><tr><td>&ldquo;__newindex&rdquo;</td><td>èµ‹å€¼ç»™æŒ‡å®šä¸‹æ ‡ table[key] = value</td></tr><tr><td>&ldquo;__tostring&rdquo;</td><td>è½¬æ¢æˆå­—ç¬¦ä¸²</td></tr><tr><td>&ldquo;__call&rdquo;</td><td>å½“ Lua è°ƒç”¨ä¸€ä¸ªå€¼æ—¶è°ƒç”¨</td></tr><tr><td>&ldquo;__mode&rdquo;</td><td>ç”¨äºå¼±è¡¨(week table)</td></tr><tr><td>&ldquo;__metatable&rdquo;</td><td>ç”¨äºä¿æŠ¤metatableä¸è¢«è®¿é—®</td></tr></tbody></table><a href=#__index-å…ƒæ–¹æ³•><h2 id=__index-å…ƒæ–¹æ³•><span class=hanchor arialabel=Anchor># </span><strong>__index å…ƒæ–¹æ³•</strong></h2></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>mytable</span> <span class=o>=</span> <span class=n>setmetatable</span><span class=p>({</span><span class=n>key1</span> <span class=o>=</span> <span class=s2>&#34;value1&#34;</span><span class=p>},</span>   <span class=c1>--åŸå§‹è¡¨</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=n>__index</span> <span class=o>=</span> <span class=kr>function</span><span class=p>(</span><span class=n>self</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>            <span class=c1>--é‡è½½å‡½æ•°</span>
</span></span><span class=line><span class=cl>    <span class=kr>if</span> <span class=n>key</span> <span class=o>==</span> <span class=s2>&#34;key2&#34;</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>        <span class=kr>return</span> <span class=s2>&#34;metatablevalue&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>mytable.key1</span><span class=p>,</span><span class=n>mytable.key2</span><span class=p>)</span>  <span class=c1>--&gt; outputï¼švalue1 metatablevalue</span>
</span></span></code></pre></td></tr></table></div></div><p>å…³äº __index å…ƒæ–¹æ³•ï¼Œæœ‰å¾ˆå¤šæ¯”è¾ƒé«˜é˜¶çš„æŠ€å·§ï¼Œä¾‹å¦‚ï¼š__index çš„å…ƒæ–¹æ³•ä¸éœ€è¦éæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä»–ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¡¨ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>t</span> <span class=o>=</span> <span class=n>setmetatable</span><span class=p>({[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;hello&#34;</span><span class=p>},</span> <span class=p>{</span><span class=n>__index</span> <span class=o>=</span> <span class=p>{[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;world&#34;</span><span class=p>}})</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>t</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>   <span class=c1>--&gt;hello wor</span>
</span></span></code></pre></td></tr></table></div></div><a href=#__tostring-å…ƒæ–¹æ³•><h2 id=__tostring-å…ƒæ–¹æ³•><span class=hanchor arialabel=Anchor># </span><strong>__tostring å…ƒæ–¹æ³•</strong></h2></a><p>ä¸ Java ä¸­çš„ toString() å‡½æ•°ç±»ä¼¼ï¼Œå¯ä»¥å®ç°è‡ªå®šä¹‰çš„å­—ç¬¦ä¸²è½¬æ¢ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>arr</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>arr</span> <span class=o>=</span> <span class=n>setmetatable</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=p>{</span><span class=n>__tostring</span> <span class=o>=</span> <span class=kr>function</span> <span class=p>(</span><span class=n>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>result</span> <span class=o>=</span> <span class=s1>&#39;{&#39;</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>sep</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=kr>for</span> <span class=n>_</span><span class=p>,</span> <span class=n>i</span> <span class=kr>in</span> <span class=n>pairs</span><span class=p>(</span><span class=n>self</span><span class=p>)</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>result</span> <span class=o>..</span><span class=n>sep</span> <span class=o>..</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>        <span class=n>sep</span> <span class=o>=</span> <span class=s1>&#39;, &#39;</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>result</span> <span class=o>..</span> <span class=s1>&#39;}&#39;</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl><span class=kr>end</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>arr</span><span class=p>)</span>  <span class=c1>--&gt; {1, 2, 3, 4}</span>
</span></span></code></pre></td></tr></table></div></div><a href=#__call-å…ƒæ–¹æ³•><h2 id=__call-å…ƒæ–¹æ³•><span class=hanchor arialabel=Anchor># </span><strong>__call å…ƒæ–¹æ³•</strong></h2></a><p>__call å…ƒæ–¹æ³•çš„åŠŸèƒ½ç±»ä¼¼äº C++ ä¸­çš„ä»¿å‡½æ•°ï¼Œä½¿å¾—æ™®é€šçš„è¡¨ä¹Ÿå¯ä»¥è¢«è°ƒç”¨ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>functor</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>func1</span><span class=p>(</span><span class=n>self</span><span class=p>,</span> <span class=n>arg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span> <span class=p>(</span><span class=s2>&#34;called from&#34;</span><span class=p>,</span> <span class=n>arg</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=n>setmetatable</span><span class=p>(</span><span class=n>functor</span><span class=p>,</span> <span class=p>{</span><span class=n>__call</span> <span class=o>=</span> <span class=n>func1</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>functor</span><span class=p>(</span><span class=s2>&#34;functor&#34;</span><span class=p>)</span>  <span class=c1>--&gt; called from functor</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>functor</span><span class=p>)</span>      <span class=c1>--&gt; outputï¼š0x00076fc8 ï¼ˆåé¢è¿™ä¸²æ•°å­—å¯èƒ½ä¸ä¸€æ ·ï¼‰</span>
</span></span></code></pre></td></tr></table></div></div><a href=#__metatable-å…ƒæ–¹æ³•><h2 id=__metatable-å…ƒæ–¹æ³•><span class=hanchor arialabel=Anchor># </span><strong>__metatable å…ƒæ–¹æ³•</strong></h2></a><p>å‡å¦‚æˆ‘ä»¬æƒ³ä¿æŠ¤æˆ‘ä»¬çš„å¯¹è±¡ä½¿å…¶ä½¿ç”¨è€…æ—¢çœ‹ä¸åˆ°ä¹Ÿä¸èƒ½ä¿®æ”¹ metatablesã€‚æˆ‘<strong>ä»¬å¯ä»¥å¯¹ metatable è®¾ç½®äº† __metatable çš„å€¼ï¼Œgetmetatable å°†è¿”å›è¿™ä¸ªåŸŸçš„å€¼ï¼Œè€Œè°ƒç”¨ setmetatable å°†ä¼šå‡ºé”™</strong>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>bject</span> <span class=o>=</span> <span class=n>setmetatable</span><span class=p>({},</span> <span class=p>{</span><span class=n>__metatable</span> <span class=o>=</span> <span class=s2>&#34;You cannot access here&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>getmetatable</span><span class=p>(</span><span class=n>Object</span><span class=p>))</span> <span class=c1>--&gt; You cannot access heresetmetatable(Object, {})    --&gt; å¼•å‘ç¼–è¯‘å™¨æŠ¥é”™</span>
</span></span></code></pre></td></tr></table></div></div><a href=#é¢å‘å¯¹è±¡><h1 id=é¢å‘å¯¹è±¡><span class=hanchor arialabel=Anchor># </span>é¢å‘å¯¹è±¡</h1></a><a href=#ç±»><h2 id=ç±»><span class=hanchor arialabel=Anchor># </span>ç±»</h2></a><p>åœ¨ Lua ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¡¨å’Œå‡½æ•°å®ç°é¢å‘å¯¹è±¡ã€‚<strong>å°†å‡½æ•°å’Œç›¸å…³çš„æ•°æ®æ”¾ç½®äºåŒä¸€ä¸ªè¡¨ä¸­å°±å½¢æˆäº†ä¸€ä¸ªå¯¹è±¡ã€‚</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>local _M = {}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>local mt = { __index = _M }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function _M.deposit (self, v)
</span></span><span class=line><span class=cl>    self.balance = self.balance + v
</span></span><span class=line><span class=cl>end
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function _M.withdraw (self, v)
</span></span><span class=line><span class=cl>    if self.balance &gt; v then
</span></span><span class=line><span class=cl>        self.balance = self.balance - v
</span></span><span class=line><span class=cl>    else
</span></span><span class=line><span class=cl>        error(&#34;insufficient funds&#34;)
</span></span><span class=line><span class=cl>    end
</span></span><span class=line><span class=cl>end
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function _M.new (self, balance)
</span></span><span class=line><span class=cl>    balance = balance or 0
</span></span><span class=line><span class=cl>    return setmetatable({balance = balance}, mt)
</span></span><span class=line><span class=cl>end
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>return _M
</span></span></code></pre></td></tr></table></div></div><p>å¼•ç”¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>account</span> <span class=o>=</span> <span class=n>require</span><span class=p>(</span><span class=s2>&#34;account&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>a</span> <span class=o>=</span> <span class=n>account</span><span class=p>:</span><span class=n>new</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=p>:</span><span class=n>deposit</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>b</span> <span class=o>=</span> <span class=n>account</span><span class=p>:</span><span class=n>new</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>b</span><span class=p>:</span><span class=n>deposit</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>a.balance</span><span class=p>)</span>  <span class=c1>--&gt; output: 100</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>b.balance</span><span class=p>)</span>  <span class=c1>--&gt; output: 50</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¸Šé¢è¿™æ®µä»£ç  &ldquo;setmetatable({balance = balance}, mt)"ï¼Œå…¶ä¸­ mt ä»£è¡¨ <code>{ __index = _M }</code> ï¼Œè¿™å¥è¯å€¼å¾—æ³¨æ„ã€‚æ ¹æ®æˆ‘ä»¬åœ¨å…ƒè¡¨è¿™ä¸€ç« å­¦åˆ°çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬æ˜ç™½ï¼Œsetmetatable å°† <code>_M</code> ä½œä¸ºæ–°å»ºè¡¨çš„åŸå‹ï¼Œæ‰€ä»¥åœ¨è‡ªå·±çš„è¡¨å†…æ‰¾ä¸åˆ° &lsquo;deposit&rsquo;ã€&lsquo;withdraw&rsquo; è¿™äº›æ–¹æ³•å’Œå˜é‡çš„æ—¶å€™ï¼Œä¾¿ä¼šåˆ° __index æ‰€æŒ‡å®šçš„ _M ç±»å‹ä¸­å»å¯»æ‰¾ã€‚</p><a href=#ç»§æ‰¿><h2 id=ç»§æ‰¿><span class=hanchor arialabel=Anchor># </span>ç»§æ‰¿</h2></a><p>ç»§æ‰¿å¯ä»¥ç”¨å…ƒè¡¨å®ç°ï¼Œå®ƒæä¾›äº†åœ¨çˆ¶ç±»ä¸­æŸ¥æ‰¾å­˜åœ¨çš„æ–¹æ³•å’Œå˜é‡çš„æœºåˆ¶ã€‚åœ¨ Lua ä¸­æ˜¯ä¸æ¨èä½¿ç”¨ç»§æ‰¿æ–¹å¼å®Œæˆæ„é€ çš„ï¼Œè¿™æ ·åšå¼•å…¥çš„é—®é¢˜å¯èƒ½æ¯”è§£å†³çš„é—®é¢˜è¦å¤šï¼Œä¸‹é¢ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²æ“ä½œç±»åº“ï¼Œç»™å¤§å®¶æ¼”ç¤ºä¸€ä¸‹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=c1>---------- s_base.lualocal _M = {}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>mt</span> <span class=o>=</span> <span class=p>{</span> <span class=n>__index</span> <span class=o>=</span> <span class=n>_M</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>_M</span><span class=p>.</span><span class=nf>upper</span> <span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=kr>return</span> <span class=n>string.upper</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>endreturn</span> <span class=n>_M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>---------- s_more.lualocal s_base = require(&#34;s_base&#34;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>_M</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=n>_M</span> <span class=o>=</span> <span class=n>setmetatable</span><span class=p>(</span><span class=n>_M</span><span class=p>,</span> <span class=p>{</span> <span class=n>__index</span> <span class=o>=</span> <span class=n>s_base</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>_M</span><span class=p>.</span><span class=nf>lower</span> <span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=kr>return</span> <span class=n>string.lower</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>endreturn</span> <span class=n>_M</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>---------- test.lualocal s_more = require(&#34;s_more&#34;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>s_more.upper</span><span class=p>(</span><span class=s2>&#34;Hello&#34;</span><span class=p>))</span>   <span class=c1>-- output: HELLOprint(s_more.lower(&#34;Hello&#34;))   -- output: hello</span>
</span></span></code></pre></td></tr></table></div></div><a href=#æˆå‘˜ç§æœ‰æ€§><h2 id=æˆå‘˜ç§æœ‰æ€§><span class=hanchor arialabel=Anchor># </span>æˆå‘˜ç§æœ‰æ€§</h2></a><p>åœ¨åŠ¨æ€è¯­è¨€ä¸­å¼•å…¥æˆå‘˜ç§æœ‰æ€§å¹¶æ²¡æœ‰å¤ªå¤§çš„å¿…è¦ï¼Œåè€Œä¼šæ˜¾è‘—å¢åŠ è¿è¡Œæ—¶çš„å¼€é”€ï¼Œæ¯•ç«Ÿè¿™ç§æ£€æŸ¥æ— æ³•åƒè®¸å¤šé™æ€è¯­è¨€é‚£æ ·åœ¨ç¼–è¯‘æœŸå®Œæˆã€‚ä¸‹é¢çš„æŠ€å·§æŠŠå¯¹è±¡ä½œä¸ºå„æ–¹æ³•çš„ upvalueï¼Œæœ¬èº«æ˜¯å¾ˆå·§å¦™çš„ï¼Œä½†ä¼šè®©å­ç±»ç»§æ‰¿å˜å¾—å›°éš¾ï¼ŒåŒæ—¶æ„é€ å‡½æ•°åŠ¨æ€åˆ›å»ºäº†å‡½æ•°ï¼Œä¼šå¯¼è‡´æ„é€ å‡½æ•°æ— æ³•è¢« JIT ç¼–è¯‘ã€‚</p><p>åœ¨ Lua ä¸­ï¼Œæˆå‘˜çš„ç§æœ‰æ€§ï¼Œä½¿ç”¨ç±»ä¼¼äºå‡½æ•°é—­åŒ…çš„å½¢å¼æ¥å®ç°ã€‚åœ¨æˆ‘ä»¬ä¹‹å‰çš„é“¶è¡Œè´¦æˆ·çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå·¥å‚æ–¹æ³•æ¥åˆ›å»ºæ–°çš„è´¦æˆ·å®ä¾‹ï¼Œé€šè¿‡å·¥å‚æ–¹æ³•å¯¹å¤–æä¾›çš„é—­åŒ…æ¥æš´éœ²å¯¹å¤–æ¥å£ã€‚è€Œä¸æƒ³æš´éœ²åœ¨å¤–çš„ä¾‹å¦‚ balance æˆå‘˜å˜é‡ï¼Œåˆ™è¢«å¾ˆå¥½çš„éšè—èµ·æ¥ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>newAccount</span> <span class=p>(</span><span class=n>initialBalance</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>self</span> <span class=o>=</span> <span class=p>{</span><span class=n>balance</span> <span class=o>=</span> <span class=n>initialBalance</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>withdraw</span> <span class=o>=</span> <span class=kr>function</span> <span class=p>(</span><span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>self.balance</span> <span class=o>=</span> <span class=n>self.balance</span> <span class=o>-</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>deposit</span> <span class=o>=</span> <span class=kr>function</span> <span class=p>(</span><span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>self.balance</span> <span class=o>=</span> <span class=n>self.balance</span> <span class=o>+</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>getBalance</span> <span class=o>=</span> <span class=kr>function</span> <span class=p>()</span> 
</span></span><span class=line><span class=cl>        <span class=kr>return</span> <span class=n>self.balance</span> 
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>withdraw</span> <span class=o>=</span> <span class=n>withdraw</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>deposit</span> <span class=o>=</span> <span class=n>deposit</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>getBalance</span> <span class=o>=</span> <span class=n>getBalance</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>newAccount</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>a.deposit</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>a.getBalance</span><span class=p>())</span> <span class=c1>--&gt; 200print(a.balance)      --&gt; nil</span>
</span></span></code></pre></td></tr></table></div></div><a href=#å±€éƒ¨å˜é‡><h1 id=å±€éƒ¨å˜é‡><span class=hanchor arialabel=Anchor># </span>å±€éƒ¨å˜é‡</h1></a><p>Lua çš„è®¾è®¡æœ‰ä¸€ç‚¹å¾ˆå¥‡æ€ªï¼Œ<strong>åœ¨ä¸€ä¸ª block ä¸­çš„å˜é‡ï¼Œå¦‚æœä¹‹å‰æ²¡æœ‰å®šä¹‰è¿‡ï¼Œé‚£ä¹ˆè®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡</strong>ï¼Œ<strong>è€Œä¸æ˜¯è¿™ä¸ª block çš„å±€éƒ¨å˜é‡</strong>ã€‚è¿™ä¸€ç‚¹å’Œåˆ«çš„è¯­è¨€ä¸åŒã€‚<strong>å®¹æ˜“é€ æˆä¸å°å¿ƒè¦†ç›–äº†å…¨å±€åŒåå˜é‡çš„é”™è¯¯</strong>ã€‚</p><a href=#å®šä¹‰><h2 id=å®šä¹‰><span class=hanchor arialabel=Anchor># </span><strong>å®šä¹‰</strong></h2></a><p>Lua ä¸­çš„å±€éƒ¨å˜é‡è¦ç”¨ local å…³é”®å­—æ¥æ˜¾å¼å®šä¹‰ï¼Œä¸ä½¿ç”¨ local æ˜¾å¼å®šä¹‰çš„å˜é‡å°±æ˜¯å…¨å±€å˜é‡</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>g_var</span> <span class=o>=</span> <span class=mi>1</span>         <span class=c1>-- global var</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>l_var</span> <span class=o>=</span> <span class=mi>2</span>   <span class=c1>-- local var</span>
</span></span></code></pre></td></tr></table></div></div><a href=#ä½œç”¨åŸŸ><h2 id=ä½œç”¨åŸŸ><span class=hanchor arialabel=Anchor># </span><strong>ä½œç”¨åŸŸ</strong></h2></a><p><strong>å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æœ‰é™çš„ï¼Œå®ƒçš„ä½œç”¨åŸŸä»…é™äºå£°æ˜å®ƒçš„å—ï¼ˆblockï¼‰</strong>ã€‚ä¸€ä¸ªå—æ˜¯ä¸€ä¸ªæ§åˆ¶ç»“æ„çš„æ‰§è¡Œä½“ã€æˆ–è€…æ˜¯ä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œä½“å†æˆ–è€…æ˜¯ä¸€ä¸ªç¨‹åºå—ï¼ˆchunkï¼‰ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span>         <span class=c1>-- ç¨‹åºå—ä¸­çš„å±€éƒ¨å˜é‡ i</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>while</span> <span class=n>i</span> <span class=o>&lt;=</span><span class=n>x</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>x</span> <span class=o>=</span> <span class=n>i</span> <span class=o>*</span> <span class=mi>2</span>   <span class=c1>-- while å¾ªç¯ä½“ä¸­çš„å±€éƒ¨å˜é‡ x</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>          <span class=c1>-- outputï¼š 2, 4, 6, 8, ...</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>if</span> <span class=n>i</span> <span class=o>&gt;</span> <span class=mi>20</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>x</span>           <span class=c1>-- then ä¸­çš„å±€éƒ¨å˜é‡ x</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>x</span> <span class=o>+</span> <span class=mi>2</span><span class=p>)</span>      <span class=c1>-- å¦‚æœi &gt; 20 å°†ä¼šæ‰“å° 22ï¼Œæ­¤å¤„çš„ x æ˜¯å±€éƒ¨å˜é‡</span>
</span></span><span class=line><span class=cl><span class=kr>else</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>          <span class=c1>-- æ‰“å° 10ï¼Œè¿™é‡Œ x æ˜¯å…¨å±€å˜é‡</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>            <span class=c1>-- æ‰“å° 10</span>
</span></span></code></pre></td></tr></table></div></div><a href=#ä½¿ç”¨å±€éƒ¨å˜é‡çš„å¥½å¤„><h2 id=ä½¿ç”¨å±€éƒ¨å˜é‡çš„å¥½å¤„><span class=hanchor arialabel=Anchor># </span>ä½¿ç”¨å±€éƒ¨å˜é‡çš„å¥½å¤„</h2></a><ol><li><p>å±€éƒ¨å˜é‡å¯ä»¥é¿å…å› ä¸ºå‘½åé—®é¢˜æ±¡æŸ“äº†å…¨å±€ç¯å¢ƒ</p></li><li><p>local å˜é‡çš„è®¿é—®æ¯”å…¨å±€å˜é‡æ›´å¿«</p></li><li><p>ç”±äºå±€éƒ¨å˜é‡å‡ºäº†ä½œç”¨åŸŸä¹‹åç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œè¿™æ ·å¯ä»¥è¢«åƒåœ¾å›æ”¶å™¨åŠæ—¶é‡Šæ”¾</p></li></ol><a href=#æ£€æµ‹æ¨¡å—çš„å‡½æ•°ä½¿ç”¨å±€éƒ¨å˜é‡><h2 id=æ£€æµ‹æ¨¡å—çš„å‡½æ•°ä½¿ç”¨å±€éƒ¨å˜é‡><span class=hanchor arialabel=Anchor># </span>æ£€æµ‹æ¨¡å—çš„å‡½æ•°ä½¿ç”¨å±€éƒ¨å˜é‡</h2></a><p>foo.lua</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>_M</span> <span class=o>=</span> <span class=p>{</span> <span class=n>_VERSION</span> <span class=o>=</span> <span class=s1>&#39;0.01&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>_M</span><span class=p>.</span><span class=nf>add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>     <span class=c1>--ä¸¤ä¸ªnumberå‹å˜é‡ç›¸åŠ </span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>_M</span><span class=p>.</span><span class=nf>update_A</span><span class=p>()</span>    <span class=c1>--æ›´æ–°å˜é‡å€¼</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span> <span class=o>=</span> <span class=mi>365</span>               <span class=c1>-- A æ˜¯å…¨å±€å˜é‡</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>return</span> <span class=n>_M</span>
</span></span></code></pre></td></tr></table></div></div><p>use_foo.lua</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>A</span> <span class=o>=</span> <span class=mi>360</span>     <span class=c1>--å®šä¹‰å…¨å±€å˜é‡</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>foo</span> <span class=o>=</span> <span class=n>require</span><span class=p>(</span><span class=s2>&#34;foo&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>b</span> <span class=o>=</span> <span class=n>foo.add</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>A</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;b = &#34;</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>foo.update_A</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;A = &#34;</span><span class=p>,</span> <span class=n>A</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>å› ä¸ºA æ˜¯å…¨å±€å˜é‡ï¼Œæ”¹å˜äº†Açš„å€¼</p><p>Lua ä¸Šä¸‹æ–‡ä¸­åº”å½“ä¸¥æ ¼é¿å…ä½¿ç”¨è‡ªå·±å®šä¹‰çš„å…¨å±€å˜é‡ã€‚<strong>å¯ä»¥ä½¿ç”¨ä¸€ä¸ª lj-releng å·¥å…·æ¥æ‰«æ Lua ä»£ç ï¼Œå®šä½ä½¿ç”¨ Lua å…¨å±€å˜é‡çš„åœ°æ–¹</strong>ã€‚lj-releng çš„ç›¸å…³é“¾æ¥ï¼š
<a href=https://github.com/openresty/openresty-devel-utils/blob/master/lj-releng rel=noopener>https://github.com/openresty/openresty-devel-utils/blob/master/lj-releng</a></p><p>Windows ç”¨æˆ·æŠŠ lj-releng æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•çš„ç»å¯¹è·¯å¾„æ·»åŠ è¿› PATH ç¯å¢ƒå˜é‡ã€‚ç„¶åè¿›å…¥ä½ è‡ªå·±çš„ Lua æ–‡ä»¶æ‰€åœ¨çš„å·¥ä½œç›®å½•ï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=o>#</span>  <span class=n>lj</span><span class=o>-</span><span class=n>releng</span>
</span></span><span class=line><span class=cl><span class=n>foo.lua</span><span class=p>:</span> <span class=mf>0.01</span> <span class=p>(</span><span class=mf>0.01</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Checking</span> <span class=n>use</span> <span class=n>of</span> <span class=n>Lua</span> <span class=n>global</span> <span class=n>variables</span> <span class=kr>in</span> <span class=n>file</span> <span class=n>foo.lua</span><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=n>op</span> <span class=n>no</span><span class=p>.</span>  <span class=n>line</span>  <span class=n>instruction</span> <span class=n>args</span>  <span class=p>;</span> <span class=n>code</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=p>[</span><span class=mi>8</span><span class=p>]</span> <span class=n>SETGLOBAL</span> <span class=mi>0</span> <span class=o>-</span><span class=mi>1</span>  <span class=p>;</span> <span class=n>A</span>
</span></span><span class=line><span class=cl><span class=n>Checking</span> <span class=n>line</span> <span class=n>length</span> <span class=n>exceeding</span> <span class=mf>80.</span><span class=o>..</span>
</span></span><span class=line><span class=cl><span class=n>WARNING</span><span class=p>:</span> <span class=n>No</span> <span class=s2>&#34;_VERSION&#34;</span> <span class=ow>or</span> <span class=s2>&#34;version&#34;</span> <span class=n>field</span> <span class=n>found</span> <span class=kr>in</span> <span class=err>`</span><span class=n>use_foo.lua</span><span class=err>`</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=n>Checking</span> <span class=n>use</span> <span class=n>of</span> <span class=n>Lua</span> <span class=n>global</span> <span class=n>variables</span> <span class=kr>in</span> <span class=n>file</span> <span class=n>use_foo.lua</span><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=n>op</span> <span class=n>no</span><span class=p>.</span>  <span class=n>line</span>  <span class=n>instruction</span> <span class=n>args</span>  <span class=p>;</span> <span class=n>code</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>  <span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=n>SETGLOBAL</span> <span class=mi>0</span> <span class=o>-</span><span class=mi>1</span>  <span class=p>;</span> <span class=n>A</span>
</span></span><span class=line><span class=cl><span class=mi>7</span>  <span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=n>GETGLOBAL</span> <span class=mi>2</span> <span class=o>-</span><span class=mi>1</span>  <span class=p>;</span> <span class=n>A</span>
</span></span><span class=line><span class=cl><span class=mi>8</span>  <span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=n>GETGLOBAL</span> <span class=mi>3</span> <span class=o>-</span><span class=mi>1</span>  <span class=p>;</span> <span class=n>A</span>
</span></span><span class=line><span class=cl><span class=mi>18</span> <span class=p>[</span><span class=mi>8</span><span class=p>]</span> <span class=n>GETGLOBAL</span> <span class=mi>4</span> <span class=o>-</span><span class=mi>1</span>  <span class=p>;</span> <span class=n>A</span>
</span></span></code></pre></td></tr></table></div></div><p>å½“ç„¶ï¼Œæ›´æ¨èé‡‡ç”¨ <strong>luacheck æ¥æ£€æŸ¥é¡¹ç›®ä¸­å…¨å±€å˜é‡ï¼Œä¹‹åçš„â€œä»£ç é™æ€åˆ†æâ€ä¸€èŠ‚ï¼Œæˆ‘ä»¬è¿˜ä¼šè®²åˆ°å¦‚ä½•ä½¿ç”¨ luacheck</strong>ã€‚</p><a href=#åˆ¤æ–­æ•°ç»„çš„å¤§å°><h1 id=åˆ¤æ–­æ•°ç»„çš„å¤§å°><span class=hanchor arialabel=Anchor># </span>åˆ¤æ–­æ•°ç»„çš„å¤§å°</h1></a><ul><li><p>table.getn(t) ç­‰ä»·äº t ä½†<strong>è®¡ç®—çš„æ˜¯æ•°ç»„å…ƒç´ ï¼Œä¸åŒ…æ‹¬ hash é”®å€¼</strong>ã€‚è€Œä¸”æ•°ç»„æ˜¯ä»¥ç¬¬ä¸€ä¸ª nil å…ƒç´ æ¥åˆ¤æ–­æ•°ç»„ç»“æŸã€‚</p></li><li><p><code>#</code> åªè®¡ç®— array çš„å…ƒç´ ä¸ªæ•°ï¼Œå®ƒå®é™…ä¸Šè°ƒç”¨äº†å¯¹è±¡çš„ metatable çš„ <code>__len</code> å‡½æ•°ã€‚å¯¹äºæœ‰ <code>__len</code> æ–¹æ³•çš„å‡½æ•°è¿”å›å‡½æ•°è¿”å›å€¼ï¼Œä¸ç„¶å°±è¿”å›æ•°ç»„æˆå‘˜æ•°ç›®</p></li><li><p><em>Lua</em> å†…éƒ¨å®é™…é‡‡ç”¨å“ˆå¸Œè¡¨å’Œæ•°ç»„åˆ†åˆ«ä¿å­˜é”®å€¼å¯¹ã€æ™®é€šå€¼ï¼Œæ‰€ä»¥ä¸æ¨èæ··åˆä½¿ç”¨è¿™ä¸¤ç§èµ‹å€¼æ–¹å¼ã€‚</p></li><li><p>Lua æ•°ç»„ä¸­å…è®¸ nil å€¼çš„å­˜åœ¨ï¼Œä½†æ˜¯æ•°ç»„é»˜è®¤ç»“æŸæ ‡å¿—å´æ˜¯ nilã€‚è¿™ç±»æ¯”äº C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¸­å…è®¸ &lsquo;\0&rsquo; å­˜åœ¨ï¼Œä½†å½“è¯»åˆ° &lsquo;\0&rsquo; æ—¶ï¼Œå°±è®¤ä¸ºå­—ç¬¦ä¸²å·²ç»ç»“æŸäº†ã€‚</p></li><li><p>åˆå§‹åŒ–æ˜¯ä¾‹å¤–ï¼Œåœ¨ Lua ç›¸å…³æºç ä¸­ï¼Œåˆå§‹åŒ–æ•°ç»„æ—¶é¦–å…ˆåˆ¤æ–­æ•°ç»„çš„é•¿åº¦ï¼Œè‹¥é•¿åº¦å¤§äº 0 ï¼Œå¹¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸ä¸º nilï¼Œè¿”å›åŒ…æ‹¬ nil çš„é•¿åº¦ï¼›è‹¥æœ€åä¸€ä¸ªå€¼ä¸º nilï¼Œåˆ™è¿”å›æˆªè‡³ç¬¬ä¸€ä¸ªé nil å€¼çš„é•¿åº¦ã€‚</p></li><li><p><strong>å¦‚æœä½ è¦åˆ é™¤ä¸€ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ ï¼Œè¯·ä½¿ç”¨ remove å‡½æ•°ï¼Œè€Œä¸æ˜¯ç”¨ nil èµ‹å€¼</strong></p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=c1>-- test.lua</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>tblTest1</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;Test1 &#34;</span> <span class=o>..</span> <span class=o>#</span><span class=p>(</span><span class=n>tblTest1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>tblTest2</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=kc>nil</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;Test2 &#34;</span> <span class=o>..</span> <span class=o>#</span><span class=p>(</span><span class=n>tblTest2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>tblTest3</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>2</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;Test3 &#34;</span> <span class=o>..</span> <span class=o>#</span><span class=p>(</span><span class=n>tblTest3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>tblTest4</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=kc>nil</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;Test4 &#34;</span> <span class=o>..</span> <span class=o>#</span><span class=p>(</span><span class=n>tblTest4</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>tblTest5</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=kc>nil</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;Test5 &#34;</span> <span class=o>..</span> <span class=o>#</span><span class=p>(</span><span class=n>tblTest5</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>tblTest6</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=kc>nil</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;Test6 &#34;</span> <span class=o>..</span> <span class=o>#</span><span class=p>(</span><span class=n>tblTest6</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨ Lua å’Œ LuaJIT æ¥æ‰§è¡Œä¸€ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=err>âœ</span> <span class=n>luajit</span> <span class=n>test.lua</span>
</span></span><span class=line><span class=cl><span class=n>Test1</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>Test2</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Test3</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Test4</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Test5</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Test6</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>âœ</span> <span class=n>lua</span> <span class=n>test.lua</span>
</span></span><span class=line><span class=cl><span class=n>Test1</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>Test2</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Test3</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>Test4</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Test5</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>Test6</span> <span class=mi>1</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™ä¸€æ®µçš„è¾“å‡ºç»“æœï¼Œå°±æ˜¯è¿™ä¹ˆ <strong>åŒªå¤·æ‰€æ€</strong>ã€‚ä¸è¦åœ¨ Lua çš„ table ä¸­ä½¿ç”¨ nil å€¼ï¼Œ<strong>å¦‚æœä¸€ä¸ªå…ƒç´ è¦åˆ é™¤ï¼Œç›´æ¥ removeï¼Œä¸è¦ç”¨ nil å»ä»£æ›¿</strong>ã€‚</p><a href=#éç©ºåˆ¤æ–­><h1 id=éç©ºåˆ¤æ–­><span class=hanchor arialabel=Anchor># </span>éç©ºåˆ¤æ–­</h1></a><p>æœ‰æ—¶å€™ä¸å°å¿ƒå¼•ç”¨äº†ä¸€ä¸ªæ²¡æœ‰èµ‹å€¼çš„å˜é‡ï¼Œè¿™æ—¶å®ƒçš„å€¼é»˜è®¤ä¸º nilã€‚å¦‚æœå¯¹ä¸€ä¸ª nil è¿›è¡Œç´¢å¼•çš„è¯ï¼Œä¼šå¯¼è‡´å¼‚å¸¸ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>local person = {name = &#34;Bob&#34;, sex = &#34;M&#34;}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-- do something
</span></span><span class=line><span class=cl>person = nil
</span></span><span class=line><span class=cl>-- do something
</span></span><span class=line><span class=cl>print(person.name)
</span></span></code></pre></td></tr></table></div></div><p>ä¼šæŠ¥é”™</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>stdin</span><span class=p>:</span><span class=mi>1</span><span class=p>:</span><span class=n>attempt</span> <span class=n>to</span> <span class=n>index</span> <span class=n>global</span> <span class=s1>&#39;person&#39;</span> <span class=p>(</span><span class=n>a</span> <span class=kc>nil</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>stack</span> <span class=n>traceback</span><span class=p>:</span>
</span></span><span class=line><span class=cl>   <span class=n>stdin</span><span class=p>:</span><span class=mi>1</span><span class=p>:</span> <span class=kr>in</span> <span class=n>main</span> <span class=n>chunk</span>
</span></span><span class=line><span class=cl>   <span class=p>[</span><span class=n>C</span><span class=p>]:</span> <span class=err>?</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨å®é™…çš„å·¥ç¨‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¾ˆéš¾è¿™ä¹ˆè½»æ˜“åœ°å‘ç°æˆ‘ä»¬å¼•ç”¨äº† nil å˜é‡ã€‚å› æ­¤ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬åœ¨è®¿é—®ä¸€äº› table å‹å˜é‡æ—¶ï¼Œéœ€è¦å…ˆåˆ¤æ–­è¯¥å˜é‡æ˜¯å¦ä¸º nilï¼Œä¾‹å¦‚å°†ä¸Šé¢çš„ä»£ç æ”¹æˆ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>person</span> <span class=o>=</span> <span class=p>{</span><span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;Bob&#34;</span><span class=p>,</span> <span class=n>sex</span> <span class=o>=</span> <span class=s2>&#34;M&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- do something</span>
</span></span><span class=line><span class=cl><span class=n>person</span> <span class=o>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=c1>-- do something</span>
</span></span><span class=line><span class=cl><span class=kr>if</span> <span class=n>person</span> <span class=o>~=</span> <span class=kc>nil</span> <span class=ow>and</span> <span class=n>person.name</span> <span class=o>~=</span> <span class=kc>nil</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>person.name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>else</span>
</span></span><span class=line><span class=cl><span class=c1>-- do somethingend</span>
</span></span></code></pre></td></tr></table></div></div><p>å¯¹äºç®€å•ç±»å‹çš„å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <em>if (var == nil) then</em> è¿™æ ·çš„ç®€å•å¥å­æ¥åˆ¤æ–­ã€‚<strong>ä½†æ˜¯å¯¹äº table å‹çš„ Lua å¯¹è±¡ï¼Œå°±ä¸èƒ½è¿™ä¹ˆç®€å•åˆ¤æ–­å®ƒæ˜¯å¦ä¸ºç©ºäº†ã€‚ä¸€ä¸ª table å‹å˜é‡çš„å€¼å¯èƒ½æ˜¯</strong> <strong><code>{}</code></strong>ï¼Œè¿™æ—¶å®ƒä¸ç­‰äº nilã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>next</span> <span class=o>=</span> <span class=n>next</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>a</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>b</span> <span class=o>=</span> <span class=p>{</span><span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;Bob&#34;</span><span class=p>,</span> <span class=n>sex</span> <span class=o>=</span> <span class=s2>&#34;Male&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>c</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;Male&#34;</span><span class=p>,</span> <span class=s2>&#34;Female&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>d</span> <span class=o>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=o>#</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=o>#</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=o>#</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>--print(#d)    -- error</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>if</span> <span class=n>a</span> <span class=o>==</span> <span class=kc>nil</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s2>&#34;a == nil&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>if</span> <span class=n>b</span> <span class=o>==</span> <span class=kc>nil</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s2>&#34;b == nil&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>if</span> <span class=n>c</span> <span class=o>==</span> <span class=kc>nil</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s2>&#34;c == nil&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>if</span> <span class=n>d</span><span class=o>==</span> <span class=kc>nil</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s2>&#34;d == nil&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>if</span> <span class=n>next</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=o>==</span> <span class=kc>nil</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s2>&#34;next(a) == nil&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>if</span> <span class=n>next</span><span class=p>(</span><span class=n>b</span><span class=p>)</span> <span class=o>==</span> <span class=kc>nil</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s2>&#34;next(b) == nil&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>if</span> <span class=n>next</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>==</span> <span class=kc>nil</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s2>&#34;next(c) == nil&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></td></tr></table></div></div><p>è¾“å‡º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>==</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=n>next</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=o>==</span> <span class=kc>nil</span>
</span></span></code></pre></td></tr></table></div></div><p>å› æ­¤ï¼Œæˆ‘ä»¬è¦åˆ¤æ–­ä¸€ä¸ª table æ˜¯å¦ä¸º <code>{}</code>ï¼Œä¸èƒ½é‡‡ç”¨ <code>#table == 0</code> çš„æ–¹å¼æ¥åˆ¤æ–­ã€‚å¯ä»¥ç”¨ä¸‹é¢è¿™æ ·çš„æ–¹æ³•æ¥åˆ¤æ–­ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>function isTableEmpty(t)
</span></span><span class=line><span class=cl>    return t <mark> nil or next(t) </mark> nil
</span></span><span class=line><span class=cl>end
</span></span></code></pre></td></tr></table></div></div><p>æ³¨æ„ï¼š<strong><code>next</code></strong> <strong>æŒ‡ä»¤æ˜¯ä¸èƒ½è¢« LuaJIT çš„ JIT ç¼–è¯‘ä¼˜åŒ–ï¼Œå¹¶ä¸” LuaJIT è²Œä¼¼æ²¡æœ‰æ˜ç¡®è®¡åˆ’æ”¯æŒè¿™ä¸ªæŒ‡ä»¤ä¼˜åŒ–ï¼Œåœ¨ä¸æ˜¯å¿…é¡»çš„æƒ…å†µä¸‹ï¼Œå°½é‡å°‘ç”¨ã€‚</strong></p><a href=#æ­£åˆ™è¡¨è¾¾å¼><h1 id=æ­£åˆ™è¡¨è¾¾å¼><span class=hanchor arialabel=Anchor># </span>æ­£åˆ™è¡¨è¾¾å¼</h1></a><p>åŒæ—¶å­˜åœ¨ä¸¤å¥—æ­£åˆ™è¡¨è¾¾å¼è§„èŒƒï¼š<em>Lua</em> è¯­è¨€çš„è§„èŒƒå’Œ <code>ngx.re.*</code> çš„è§„èŒƒï¼Œå³ä½¿æ‚¨å¯¹ <em>Lua</em> è¯­è¨€ä¸­çš„è§„èŒƒéå¸¸ç†Ÿæ‚‰ï¼Œæˆ‘ä»¬ä»ä¸å»ºè®®ä½¿ç”¨ <em>Lua</em> ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><ul><li><p>ä¸€æ˜¯å› ä¸º <em>Lua</em> ä¸­æ­£åˆ™è¡¨è¾¾å¼çš„æ€§èƒ½å¹¶ä¸å¦‚ <code>ngx.re.*</code> ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ä¼˜ç§€ï¼›</p></li><li><p>äºŒæ˜¯ <em>Lua</em> ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼å¹¶ä¸ç¬¦åˆ <em>POSIX</em> è§„èŒƒï¼Œè€Œ <code>ngx.re.*</code> ä¸­å®ç°çš„æ˜¯æ ‡å‡†çš„ <em>POSIX</em> è§„èŒƒï¼Œåè€…æ˜æ˜¾æ›´å…·å¤‡é€šç”¨æ€§ã€‚</p></li></ul><p><code>ngx.re.*</code> ä¸­çš„ <code>o</code> é€‰é¡¹ï¼ŒæŒ‡æ˜è¯¥å‚æ•°ï¼Œè¢«ç¼–è¯‘çš„ Pattern å°†ä¼šåœ¨å·¥ä½œè¿›ç¨‹ä¸­ç¼“å­˜ï¼Œå¹¶ä¸”è¢«å½“å‰å·¥ä½œè¿›ç¨‹çš„æ¯æ¬¡è¯·æ±‚æ‰€å…±äº«ã€‚Pattern ç¼“å­˜çš„ä¸Šé™å€¼é€šè¿‡ <code>lua_regex_cache_max_entries</code> æ¥ä¿®æ”¹ï¼Œå®ƒçš„é»˜è®¤å€¼ä¸º1024ã€‚</p><p><code>ngx.re.*</code> ä¸­çš„ <code>j</code> é€‰é¡¹ï¼ŒæŒ‡æ˜è¯¥å‚æ•°ï¼Œå¦‚æœä½¿ç”¨çš„ PCRE åº“æ”¯æŒ JITï¼ŒOpenResty ä¼šåœ¨ç¼–è¯‘ Pattern æ—¶å¯ç”¨ JITã€‚å¯ç”¨ JIT åæ­£åˆ™åŒ¹é…ä¼šæœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ã€‚è¾ƒæ–°çš„å¹³å°ï¼Œè‡ªå¸¦çš„ PCRE åº“å‡æ”¯æŒ JITã€‚å¦‚æœç³»ç»Ÿè‡ªå¸¦çš„ PCRE åº“ä¸æ”¯æŒ JITï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œæœ€å¥½è‡ªå·±ç¼–è¯‘ä¸€ä»½ libpcre.soï¼Œç„¶ååœ¨ç¼–è¯‘ OpenResty æ—¶é“¾æ¥è¿‡å»ã€‚è¦æƒ³éªŒè¯å½“å‰ PCRE åº“æ˜¯å¦æ”¯æŒ JITï¼Œå¯ä»¥è¿™ä¹ˆåš</p><ol><li><p>ç¼–è¯‘ OpenResty æ—¶åœ¨ <code>./configure</code> ä¸­æŒ‡å®š <code>--with-debug</code> é€‰é¡¹</p></li><li><p>åœ¨ <code>error_log</code> æŒ‡ä»¤ä¸­æŒ‡å®šæ—¥å¿—çº§åˆ«ä¸º <code>debug</code></p></li><li><p>è¿è¡Œæ­£åˆ™åŒ¹é…ä»£ç ï¼ŒæŸ¥çœ‹æ—¥å¿—ä¸­æ˜¯å¦æœ‰ <code>pcre JIT compiling result: 1</code></p></li></ol><p>å³ä½¿è¿è¡Œåœ¨ä¸æ”¯æŒ JIT çš„ OpenResty ä¸Šï¼ŒåŠ ä¸Š <code>j</code> é€‰é¡¹ä¹Ÿä¸ä¼šå¸¦æ¥åçš„å½±å“ã€‚åœ¨ OpenResty å®˜æ–¹çš„ Lua åº“ä¸­ï¼Œæ­£åˆ™åŒ¹é…è‡³å°‘éƒ½ä¼šå¸¦ä¸Š <code>jo</code> è¿™ä¸¤ä¸ªé€‰é¡¹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>location</span> <span class=o>/</span><span class=n>test</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>content_by_lua_block</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>local</span> <span class=n>regex</span> <span class=o>=</span> <span class=s>[[\d+]]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>-- å‚æ•° &#34;j&#34; å¯ç”¨ JIT ç¼–è¯‘ï¼Œå‚æ•° &#34;o&#34; æ˜¯å¼€å¯ç¼“å­˜å¿…é¡»çš„</span>
</span></span><span class=line><span class=cl>        <span class=kd>local</span> <span class=n>m</span> <span class=o>=</span> <span class=n>ngx.re</span><span class=p>.</span><span class=n>match</span><span class=p>(</span><span class=s2>&#34;hello, 1234&#34;</span><span class=p>,</span> <span class=n>regex</span><span class=p>,</span> <span class=s2>&#34;jo&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=kr>if</span> <span class=n>m</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>            <span class=n>ngx.say</span><span class=p>(</span><span class=n>m</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=kr>else</span>
</span></span><span class=line><span class=cl>            <span class=n>ngx.say</span><span class=p>(</span><span class=s2>&#34;not matched!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><a href=#lua-æ­£åˆ™ç®€å•æ±‡æ€»><h4 id=lua-æ­£åˆ™ç®€å•æ±‡æ€»><span class=hanchor arialabel=Anchor># </span><strong>Lua æ­£åˆ™ç®€å•æ±‡æ€»</strong></h4></a><p><em>Lua</em> ä¸­æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ä¸Šæœ€å¤§çš„åŒºåˆ«ï¼Œ<em>Lua</em> ä½¿ç”¨ <em>&rsquo;%&rsquo;</em> æ¥è¿›è¡Œè½¬ä¹‰ï¼Œè€Œå…¶ä»–è¯­è¨€çš„æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨ <em>&rsquo;'</em> ç¬¦å·æ¥è¿›è¡Œè½¬ä¹‰ã€‚å…¶æ¬¡ï¼Œ<em>Lua</em> ä¸­å¹¶ä¸ä½¿ç”¨ <em>&rsquo;?&rsquo;</em> æ¥è¡¨ç¤ºéè´ªå©ªåŒ¹é…ï¼Œè€Œæ˜¯å®šä¹‰äº†ä¸åŒçš„å­—ç¬¦æ¥è¡¨ç¤ºæ˜¯å¦æ˜¯è´ªå©ªåŒ¹é…ã€‚å®šä¹‰å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç¬¦å·</th><th>åŒ¹é…æ¬¡æ•°</th><th>åŒ¹é…æ¨¡å¼</th></tr></thead><tbody><tr><td>+</td><td>åŒ¹é…å‰ä¸€å­—ç¬¦ 1 æ¬¡æˆ–å¤šæ¬¡</td><td>éè´ªå©ª</td></tr><tr><td><code>*</code></td><td>åŒ¹é…å‰ä¸€å­—ç¬¦ 0 æ¬¡æˆ–å¤šæ¬¡</td><td>è´ªå©ª</td></tr><tr><td>-</td><td>åŒ¹é…å‰ä¸€å­—ç¬¦ 0 æ¬¡æˆ–å¤šæ¬¡</td><td>éè´ªå©ª</td></tr><tr><td>?</td><td>åŒ¹é…å‰ä¸€å­—ç¬¦ 0 æ¬¡æˆ–1æ¬¡</td><td>ä»…ç”¨äºæ­¤ï¼Œä¸ç”¨äºæ ‡è¯†æ˜¯å¦è´ªå©ª</td></tr></tbody></table><table><thead><tr><th>ç¬¦å·</th><th>åŒ¹é…æ¨¡å¼</th></tr></thead><tbody><tr><td>.</td><td>ä»»æ„å­—ç¬¦</td></tr><tr><td>%a</td><td>å­—æ¯</td></tr><tr><td>%c</td><td>æ§åˆ¶å­—ç¬¦</td></tr><tr><td>%d</td><td>æ•°å­—</td></tr><tr><td>%l</td><td>å°å†™å­—æ¯</td></tr><tr><td>%p</td><td>æ ‡ç‚¹å­—ç¬¦</td></tr><tr><td>%s</td><td>ç©ºç™½ç¬¦</td></tr><tr><td>%u</td><td>å¤§å†™å­—æ¯</td></tr><tr><td>%w</td><td>å­—æ¯å’Œæ•°å­—</td></tr><tr><td>%x</td><td>åå…­è¿›åˆ¶æ•°å­—</td></tr><tr><td>%z</td><td>ä»£è¡¨ 0 çš„å­—ç¬¦</td></tr></tbody></table><a href=#è™šå˜é‡><h1 id=è™šå˜é‡><span class=hanchor arialabel=Anchor># </span>è™šå˜é‡</h1></a><p>å½“ä¸€ä¸ªæ–¹æ³•è¿”å›å¤šä¸ªå€¼æ—¶ï¼Œæœ‰äº›è¿”å›å€¼æœ‰æ—¶å€™ç”¨ä¸åˆ°ï¼Œè¦æ˜¯å£°æ˜å¾ˆå¤šå˜é‡æ¥ä¸€ä¸€æ¥æ”¶ï¼Œæ˜¾ç„¶ä¸å¤ªåˆé€‚ï¼ˆä¸æ˜¯ä¸èƒ½ï¼‰ã€‚<strong>Lua æä¾›äº†ä¸€ä¸ªè™šå˜é‡(dummy variable)çš„æ¦‚å¿µï¼Œ æŒ‰ç…§</strong>**
<a href=https://www.lua.org/pil/1.3.html rel=noopener>æƒ¯ä¾‹</a>**<strong>ä»¥ä¸€ä¸ªä¸‹åˆ’çº¿ï¼ˆâ€œ_â€ï¼‰æ¥å‘½åï¼Œç”¨å®ƒæ¥è¡¨ç¤ºä¸¢å¼ƒä¸éœ€è¦çš„æ•°å€¼ï¼Œä»…ä»…èµ·åˆ°å ä½çš„ä½œç”¨ã€‚</strong></p><a href=#è¿”å›å€¼><h2 id=è¿”å›å€¼><span class=hanchor arialabel=Anchor># </span>è¿”å›å€¼</h2></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=c1>-- string.find (s,p) ä»string å˜é‡sçš„å¼€å¤´å‘ååŒ¹é… string</span>
</span></span><span class=line><span class=cl><span class=c1>-- pï¼Œè‹¥åŒ¹é…ä¸æˆåŠŸï¼Œè¿”å›nilï¼Œè‹¥åŒ¹é…æˆåŠŸï¼Œè¿”å›ç¬¬ä¸€æ¬¡åŒ¹é…æˆåŠŸ</span>
</span></span><span class=line><span class=cl><span class=c1>-- çš„èµ·æ­¢ä¸‹æ ‡ã€‚</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>start</span><span class=p>,</span> <span class=n>finish</span> <span class=o>=</span> <span class=n>string.find</span><span class=p>(</span><span class=s2>&#34;hello&#34;</span><span class=p>,</span> <span class=s2>&#34;he&#34;</span><span class=p>)</span> <span class=c1>--start å€¼ä¸ºèµ·å§‹ä¸‹æ ‡ï¼Œfinish</span>
</span></span><span class=line><span class=cl><span class=c1>--å€¼ä¸ºç»“æŸä¸‹æ ‡</span>
</span></span><span class=line><span class=cl><span class=n>print</span> <span class=p>(</span> <span class=n>start</span><span class=p>,</span> <span class=n>finish</span> <span class=p>)</span>                          <span class=c1>--è¾“å‡º 1   2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>start</span> <span class=o>=</span> <span class=n>string.find</span><span class=p>(</span><span class=s2>&#34;hello&#34;</span><span class=p>,</span> <span class=s2>&#34;he&#34;</span><span class=p>)</span>      <span class=c1>-- startå€¼ä¸ºèµ·å§‹ä¸‹æ ‡</span>
</span></span><span class=line><span class=cl><span class=n>print</span> <span class=p>(</span> <span class=n>start</span> <span class=p>)</span>                               <span class=c1>-- è¾“å‡º 1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>_</span><span class=p>,</span><span class=n>finish</span> <span class=o>=</span> <span class=n>string.find</span><span class=p>(</span><span class=s2>&#34;hello&#34;</span><span class=p>,</span> <span class=s2>&#34;he&#34;</span><span class=p>)</span>   <span class=c1>--é‡‡ç”¨è™šå˜é‡ï¼ˆå³ä¸‹åˆ’çº¿ï¼‰ï¼Œæ¥æ”¶èµ·</span>
</span></span><span class=line><span class=cl><span class=c1>--å§‹ä¸‹æ ‡å€¼ï¼Œç„¶åä¸¢å¼ƒï¼Œfinishæ¥æ”¶</span>
</span></span><span class=line><span class=cl><span class=c1>--ç»“æŸä¸‹æ ‡å€¼</span>
</span></span><span class=line><span class=cl><span class=n>print</span> <span class=p>(</span> <span class=n>finish</span> <span class=p>)</span>                              <span class=c1>--è¾“å‡º 2</span>
</span></span><span class=line><span class=cl><span class=n>print</span> <span class=p>(</span> <span class=n>_</span> <span class=p>)</span>    
</span></span></code></pre></td></tr></table></div></div><a href=#è¿­ä»£><h2 id=è¿­ä»£><span class=hanchor arialabel=Anchor># </span>è¿­ä»£</h2></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=c1>-- test.lua æ–‡ä»¶</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>t</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;all  data:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>for</span> <span class=n>i</span><span class=p>,</span><span class=n>v</span> <span class=kr>in</span> <span class=n>ipairs</span><span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=s2>&#34;part data:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>for</span> <span class=n>_</span><span class=p>,</span><span class=n>v</span> <span class=kr>in</span> <span class=n>ipairs</span><span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></td></tr></table></div></div><p>è¾“å‡º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=o>#</span> <span class=n>luajit</span> <span class=n>test.lua</span>
</span></span><span class=line><span class=cl><span class=n>all</span>  <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>   <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>2</span>   <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>   <span class=mi>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>part</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=mi>5</span>
</span></span></code></pre></td></tr></table></div></div><a href=#æŠµåˆ¶ä½¿ç”¨-module-å®šä¹‰æ¨¡å—><h1 id=æŠµåˆ¶ä½¿ç”¨-module-å®šä¹‰æ¨¡å—><span class=hanchor arialabel=Anchor># </span><strong>æŠµåˆ¶ä½¿ç”¨ module() å®šä¹‰æ¨¡å—</strong></h1></a><p>æ—§å¼çš„æ¨¡å—å®šä¹‰æ–¹å¼æ˜¯é€šè¿‡ <code>module("filename"[,package.seeall])*</code> æ¥æ˜¾å¼å£°æ˜ä¸€ä¸ªåŒ…ï¼Œç°åœ¨å®˜æ–¹ä¸æ¨èå†ä½¿ç”¨è¿™ç§æ–¹å¼</p><p>è¿™ç§æ–¹å¼å°†ä¼šè¿”å›ä¸€ä¸ªç”± <code>filename</code> æ¨¡å—å‡½æ•°ç»„æˆçš„ <code>table</code>ï¼Œå¹¶ä¸”è¿˜ä¼šå®šä¹‰ä¸€ä¸ªåŒ…å«è¯¥ <code>table</code> çš„å…¨å±€å˜é‡ã€‚</p><ol><li><p><code>package.seeall</code> è¿™ç§æ–¹å¼ç ´åäº†æ¨¡å—çš„é«˜å†…èšï¼ŒåŸæœ¬å¼•å…¥ &ldquo;filename&rdquo; æ¨¡å—åªæƒ³è°ƒç”¨å®ƒçš„ <em>foobar()</em> å‡½æ•°ï¼Œä½†æ˜¯å®ƒå´å¯ä»¥è¯»å†™å…¨å±€å±æ€§ï¼Œä¾‹å¦‚ <code>"filename.os"</code>ã€‚</p></li><li><p><code>module</code> å‡½æ•°å‹æ ˆæ“ä½œå¼•å‘çš„å‰¯ä½œç”¨ï¼Œæ±¡æŸ“äº†å…¨å±€ç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚ <code>module("filename")</code> ä¼šåˆ›å»ºä¸€ä¸ª <code>filename</code> çš„ <code>table</code>ï¼Œå¹¶å°†è¿™ä¸ª <code>table</code> æ³¨å…¥å…¨å±€ç¯å¢ƒå˜é‡ä¸­ï¼Œè¿™æ ·ä½¿å¾—æ²¡æœ‰å¼•ç”¨å®ƒçš„æ–‡ä»¶ä¹Ÿèƒ½è°ƒç”¨ <code>filename</code> æ¨¡å—çš„æ–¹æ³•ã€‚</p></li></ol><p>æ¨èçš„æ¨¡å—å®šä¹‰</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=c1>-- square.lua é•¿æ–¹å½¢æ¨¡å—</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>_M</span> <span class=o>=</span> <span class=p>{}</span>           <span class=c1>-- å±€éƒ¨çš„å˜é‡</span>
</span></span><span class=line><span class=cl><span class=n>_M._VERSION</span> <span class=o>=</span> <span class=s1>&#39;1.0&#39;</span>     <span class=c1>-- æ¨¡å—ç‰ˆæœ¬</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>mt</span> <span class=o>=</span> <span class=p>{</span> <span class=n>__index</span> <span class=o>=</span> <span class=n>_M</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>_M</span><span class=p>.</span><span class=nf>new</span><span class=p>(</span><span class=n>self</span><span class=p>,</span> <span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>setmetatable</span><span class=p>({</span> <span class=n>width</span><span class=o>=</span><span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=o>=</span><span class=n>height</span> <span class=p>},</span> <span class=n>mt</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>_M</span><span class=p>.</span><span class=nf>get_square</span><span class=p>(</span><span class=n>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>self.width</span> <span class=o>*</span> <span class=n>self.height</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>_M</span><span class=p>.</span><span class=nf>get_circumference</span><span class=p>(</span><span class=n>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=p>(</span><span class=n>self.width</span> <span class=o>+</span> <span class=n>self.height</span><span class=p>)</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>return</span> <span class=n>_M</span>
</span></span></code></pre></td></tr></table></div></div><p>ä½¿ç”¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>square</span> <span class=o>=</span> <span class=n>require</span> <span class=s2>&#34;square&#34;</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>s1</span> <span class=o>=</span> <span class=n>square</span><span class=p>:</span><span class=n>new</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>s1</span><span class=p>:</span><span class=n>get_square</span><span class=p>())</span>          <span class=c1>--output: 2</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>s1</span><span class=p>:</span><span class=n>get_circumference</span><span class=p>())</span>   <span class=c1>--output: 6</span>
</span></span></code></pre></td></tr></table></div></div><p>å¦ä¸€ä¸ªè·Ÿ Lua çš„ module æ¨¡å—ç›¸å…³éœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼Œå½“ lua_code_cache on å¼€å¯æ—¶ï¼Œrequire åŠ è½½çš„æ¨¡å—æ˜¯ä¼šè¢«ç¼“å­˜ä¸‹æ¥çš„ï¼Œè¿™æ ·æˆ‘ä»¬çš„æ¨¡å—å°±ä¼šä»¥æœ€é«˜æ•ˆçš„æ–¹å¼è¿è¡Œï¼Œç›´åˆ°è¢«æ˜¾å¼åœ°è°ƒç”¨å¦‚ä¸‹è¯­å¥ï¼ˆè¿™é‡Œæœ‰ç‚¹åƒæ¨¡å—å¸è½½ï¼‰ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>package.loaded[&#34;square&#34;] = nil
</span></span></code></pre></td></tr></table></div></div><a href=#è°ƒç”¨å‡½æ•°å‰å…ˆå®šä¹‰å‡½æ•°><h2 id=è°ƒç”¨å‡½æ•°å‰å…ˆå®šä¹‰å‡½æ•°><span class=hanchor arialabel=Anchor># </span>è°ƒç”¨å‡½æ•°å‰å…ˆå®šä¹‰å‡½æ•°</h2></a><p>Lua é‡Œé¢çš„å‡½æ•°å¿…é¡»æ”¾åœ¨è°ƒç”¨çš„ä»£ç ä¹‹å‰ï¼Œä¸‹é¢çš„ä»£ç æ˜¯ä¸€ä¸ªå¸¸è§çš„é”™è¯¯ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=c1>-- test.lua æ–‡ä»¶local i = 100</span>
</span></span><span class=line><span class=cl><span class=n>i</span> <span class=o>=</span> <span class=n>add_one</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>add_one</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></td></tr></table></div></div><p>å› æ­¤åœ¨å‡½æ•°å®šä¹‰ä¹‹å‰ä½¿ç”¨å‡½æ•°ç›¸å½“äºåœ¨å˜é‡èµ‹å€¼ä¹‹å‰ä½¿ç”¨å˜é‡ï¼ŒLua ä¸–ç•Œå¯¹äºæ²¡æœ‰èµ‹å€¼çš„å˜é‡ï¼Œé»˜è®¤éƒ½æ˜¯ nilï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿå°±äº§ç”Ÿäº†ä¸€ä¸ª nil çš„é”™è¯¯ã€‚</p><a href=#ç‚¹å·æ“ä½œç¬¦å’Œå†’å·æ“ä½œç¬¦çš„åŒºåˆ«><h1 id=ç‚¹å·æ“ä½œç¬¦å’Œå†’å·æ“ä½œç¬¦çš„åŒºåˆ«><span class=hanchor arialabel=Anchor># </span>ç‚¹å·æ“ä½œç¬¦å’Œå†’å·æ“ä½œç¬¦çš„åŒºåˆ«</h1></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>local str = &#34;abcde&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>print(&#34;case 1:&#34;, str:sub(1, 2))
</span></span><span class=line><span class=cl>print(&#34;case 2:&#34;, str.sub(str, 1, 2))
</span></span></code></pre></td></tr></table></div></div><p>è¾“å‡º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Lua data-lang=Lua><span class=line><span class=cl><span class=n>case</span> <span class=mi>1</span><span class=p>:</span> <span class=n>ab</span>
</span></span><span class=line><span class=cl><span class=n>case</span> <span class=mi>2</span><span class=p>:</span> <span class=n>ab</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p><strong>å†’å·æ“ä½œä¼šå¸¦å…¥ä¸€ä¸ª</strong> <strong><code>self</code></strong> <strong>å‚æ•°ï¼Œç”¨æ¥ä»£è¡¨</strong> <strong><code>è‡ªå·±</code>****ã€‚</strong></p></li><li><p>è€Œç‚¹å·æ“ä½œï¼Œåªæ˜¯ <code>å†…å®¹</code> çš„å±•å¼€ã€‚</p></li></ul><p>åœ¨å‡½æ•°å®šä¹‰æ—¶ï¼Œä½¿ç”¨å†’å·å°†é»˜è®¤æ¥æ”¶ä¸€ä¸ª <code>self</code> å‚æ•°ï¼Œè€Œä½¿ç”¨ç‚¹å·åˆ™éœ€è¦æ˜¾å¼ä¼ å…¥ <code>self</code> å‚æ•°</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>obj = { x = 20 }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function obj:fun1()
</span></span><span class=line><span class=cl>    print(self.x)
</span></span><span class=line><span class=cl>end
</span></span></code></pre></td></tr></table></div></div><p>ç­‰ä»·äº</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>obj = { x = 20 }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function obj.fun1(self)
</span></span><span class=line><span class=cl>    print(self.x)
</span></span><span class=line><span class=cl>end
</span></span></code></pre></td></tr></table></div></div><a href=#moduleçš„ç¼ºç‚¹><h1 id=moduleçš„ç¼ºç‚¹><span class=hanchor arialabel=Anchor># </span>moduleçš„ç¼ºç‚¹</h1></a><p>ç”±äº <code>lua_code_cache off</code> æƒ…å†µä¸‹ï¼Œç¼“å­˜çš„ä»£ç ä¼šä¼´éšè¯·æ±‚å®Œç»“è€Œé‡Šæ”¾ã€‚module çš„æœ€å¤§å¥½å¤„ç¼“å­˜è¿™æ—¶å€™æ˜¯æ— æ³•å‘æŒ¥çš„ï¼Œæ‰€ä»¥æœ¬ç« çš„å†…å®¹éƒ½æ˜¯åŸºäº <code>lua_code_cache on</code> çš„æƒ…å†µä¸‹ã€‚</p><p>å…ˆçœ‹çœ‹ä¸‹é¢ä»£ç ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>local ngx_socket_tcp = ngx.socket.tcp           -- â‘ 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>local _M = { _VERSION = &#39;0.06&#39; }                -- â‘¡
</span></span><span class=line><span class=cl>local mt = { __index = _M }                     -- â‘¢
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function _M.new(self)
</span></span><span class=line><span class=cl>    local sock, err = ngx_socket_tcp()          -- â‘£
</span></span><span class=line><span class=cl>    if not sock then
</span></span><span class=line><span class=cl>        return nil, err
</span></span><span class=line><span class=cl>    end
</span></span><span class=line><span class=cl>    return setmetatable({ sock = sock }, mt)    -- â‘¤
</span></span><span class=line><span class=cl>end
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function _M.set_timeout(self, timeout)
</span></span><span class=line><span class=cl>    local sock = self.sock
</span></span><span class=line><span class=cl>    if not sock then
</span></span><span class=line><span class=cl>        return nil, &#34;not initialized&#34;
</span></span><span class=line><span class=cl>    end
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return sock:settimeout(timeout)
</span></span><span class=line><span class=cl>end
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-- ... å…¶ä»–åŠŸèƒ½ä»£ç ï¼Œè¿™é‡Œç®€ç•¥
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>return _M
</span></span></code></pre></td></tr></table></div></div><ol><li><p>å¯¹äºæ¯”è¾ƒåº•å±‚çš„æ¨¡å—ï¼Œå†…éƒ¨ä½¿ç”¨åˆ°çš„éæœ¬åœ°å‡½æ•°ï¼Œéƒ½éœ€è¦ local æœ¬åœ°åŒ–ï¼Œè¿™æ ·åšçš„å¥½å¤„ï¼š</p><ol><li><p>é¿å…å‘½åå†²çªï¼šé˜²æ­¢å¤–éƒ¨æ˜¯ <code>require(...)</code> çš„æ–¹æ³•è°ƒç”¨é€ æˆå…¨å±€å˜é‡æ±¡æŸ“</p></li><li><p>è®¿é—®å±€éƒ¨å˜é‡çš„é€Ÿåº¦æ¯”å…¨å±€å˜é‡æ›´å¿«ã€æ›´å¿«ã€æ›´å¿«ï¼ˆé‡è¦äº‹æƒ…è¯´ä¸‰éï¼‰</p></li></ol></li><li><p>æ¯ä¸ªåŸºç¡€æ¨¡å—æœ€å¥½æœ‰è‡ªå·± <code>_VERSION</code> æ ‡è¯†ï¼Œæ–¹ä¾¿åæœŸåˆ©ç”¨ <code>_VERSION</code> å®Œæˆçƒ­ä»£ç éƒ¨ç½²ç­‰é«˜çº§ç‰¹æ€§ï¼Œä¹Ÿä¾¿äºä½¿ç”¨è€…å¯¹ç‰ˆæœ¬æœ‰æ•´ä½“æ„è¯†ã€‚</p></li><li><p>å…¶å® <code>_M</code> å’Œ <code>mt</code> å¯¹äºä¸åŒçš„è¯·æ±‚å®ä¾‹ï¼ˆrequire æ–¹æ³•å¾—åˆ°çš„å¯¹è±¡ï¼‰æ˜¯ç›¸åŒçš„ï¼Œå› ä¸º module ä¼šè¢«ç¼“å­˜åˆ°å…¨å±€ç¯å¢ƒä¸­ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªä½ç½®åƒä¸‡ä¸è¦æ”¾å•è¯·æ±‚å†…ä¸ªæ€§ä¿¡æ¯ï¼Œä¾‹å¦‚ ngx.ctx ç­‰å˜é‡ã€‚</p></li><li><p><strong>è¿™é‡Œéœ€è¦å®ç°çš„æ˜¯ç»™æ¯ä¸ªå®ä¾‹ç»‘å®šä¸åŒçš„ tcp å¯¹è±¡</strong>ï¼Œå<strong>é¢ setmetatable ç¡®ä¿äº†æ¯ä¸ªå®ä¾‹æ‹¥æœ‰è‡ªå·±çš„ socket å¯¹è±¡ï¼Œæ‰€ä»¥å¿…é¡»æ”¾åœ¨ new å‡½æ•°ä¸­</strong>ã€‚å¦‚æœæ”¾åœ¨ â‘¢ çš„ä¸‹é¢ï¼Œé‚£ä¹ˆè¿™æ—¶å€™æ‰€æœ‰çš„ä¸åŒå®ä¾‹å†…éƒ¨å°†ç»‘å®šäº†åŒä¸€ä¸ª socket å¯¹è±¡ã€‚</p></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>local mt = { __index = _M }                     -- â‘¢
</span></span><span class=line><span class=cl>local sock = ngx_socket_tcp()                   -- â‘£ é”™è¯¯çš„
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function _M.new(self)
</span></span><span class=line><span class=cl>    return setmetatable({ sock = sock }, mt)    -- â‘¤
</span></span><span class=line><span class=cl>end
</span></span></code></pre></td></tr></table></div></div><ol start=5><li><p>Lua çš„ module æœ‰ä¸¤ç§ç±»å‹ï¼š</p><ol><li><p>æ”¯æŒé¢å‘å¯¹è±¡ç—•è¿¹å¯ä»¥ä¿ç•™ç§æœ‰å±æ€§ï¼›é™æ€æ–¹æ³•æä¾›è€…ï¼Œæ²¡æœ‰ä»»ä½•ç§æœ‰å±æ€§ã€‚</p></li><li><p>çœŸæ­£èµ·åˆ°åŒºåˆ«ä½œç”¨çš„å°±æ˜¯ setmetatable å‡½æ•°ï¼Œæ˜¯å¦æœ‰è‡ªå·±çš„ä¸ªæ€§å…ƒè¡¨ï¼Œæœ€ç»ˆå¯¼è‡´ä¸¤ç§ä¸åŒçš„å½¢æ€ã€‚</p></li></ol></li></ol><a href=#ffi><h1 id=ffi><span class=hanchor arialabel=Anchor># </span>FFI</h1></a><p><a href=https://moonbingbing.gitbooks.io/openresty-best-practices/content/lua/FFI.html rel=noopener>https://moonbingbing.gitbooks.io/openresty-best-practices/content/lua/FFI.html</a></p><p>FFI åº“ï¼Œæ˜¯ LuaJIT ä¸­æœ€é‡è¦çš„ä¸€ä¸ªæ‰©å±•åº“ã€‚å®ƒå…è®¸ä»çº¯ Lua ä»£ç è°ƒç”¨å¤–éƒ¨ C å‡½æ•°ï¼Œä½¿ç”¨ C æ•°æ®ç»“æ„ã€‚</p><p>FFI åº“æœ€å¤§é™åº¦çš„çœå»äº†ä½¿ç”¨ C æ‰‹å·¥ç¼–å†™ç¹é‡çš„ <code>Lua/C</code> ç»‘å®šçš„éœ€è¦ã€‚ä¸éœ€è¦å­¦ä¹ ä¸€é—¨ç‹¬ç«‹/é¢å¤–çš„ç»‘å®šè¯­è¨€â€”â€”å®ƒè§£ææ™®é€š C å£°æ˜ã€‚è¿™æ ·å¯ä»¥ä» C å¤´æ–‡ä»¶æˆ–å‚è€ƒæ‰‹å†Œä¸­ï¼Œç›´æ¥å‰ªåˆ‡ï¼Œç²˜è´´ã€‚å®ƒçš„ä»»åŠ¡å°±æ˜¯ç»‘å®šå¾ˆå¤§çš„åº“ï¼Œä½†ä¸éœ€è¦æ£é¼“è„†å¼±çš„ç»‘å®šç”Ÿæˆå™¨ã€‚</p><p>FFI ç´§ç´§çš„æ•´åˆè¿›äº† LuaJITï¼ˆå‡ ä¹ä¸å¯èƒ½ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼‰ã€‚<code>JIT</code> ç¼–è¯‘å™¨åœ¨ C æ•°æ®ç»“æ„ä¸Šæ‰€äº§ç”Ÿçš„ä»£ç ï¼Œç­‰åŒäºä¸€ä¸ª C ç¼–è¯‘å™¨åº”è¯¥ç”Ÿäº§çš„ä»£ç ã€‚åœ¨ <code>JIT</code> ç¼–è¯‘è¿‡çš„ä»£ç ä¸­ï¼Œè°ƒç”¨ C å‡½æ•°ï¼Œå¯ä»¥è¢«å†…è¿å¤„ç†ï¼Œä¸åŒäºåŸºäº <code>Lua/C API</code> å‡½æ•°è°ƒç”¨ã€‚</p><a href=#ffi-åº“-è¯æ±‡><h2 id=ffi-åº“-è¯æ±‡><span class=hanchor arialabel=Anchor># </span><strong>ffi åº“ è¯æ±‡</strong></h2></a><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>noun</td><td>Explanation</td></tr><tr><td>cdecl</td><td>A definition of an abstract C type(actually, is a lua string)</td></tr><tr><td>ctype</td><td>C type object</td></tr><tr><td>cdata</td><td>C data object</td></tr><tr><td>ct</td><td>C type format, is a template object, may be cdecl, cdata, ctype</td></tr><tr><td>cb</td><td>callback object</td></tr><tr><td>VLA</td><td>An array of variable length</td></tr><tr><td>VLS</td><td>A structure of variable length</td></tr></tbody></table><a href=#ffi-api><h2 id=ffi-api><span class=hanchor arialabel=Anchor># </span><em><em>ffi.</em> API</em>*</h2></a><p><strong>åŠŸèƒ½ï¼š</strong> <em>Lua ffi åº“çš„ APIï¼Œä¸ LuaJIT ä¸å¯åˆ†å‰²ã€‚</em></p><p>æ¯«æ— ç–‘é—®ï¼Œåœ¨ <code>lua</code> æ–‡ä»¶ä¸­ä½¿ç”¨ <code>ffi</code> åº“çš„æ—¶å€™ï¼Œå¿…é¡»è¦æœ‰ä¸‹é¢çš„ä¸€è¡Œã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>local ffi = require &#34;ffi&#34;
</span></span></code></pre></td></tr></table></div></div><a href=#jit><h1 id=jit><span class=hanchor arialabel=Anchor># </span>JIT</h1></a><p>çœ‹ä¸€ä¸‹ LuaJIT å®˜æ–¹çš„è§£é‡Šï¼šLuaJIT is a Just-In-Time Compilerfor the Lua programming languageã€‚</p><p><strong>LuaJIT çš„è¿è¡Œæ—¶ç¯å¢ƒåŒ…æ‹¬ä¸€ä¸ªç”¨æ‰‹å†™æ±‡ç¼–å®ç°çš„ Lua è§£é‡Šå™¨å’Œä¸€ä¸ªå¯ä»¥ç›´æ¥ç”Ÿæˆæœºå™¨ä»£ç çš„ JIT ç¼–è¯‘å™¨</strong></p><ul><li><p>ä¸€å¼€å§‹çš„æ—¶å€™ï¼ŒLua å­—èŠ‚ç æ€»æ˜¯è¢« LuaJIT çš„è§£é‡Šå™¨è§£é‡Šæ‰§è¡Œã€‚LuaJIT çš„è§£é‡Šå™¨ä¼šåœ¨æ‰§è¡Œå­—èŠ‚ç æ—¶åŒæ—¶è®°å½•ä¸€äº›è¿è¡Œæ—¶çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ¯”å¦‚æ¯ä¸ª Lua å‡½æ•°è°ƒç”¨å…¥å£çš„å®é™…è¿è¡Œæ¬¡æ•°ï¼Œè¿˜æœ‰æ¯ä¸ª Lua å¾ªç¯çš„å®é™…æ‰§è¡Œæ¬¡æ•°ã€‚</p></li><li><p>å½“è¿™äº›æ¬¡æ•°è¶…è¿‡æŸä¸ªé¢„è®¾çš„é˜ˆå€¼æ—¶ï¼Œä¾¿è®¤ä¸ºå¯¹åº”çš„ Lua å‡½æ•°å…¥å£æˆ–è€…å¯¹åº”çš„ Lua å¾ªç¯è¶³å¤Ÿçš„â€œçƒ­â€ï¼Œè¿™æ—¶ä¾¿ä¼šè§¦å‘ JIT ç¼–è¯‘å™¨å¼€å§‹å·¥ä½œã€‚</p></li><li><p>JIT ç¼–è¯‘å™¨ä¼šä»çƒ­å‡½æ•°çš„å…¥å£æˆ–è€…çƒ­å¾ªç¯çš„æŸä¸ªä½ç½®å¼€å§‹å°è¯•ç¼–è¯‘å¯¹åº”çš„ Lua ä»£ç è·¯å¾„ã€‚ç¼–è¯‘çš„è¿‡ç¨‹æ˜¯æŠŠ LuaJIT å­—èŠ‚ç å…ˆè½¬æ¢æˆ LuaJIT è‡ªå·±å®šä¹‰çš„ä¸­é—´ç ï¼ˆIRï¼‰ï¼Œç„¶åå†ç”Ÿæˆé’ˆå¯¹ç›®æ ‡ä½“ç³»ç»“æ„çš„æœºå™¨ç ï¼ˆæ¯”å¦‚ x86_64 æŒ‡ä»¤ç»„æˆçš„æœºå™¨ç ï¼‰</p></li><li><p>å¦‚æœå½“å‰ Lua ä»£ç è·¯å¾„ä¸Šçš„æ‰€æœ‰çš„æ“ä½œéƒ½å¯ä»¥è¢« JIT ç¼–è¯‘å™¨é¡ºåˆ©ç¼–è¯‘ï¼Œåˆ™è¿™æ¡ç¼–è¯‘è¿‡çš„ä»£ç è·¯å¾„ä¾¿è¢«ç§°ä¸ºä¸€ä¸ªâ€œtraceâ€ï¼Œåœ¨ç‰©ç†ä¸Šå¯¹åº”ä¸€ä¸ª <code>trace</code> ç±»å‹çš„ GC å¯¹è±¡ï¼ˆå³å‚ä¸ Lua GC çš„å¯¹è±¡ï¼‰ã€‚</p></li></ul><p>JIT ç¼–è¯‘å™¨ä¸æ”¯æŒçš„åŸè¯­è¢«ç§°ä¸º <strong>NYIï¼ˆNot Yet Implementedï¼‰åŸè¯­</strong>ã€‚æ¯”è¾ƒå®Œæ•´çš„ NYI åˆ—è¡¨åœ¨è¿™ç¯‡æ–‡æ¡£é‡Œé¢ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Plaintext data-lang=Plaintext><span class=line><span class=cl>http://wiki.luajit.org/NYI
</span></span></code></pre></td></tr></table></div></div><p>æ‰€è°“â€œè®©æ›´å¤šçš„ Lua ä»£ç è¢« JIT ç¼–è¯‘â€ï¼Œå…¶å®å°±æ˜¯å¸®åŠ©æ›´å¤šçš„ Lua ä»£ç è·¯å¾„èƒ½ä¸º JIT ç¼–è¯‘å™¨æ‰€æ¥å—ã€‚è¿™ä¸€èˆ¬é€šè¿‡ä¸¤ç§é€”å¾„æ¥å®ç°ï¼š</p><ol><li><p>è°ƒæ•´å¯¹åº”çš„ Lua ä»£ç ï¼Œ<strong>é¿å…ä½¿ç”¨ NYI åŸè¯­</strong>ã€‚</p></li><li><p>å¢å¼º JIT ç¼–è¯‘å™¨ï¼Œè®©è¶Šæ¥è¶Šå¤šçš„ NYI åŸè¯­èƒ½å¤Ÿè¢«ç¼–è¯‘ã€‚</p></li></ol><a href=#å¯ä»¥è¢«-jit-ç¼–è¯‘çš„å…ƒæ“ä½œ><h2 id=å¯ä»¥è¢«-jit-ç¼–è¯‘çš„å…ƒæ“ä½œ><span class=hanchor arialabel=Anchor># </span><strong>å¯ä»¥è¢« JIT ç¼–è¯‘çš„å…ƒæ“ä½œ</strong></h2></a><p>ä¸‹é¢ç»™å¤§å®¶åˆ—ä¸€ä¸‹æˆªæ­¢åˆ°ç›®å‰å·²ç»å¯ä»¥è¢« JIT ç¼–è¯‘çš„å…ƒæ“ä½œã€‚ å…¶ä»–è¿˜æœ‰ IOã€Bitã€FFIã€Coroutineã€OSã€Packageã€Debugã€JIT ç­‰åˆ†ç±»ï¼Œä½¿ç”¨é¢‘ç‡ç›¸å¯¹è¾ƒä½ï¼Œè¿™é‡Œå°±ä¸ç½—åˆ—äº†ï¼Œå¯ä»¥å‚è€ƒå®˜ç½‘ï¼š
<a href=http://wiki.luajit.org/NYI rel=noopener>http://wiki.luajit.org/NYI</a>ã€‚</p><a href=#åŸºç¡€åº“çš„æ”¯æŒæƒ…å†µ><h3 id=åŸºç¡€åº“çš„æ”¯æŒæƒ…å†µ><span class=hanchor arialabel=Anchor># </span><strong>åŸºç¡€åº“çš„æ”¯æŒæƒ…å†µ</strong></h3></a><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>å‡½æ•°</td><td>ç¼–è¯‘?</td><td>å¤‡æ³¨</td></tr><tr><td>assert</td><td>yes</td><td></td></tr><tr><td>collectgarbage</td><td>no</td><td></td></tr><tr><td>dofile</td><td>never</td><td></td></tr><tr><td>error</td><td>never</td><td></td></tr><tr><td>getfenv</td><td>2.1 partial</td><td>åªæœ‰ getfenv(0) èƒ½ç¼–è¯‘</td></tr><tr><td>getmetatable</td><td>yes</td><td></td></tr><tr><td>ipairs</td><td>yes</td><td></td></tr><tr><td>load</td><td>never</td><td></td></tr><tr><td>loadfile</td><td>never</td><td></td></tr><tr><td>loadstring</td><td>never</td><td></td></tr><tr><td>next</td><td>no</td><td></td></tr><tr><td>pairs</td><td>no</td><td></td></tr><tr><td>pcall</td><td>yes</td><td></td></tr><tr><td>print</td><td>no</td><td></td></tr><tr><td>rawequal</td><td>yes</td><td></td></tr><tr><td>rawget</td><td>yes</td><td></td></tr><tr><td>rawlen (5.2)</td><td>yes</td><td></td></tr><tr><td>rawset</td><td>yes</td><td></td></tr><tr><td>select</td><td>partial</td><td>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é™æ€å˜é‡çš„æ—¶å€™å¯ä»¥ç¼–è¯‘</td></tr><tr><td>setfenv</td><td>no</td><td></td></tr><tr><td>setmetatable</td><td>yes</td><td></td></tr><tr><td>tonumber</td><td>partial</td><td>ä¸èƒ½ç¼–è¯‘é10è¿›åˆ¶ï¼Œéé¢„æœŸçš„å¼‚å¸¸è¾“å…¥</td></tr><tr><td>tostring</td><td>partial</td><td>åªèƒ½ç¼–è¯‘ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”ã€nil ä»¥åŠæ”¯æŒ __tostringå…ƒæ–¹æ³•çš„ç±»å‹</td></tr><tr><td>type</td><td>yes</td><td></td></tr><tr><td>unpack</td><td>no</td><td></td></tr><tr><td>xpcall</td><td>yes</td><td></td></tr></tbody></table><a href=#å­—ç¬¦ä¸²åº“><h3 id=å­—ç¬¦ä¸²åº“><span class=hanchor arialabel=Anchor># </span><strong>å­—ç¬¦ä¸²åº“</strong></h3></a><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>å‡½æ•°</td><td>ç¼–è¯‘?</td><td>å¤‡æ³¨</td></tr><tr><td>string.byte</td><td>yes</td><td></td></tr><tr><td>string.char</td><td>2.1</td><td></td></tr><tr><td>string.dump</td><td>never</td><td></td></tr><tr><td>string.find</td><td>2.1 partial</td><td>åªæœ‰å­—ç¬¦ä¸²æ ·å¼æŸ¥æ‰¾ï¼ˆæ²¡æœ‰æ ·å¼ï¼‰</td></tr><tr><td>string.format</td><td>2.1 partial</td><td>ä¸æ”¯æŒ %p æˆ– éå­—ç¬¦ä¸²å‚æ•°çš„ %s</td></tr><tr><td>string.gmatch</td><td>no</td><td></td></tr><tr><td>string.gsub</td><td>no</td><td></td></tr><tr><td>string.len</td><td>yes</td><td></td></tr><tr><td>string.lower</td><td>2.1</td><td></td></tr><tr><td>string.match</td><td>no</td><td></td></tr><tr><td>string.rep</td><td>2.1</td><td></td></tr><tr><td>string.reverse</td><td>2.1</td><td></td></tr><tr><td>string.sub</td><td>yes</td><td></td></tr><tr><td>string.upper</td><td>2.1</td><td></td></tr></tbody></table><a href=#è¡¨><h3 id=è¡¨><span class=hanchor arialabel=Anchor># </span><strong>è¡¨</strong></h3></a><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>å‡½æ•°</td><td>ç¼–è¯‘?</td><td>å¤‡æ³¨</td></tr><tr><td>table.concat</td><td>2.1</td><td></td></tr><tr><td>table.foreach</td><td>no</td><td>2.1: å†…éƒ¨ç¼–è¯‘ï¼Œä½†è¿˜æ²¡æœ‰å¤–æ”¾</td></tr><tr><td>table.foreachi</td><td>2.1</td><td></td></tr><tr><td>table.getn</td><td>yes</td><td></td></tr><tr><td>table.insert</td><td>partial</td><td>åªæœ‰ push æ“ä½œ</td></tr><tr><td>table.maxn</td><td>no</td><td></td></tr><tr><td>table.pack (5.2)</td><td>no</td><td></td></tr><tr><td>table.remove</td><td>2.1</td><td>éƒ¨åˆ†ï¼Œåªæœ‰ pop æ“ä½œ</td></tr><tr><td>table.sort</td><td>no</td><td></td></tr><tr><td>table.unpack (5.2)</td><td>no</td><td></td></tr></tbody></table><a href=#math-åº“><h3 id=math-åº“><span class=hanchor arialabel=Anchor># </span><strong>math åº“</strong></h3></a><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>å‡½æ•°</td><td>ç¼–è¯‘?</td><td>å¤‡æ³¨</td></tr><tr><td>math.abs</td><td>yes</td><td></td></tr><tr><td>math.acos</td><td>yes</td><td></td></tr><tr><td>math.asin</td><td>yes</td><td></td></tr><tr><td>math.atan</td><td>yes</td><td></td></tr><tr><td>math.atan2</td><td>yes</td><td></td></tr><tr><td>math.ceil</td><td>yes</td><td></td></tr><tr><td>math.cos</td><td>yes</td><td></td></tr><tr><td>math.cosh</td><td>yes</td><td></td></tr><tr><td>math.deg</td><td>yes</td><td></td></tr><tr><td>math.exp</td><td>yes</td><td></td></tr><tr><td>math.floor</td><td>yes</td><td></td></tr><tr><td>math.fmod</td><td>no</td><td></td></tr><tr><td>math.frexp</td><td>no</td><td></td></tr><tr><td>math.ldexp</td><td>yes</td><td></td></tr><tr><td>math.log</td><td>yes</td><td></td></tr><tr><td>math.log10</td><td>yes</td><td></td></tr><tr><td>math.max</td><td>yes</td><td></td></tr><tr><td>math.min</td><td>yes</td><td></td></tr><tr><td>math.modf</td><td>yes</td><td></td></tr><tr><td>math.pow</td><td>yes</td><td></td></tr><tr><td>math.rad</td><td>yes</td><td></td></tr><tr><td>math.random</td><td>yes</td><td></td></tr><tr><td>math.randomseed</td><td>no</td><td></td></tr><tr><td>math.sin</td><td>yes</td><td></td></tr><tr><td>math.sinh</td><td>yes</td><td></td></tr><tr><td>math.sqrt</td><td>yes</td><td></td></tr><tr><td>math.tan</td><td>yes</td><td></td></tr><tr><td>math.tanh</td><td>yes</td><td></td></tr></tbody></table></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/lua/%E7%94%A8Go%E5%AE%9E%E7%8E%B0Lua/%E5%89%8D%E8%A8%80/ data-ctx=Luaé«˜çº§ data-src=/lua/%E7%94%A8Go%E5%AE%9E%E7%8E%B0Lua/%E5%89%8D%E8%A8%80 class=internal-link>å‰è¨€</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://googoo-s.github.io/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by googoo-s using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2023</p><ul><li><a href=https://googoo-s.github.io/>Home</a></li><li><a href=https://github.com/googoo-s>GitHub</a></li></ul></footer></div></div></body></html>