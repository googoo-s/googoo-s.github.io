<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="åŸæ–‡åœ°å€ï¼š https://juejin.cn/post/7122014462181113887ï¼ŒJavaGuideopen in new window å¯¹æœ¬æ–‡è¿›è¡Œäº†å®Œå–„æ€»ç»“ã€‚
 æˆ‘æœ‰ä¸€ä¸ªæœ‹å‹åšäº†ä¸€ä¸ªå°ç ´ç«™ï¼Œç°åœ¨è¦å®ç°ä¸€ä¸ªç«™å†…ä¿¡ Web æ¶ˆæ¯æ¨é€çš„åŠŸèƒ½ï¼Œå¯¹ï¼Œå°±æ˜¯ä¸‹å›¾è¿™ä¸ªå°çº¢ç‚¹ï¼Œä¸€ä¸ªå¾ˆå¸¸ç”¨çš„åŠŸèƒ½ã€‚
 ç«™å†…ä¿¡ Web æ¶ˆæ¯æ¨é€
ä¸è¿‡ä»–è¿˜æ²¡æƒ³å¥½ç”¨ä»€ä¹ˆæ–¹å¼åšï¼Œè¿™é‡Œæˆ‘å¸®ä»–æ•´ç†äº†ä¸€ä¸‹å‡ ç§æ–¹æ¡ˆï¼Œå¹¶ç®€å•åšäº†å®ç°ã€‚
# ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ¨é€ï¼Ÿ æ¨é€çš„åœºæ™¯æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚æœ‰äººå…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼Œè¿™æ—¶æˆ‘å°±ä¼šæ”¶åˆ°ä¸€æ¡æ¨é€æ¶ˆæ¯ï¼Œä»¥æ­¤æ¥å¸å¼•æˆ‘ç‚¹å‡»æ‰“å¼€åº”ç”¨ã€‚
æ¶ˆæ¯æ¨é€é€šå¸¸æ˜¯æŒ‡ç½‘ç«™çš„è¿è¥å·¥ä½œç­‰äººå‘˜ï¼Œé€šè¿‡æŸç§å·¥å…·å¯¹ç”¨æˆ·å½“å‰ç½‘é¡µæˆ–ç§»åŠ¨è®¾å¤‡ APP è¿›è¡Œçš„ä¸»åŠ¨æ¶ˆæ¯æ¨é€ã€‚"><meta property="og:title" content><meta property="og:description" content="åŸæ–‡åœ°å€ï¼š https://juejin.cn/post/7122014462181113887ï¼ŒJavaGuideopen in new window å¯¹æœ¬æ–‡è¿›è¡Œäº†å®Œå–„æ€»ç»“ã€‚
 æˆ‘æœ‰ä¸€ä¸ªæœ‹å‹åšäº†ä¸€ä¸ªå°ç ´ç«™ï¼Œç°åœ¨è¦å®ç°ä¸€ä¸ªç«™å†…ä¿¡ Web æ¶ˆæ¯æ¨é€çš„åŠŸèƒ½ï¼Œå¯¹ï¼Œå°±æ˜¯ä¸‹å›¾è¿™ä¸ªå°çº¢ç‚¹ï¼Œä¸€ä¸ªå¾ˆå¸¸ç”¨çš„åŠŸèƒ½ã€‚
 ç«™å†…ä¿¡ Web æ¶ˆæ¯æ¨é€
ä¸è¿‡ä»–è¿˜æ²¡æƒ³å¥½ç”¨ä»€ä¹ˆæ–¹å¼åšï¼Œè¿™é‡Œæˆ‘å¸®ä»–æ•´ç†äº†ä¸€ä¸‹å‡ ç§æ–¹æ¡ˆï¼Œå¹¶ç®€å•åšäº†å®ç°ã€‚
# ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ¨é€ï¼Ÿ æ¨é€çš„åœºæ™¯æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚æœ‰äººå…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼Œè¿™æ—¶æˆ‘å°±ä¼šæ”¶åˆ°ä¸€æ¡æ¨é€æ¶ˆæ¯ï¼Œä»¥æ­¤æ¥å¸å¼•æˆ‘ç‚¹å‡»æ‰“å¼€åº”ç”¨ã€‚
æ¶ˆæ¯æ¨é€é€šå¸¸æ˜¯æŒ‡ç½‘ç«™çš„è¿è¥å·¥ä½œç­‰äººå‘˜ï¼Œé€šè¿‡æŸç§å·¥å…·å¯¹ç”¨æˆ·å½“å‰ç½‘é¡µæˆ–ç§»åŠ¨è®¾å¤‡ APP è¿›è¡Œçš„ä¸»åŠ¨æ¶ˆæ¯æ¨é€ã€‚"><meta property="og:type" content="website"><meta property="og:image" content="https://googoo-s.github.io/icon.png"><meta property="og:url" content="https://googoo-s.github.io/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5/Web-%E5%AE%9E%E6%97%B6%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E8%AF%A6%E8%A7%A3/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="åŸæ–‡åœ°å€ï¼š https://juejin.cn/post/7122014462181113887ï¼ŒJavaGuideopen in new window å¯¹æœ¬æ–‡è¿›è¡Œäº†å®Œå–„æ€»ç»“ã€‚
 æˆ‘æœ‰ä¸€ä¸ªæœ‹å‹åšäº†ä¸€ä¸ªå°ç ´ç«™ï¼Œç°åœ¨è¦å®ç°ä¸€ä¸ªç«™å†…ä¿¡ Web æ¶ˆæ¯æ¨é€çš„åŠŸèƒ½ï¼Œå¯¹ï¼Œå°±æ˜¯ä¸‹å›¾è¿™ä¸ªå°çº¢ç‚¹ï¼Œä¸€ä¸ªå¾ˆå¸¸ç”¨çš„åŠŸèƒ½ã€‚
 ç«™å†…ä¿¡ Web æ¶ˆæ¯æ¨é€
ä¸è¿‡ä»–è¿˜æ²¡æƒ³å¥½ç”¨ä»€ä¹ˆæ–¹å¼åšï¼Œè¿™é‡Œæˆ‘å¸®ä»–æ•´ç†äº†ä¸€ä¸‹å‡ ç§æ–¹æ¡ˆï¼Œå¹¶ç®€å•åšäº†å®ç°ã€‚
# ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ¨é€ï¼Ÿ æ¨é€çš„åœºæ™¯æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚æœ‰äººå…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼Œè¿™æ—¶æˆ‘å°±ä¼šæ”¶åˆ°ä¸€æ¡æ¨é€æ¶ˆæ¯ï¼Œä»¥æ­¤æ¥å¸å¼•æˆ‘ç‚¹å‡»æ‰“å¼€åº”ç”¨ã€‚
æ¶ˆæ¯æ¨é€é€šå¸¸æ˜¯æŒ‡ç½‘ç«™çš„è¿è¥å·¥ä½œç­‰äººå‘˜ï¼Œé€šè¿‡æŸç§å·¥å…·å¯¹ç”¨æˆ·å½“å‰ç½‘é¡µæˆ–ç§»åŠ¨è®¾å¤‡ APP è¿›è¡Œçš„ä¸»åŠ¨æ¶ˆæ¯æ¨é€ã€‚"><meta name=twitter:image content="https://googoo-s.github.io/icon.png"><title>googoo-s ğŸ˜„ğŸ˜¸ğŸ˜</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://googoo-s.github.io//icon.png><link href=https://googoo-s.github.io/styles.19109a40042e9f0e72e952fda4442a34.min.css rel=stylesheet><link href=https://googoo-s.github.io/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://googoo-s.github.io/js/darkmode.953af745b0f9342644d632fc167f3727.min.js></script>
<script src=https://googoo-s.github.io/js/util.00639692264b21bc3ee219733d38a8be.min.js></script>
<link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script defer src=https://googoo-s.github.io/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://googoo-s.github.io/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://googoo-s.github.io/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://googoo-s.github.io/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://googoo-s.github.io/",fetchData=Promise.all([fetch("https://googoo-s.github.io/indices/linkIndex.42375ba996c43a74314996d90dacfb87.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://googoo-s.github.io/indices/contentIndex.4994776ff53419a01429d7b1a0de2e9f.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://googoo-s.github.io",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!0;drawGraph("https://googoo-s.github.io",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/googoo-s.github.io\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=googoo-s.github.io src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://googoo-s.github.io/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://googoo-s.github.io/>googoo-s ğŸ˜„ğŸ˜¸ğŸ˜</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><p class=meta>Last updated
Unknown</p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><ol><li><a href=#ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ¨é€-ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ¨é€><a href=#%E4%BB%80%E4%B9%88%E6%98%AF%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81>#</a> ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ¨é€ï¼Ÿ</a></li><li><a href=#æ¶ˆæ¯æ¨é€å¸¸è§æ–¹æ¡ˆ-æ¶ˆæ¯æ¨é€å¸¸è§æ–¹æ¡ˆ><a href=#%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E5%B8%B8%E8%A7%81%E6%96%B9%E6%A1%88>#</a> æ¶ˆæ¯æ¨é€å¸¸è§æ–¹æ¡ˆ</a><ol><li><a href=#çŸ­è½®è¯¢-çŸ­è½®è¯¢><a href=#%E7%9F%AD%E8%BD%AE%E8%AF%A2>#</a> çŸ­è½®è¯¢</a></li><li><a href=#é•¿è½®è¯¢-é•¿è½®è¯¢><a href=#%E9%95%BF%E8%BD%AE%E8%AF%A2>#</a> é•¿è½®è¯¢</a></li><li><a href=#iframe-æµ-iframe-æµ><a href=#iframe-%E6%B5%81>#</a> iframe æµ</a></li><li><a href=#sse-æˆ‘çš„æ–¹å¼-sse-æˆ‘çš„æ–¹å¼><a href=#sse-%E6%88%91%E7%9A%84%E6%96%B9%E5%BC%8F>#</a> SSE (æˆ‘çš„æ–¹å¼)</a></li><li><a href=#websocket-websocket><a href=#websocket>#</a> Websocket</a></li><li><a href=#mqtt-mqtt><a href=#mqtt>#</a> MQTT</a></li></ol></li><li><a href=#æ€»ç»“-æ€»ç»“><a href=#%E6%80%BB%E7%BB%93>#</a> æ€»ç»“</a></li></ol></li></ol></nav></details></aside><blockquote><p>åŸæ–‡åœ°å€ï¼š
<a href=https://juejin.cn/post/7122014462181113887%EF%BC%8CJavaGuide rel=noopener>https://juejin.cn/post/7122014462181113887ï¼ŒJavaGuideopen in new window</a> å¯¹æœ¬æ–‡è¿›è¡Œäº†å®Œå–„æ€»ç»“ã€‚</p></blockquote><p>æˆ‘æœ‰ä¸€ä¸ªæœ‹å‹åšäº†ä¸€ä¸ªå°ç ´ç«™ï¼Œç°åœ¨è¦å®ç°ä¸€ä¸ªç«™å†…ä¿¡ Web æ¶ˆæ¯æ¨é€çš„åŠŸèƒ½ï¼Œå¯¹ï¼Œå°±æ˜¯ä¸‹å›¾è¿™ä¸ªå°çº¢ç‚¹ï¼Œä¸€ä¸ªå¾ˆå¸¸ç”¨çš„åŠŸèƒ½ã€‚</p><p><img src=https://googoo-s.github.io//statistic/%E7%AB%99%E5%86%85%E4%BF%A1_Web_%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81.png width=auto alt="ç«™å†…ä¿¡ Web æ¶ˆæ¯æ¨é€"></p><p>ç«™å†…ä¿¡ Web æ¶ˆæ¯æ¨é€</p><p>ä¸è¿‡ä»–è¿˜æ²¡æƒ³å¥½ç”¨ä»€ä¹ˆæ–¹å¼åšï¼Œè¿™é‡Œæˆ‘å¸®ä»–æ•´ç†äº†ä¸€ä¸‹å‡ ç§æ–¹æ¡ˆï¼Œå¹¶ç®€å•åšäº†å®ç°ã€‚</p><h2 id=ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ¨é€-ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ¨é€><a rel=noopener class="internal-link broken" data-src=#%e4%bb%80%e4%b9%88%e6%98%af%e6%b6%88%e6%81%af%e6%8e%a8%e9%80%81>#</a> ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ¨é€ï¼Ÿ</h2><p>æ¨é€çš„åœºæ™¯æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚æœ‰äººå…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼Œè¿™æ—¶æˆ‘å°±ä¼šæ”¶åˆ°ä¸€æ¡æ¨é€æ¶ˆæ¯ï¼Œä»¥æ­¤æ¥å¸å¼•æˆ‘ç‚¹å‡»æ‰“å¼€åº”ç”¨ã€‚</p><p>æ¶ˆæ¯æ¨é€é€šå¸¸æ˜¯æŒ‡ç½‘ç«™çš„è¿è¥å·¥ä½œç­‰äººå‘˜ï¼Œé€šè¿‡æŸç§å·¥å…·å¯¹ç”¨æˆ·å½“å‰ç½‘é¡µæˆ–ç§»åŠ¨è®¾å¤‡ APP è¿›è¡Œçš„ä¸»åŠ¨æ¶ˆæ¯æ¨é€ã€‚</p><p>æ¶ˆæ¯æ¨é€ä¸€èˆ¬åˆåˆ†ä¸º Web ç«¯æ¶ˆæ¯æ¨é€å’Œç§»åŠ¨ç«¯æ¶ˆæ¯æ¨é€ã€‚</p><p>ç§»åŠ¨ç«¯æ¶ˆæ¯æ¨é€ç¤ºä¾‹ï¼š</p><p><img src=https://googoo-s.github.io//statistic/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E7%A4%BA%E4%BE%8B.png width=auto alt=ç§»åŠ¨ç«¯æ¶ˆæ¯æ¨é€ç¤ºä¾‹></p><p>ç§»åŠ¨ç«¯æ¶ˆæ¯æ¨é€ç¤ºä¾‹</p><p>Web ç«¯æ¶ˆæ¯æ¨é€ç¤ºä¾‹ï¼š</p><p><img src=https://googoo-s.github.io//statistic/Web_%E7%AB%AF%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E7%A4%BA%E4%BE%8B.png width=auto alt="Web ç«¯æ¶ˆæ¯æ¨é€ç¤ºä¾‹"></p><p>Web ç«¯æ¶ˆæ¯æ¨é€ç¤ºä¾‹</p><p>åœ¨å…·ä½“å®ç°ä¹‹å‰ï¼Œå’±ä»¬å†æ¥åˆ†æä¸€ä¸‹å‰è¾¹çš„éœ€æ±‚ï¼Œå…¶å®åŠŸèƒ½å¾ˆç®€å•ï¼Œåªè¦è§¦å‘æŸä¸ªäº‹ä»¶ï¼ˆä¸»åŠ¨åˆ†äº«äº†èµ„æºæˆ–è€…åå°ä¸»åŠ¨æ¨é€æ¶ˆæ¯ï¼‰ï¼ŒWeb é¡µé¢çš„é€šçŸ¥å°çº¢ç‚¹å°±ä¼šå®æ—¶çš„ <code>+1</code> å°±å¯ä»¥äº†ã€‚</p><p>é€šå¸¸åœ¨æœåŠ¡ç«¯ä¼šæœ‰è‹¥å¹²å¼ æ¶ˆæ¯æ¨é€è¡¨ï¼Œç”¨æ¥è®°å½•ç”¨æˆ·è§¦å‘ä¸åŒäº‹ä»¶æ‰€æ¨é€ä¸åŒç±»å‹çš„æ¶ˆæ¯ï¼Œå‰ç«¯ä¸»åŠ¨æŸ¥è¯¢ï¼ˆæ‹‰ï¼‰æˆ–è€…è¢«åŠ¨æ¥æ”¶ï¼ˆæ¨ï¼‰ç”¨æˆ·æ‰€æœ‰æœªè¯»çš„æ¶ˆæ¯æ•°ã€‚</p><p><img src=https://googoo-s.github.io//statistic/%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E8%A1%A8.png width=auto alt=æ¶ˆæ¯æ¨é€è¡¨></p><p>æ¶ˆæ¯æ¨é€è¡¨</p><p>æ¶ˆæ¯æ¨é€æ— éæ˜¯æ¨ï¼ˆpushï¼‰å’Œæ‹‰ï¼ˆpullï¼‰ä¸¤ç§å½¢å¼ï¼Œä¸‹è¾¹æˆ‘ä»¬é€ä¸ªäº†è§£ä¸‹ã€‚</p><h2 id=æ¶ˆæ¯æ¨é€å¸¸è§æ–¹æ¡ˆ-æ¶ˆæ¯æ¨é€å¸¸è§æ–¹æ¡ˆ><a rel=noopener class="internal-link broken" data-src=#%e6%b6%88%e6%81%af%e6%8e%a8%e9%80%81%e5%b8%b8%e8%a7%81%e6%96%b9%e6%a1%88>#</a> æ¶ˆæ¯æ¨é€å¸¸è§æ–¹æ¡ˆ</h2><h3 id=çŸ­è½®è¯¢-çŸ­è½®è¯¢><a rel=noopener class="internal-link broken" data-src=#%e7%9f%ad%e8%bd%ae%e8%af%a2>#</a> çŸ­è½®è¯¢</h3><p><strong>è½®è¯¢(polling)</strong> åº”è¯¥æ˜¯å®ç°æ¶ˆæ¯æ¨é€æ–¹æ¡ˆä¸­æœ€ç®€å•çš„ä¸€ç§ï¼Œè¿™é‡Œæˆ‘ä»¬æš‚ä¸”å°†è½®è¯¢åˆ†ä¸ºçŸ­è½®è¯¢å’Œé•¿è½®è¯¢ã€‚</p><p>çŸ­è½®è¯¢å¾ˆå¥½ç†è§£ï¼ŒæŒ‡å®šçš„æ—¶é—´é—´éš”ï¼Œç”±æµè§ˆå™¨å‘æœåŠ¡å™¨å‘å‡º HTTP è¯·æ±‚ï¼ŒæœåŠ¡å™¨å®æ—¶è¿”å›æœªè¯»æ¶ˆæ¯æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œæµè§ˆå™¨å†åšæ¸²æŸ“æ˜¾ç¤ºã€‚</p><p>ä¸€ä¸ªç®€å•çš„ JS å®šæ—¶å™¨å°±å¯ä»¥æå®šï¼Œæ¯ç§’é’Ÿè¯·æ±‚ä¸€æ¬¡æœªè¯»æ¶ˆæ¯æ•°æ¥å£ï¼Œè¿”å›çš„æ•°æ®å±•ç¤ºå³å¯ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>setInterval(() =&gt; {
</span></span><span class=line><span class=cl>  // æ–¹æ³•è¯·æ±‚
</span></span><span class=line><span class=cl>  messageCount().then((res) =&gt; {
</span></span><span class=line><span class=cl>    if (res.code === 200) {
</span></span><span class=line><span class=cl>      this.messageCount = res.data;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>  });
</span></span><span class=line><span class=cl>}, 1000);
</span></span></code></pre></td></tr></table></div></div><p>æ•ˆæœè¿˜æ˜¯å¯ä»¥çš„ï¼ŒçŸ­è½®è¯¢å®ç°å›ºç„¶ç®€å•ï¼Œç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§ï¼Œç”±äºæ¨é€æ•°æ®å¹¶ä¸ä¼šé¢‘ç¹å˜æ›´ï¼Œæ— è®ºåç«¯æ­¤æ—¶æ˜¯å¦æœ‰æ–°çš„æ¶ˆæ¯äº§ç”Ÿï¼Œå®¢æˆ·ç«¯éƒ½ä¼šè¿›è¡Œè¯·æ±‚ï¼ŒåŠ¿å¿…ä¼šå¯¹æœåŠ¡ç«¯é€ æˆå¾ˆå¤§å‹åŠ›ï¼Œæµªè´¹å¸¦å®½å’ŒæœåŠ¡å™¨èµ„æºã€‚</p><h3 id=é•¿è½®è¯¢-é•¿è½®è¯¢><a rel=noopener class="internal-link broken" data-src=#%e9%95%bf%e8%bd%ae%e8%af%a2>#</a> é•¿è½®è¯¢</h3><p>é•¿è½®è¯¢æ˜¯å¯¹ä¸Šè¾¹çŸ­è½®è¯¢çš„ä¸€ç§æ”¹è¿›ç‰ˆæœ¬ï¼Œåœ¨å°½å¯èƒ½å‡å°‘å¯¹æœåŠ¡å™¨èµ„æºæµªè´¹çš„åŒæ—¶ï¼Œä¿è¯æ¶ˆæ¯çš„ç›¸å¯¹å®æ—¶æ€§ã€‚é•¿è½®è¯¢åœ¨ä¸­é—´ä»¶ä¸­åº”ç”¨çš„å¾ˆå¹¿æ³›ï¼Œæ¯”å¦‚ Nacos å’Œ Apollo é…ç½®ä¸­å¿ƒï¼Œæ¶ˆæ¯é˜Ÿåˆ— Kafkaã€RocketMQ ä¸­éƒ½æœ‰ç”¨åˆ°é•¿è½®è¯¢ã€‚</p><p><a href=https://mp.weixin.qq.com/s/94ftESkDoZI9gAGflLiGwg rel=noopener>Nacos é…ç½®ä¸­å¿ƒäº¤äº’æ¨¡å‹æ˜¯ push è¿˜æ˜¯ pullï¼Ÿopen in new window</a>ä¸€æ–‡ä¸­æˆ‘è¯¦ç»†ä»‹ç»è¿‡ Nacos é•¿è½®è¯¢çš„å®ç°åŸç†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ç…ç…ã€‚</p><p>é•¿è½®è¯¢å…¶å®åŸç†è·Ÿè½®è¯¢å·®ä¸å¤šï¼Œéƒ½æ˜¯é‡‡ç”¨è½®è¯¢çš„æ–¹å¼ã€‚ä¸è¿‡ï¼Œå¦‚æœæœåŠ¡ç«¯çš„æ•°æ®æ²¡æœ‰å‘ç”Ÿå˜æ›´ï¼Œä¼š ä¸€ç›´ hold ä½è¯·æ±‚ï¼Œç›´åˆ°æœåŠ¡ç«¯çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæˆ–è€…ç­‰å¾…ä¸€å®šæ—¶é—´è¶…æ—¶æ‰ä¼šè¿”å›ã€‚è¿”å›åï¼Œå®¢æˆ·ç«¯åˆä¼šç«‹å³å†æ¬¡å‘èµ·ä¸‹ä¸€æ¬¡é•¿è½®è¯¢ã€‚</p><p>è¿™æ¬¡æˆ‘ä½¿ç”¨ Apollo é…ç½®ä¸­å¿ƒå®ç°é•¿è½®è¯¢çš„æ–¹å¼ï¼Œåº”ç”¨äº†ä¸€ä¸ªç±»<code>DeferredResult</code>ï¼Œå®ƒæ˜¯åœ¨ Servlet3.0 åç»è¿‡ Spring å°è£…æä¾›çš„ä¸€ç§å¼‚æ­¥è¯·æ±‚æœºåˆ¶ï¼Œç›´æ„å°±æ˜¯å»¶è¿Ÿç»“æœã€‚</p><p><img src=https://googoo-s.github.io//statistic/%E9%95%BF%E8%BD%AE%E8%AF%A2%E7%A4%BA%E6%84%8F%E5%9B%BE.png width=auto alt=é•¿è½®è¯¢ç¤ºæ„å›¾></p><p>é•¿è½®è¯¢ç¤ºæ„å›¾</p><p><code>DeferredResult</code>å¯ä»¥å…è®¸å®¹å™¨çº¿ç¨‹å¿«é€Ÿé‡Šæ”¾å ç”¨çš„èµ„æºï¼Œä¸é˜»å¡è¯·æ±‚çº¿ç¨‹ï¼Œä»¥æ­¤æ¥å—æ›´å¤šçš„è¯·æ±‚æå‡ç³»ç»Ÿçš„ååé‡ï¼Œç„¶åå¯åŠ¨å¼‚æ­¥å·¥ä½œçº¿ç¨‹å¤„ç†çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†å®Œæˆè°ƒç”¨<code>DeferredResult.setResult(200)</code>æäº¤å“åº”ç»“æœã€‚</p><p>ä¸‹è¾¹æˆ‘ä»¬ç”¨é•¿è½®è¯¢æ¥å®ç°æ¶ˆæ¯æ¨é€ã€‚</p><p>å› ä¸ºä¸€ä¸ª ID å¯èƒ½ä¼šè¢«å¤šä¸ªé•¿è½®è¯¢è¯·æ±‚ç›‘å¬ï¼Œæ‰€ä»¥æˆ‘é‡‡ç”¨äº† Guava åŒ…æä¾›çš„<code>Multimap</code>ç»“æ„å­˜æ”¾é•¿è½®è¯¢ï¼Œä¸€ä¸ª key å¯ä»¥å¯¹åº”å¤šä¸ª valueã€‚ä¸€æ—¦ç›‘å¬åˆ° key å‘ç”Ÿå˜åŒ–ï¼Œå¯¹åº”çš„æ‰€æœ‰é•¿è½®è¯¢éƒ½ä¼šå“åº”ã€‚å‰ç«¯å¾—åˆ°éè¯·æ±‚è¶…æ—¶çš„çŠ¶æ€ç ï¼ŒçŸ¥æ™“æ•°æ®å˜æ›´ï¼Œä¸»åŠ¨æŸ¥è¯¢æœªè¯»æ¶ˆæ¯æ•°æ¥å£ï¼Œæ›´æ–°é¡µé¢æ•°æ®ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>@Controller
</span></span><span class=line><span class=cl>@RequestMapping(&#34;/polling&#34;)
</span></span><span class=line><span class=cl>public class PollingController {
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // å­˜æ”¾ç›‘å¬æŸä¸ªIdçš„é•¿è½®è¯¢é›†åˆ
</span></span><span class=line><span class=cl>    // çº¿ç¨‹åŒæ­¥ç»“æ„
</span></span><span class=line><span class=cl>    public static Multimap&lt;String, DeferredResult&lt;String&gt;&gt; watchRequests = Multimaps.synchronizedMultimap(HashMultimap.create());
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    /**
</span></span><span class=line><span class=cl>     * è®¾ç½®ç›‘å¬
</span></span><span class=line><span class=cl>     */
</span></span><span class=line><span class=cl>    @GetMapping(path = &#34;watch/{id}&#34;)
</span></span><span class=line><span class=cl>    @ResponseBody
</span></span><span class=line><span class=cl>    public DeferredResult&lt;String&gt; watch(@PathVariable String id) {
</span></span><span class=line><span class=cl>        // å»¶è¿Ÿå¯¹è±¡è®¾ç½®è¶…æ—¶æ—¶é—´
</span></span><span class=line><span class=cl>        DeferredResult&lt;String&gt; deferredResult = new DeferredResult&lt;&gt;(TIME_OUT);
</span></span><span class=line><span class=cl>        // å¼‚æ­¥è¯·æ±‚å®Œæˆæ—¶ç§»é™¤ keyï¼Œé˜²æ­¢å†…å­˜æº¢å‡º
</span></span><span class=line><span class=cl>        deferredResult.onCompletion(() -&gt; {
</span></span><span class=line><span class=cl>            watchRequests.remove(id, deferredResult);
</span></span><span class=line><span class=cl>        });
</span></span><span class=line><span class=cl>        // æ³¨å†Œé•¿è½®è¯¢è¯·æ±‚
</span></span><span class=line><span class=cl>        watchRequests.put(id, deferredResult);
</span></span><span class=line><span class=cl>        return deferredResult;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    /**
</span></span><span class=line><span class=cl>     * å˜æ›´æ•°æ®
</span></span><span class=line><span class=cl>     */
</span></span><span class=line><span class=cl>    @GetMapping(path = &#34;publish/{id}&#34;)
</span></span><span class=line><span class=cl>    @ResponseBody
</span></span><span class=line><span class=cl>    public String publish(@PathVariable String id) {
</span></span><span class=line><span class=cl>        // æ•°æ®å˜æ›´ å–å‡ºç›‘å¬IDçš„æ‰€æœ‰é•¿è½®è¯¢è¯·æ±‚ï¼Œå¹¶ä¸€ä¸€å“åº”å¤„ç†
</span></span><span class=line><span class=cl>        if (watchRequests.containsKey(id)) {
</span></span><span class=line><span class=cl>            Collection&lt;DeferredResult&lt;String&gt;&gt; deferredResults = watchRequests.get(id);
</span></span><span class=line><span class=cl>            for (DeferredResult&lt;String&gt; deferredResult : deferredResults) {
</span></span><span class=line><span class=cl>                deferredResult.setResult(&#34;æˆ‘æ›´æ–°äº†&#34; + new Date());
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        return &#34;success&#34;;
</span></span><span class=line><span class=cl>    }
</span></span></code></pre></td></tr></table></div></div><p>å½“è¯·æ±‚è¶…è¿‡è®¾ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œä¼šæŠ›å‡º<code>AsyncRequestTimeoutException</code>å¼‚å¸¸ï¼Œè¿™é‡Œç›´æ¥ç”¨<code>@ControllerAdvice</code>å…¨å±€æ•è·ç»Ÿä¸€è¿”å›å³å¯ï¼Œå‰ç«¯è·å–çº¦å®šå¥½çš„çŠ¶æ€ç åå†æ¬¡å‘èµ·é•¿è½®è¯¢è¯·æ±‚ï¼Œå¦‚æ­¤å¾€å¤è°ƒç”¨ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>@ControllerAdvice
</span></span><span class=line><span class=cl>public class AsyncRequestTimeoutHandler {
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    @ResponseStatus(HttpStatus.NOT_MODIFIED)
</span></span><span class=line><span class=cl>    @ResponseBody
</span></span><span class=line><span class=cl>    @ExceptionHandler(AsyncRequestTimeoutException.class)
</span></span><span class=line><span class=cl>    public String asyncRequestTimeoutHandler(AsyncRequestTimeoutException e) {
</span></span><span class=line><span class=cl>        System.out.println(&#34;å¼‚æ­¥è¯·æ±‚è¶…æ—¶&#34;);
</span></span><span class=line><span class=cl>        return &#34;304&#34;;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œé¦–å…ˆé¡µé¢å‘èµ·é•¿è½®è¯¢è¯·æ±‚<code>/polling/watch/10086</code>ç›‘å¬æ¶ˆæ¯æ›´å˜ï¼Œè¯·æ±‚è¢«æŒ‚èµ·ï¼Œä¸å˜æ›´æ•°æ®ç›´è‡³è¶…æ—¶ï¼Œå†æ¬¡å‘èµ·äº†é•¿è½®è¯¢è¯·æ±‚ï¼›ç´§æ¥ç€æ‰‹åŠ¨å˜æ›´æ•°æ®<code>/polling/publish/10086</code>ï¼Œé•¿è½®è¯¢å¾—åˆ°å“åº”ï¼Œå‰ç«¯å¤„ç†ä¸šåŠ¡é€»è¾‘å®Œæˆåå†æ¬¡å‘èµ·è¯·æ±‚ï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤ã€‚</p><p>é•¿è½®è¯¢ç›¸æ¯”äºçŸ­è½®è¯¢åœ¨æ€§èƒ½ä¸Šæå‡äº†å¾ˆå¤šï¼Œä½†ä¾ç„¶ä¼šäº§ç”Ÿè¾ƒå¤šçš„è¯·æ±‚ï¼Œè¿™æ˜¯å®ƒçš„ä¸€ç‚¹ä¸å®Œç¾çš„åœ°æ–¹ã€‚</p><h3 id=iframe-æµ-iframe-æµ><a rel=noopener class="internal-link broken" data-src=#iframe-%e6%b5%81>#</a> iframe æµ</h3><p>iframe æµå°±æ˜¯åœ¨é¡µé¢ä¸­æ’å…¥ä¸€ä¸ªéšè—çš„<code>&lt;iframe></code>æ ‡ç­¾ï¼Œé€šè¿‡åœ¨<code>src</code>ä¸­è¯·æ±‚æ¶ˆæ¯æ•°é‡ API æ¥å£ï¼Œç”±æ­¤åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´åˆ›å»ºä¸€æ¡é•¿è¿æ¥ï¼ŒæœåŠ¡ç«¯æŒç»­å‘<code>iframe</code>ä¼ è¾“æ•°æ®ã€‚</p><p>ä¼ è¾“çš„æ•°æ®é€šå¸¸æ˜¯ HTMLã€æˆ–æ˜¯å†…åµŒçš„ JavaScript è„šæœ¬ï¼Œæ¥è¾¾åˆ°å®æ—¶æ›´æ–°é¡µé¢çš„æ•ˆæœã€‚</p><p><img src=https://googoo-s.github.io//statistic/iframe_%E6%B5%81%E7%A4%BA%E6%84%8F%E5%9B%BE.png width=auto alt="iframe æµç¤ºæ„å›¾"></p><p>iframe æµç¤ºæ„å›¾</p><p>è¿™ç§æ–¹å¼å®ç°ç®€å•ï¼Œå‰ç«¯åªè¦ä¸€ä¸ª<code>&lt;iframe></code>æ ‡ç­¾æå®šäº†</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;iframe src=&#34;/iframe/message&#34; style=&#34;display:none&#34;&gt;&lt;/iframe&gt;
</span></span></code></pre></td></tr></table></div></div><p>æœåŠ¡ç«¯ç›´æ¥ç»„è£… HTMLã€JS è„šæœ¬æ•°æ®å‘ response å†™å…¥å°±è¡Œäº†</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>@Controller
</span></span><span class=line><span class=cl>@RequestMapping(&#34;/iframe&#34;)
</span></span><span class=line><span class=cl>public class IframeController {
</span></span><span class=line><span class=cl>    @GetMapping(path = &#34;message&#34;)
</span></span><span class=line><span class=cl>    public void message(HttpServletResponse response) throws IOException, InterruptedException {
</span></span><span class=line><span class=cl>        while (true) {
</span></span><span class=line><span class=cl>            response.setHeader(&#34;Pragma&#34;, &#34;no-cache&#34;);
</span></span><span class=line><span class=cl>            response.setDateHeader(&#34;Expires&#34;, 0);
</span></span><span class=line><span class=cl>            response.setHeader(&#34;Cache-Control&#34;, &#34;no-cache,no-store&#34;);
</span></span><span class=line><span class=cl>            response.setStatus(HttpServletResponse.SC_OK);
</span></span><span class=line><span class=cl>            response.getWriter().print(&#34; &lt;script type=\&#34;text/javascript\&#34;&gt;\n&#34; +
</span></span><span class=line><span class=cl>                    &#34;parent.document.getElementById(&#39;clock&#39;).innerHTML = \&#34;&#34; + count.get() + &#34;\&#34;;&#34; +
</span></span><span class=line><span class=cl>                    &#34;parent.document.getElementById(&#39;count&#39;).innerHTML = \&#34;&#34; + count.get() + &#34;\&#34;;&#34; +
</span></span><span class=line><span class=cl>                    &#34;&lt;/script&gt;&#34;);
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>iframe æµçš„æœåŠ¡å™¨å¼€é”€å¾ˆå¤§ï¼Œè€Œä¸” IEã€Chrome ç­‰æµè§ˆå™¨ä¸€ç›´ä¼šå¤„äº loading çŠ¶æ€ï¼Œå›¾æ ‡ä¼šä¸åœæ—‹è½¬ï¼Œç®€ç›´æ˜¯å¼ºè¿«ç—‡æ€æ‰‹ã€‚</p><p><img src=https://googoo-s.github.io//statistic/iframe_%E6%B5%81%E6%95%88%E6%9E%9C.gif width=auto alt="iframe æµæ•ˆæœ"></p><p>iframe æµæ•ˆæœ</p><p>iframe æµéå¸¸ä¸å‹å¥½ï¼Œå¼ºçƒˆä¸æ¨èã€‚</p><h3 id=sse-æˆ‘çš„æ–¹å¼-sse-æˆ‘çš„æ–¹å¼><a rel=noopener class="internal-link broken" data-src=#sse-%e6%88%91%e7%9a%84%e6%96%b9%e5%bc%8f>#</a> SSE (æˆ‘çš„æ–¹å¼)</h3><p>å¾ˆå¤šäººå¯èƒ½ä¸çŸ¥é“ï¼ŒæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯ï¼Œå…¶å®é™¤äº†å¯ä»¥ç”¨<code>WebSocket</code>è¿™ç§è€³ç†Ÿèƒ½è¯¦çš„æœºåˆ¶å¤–ï¼Œè¿˜æœ‰ä¸€ç§æœåŠ¡å™¨å‘é€äº‹ä»¶(Server-Sent Events)ï¼Œç®€ç§° SSEã€‚è¿™æ˜¯ä¸€ç§æœåŠ¡å™¨ç«¯åˆ°å®¢æˆ·ç«¯(æµè§ˆå™¨)çš„å•å‘æ¶ˆæ¯æ¨é€ã€‚</p><p>SSE åŸºäº HTTP åè®®çš„ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€èˆ¬æ„ä¹‰ä¸Šçš„ HTTP åè®®æ˜¯æ— æ³•åšåˆ°æœåŠ¡ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯çš„ï¼Œä½† SSE æ˜¯ä¸ªä¾‹å¤–ï¼Œå®ƒå˜æ¢äº†ä¸€ç§æ€è·¯ã€‚</p><p><img src=https://googoo-s.github.io//statistic/1460000042192390.png width=auto alt></p><p>SSE åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´æ‰“å¼€ä¸€ä¸ªå•å‘é€šé“ï¼ŒæœåŠ¡ç«¯å“åº”çš„ä¸å†æ˜¯ä¸€æ¬¡æ€§çš„æ•°æ®åŒ…è€Œæ˜¯<code>text/event-stream</code>ç±»å‹çš„æ•°æ®æµä¿¡æ¯ï¼Œåœ¨æœ‰æ•°æ®å˜æ›´æ—¶ä»æœåŠ¡å™¨æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚</p><p>æ•´ä½“çš„å®ç°æ€è·¯æœ‰ç‚¹ç±»ä¼¼äºåœ¨çº¿è§†é¢‘æ’­æ”¾ï¼Œè§†é¢‘æµä¼šè¿ç»­ä¸æ–­çš„æ¨é€åˆ°æµè§ˆå™¨ï¼Œä½ ä¹Ÿå¯ä»¥ç†è§£æˆï¼Œå®¢æˆ·ç«¯åœ¨å®Œæˆä¸€æ¬¡ç”¨æ—¶å¾ˆé•¿ï¼ˆç½‘ç»œä¸ç•…ï¼‰çš„ä¸‹è½½ã€‚</p><p><img src=https://googoo-s.github.io//statistic/SSE_%E7%A4%BA%E6%84%8F%E5%9B%BE.png width=auto alt="SSE ç¤ºæ„å›¾"></p><p>SSE ç¤ºæ„å›¾</p><p>SSE ä¸ WebSocket ä½œç”¨ç›¸ä¼¼ï¼Œéƒ½å¯ä»¥å»ºç«‹æœåŠ¡ç«¯ä¸æµè§ˆå™¨ä¹‹é—´çš„é€šä¿¡ï¼Œå®ç°æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯ï¼Œä½†è¿˜æ˜¯æœ‰äº›è®¸ä¸åŒï¼š</p><ul><li>SSE æ˜¯åŸºäº HTTP åè®®çš„ï¼Œå®ƒä»¬ä¸éœ€è¦ç‰¹æ®Šçš„åè®®æˆ–æœåŠ¡å™¨å®ç°å³å¯å·¥ä½œï¼›WebSocket éœ€å•ç‹¬æœåŠ¡å™¨æ¥å¤„ç†åè®®ã€‚</li><li>SSE å•å‘é€šä¿¡ï¼Œåªèƒ½ç”±æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å•å‘é€šä¿¡ï¼›WebSocket å…¨åŒå·¥é€šä¿¡ï¼Œå³é€šä¿¡çš„åŒæ–¹å¯ä»¥åŒæ—¶å‘é€å’Œæ¥å—ä¿¡æ¯ã€‚</li><li>SSE å®ç°ç®€å•å¼€å‘æˆæœ¬ä½ï¼Œæ— éœ€å¼•å…¥å…¶ä»–ç»„ä»¶ï¼›WebSocket ä¼ è¾“æ•°æ®éœ€åšäºŒæ¬¡è§£æï¼Œå¼€å‘é—¨æ§›é«˜ä¸€äº›ã€‚</li><li>SSE é»˜è®¤æ”¯æŒæ–­çº¿é‡è¿ï¼›WebSocket åˆ™éœ€è¦è‡ªå·±å®ç°ã€‚</li><li>SSE åªèƒ½ä¼ é€æ–‡æœ¬æ¶ˆæ¯ï¼ŒäºŒè¿›åˆ¶æ•°æ®éœ€è¦ç»è¿‡ç¼–ç åä¼ é€ï¼›WebSocket é»˜è®¤æ”¯æŒä¼ é€äºŒè¿›åˆ¶æ•°æ®ã€‚</li></ul><p><strong>SSE ä¸ WebSocket è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ</strong></p><blockquote><p>æŠ€æœ¯å¹¶æ²¡æœ‰å¥½åä¹‹åˆ†ï¼Œåªæœ‰å“ªä¸ªæ›´åˆé€‚</p></blockquote><p>SSE å¥½åƒä¸€ç›´ä¸è¢«å¤§å®¶æ‰€ç†ŸçŸ¥ï¼Œä¸€éƒ¨åˆ†åŸå› æ˜¯å‡ºç°äº† WebSocketï¼Œè¿™ä¸ªæä¾›äº†æ›´ä¸°å¯Œçš„åè®®æ¥æ‰§è¡ŒåŒå‘ã€å…¨åŒå·¥é€šä¿¡ã€‚å¯¹äºæ¸¸æˆã€å³æ—¶é€šä¿¡ä»¥åŠéœ€è¦åŒå‘è¿‘ä¹å®æ—¶æ›´æ–°çš„åœºæ™¯ï¼Œæ‹¥æœ‰åŒå‘é€šé“æ›´å…·å¸å¼•åŠ›ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸éœ€è¦ä»å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚è€Œä½ åªéœ€è¦ä¸€äº›æœåŠ¡å™¨æ“ä½œçš„æ›´æ–°ã€‚æ¯”å¦‚ï¼šç«™å†…ä¿¡ã€æœªè¯»æ¶ˆæ¯æ•°ã€çŠ¶æ€æ›´æ–°ã€è‚¡ç¥¨è¡Œæƒ…ã€ç›‘æ§æ•°é‡ç­‰åœºæ™¯ï¼ŒSEE ä¸ç®¡æ˜¯ä»å®ç°çš„éš¾æ˜“å’Œæˆæœ¬ä¸Šéƒ½æ›´åŠ æœ‰ä¼˜åŠ¿ã€‚æ­¤å¤–ï¼ŒSSE å…·æœ‰ WebSocket åœ¨è®¾è®¡ä¸Šç¼ºä¹çš„å¤šç§åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šè‡ªåŠ¨é‡æ–°è¿æ¥ã€äº‹ä»¶ ID å’Œå‘é€ä»»æ„äº‹ä»¶çš„èƒ½åŠ›ã€‚</p><p>å‰ç«¯åªéœ€è¿›è¡Œä¸€æ¬¡ HTTP è¯·æ±‚ï¼Œå¸¦ä¸Šå”¯ä¸€ IDï¼Œæ‰“å¼€äº‹ä»¶æµï¼Œç›‘å¬æœåŠ¡ç«¯æ¨é€çš„äº‹ä»¶å°±å¯ä»¥äº†</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;script&gt;
</span></span><span class=line><span class=cl>    let source = null;
</span></span><span class=line><span class=cl>    let userId = 7777
</span></span><span class=line><span class=cl>    if (window.EventSource) {
</span></span><span class=line><span class=cl>        // å»ºç«‹è¿æ¥
</span></span><span class=line><span class=cl>        source = new EventSource(&#39;http://localhost:7777/sse/sub/&#39;+userId);
</span></span><span class=line><span class=cl>        setMessageInnerHTML(&#34;è¿æ¥ç”¨æˆ·=&#34; + userId);
</span></span><span class=line><span class=cl>        /**
</span></span><span class=line><span class=cl>         * è¿æ¥ä¸€æ—¦å»ºç«‹ï¼Œå°±ä¼šè§¦å‘openäº‹ä»¶
</span></span><span class=line><span class=cl>         * å¦ä¸€ç§å†™æ³•ï¼šsource.onopen = function (event) {}
</span></span><span class=line><span class=cl>         */
</span></span><span class=line><span class=cl>        source.addEventListener(&#39;open&#39;, function (e) {
</span></span><span class=line><span class=cl>            setMessageInnerHTML(&#34;å»ºç«‹è¿æ¥ã€‚ã€‚ã€‚&#34;);
</span></span><span class=line><span class=cl>        }, false);
</span></span><span class=line><span class=cl>        /**
</span></span><span class=line><span class=cl>         * å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å‘æ¥çš„æ•°æ®
</span></span><span class=line><span class=cl>         * å¦ä¸€ç§å†™æ³•ï¼šsource.onmessage = function (event) {}
</span></span><span class=line><span class=cl>         */
</span></span><span class=line><span class=cl>        source.addEventListener(&#39;message&#39;, function (e) {
</span></span><span class=line><span class=cl>            setMessageInnerHTML(e.data);
</span></span><span class=line><span class=cl>        });
</span></span><span class=line><span class=cl>    } else {
</span></span><span class=line><span class=cl>        setMessageInnerHTML(&#34;ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒSSE&#34;);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>&lt;/script&gt;
</span></span></code></pre></td></tr></table></div></div><p>æœåŠ¡ç«¯çš„å®ç°æ›´ç®€å•ï¼Œåˆ›å»ºä¸€ä¸ª<code>SseEmitter</code>å¯¹è±¡æ”¾å…¥<code>sseEmitterMap</code>è¿›è¡Œç®¡ç†</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>private static Map&lt;String, SseEmitter&gt; sseEmitterMap = new ConcurrentHashMap&lt;&gt;();
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>/**
</span></span><span class=line><span class=cl> * åˆ›å»ºè¿æ¥
</span></span><span class=line><span class=cl> */
</span></span><span class=line><span class=cl>public static SseEmitter connect(String userId) {
</span></span><span class=line><span class=cl>    try {
</span></span><span class=line><span class=cl>        // è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œ0è¡¨ç¤ºä¸è¿‡æœŸã€‚é»˜è®¤30ç§’
</span></span><span class=line><span class=cl>        SseEmitter sseEmitter = new SseEmitter(0L);
</span></span><span class=line><span class=cl>        // æ³¨å†Œå›è°ƒ
</span></span><span class=line><span class=cl>        sseEmitter.onCompletion(completionCallBack(userId));
</span></span><span class=line><span class=cl>        sseEmitter.onError(errorCallBack(userId));
</span></span><span class=line><span class=cl>        sseEmitter.onTimeout(timeoutCallBack(userId));
</span></span><span class=line><span class=cl>        sseEmitterMap.put(userId, sseEmitter);
</span></span><span class=line><span class=cl>        count.getAndIncrement();
</span></span><span class=line><span class=cl>        return sseEmitter;
</span></span><span class=line><span class=cl>    } catch (Exception e) {
</span></span><span class=line><span class=cl>        log.info(&#34;åˆ›å»ºæ–°çš„sseè¿æ¥å¼‚å¸¸ï¼Œå½“å‰ç”¨æˆ·ï¼š{}&#34;, userId);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    return null;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>/**
</span></span><span class=line><span class=cl> * ç»™æŒ‡å®šç”¨æˆ·å‘é€æ¶ˆæ¯
</span></span><span class=line><span class=cl> */
</span></span><span class=line><span class=cl>public static void sendMessage(String userId, String message) {
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if (sseEmitterMap.containsKey(userId)) {
</span></span><span class=line><span class=cl>        try {
</span></span><span class=line><span class=cl>            sseEmitterMap.get(userId).send(message);
</span></span><span class=line><span class=cl>        } catch (IOException e) {
</span></span><span class=line><span class=cl>            log.error(&#34;ç”¨æˆ·[{}]æ¨é€å¼‚å¸¸:{}&#34;, userId, e.getMessage());
</span></span><span class=line><span class=cl>            removeUser(userId);
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p><strong>æ³¨æ„ï¼š</strong> SSE ä¸æ”¯æŒ IE æµè§ˆå™¨ï¼Œå¯¹å…¶ä»–ä¸»æµæµè§ˆå™¨å…¼å®¹æ€§åšçš„è¿˜ä¸é”™ã€‚</p><p><img src=https://googoo-s.github.io//statistic/SSE_%E5%85%BC%E5%AE%B9%E6%80%A7.png width=auto alt="SSE å…¼å®¹æ€§"></p><p>SSE å…¼å®¹æ€§</p><h3 id=websocket-websocket><a rel=noopener class="internal-link broken" data-src=#websocket>#</a> Websocket</h3><p>Websocket åº”è¯¥æ˜¯å¤§å®¶éƒ½æ¯”è¾ƒç†Ÿæ‚‰çš„ä¸€ç§å®ç°æ¶ˆæ¯æ¨é€çš„æ–¹å¼ï¼Œä¸Šè¾¹æˆ‘ä»¬åœ¨è®² SSE çš„æ—¶å€™ä¹Ÿå’Œ Websocket è¿›è¡Œè¿‡æ¯”è¾ƒã€‚</p><p>æ˜¯ä¸€ç§åœ¨ TCP è¿æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šä¿¡çš„åè®®ï¼Œå»ºç«‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ¸ é“ã€‚æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä»…éœ€ä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±ç›´æ¥å¯ä»¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ã€‚</p><p><img src=https://googoo-s.github.io//statistic/Websocket_%E7%A4%BA%E6%84%8F%E5%9B%BE.png width=auto alt="Websocket ç¤ºæ„å›¾"></p><p>Websocket ç¤ºæ„å›¾</p><p>SpringBoot æ•´åˆ Websocketï¼Œå…ˆå¼•å…¥ Websocket ç›¸å…³çš„å·¥å…·åŒ…ï¼Œå’Œ SSE ç›¸æ¯”é¢å¤–çš„å¼€å‘æˆæœ¬ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;!-- å¼•å…¥websocket --&gt;
</span></span><span class=line><span class=cl>&lt;dependency&gt;
</span></span><span class=line><span class=cl>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span><span class=line><span class=cl>    &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;
</span></span><span class=line><span class=cl>&lt;/dependency&gt;
</span></span></code></pre></td></tr></table></div></div><p>æœåŠ¡ç«¯ä½¿ç”¨<code>@ServerEndpoint</code>æ³¨è§£æ ‡æ³¨å½“å‰ç±»ä¸ºä¸€ä¸ª WebSocket æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡<code>ws://localhost:7777/webSocket/10086</code>æ¥è¿æ¥åˆ° WebSocket æœåŠ¡å™¨ç«¯ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>@Component
</span></span><span class=line><span class=cl>@Slf4j
</span></span><span class=line><span class=cl>@ServerEndpoint(&#34;/websocket/{userId}&#34;)
</span></span><span class=line><span class=cl>public class WebSocketServer {
</span></span><span class=line><span class=cl>    //ä¸æŸä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ä¼šè¯ï¼Œéœ€è¦é€šè¿‡å®ƒæ¥ç»™å®¢æˆ·ç«¯å‘é€æ•°æ®
</span></span><span class=line><span class=cl>    private Session session;
</span></span><span class=line><span class=cl>    private static final CopyOnWriteArraySet&lt;WebSocketServer&gt; webSockets = new CopyOnWriteArraySet&lt;&gt;();
</span></span><span class=line><span class=cl>    // ç”¨æ¥å­˜åœ¨çº¿è¿æ¥æ•°
</span></span><span class=line><span class=cl>    private static final Map&lt;String, Session&gt; sessionPool = new HashMap&lt;String, Session&gt;();
</span></span><span class=line><span class=cl>    /**
</span></span><span class=line><span class=cl>     * é“¾æ¥æˆåŠŸè°ƒç”¨çš„æ–¹æ³•
</span></span><span class=line><span class=cl>     */
</span></span><span class=line><span class=cl>    @OnOpen
</span></span><span class=line><span class=cl>    public void onOpen(Session session, @PathParam(value = &#34;userId&#34;) String userId) {
</span></span><span class=line><span class=cl>        try {
</span></span><span class=line><span class=cl>            this.session = session;
</span></span><span class=line><span class=cl>            webSockets.add(this);
</span></span><span class=line><span class=cl>            sessionPool.put(userId, session);
</span></span><span class=line><span class=cl>            log.info(&#34;websocketæ¶ˆæ¯: æœ‰æ–°çš„è¿æ¥ï¼Œæ€»æ•°ä¸º:&#34; + webSockets.size());
</span></span><span class=line><span class=cl>        } catch (Exception e) {
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    /**
</span></span><span class=line><span class=cl>     * æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åè°ƒç”¨çš„æ–¹æ³•
</span></span><span class=line><span class=cl>     */
</span></span><span class=line><span class=cl>    @OnMessage
</span></span><span class=line><span class=cl>    public void onMessage(String message) {
</span></span><span class=line><span class=cl>        log.info(&#34;websocketæ¶ˆæ¯: æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯:&#34; + message);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    /**
</span></span><span class=line><span class=cl>     * æ­¤ä¸ºå•ç‚¹æ¶ˆæ¯
</span></span><span class=line><span class=cl>     */
</span></span><span class=line><span class=cl>    public void sendOneMessage(String userId, String message) {
</span></span><span class=line><span class=cl>        Session session = sessionPool.get(userId);
</span></span><span class=line><span class=cl>        if (session != null &amp;&amp; session.isOpen()) {
</span></span><span class=line><span class=cl>            try {
</span></span><span class=line><span class=cl>                log.info(&#34;websocketæ¶ˆ: å•ç‚¹æ¶ˆæ¯:&#34; + message);
</span></span><span class=line><span class=cl>                session.getAsyncRemote().sendText(message);
</span></span><span class=line><span class=cl>            } catch (Exception e) {
</span></span><span class=line><span class=cl>                e.printStackTrace();
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>å‰ç«¯åˆå§‹åŒ–æ‰“å¼€ WebSocket è¿æ¥ï¼Œå¹¶ç›‘å¬è¿æ¥çŠ¶æ€ï¼Œæ¥æ”¶æœåŠ¡ç«¯æ•°æ®æˆ–å‘æœåŠ¡ç«¯å‘é€æ•°æ®ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;script&gt;
</span></span><span class=line><span class=cl>    var ws = new WebSocket(&#39;ws://localhost:7777/webSocket/10086&#39;);
</span></span><span class=line><span class=cl>    // è·å–è¿æ¥çŠ¶æ€
</span></span><span class=line><span class=cl>    console.log(&#39;wsè¿æ¥çŠ¶æ€ï¼š&#39; + ws.readyState);
</span></span><span class=line><span class=cl>    //ç›‘å¬æ˜¯å¦è¿æ¥æˆåŠŸ
</span></span><span class=line><span class=cl>    ws.onopen = function () {
</span></span><span class=line><span class=cl>        console.log(&#39;wsè¿æ¥çŠ¶æ€ï¼š&#39; + ws.readyState);
</span></span><span class=line><span class=cl>        //è¿æ¥æˆåŠŸåˆ™å‘é€ä¸€ä¸ªæ•°æ®
</span></span><span class=line><span class=cl>        ws.send(&#39;test1&#39;);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    // æ¥å¬æœåŠ¡å™¨å‘å›çš„ä¿¡æ¯å¹¶å¤„ç†å±•ç¤º
</span></span><span class=line><span class=cl>    ws.onmessage = function (data) {
</span></span><span class=line><span class=cl>        console.log(&#39;æ¥æ”¶åˆ°æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯ï¼š&#39;);
</span></span><span class=line><span class=cl>        console.log(data);
</span></span><span class=line><span class=cl>        //å®Œæˆé€šä¿¡åå…³é—­WebSocketè¿æ¥
</span></span><span class=line><span class=cl>        ws.close();
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    // ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶
</span></span><span class=line><span class=cl>    ws.onclose = function () {
</span></span><span class=line><span class=cl>        // ç›‘å¬æ•´ä¸ªè¿‡ç¨‹ä¸­websocketçš„çŠ¶æ€
</span></span><span class=line><span class=cl>        console.log(&#39;wsè¿æ¥çŠ¶æ€ï¼š&#39; + ws.readyState);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    // ç›‘å¬å¹¶å¤„ç†erroräº‹ä»¶
</span></span><span class=line><span class=cl>    ws.onerror = function (error) {
</span></span><span class=line><span class=cl>        console.log(error);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    function sendMessage() {
</span></span><span class=line><span class=cl>        var content = $(&#34;#message&#34;).val();
</span></span><span class=line><span class=cl>        $.ajax({
</span></span><span class=line><span class=cl>            url: &#39;/socket/publish?userId=10086&amp;message=&#39; + content,
</span></span><span class=line><span class=cl>            type: &#39;GET&#39;,
</span></span><span class=line><span class=cl>            data: { &#34;id&#34;: &#34;7777&#34;, &#34;content&#34;: content },
</span></span><span class=line><span class=cl>            success: function (data) {
</span></span><span class=line><span class=cl>                console.log(data)
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>        })
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>&lt;/script&gt;
</span></span></code></pre></td></tr></table></div></div><p>é¡µé¢åˆå§‹åŒ–å»ºç«‹ WebSocket è¿æ¥ï¼Œä¹‹åå°±å¯ä»¥è¿›è¡ŒåŒå‘é€šä¿¡äº†ï¼Œæ•ˆæœè¿˜ä¸é”™ã€‚</p><p><img src=https://googoo-s.github.io//statistic/1460000042192395.png width=auto alt></p><h3 id=mqtt-mqtt><a rel=noopener class="internal-link broken" data-src=#mqtt>#</a> MQTT</h3><p><strong>ä»€ä¹ˆæ˜¯ MQTT åè®®ï¼Ÿ</strong></p><p>MQTT (Message Queue Telemetry Transport)æ˜¯ä¸€ç§åŸºäºå‘å¸ƒ/è®¢é˜…ï¼ˆpublish/subscribeï¼‰æ¨¡å¼çš„è½»é‡çº§é€šè®¯åè®®ï¼Œé€šè¿‡è®¢é˜…ç›¸åº”çš„ä¸»é¢˜æ¥è·å–æ¶ˆæ¯ï¼Œæ˜¯ç‰©è”ç½‘ï¼ˆInternet of Thingï¼‰ä¸­çš„ä¸€ä¸ªæ ‡å‡†ä¼ è¾“åè®®ã€‚</p><p>è¯¥åè®®å°†æ¶ˆæ¯çš„å‘å¸ƒè€…ï¼ˆpublisherï¼‰ä¸è®¢é˜…è€…ï¼ˆsubscriberï¼‰è¿›è¡Œåˆ†ç¦»ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸å¯é çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œä¸ºè¿œç¨‹è¿æ¥çš„è®¾å¤‡æä¾›å¯é çš„æ¶ˆæ¯æœåŠ¡ï¼Œä½¿ç”¨æ–¹å¼ä¸ä¼ ç»Ÿçš„ MQ æœ‰ç‚¹ç±»ä¼¼ã€‚</p><p><img src=https://googoo-s.github.io//statistic/MQTT_%E5%8D%8F%E8%AE%AE%E7%A4%BA%E4%BE%8B.png width=auto alt="MQTT åè®®ç¤ºä¾‹"></p><p>MQTT åè®®ç¤ºä¾‹</p><p>TCP åè®®ä½äºä¼ è¾“å±‚ï¼ŒMQTT åè®®ä½äºåº”ç”¨å±‚ï¼ŒMQTT åè®®æ„å»ºäº TCP/IP åè®®ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æ”¯æŒ TCP/IP åè®®æ ˆçš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ MQTT åè®®ã€‚</p><p><strong>ä¸ºä»€ä¹ˆè¦ç”¨ MQTT åè®®ï¼Ÿ</strong></p><p>MQTT åè®®ä¸ºä»€ä¹ˆåœ¨ç‰©è”ç½‘ï¼ˆIOTï¼‰ä¸­å¦‚æ­¤å—åçˆ±ï¼Ÿè€Œä¸æ˜¯å…¶å®ƒåè®®ï¼Œæ¯”å¦‚æˆ‘ä»¬æ›´ä¸ºç†Ÿæ‚‰çš„ HTTP åè®®å‘¢ï¼Ÿ</p><ul><li>é¦–å…ˆ HTTP åè®®å®ƒæ˜¯ä¸€ç§åŒæ­¥åè®®ï¼Œå®¢æˆ·ç«¯è¯·æ±‚åéœ€è¦ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ã€‚è€Œåœ¨ç‰©è”ç½‘ï¼ˆIOTï¼‰ç¯å¢ƒä¸­ï¼Œè®¾å¤‡ä¼šå¾ˆå—åˆ¶äºç¯å¢ƒçš„å½±å“ï¼Œæ¯”å¦‚å¸¦å®½ä½ã€ç½‘ç»œå»¶è¿Ÿé«˜ã€ç½‘ç»œé€šä¿¡ä¸ç¨³å®šç­‰ï¼Œæ˜¾ç„¶å¼‚æ­¥æ¶ˆæ¯åè®®æ›´ä¸ºé€‚åˆ IOT åº”ç”¨ç¨‹åºã€‚</li><li>HTTP æ˜¯å•å‘çš„ï¼Œå¦‚æœè¦è·å–æ¶ˆæ¯å®¢æˆ·ç«¯å¿…é¡»å‘èµ·è¿æ¥ï¼Œè€Œåœ¨ç‰©è”ç½‘ï¼ˆIOTï¼‰åº”ç”¨ç¨‹åºä¸­ï¼Œè®¾å¤‡æˆ–ä¼ æ„Ÿå™¨å¾€å¾€éƒ½æ˜¯å®¢æˆ·ç«¯ï¼Œè¿™æ„å‘³ç€å®ƒä»¬æ— æ³•è¢«åŠ¨åœ°æ¥æ”¶æ¥è‡ªç½‘ç»œçš„å‘½ä»¤ã€‚</li><li>é€šå¸¸éœ€è¦å°†ä¸€æ¡å‘½ä»¤æˆ–è€…æ¶ˆæ¯ï¼Œå‘é€åˆ°ç½‘ç»œä¸Šçš„æ‰€æœ‰è®¾å¤‡ä¸Šã€‚HTTP è¦å®ç°è¿™æ ·çš„åŠŸèƒ½ä¸ä½†å¾ˆå›°éš¾ï¼Œè€Œä¸”æˆæœ¬æé«˜ã€‚</li></ul><p>å…·ä½“çš„ MQTT åè®®ä»‹ç»å’Œå®è·µï¼Œè¿™é‡Œæˆ‘å°±ä¸å†èµ˜è¿°äº†ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« ï¼Œé‡Œè¾¹å†™çš„ä¹Ÿéƒ½å¾ˆè¯¦ç»†äº†ã€‚</p><ul><li>MQTT åè®®çš„ä»‹ç»ï¼š
<a href=https://mp.weixin.qq.com/s/udFE6k9pPetIWsa6KeErrA rel=noopener>æˆ‘ä¹Ÿæ²¡æƒ³åˆ° SpringBoot + RabbitMQ åšæ™ºèƒ½å®¶å±…ï¼Œä¼šè¿™ä¹ˆç®€å•open in new window</a></li><li>MQTT å®ç°æ¶ˆæ¯æ¨é€ï¼š
<a href=https://mp.weixin.qq.com/s/U-fUGr9i1MVa4PoVyiDFCg rel=noopener>æœªè¯»æ¶ˆæ¯ï¼ˆå°çº¢ç‚¹ï¼‰ï¼Œå‰ç«¯ ä¸ RabbitMQ å®æ—¶æ¶ˆæ¯æ¨é€å®è·µï¼Œè´¼ç®€å•~open in new window</a></li></ul><h2 id=æ€»ç»“-æ€»ç»“><a rel=noopener class="internal-link broken" data-src=#%e6%80%bb%e7%bb%93>#</a> æ€»ç»“</h2><p><img src=https://googoo-s.github.io//statistic/Pasted%20image%2020230802002008.png width=auto alt></p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://googoo-s.github.io/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by googoo-s using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2023</p><ul><li><a href=https://googoo-s.github.io/>Home</a></li><li><a href=https://github.com/googoo-s>GitHub</a></li></ul></footer></div></div></body></html>