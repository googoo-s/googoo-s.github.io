{"/":{"title":"_index","content":"\nğŸ˜€ğŸ˜ğŸ˜²ğŸŒğŸ™€\n\nè¿™æ˜¯æˆ‘çš„ [Obsidian](https://obsidian.md/) çš„ vault ,æˆ‘ä½¿ç”¨äº† [quartz](https://github.com/jackyzha0/quartz) æ­å»ºäº†è¿™ä¸ªé¡µé¢ã€‚\n\n\u003e å…³äºå¦‚ä½•æ­å»ºå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç«  [ä½¿ç”¨quartzå‘å¸ƒobsidian  vault](Obsidian/ä½¿ç”¨quartzå‘å¸ƒobsidian%20%20vault.md)\n\nå¯ä»¥ç®—æ˜¯æˆ‘çš„åšå®¢ï¼Œå’Œèµ„æºåº“ã€‚ä¸»è¦åŒ…æ‹¬çš„å†…å®¹ï¼š\n\n* [å·¥å…·](å·¥å…·å’Œç¯å¢ƒ/å·¥å…·.md)\n\n* [ç¯å¢ƒæ­å»º](å·¥å…·å’Œç¯å¢ƒ/ç¯å¢ƒæ­å»º.md)\n\n* å„ç§ç¬”è®°\n\n* [èµ„æºæ±‡æ€»](èµ„æº/èµ„æºæ±‡æ€».md)\n\n\n\n\n\n\n\n\n","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/%E5%88%86%E5%B8%83%E5%BC%8F%E9%AB%98%E5%B9%B6%E5%8F%91%E9%AB%98%E6%80%A7%E8%83%BD%E9%AB%98%E5%8F%AF%E7%94%A8/%E6%97%A5%E5%BF%97/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8B%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86":{"title":"æœåŠ¡æ²»ç†ï¼šåˆ†å¸ƒå¼ä¸‹å¦‚ä½•è¿›è¡Œæ—¥å¿—ç®¡ç†ï¼Ÿ","content":"![](statistic/Pasted%20image%2020230802010117.png)","lastmodified":"2023-08-07T15:43:18.70778422Z","tags":[]},"/%E5%88%86%E5%B8%83%E5%BC%8F%E9%AB%98%E5%B9%B6%E5%8F%91%E9%AB%98%E6%80%A7%E8%83%BD%E9%AB%98%E5%8F%AF%E7%94%A8/%E7%9B%91%E6%8E%A7/%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E5%A6%82%E4%BD%95%E5%81%9A":{"title":"æœåŠ¡æ²»ç†ï¼šç›‘æ§ç³»ç»Ÿå¦‚ä½•åšï¼Ÿ","content":"![](statistic/Pasted%20image%2020230802010009.png)","lastmodified":"2023-08-07T15:43:18.70778422Z","tags":[]},"/%E5%B7%A5%E5%85%B7%E5%92%8C%E7%8E%AF%E5%A2%83/%E5%B7%A5%E5%85%B7":{"title":"å·¥å…·","content":"\n\n\n","lastmodified":"2023-08-07T15:43:18.711784297Z","tags":[]},"/%E5%B7%A5%E5%85%B7%E5%92%8C%E7%8E%AF%E5%A2%83/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA":{"title":"ç¯å¢ƒæ­å»º","content":"","lastmodified":"2023-08-07T15:43:18.711784297Z","tags":[]},"/%E5%B7%A5%E5%85%B7%E5%92%8C%E7%8E%AF%E5%A2%83/git/git":{"title":"git","content":"\n## ç‰ˆæœ¬æ§åˆ¶\n\n### ä»€ä¹ˆæ˜¯ç‰ˆæœ¬æ§åˆ¶\n\nç‰ˆæœ¬æ§åˆ¶æ˜¯ä¸€ç§è®°å½•ä¸€ä¸ªæˆ–è‹¥å¹²æ–‡ä»¶å†…å®¹å˜åŒ–ï¼Œä»¥ä¾¿å°†æ¥æŸ¥é˜…ç‰¹å®šç‰ˆæœ¬ä¿®è®¢æƒ…å†µçš„ç³»ç»Ÿã€‚é™¤äº†é¡¹ç›®æºä»£ç ï¼Œä½ å¯ä»¥å¯¹ä»»ä½•ç±»å‹çš„æ–‡ä»¶è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚\n\n### ä¸ºä»€ä¹ˆè¦ç‰ˆæœ¬æ§åˆ¶\n\næœ‰äº†å®ƒä½ å°±å¯ä»¥å°†æŸä¸ªæ–‡ä»¶å›æº¯åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼Œç”šè‡³å°†æ•´ä¸ªé¡¹ç›®éƒ½å›é€€åˆ°è¿‡å»æŸä¸ªæ—¶é—´ç‚¹çš„çŠ¶æ€ï¼Œä½ å¯ä»¥æ¯”è¾ƒæ–‡ä»¶çš„å˜åŒ–ç»†èŠ‚ï¼ŒæŸ¥å‡ºæœ€åæ˜¯è°ä¿®æ”¹äº†å“ªä¸ªåœ°æ–¹ï¼Œä»è€Œæ‰¾å‡ºå¯¼è‡´æ€ªå¼‚é—®é¢˜å‡ºç°çš„åŸå› ï¼Œåˆæ˜¯è°åœ¨ä½•æ—¶æŠ¥å‘Šäº†æŸä¸ªåŠŸèƒ½ç¼ºé™·ç­‰ç­‰ã€‚\n\n### æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ\n\nè®¸å¤šäººä¹ æƒ¯ç”¨å¤åˆ¶æ•´ä¸ªé¡¹ç›®ç›®å½•çš„æ–¹å¼æ¥ä¿å­˜ä¸åŒçš„ç‰ˆæœ¬ï¼Œæˆ–è®¸è¿˜ä¼šæ”¹ååŠ ä¸Šå¤‡ä»½æ—¶é—´ä»¥ç¤ºåŒºåˆ«ã€‚è¿™ä¹ˆåšå”¯ä¸€çš„å¥½å¤„å°±æ˜¯ç®€å•ï¼Œä½†æ˜¯ç‰¹åˆ«å®¹æ˜“çŠ¯é”™ã€‚æœ‰æ—¶å€™ä¼šæ··æ·†æ‰€åœ¨çš„å·¥ä½œç›®å½•ï¼Œä¸€ä¸å°å¿ƒä¼šå†™é”™æ–‡ä»¶æˆ–è€…è¦†ç›–æ„æƒ³å¤–çš„æ–‡ä»¶ã€‚\n\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œäººä»¬å¾ˆä¹…ä»¥å‰å°±å¼€å‘äº†è®¸å¤šç§æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå¤§å¤šéƒ½æ˜¯é‡‡ç”¨æŸç§ç®€å•çš„æ•°æ®åº“æ¥è®°å½•æ–‡ä»¶çš„å†æ¬¡æ›´æ–°å·®å¼‚ã€‚\n\n![æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ](statistic/æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ.png)\n\n### é›†ä¸­åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ\n\næ¥ä¸‹æ¥äººä»¬åˆé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•è®©åœ¨ä¸åŒç³»ç»Ÿä¸Šçš„å¼€å‘è€…ååŒå·¥ä½œï¼Ÿ äºæ˜¯ï¼Œé›†ä¸­åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆCentralized Version Control Systemsï¼Œç®€ç§° CVCSï¼‰åº”è¿è€Œç”Ÿã€‚\n\né›†ä¸­åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿéƒ½æœ‰ä¸€ä¸ªå•ä¸€çš„é›†ä¸­ç®¡ç†çš„æœåŠ¡å™¨ï¼Œä¿å­˜æ‰€æœ‰æ–‡ä»¶çš„ä¿®è®¢ç‰ˆæœ¬ï¼Œè€ŒååŒå·¥ä½œçš„äººä»¬éƒ½é€šè¿‡å®¢æˆ·ç«¯è¿åˆ°è¿™å°æœåŠ¡å™¨ï¼Œå–å‡ºæœ€æ–°çš„æ–‡ä»¶æˆ–è€…æäº¤æ›´æ–°ã€‚\n\n![é›†ä¸­åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ](statistic/é›†ä¸­åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ.png)\n\nè¿™ä¹ˆåšè™½ç„¶è§£å†³äº†æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ— æ³•è®©åœ¨ä¸åŒç³»ç»Ÿä¸Šçš„å¼€å‘è€…ååŒå·¥ä½œçš„è¯Ÿç—…ï¼Œä½†ä¹Ÿè¿˜æ˜¯å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š\n\n- **å•ç‚¹æ•…éšœï¼š** ä¸­å¤®æœåŠ¡å™¨å®•æœºï¼Œåˆ™å…¶ä»–äººæ— æ³•ä½¿ç”¨ï¼›å¦‚æœä¸­å¿ƒæ•°æ®åº“ç£ç›˜æŸååˆæ²¡æœ‰è¿›è¡Œå¤‡ä»½ï¼Œä½ å°†ä¸¢å¤±æ‰€æœ‰æ•°æ®ã€‚æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¹Ÿå­˜åœ¨ç±»ä¼¼é—®é¢˜ï¼Œåªè¦æ•´ä¸ªé¡¹ç›®çš„å†å²è®°å½•è¢«ä¿å­˜åœ¨å•ä¸€ä½ç½®ï¼Œå°±æœ‰ä¸¢å¤±æ‰€æœ‰å†å²æ›´æ–°è®°å½•çš„é£é™©ã€‚\n- **å¿…é¡»è”ç½‘æ‰èƒ½å·¥ä½œï¼š** å—ç½‘ç»œçŠ¶å†µã€å¸¦å®½å½±å“ã€‚\n\n### åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ\n\näºæ˜¯åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆDistributed Version Control Systemï¼Œç®€ç§° DVCSï¼‰é¢ä¸–äº†ã€‚ Git å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚\n\nè¿™ç±»ç³»ç»Ÿï¼Œå®¢æˆ·ç«¯å¹¶ä¸åªæå–æœ€æ–°ç‰ˆæœ¬çš„æ–‡ä»¶å¿«ç…§ï¼Œè€Œæ˜¯æŠŠä»£ç ä»“åº“å®Œæ•´åœ°é•œåƒä¸‹æ¥ã€‚è¿™ä¹ˆä¸€æ¥ï¼Œä»»ä½•ä¸€å¤„ååŒå·¥ä½œç”¨çš„æœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼Œäº‹åéƒ½å¯ä»¥ç”¨ä»»ä½•ä¸€ä¸ªé•œåƒå‡ºæ¥çš„æœ¬åœ°ä»“åº“æ¢å¤ã€‚å› ä¸ºæ¯ä¸€æ¬¡çš„å…‹éš†æ“ä½œï¼Œå®é™…ä¸Šéƒ½æ˜¯ä¸€æ¬¡å¯¹ä»£ç ä»“åº“çš„å®Œæ•´å¤‡ä»½ã€‚\n\n![åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ](statistic/åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ.png)\n\nåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå¯ä»¥ä¸ç”¨è”ç½‘å°±å¯ä»¥å·¥ä½œï¼Œå› ä¸ºæ¯ä¸ªäººçš„ç”µè„‘ä¸Šéƒ½æ˜¯å®Œæ•´çš„ç‰ˆæœ¬åº“ï¼Œå½“ä½ ä¿®æ”¹äº†æŸä¸ªæ–‡ä»¶åï¼Œä½ åªéœ€è¦å°†è‡ªå·±çš„ä¿®æ”¹æ¨é€ç»™åˆ«äººå°±å¯ä»¥äº†ã€‚ä½†æ˜¯ï¼Œåœ¨å®é™…ä½¿ç”¨åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„æ—¶å€™ï¼Œå¾ˆå°‘ä¼šç›´æ¥è¿›è¡Œæ¨é€ä¿®æ”¹ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€å°å……å½“â€œä¸­å¤®æœåŠ¡å™¨â€çš„ä¸œè¥¿ã€‚è¿™ä¸ªæœåŠ¡å™¨çš„ä½œç”¨ä»…ä»…æ˜¯ç”¨æ¥æ–¹ä¾¿â€œäº¤æ¢â€å¤§å®¶çš„ä¿®æ”¹ï¼Œæ²¡æœ‰å®ƒå¤§å®¶ä¹Ÿä¸€æ ·å¹²æ´»ï¼Œåªæ˜¯äº¤æ¢ä¿®æ”¹ä¸æ–¹ä¾¿è€Œå·²ã€‚\n\nåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„ä¼˜åŠ¿ä¸å•æ˜¯ä¸å¿…è”ç½‘è¿™ä¹ˆç®€å•ï¼Œåé¢æˆ‘ä»¬è¿˜ä¼šçœ‹åˆ° Git æå…¶å¼ºå¤§çš„åˆ†æ”¯ç®¡ç†ç­‰åŠŸèƒ½ã€‚\n\n## è®¤è¯† Git\n\n### Git ç®€å²\n\nLinux å†…æ ¸é¡¹ç›®ç»„å½“æ—¶ä½¿ç”¨åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ BitKeeper æ¥ç®¡ç†å’Œç»´æŠ¤ä»£ç ã€‚ä½†æ˜¯ï¼Œåæ¥å¼€å‘ BitKeeper çš„å•†ä¸šå…¬å¸åŒ Linux å†…æ ¸å¼€æºç¤¾åŒºçš„åˆä½œå…³ç³»ç»“æŸï¼Œä»–ä»¬æ”¶å›äº† Linux å†…æ ¸ç¤¾åŒºå…è´¹ä½¿ç”¨ BitKeeper çš„æƒåŠ›ã€‚ Linux å¼€æºç¤¾åŒºï¼ˆç‰¹åˆ«æ˜¯ Linux çš„ç¼”é€ è€… Linus Torvaldsï¼‰åŸºäºä½¿ç”¨ BitKeeper æ—¶çš„ç»éªŒæ•™è®­ï¼Œå¼€å‘å‡ºè‡ªå·±çš„ç‰ˆæœ¬ç³»ç»Ÿï¼Œè€Œä¸”å¯¹æ–°çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿåšäº†å¾ˆå¤šæ”¹è¿›ã€‚\n\n### Git ä¸å…¶ä»–ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿçš„ä¸»è¦åŒºåˆ«\n\nGit åœ¨ä¿å­˜å’Œå¯¹å¾…å„ç§ä¿¡æ¯çš„æ—¶å€™ä¸å…¶å®ƒç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæœ‰å¾ˆå¤§å·®å¼‚ï¼Œå°½ç®¡æ“ä½œèµ·æ¥çš„å‘½ä»¤å½¢å¼éå¸¸ç›¸è¿‘ï¼Œç†è§£è¿™äº›å·®å¼‚å°†æœ‰åŠ©äºé˜²æ­¢ä½ ä½¿ç”¨ä¸­çš„å›°æƒ‘ã€‚\n\nä¸‹é¢æˆ‘ä»¬ä¸»è¦è¯´ä¸€ä¸ªå…³äº Git ä¸å…¶ä»–ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿçš„ä¸»è¦å·®åˆ«ï¼š**å¯¹å¾…æ•°æ®çš„æ–¹å¼**ã€‚\n\n**Git é‡‡ç”¨çš„æ˜¯ç›´æ¥è®°å½•å¿«ç…§çš„æ–¹å¼ï¼Œè€Œéå·®å¼‚æ¯”è¾ƒã€‚æˆ‘åé¢ä¼šè¯¦ç»†ä»‹ç»è¿™ä¸¤ç§æ–¹å¼çš„å·®åˆ«ã€‚**\n\nå¤§éƒ¨åˆ†ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆCVSã€Subversionã€Perforceã€Bazaar ç­‰ç­‰ï¼‰éƒ½æ˜¯ä»¥æ–‡ä»¶å˜æ›´åˆ—è¡¨çš„æ–¹å¼å­˜å‚¨ä¿¡æ¯ï¼Œè¿™ç±»ç³»ç»Ÿ**å°†å®ƒä»¬ä¿å­˜çš„ä¿¡æ¯çœ‹ä½œæ˜¯ä¸€ç»„åŸºæœ¬æ–‡ä»¶å’Œæ¯ä¸ªæ–‡ä»¶éšæ—¶é—´é€æ­¥ç´¯ç§¯çš„å·®å¼‚ã€‚**\n\nå…·ä½“åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç†è§£èµ·æ¥å…¶å®å¾ˆç®€å•ï¼Œæ¯å½“æˆ‘ä»¬æäº¤æ›´æ–°ä¸€ä¸ªæ–‡ä»¶ä¹‹åï¼Œç³»ç»Ÿéƒ½ä¼šè®°å½•è¿™ä¸ªæ–‡ä»¶åšäº†å“ªäº›æ›´æ–°ï¼Œä»¥å¢é‡ç¬¦å· Î”(Delta)è¡¨ç¤ºã€‚\n\n![](statistic/2019-3deltas.png)\n\n**æˆ‘ä»¬æ€æ ·æ‰èƒ½å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶çš„æœ€ç»ˆç‰ˆæœ¬å‘¢ï¼Ÿ**\n\nå¾ˆç®€å•ï¼Œé«˜ä¸­æ•°å­¦çš„åŸºæœ¬çŸ¥è¯†ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¿™äº›åŸæ–‡ä»¶å’Œè¿™äº›å¢åŠ è¿›è¡Œç›¸åŠ å°±è¡Œäº†ã€‚\n\n**è¿™ç§æ–¹å¼æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ**\n\næ¯”å¦‚æˆ‘ä»¬çš„å¢é‡ç‰¹åˆ«ç‰¹åˆ«å¤šçš„è¯ï¼Œå¦‚æœæˆ‘ä»¬è¦å¾—åˆ°æœ€ç»ˆçš„æ–‡ä»¶æ˜¯ä¸æ˜¯ä¼šè€—è´¹æ—¶é—´å’Œæ€§èƒ½ã€‚\n\nGit ä¸æŒ‰ç…§ä»¥ä¸Šæ–¹å¼å¯¹å¾…æˆ–ä¿å­˜æ•°æ®ã€‚åä¹‹ï¼ŒGit æ›´åƒæ˜¯æŠŠæ•°æ®çœ‹ä½œæ˜¯å¯¹å°å‹æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ç»„å¿«ç…§ã€‚æ¯æ¬¡ä½ æäº¤æ›´æ–°ï¼Œæˆ–åœ¨ Git ä¸­ä¿å­˜é¡¹ç›®çŠ¶æ€æ—¶ï¼Œå®ƒä¸»è¦å¯¹å½“æ—¶çš„å…¨éƒ¨æ–‡ä»¶åˆ¶ä½œä¸€ä¸ªå¿«ç…§å¹¶ä¿å­˜è¿™ä¸ªå¿«ç…§çš„ç´¢å¼•ã€‚ä¸ºäº†é«˜æ•ˆï¼Œå¦‚æœæ–‡ä»¶æ²¡æœ‰ä¿®æ”¹ï¼ŒGit ä¸å†é‡æ–°å­˜å‚¨è¯¥æ–‡ä»¶ï¼Œè€Œæ˜¯åªä¿ç•™ä¸€ä¸ªé“¾æ¥æŒ‡å‘ä¹‹å‰å­˜å‚¨çš„æ–‡ä»¶ã€‚ Git å¯¹å¾…æ•°æ®æ›´åƒæ˜¯ä¸€ä¸ª **å¿«ç…§æµ**ã€‚\n\n![](statistic/2019-3snapshots.png)\n\n### Git çš„ä¸‰ç§çŠ¶æ€\n\nGit æœ‰ä¸‰ç§çŠ¶æ€ï¼Œä½ çš„æ–‡ä»¶å¯èƒ½å¤„äºå…¶ä¸­ä¹‹ä¸€ï¼š\n\n1. **å·²æäº¤ï¼ˆcommittedï¼‰**ï¼šæ•°æ®å·²ç»å®‰å…¨çš„ä¿å­˜åœ¨æœ¬åœ°æ•°æ®åº“ä¸­ã€‚\n2. **å·²ä¿®æ”¹ï¼ˆmodifiedï¼‰**ï¼šå·²ä¿®æ”¹è¡¨ç¤ºä¿®æ”¹äº†æ–‡ä»¶ï¼Œä½†è¿˜æ²¡ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚\n3. **å·²æš‚å­˜ï¼ˆstagedï¼‰**ï¼šè¡¨ç¤ºå¯¹ä¸€ä¸ªå·²ä¿®æ”¹æ–‡ä»¶çš„å½“å‰ç‰ˆæœ¬åšäº†æ ‡è®°ï¼Œä½¿ä¹‹åŒ…å«åœ¨ä¸‹æ¬¡æäº¤çš„å¿«ç…§ä¸­ã€‚\n\nç”±æ­¤å¼•å…¥ Git é¡¹ç›®çš„ä¸‰ä¸ªå·¥ä½œåŒºåŸŸçš„æ¦‚å¿µï¼š**Git ä»“åº“ (. Git directory)**ã€**å·¥ä½œç›®å½• (Working Directory)** ä»¥åŠ **æš‚å­˜åŒºåŸŸ (Staging Area)** ã€‚\n\n![](statistic/2019-3areas.png)\n\n**åŸºæœ¬çš„ Git å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š**\n\n1. åœ¨å·¥ä½œç›®å½•ä¸­ä¿®æ”¹æ–‡ä»¶ã€‚\n2. æš‚å­˜æ–‡ä»¶ï¼Œå°†æ–‡ä»¶çš„å¿«ç…§æ”¾å…¥æš‚å­˜åŒºåŸŸã€‚\n3. æäº¤æ›´æ–°ï¼Œæ‰¾åˆ°æš‚å­˜åŒºåŸŸçš„æ–‡ä»¶ï¼Œå°†å¿«ç…§æ°¸ä¹…æ€§å­˜å‚¨åˆ° Git ä»“åº“ç›®å½•ã€‚\n\n## Git ä½¿ç”¨å¿«é€Ÿå…¥é—¨\n\n### è·å– Git ä»“åº“\n\næœ‰ä¸¤ç§å–å¾— Git é¡¹ç›®ä»“åº“çš„æ–¹æ³•ã€‚\n\n1. åœ¨ç°æœ‰ç›®å½•ä¸­åˆå§‹åŒ–ä»“åº“: è¿›å…¥é¡¹ç›®ç›®å½•è¿è¡Œ `git init` å‘½ä»¤, è¯¥å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸º `.git` çš„å­ç›®å½•ã€‚\n2. ä»ä¸€ä¸ªæœåŠ¡å™¨å…‹éš†ä¸€ä¸ªç°æœ‰çš„ Git ä»“åº“: `git clone [url]` è‡ªå®šä¹‰æœ¬åœ°ä»“åº“çš„åå­—: `git clone [url] directoryname`\n\n### è®°å½•æ¯æ¬¡æ›´æ–°åˆ°ä»“åº“\n\n1. **æ£€æµ‹å½“å‰æ–‡ä»¶çŠ¶æ€** : `git status`\n2. **æå‡ºæ›´æ”¹ï¼ˆæŠŠå®ƒä»¬æ·»åŠ åˆ°æš‚å­˜åŒº**ï¼‰ï¼š`git add filename` (é’ˆå¯¹ç‰¹å®šæ–‡ä»¶)ã€`git add *` (æ‰€æœ‰æ–‡ä»¶)ã€`git add *.txt`ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼Œæ‰€æœ‰ .txt æ–‡ä»¶ï¼‰\n3. **å¿½ç•¥æ–‡ä»¶**ï¼š`.gitignore` æ–‡ä»¶\n4. **æäº¤æ›´æ–°:** `git commit -m \"ä»£ç æäº¤ä¿¡æ¯\"` ï¼ˆæ¯æ¬¡å‡†å¤‡æäº¤å‰ï¼Œå…ˆç”¨ `git status` çœ‹ä¸‹ï¼Œæ˜¯ä¸æ˜¯éƒ½å·²æš‚å­˜èµ·æ¥äº†ï¼Œç„¶åå†è¿è¡Œæäº¤å‘½ä»¤ `git commit`ï¼‰\n5. **è·³è¿‡ä½¿ç”¨æš‚å­˜åŒºåŸŸæ›´æ–°çš„æ–¹å¼** : `git commit -a -m \"ä»£ç æäº¤ä¿¡æ¯\"`ã€‚ `git commit` åŠ ä¸Š `-a` é€‰é¡¹ï¼ŒGit å°±ä¼šè‡ªåŠ¨æŠŠæ‰€æœ‰å·²ç»è·Ÿè¸ªè¿‡çš„æ–‡ä»¶æš‚å­˜èµ·æ¥ä¸€å¹¶æäº¤ï¼Œä»è€Œè·³è¿‡ `git add` æ­¥éª¤ã€‚\n6. **ç§»é™¤æ–‡ä»¶**ï¼š`git rm filename` ï¼ˆä»æš‚å­˜åŒºåŸŸç§»é™¤ï¼Œç„¶åæäº¤ã€‚ï¼‰\n7. **å¯¹æ–‡ä»¶é‡å‘½å**ï¼š`git mv README.md README` (è¿™ä¸ªå‘½ä»¤ç›¸å½“äº `mv README.md README`ã€`git rm README.md`ã€`git add README` è¿™ä¸‰æ¡å‘½ä»¤çš„é›†åˆ)\n\n### ä¸€ä¸ªå¥½çš„ Git æäº¤æ¶ˆæ¯\n\nä¸€ä¸ªå¥½çš„ Git æäº¤æ¶ˆæ¯å¦‚ä¸‹ï¼š\n\n```\næ ‡é¢˜è¡Œï¼šç”¨è¿™ä¸€è¡Œæ¥æè¿°å’Œè§£é‡Šä½ çš„è¿™æ¬¡æäº¤\n\nä¸»ä½“éƒ¨åˆ†å¯ä»¥æ˜¯å¾ˆå°‘çš„å‡ è¡Œï¼Œæ¥åŠ å…¥æ›´å¤šçš„ç»†èŠ‚æ¥è§£é‡Šæäº¤ï¼Œæœ€å¥½æ˜¯èƒ½ç»™å‡ºä¸€äº›ç›¸å…³çš„èƒŒæ™¯æˆ–è€…è§£é‡Šè¿™ä¸ªæäº¤èƒ½ä¿®å¤å’Œè§£å†³ä»€ä¹ˆé—®é¢˜ã€‚\n\nä¸»ä½“éƒ¨åˆ†å½“ç„¶ä¹Ÿå¯ä»¥æœ‰å‡ æ®µï¼Œä½†æ˜¯ä¸€å®šè¦æ³¨æ„æ¢è¡Œå’Œå¥å­ä¸è¦å¤ªé•¿ã€‚å› ä¸ºè¿™æ ·åœ¨ä½¿ç”¨ \"git log\" çš„æ—¶å€™ä¼šæœ‰ç¼©è¿›æ¯”è¾ƒå¥½çœ‹ã€‚\n```\n\næäº¤çš„æ ‡é¢˜è¡Œæè¿°åº”è¯¥å°½é‡çš„æ¸…æ™°å’Œå°½é‡çš„ä¸€å¥è¯æ¦‚æ‹¬ã€‚è¿™æ ·å°±æ–¹ä¾¿ç›¸å…³çš„ Git æ—¥å¿—æŸ¥çœ‹å·¥å…·æ˜¾ç¤ºå’Œå…¶ä»–äººçš„é˜…è¯»ã€‚\n\n### æ¨é€æ”¹åŠ¨åˆ°è¿œç¨‹ä»“åº“\n\n- å¦‚æœä½ è¿˜æ²¡æœ‰å…‹éš†ç°æœ‰ä»“åº“ï¼Œå¹¶æ¬²å°†ä½ çš„ä»“åº“è¿æ¥åˆ°æŸä¸ªè¿œç¨‹æœåŠ¡å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ·»åŠ ï¼š`git remote add origin \u003cserver\u003e` ,æ¯”å¦‚æˆ‘ä»¬è¦è®©æœ¬åœ°çš„ä¸€ä¸ªä»“åº“å’Œ GitHub ä¸Šåˆ›å»ºçš„ä¸€ä¸ªä»“åº“å…³è”å¯ä»¥è¿™æ · `git remote add origin https://github.com/Snailclimb/test.git`\n- å°†è¿™äº›æ”¹åŠ¨æäº¤åˆ°è¿œç«¯ä»“åº“ï¼š`git push origin master` (å¯ä»¥æŠŠ _master_ æ¢æˆä½ æƒ³è¦æ¨é€çš„ä»»ä½•åˆ†æ”¯)\n\n  å¦‚æ­¤ä½ å°±èƒ½å¤Ÿå°†ä½ çš„æ”¹åŠ¨æ¨é€åˆ°æ‰€æ·»åŠ çš„æœåŠ¡å™¨ä¸Šå»äº†ã€‚\n\n### è¿œç¨‹ä»“åº“çš„ç§»é™¤ä¸é‡å‘½å\n\n- å°† test é‡å‘½åä¸º test 1ï¼š`git remote rename test test 1`\n- ç§»é™¤è¿œç¨‹ä»“åº“ test 1:`git remote rm test 1`\n\n### æŸ¥çœ‹æäº¤å†å²\n\nåœ¨æäº¤äº†è‹¥å¹²æ›´æ–°ï¼Œåˆæˆ–è€…å…‹éš†äº†æŸä¸ªé¡¹ç›®ä¹‹åï¼Œä½ ä¹Ÿè®¸æƒ³å›é¡¾ä¸‹æäº¤å†å²ã€‚å®Œæˆè¿™ä¸ªä»»åŠ¡æœ€ç®€å•è€Œåˆæœ‰æ•ˆçš„å·¥å…·æ˜¯ `git log` å‘½ä»¤ã€‚`git log` ä¼šæŒ‰æäº¤æ—¶é—´åˆ—å‡ºæ‰€æœ‰çš„æ›´æ–°ï¼Œæœ€è¿‘çš„æ›´æ–°æ’åœ¨æœ€ä¸Šé¢ã€‚\n\n**å¯ä»¥æ·»åŠ ä¸€äº›å‚æ•°æ¥æŸ¥çœ‹è‡ªå·±å¸Œæœ›çœ‹åˆ°çš„å†…å®¹ï¼š**\n\nåªçœ‹æŸä¸ªäººçš„æäº¤è®°å½•ï¼š\n\n```shell\nGit log --author=bob\n```\n\n### æ’¤é”€æ“ä½œ\n\næœ‰æ—¶å€™æˆ‘ä»¬æäº¤å®Œäº†æ‰å‘ç°æ¼æ‰äº†å‡ ä¸ªæ–‡ä»¶æ²¡æœ‰æ·»åŠ ï¼Œæˆ–è€…æäº¤ä¿¡æ¯å†™é”™äº†ã€‚æ­¤æ—¶ï¼Œå¯ä»¥è¿è¡Œå¸¦æœ‰ `--amend` é€‰é¡¹çš„æäº¤å‘½ä»¤å°è¯•é‡æ–°æäº¤ï¼š\n\n```shell\nGit commit --amend\n```\n\nå–æ¶ˆæš‚å­˜çš„æ–‡ä»¶\n\n```shell\nGit reset filename\n```\n\næ’¤æ¶ˆå¯¹æ–‡ä»¶çš„ä¿®æ”¹:\n\n```shell\nGit checkout -- filename\n```\n\nå‡å¦‚ä½ æƒ³ä¸¢å¼ƒä½ åœ¨æœ¬åœ°çš„æ‰€æœ‰æ”¹åŠ¨ä¸æäº¤ï¼Œå¯ä»¥åˆ°æœåŠ¡å™¨ä¸Šè·å–æœ€æ–°çš„ç‰ˆæœ¬å†å²ï¼Œå¹¶å°†ä½ æœ¬åœ°ä¸»åˆ†æ”¯æŒ‡å‘å®ƒï¼š\n\n```shell\nGit fetch origin\nGit reset --hard origin/master\n```\n\n### åˆ†æ”¯\n\nåˆ†æ”¯æ˜¯ç”¨æ¥å°†ç‰¹æ€§å¼€å‘ç»ç¼˜å¼€æ¥çš„ã€‚åœ¨ä½ åˆ›å»ºä»“åº“çš„æ—¶å€™ï¼Œ_master_ æ˜¯â€œé»˜è®¤â€çš„åˆ†æ”¯ã€‚åœ¨å…¶ä»–åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘ï¼Œå®Œæˆåå†å°†å®ƒä»¬åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸Šã€‚\n\næˆ‘ä»¬é€šå¸¸åœ¨å¼€å‘æ–°åŠŸèƒ½ã€ä¿®å¤ä¸€ä¸ªç´§æ€¥ bug ç­‰ç­‰æ—¶å€™ä¼šé€‰æ‹©åˆ›å»ºåˆ†æ”¯ã€‚å•åˆ†æ”¯å¼€å‘å¥½è¿˜æ˜¯å¤šåˆ†æ”¯å¼€å‘å¥½ï¼Œè¿˜æ˜¯è¦çœ‹å…·ä½“åœºæ™¯æ¥è¯´ã€‚\n\nåˆ›å»ºä¸€ä¸ªåå­—å«åš test çš„åˆ†æ”¯\n\n```shell\nGit branch test\n```\n\nåˆ‡æ¢å½“å‰åˆ†æ”¯åˆ° testï¼ˆå½“ä½ åˆ‡æ¢åˆ†æ”¯çš„æ—¶å€™ï¼ŒGit ä¼šé‡ç½®ä½ çš„å·¥ä½œç›®å½•ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒå›åˆ°äº†ä½ åœ¨é‚£ä¸ªåˆ†æ”¯ä¸Šæœ€åä¸€æ¬¡æäº¤çš„æ ·å­ã€‚ Git ä¼šè‡ªåŠ¨æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹æ–‡ä»¶ä»¥ç¡®ä¿æ­¤æ—¶ä½ çš„å·¥ä½œç›®å½•å’Œè¿™ä¸ªåˆ†æ”¯æœ€åä¸€æ¬¡æäº¤æ—¶çš„æ ·å­ä¸€æ¨¡ä¸€æ ·ï¼‰\n\n```shell\nGit checkout test\n```\n\n![](statistic/2019-3%E5%88%87%E6%8D%A2%E5%88%86%E6%94%AF.png)\n\nä½ ä¹Ÿå¯ä»¥ç›´æ¥è¿™æ ·åˆ›å»ºåˆ†æ”¯å¹¶åˆ‡æ¢è¿‡å» (ä¸Šé¢ä¸¤æ¡å‘½ä»¤çš„åˆå†™)\n\n```shell\nGit checkout -b feature_x\n```\n\nåˆ‡æ¢åˆ°ä¸»åˆ†æ”¯\n\n```shell\nGit checkout master\n```\n\nåˆå¹¶åˆ†æ”¯ (å¯èƒ½ä¼šæœ‰å†²çª)\n\n```shell\n Git merge test\n```\n\næŠŠæ–°å»ºçš„åˆ†æ”¯åˆ æ‰\n\n```shell\nGit branch -d feature_x\n```\n\nå°†åˆ†æ”¯æ¨é€åˆ°è¿œç«¯ä»“åº“ï¼ˆæ¨é€æˆåŠŸåå…¶ä»–äººå¯è§ï¼‰ï¼š\n\n```shell\nGit push origin\n```\n\n\n---\nTitle: Github å®ç”¨å°æŠ€å·§æ€»ç»“\nCategory: å¼€å‘å·¥å…·\nTag:\n  - Git\n---\n\næˆ‘ä½¿ç”¨ Github å·²ç»æœ‰ 6 å¹´å¤šäº†ï¼Œä»Šå¤©æ¯«æ— ä¿ç•™åœ°æŠŠè‡ªå·±è§‰å¾—æ¯”è¾ƒæœ‰ç”¨çš„ Github å°æŠ€å·§é€ç»™å…³æ³¨ JavaGuide çš„å„ä½å°ä¼™ä¼´ã€‚\n\n## ä¸€é”®ç”Ÿæˆ Github ç®€å† \u0026 Github å¹´æŠ¥\n\né€šè¿‡ [https://resume.github.io/](https://resume.github.io/) è¿™ä¸ªç½‘ç«™ä½ å¯ä»¥ä¸€é”®ç”Ÿæˆä¸€ä¸ªåœ¨çº¿çš„ Github ç®€å†ã€‚\n\nå½“æ—¶æˆ‘å‚åŠ çš„æ ¡æ‹›çš„æ—¶å€™ï¼Œä¸ªäººä¿¡æ¯é‚£é‡Œå°±æ”¾äº†ä¸€ä¸ªåœ¨çº¿çš„ Github ç®€å†ã€‚æˆ‘è§‰å¾—è¿™æ ·ä¼šè®©é¢è¯•å®˜æ„Ÿè§‰ä½ æ˜¯ä¸€ä¸ªå†…è¡Œï¼Œä¼šæé«˜ä¸€äº›å°è±¡åˆ†ã€‚\n\nä½†æ˜¯ï¼Œå¦‚æœä½ çš„ Github æ²¡æœ‰ä»€ä¹ˆé¡¹ç›®çš„è¯è¿˜æ˜¯ä¸è¦æ”¾åœ¨ç®€å†é‡Œé¢äº†ã€‚ç”Ÿæˆåçš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![Githubç®€å†](statistic/Githubç®€å†.png)\n\né€šè¿‡ \u003chttps://www.githubtrends.io/wrapped\u003e è¿™ä¸ªç½‘ç«™ï¼Œä½ å¯ä»¥ç”Ÿæˆä¸€ä»½ Github ä¸ªäººå¹´æŠ¥ï¼Œè¿™ä¸ªå¹´æŠ¥ä¼šåˆ—ä¸¾å‡ºä½ åœ¨è¿™ä¸€å¹´çš„é¡¹ç›®è´¡çŒ®æƒ…å†µã€æœ€å¸¸ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ã€è¯¦ç»†çš„è´¡çŒ®ä¿¡æ¯ã€‚\n\n![](statistic/image-20211226144607457.png)\n\n## ä¸ªæ€§åŒ– Github é¦–é¡µ\n\nGithub ç›®å‰æ”¯æŒåœ¨ä¸ªäººä¸»é¡µè‡ªå®šä¹‰å±•ç¤ºä¸€äº›å†…å®¹ã€‚å±•ç¤ºæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![ä¸ªæ€§åŒ–é¦–é¡µå±•ç¤ºæ•ˆæœ](statistic/ä¸ªæ€§åŒ–é¦–é¡µå±•ç¤ºæ•ˆæœ.png)\n\næƒ³è¦åšåˆ°è¿™æ ·éå¸¸ç®€å•ï¼Œä½ åªéœ€è¦åˆ›å»ºä¸€ä¸ªå’Œä½ çš„ Github è´¦æˆ·åŒåçš„ä»“åº“ï¼Œç„¶åè‡ªå®šä¹‰ `README.md` çš„å†…å®¹å³å¯ã€‚\n\nå±•ç¤ºåœ¨ä½ ä¸»é¡µçš„è‡ªå®šä¹‰å†…å®¹å°±æ˜¯ `README.md` çš„å†…å®¹ï¼ˆ_ä¸ä¼š Markdown è¯­æ³•çš„å°ä¼™ä¼´è‡ªè¡Œé¢å£ 5 åˆ†é’Ÿ_ï¼‰ã€‚\n\n![åˆ›å»ºä¸€ä¸ªå’Œä½ çš„Githubè´¦æˆ·åŒåçš„ä»“åº“](statistic/åˆ›å»ºä¸€ä¸ªå’Œä½ çš„Githubè´¦æˆ·åŒåçš„ä»“åº“.png)\n\nè¿™ä¸ªä¹Ÿæ˜¯å¯ä»¥ç©å‡ºèŠ±æ¥çš„ï¼æ¯”å¦‚è¯´ï¼šé€šè¿‡ [github-readme-stats](https://hellogithub.com/periodical/statistics/click/?target=https://github.com/anuraghazra/github-readme-stats) è¿™ä¸ªå¼€æºé¡¹ç›®ï¼Œä½ å¯ä»¥ README ä¸­å±•ç¤ºåŠ¨æ€ç”Ÿæˆçš„ GitHub ç»Ÿè®¡ä¿¡æ¯ã€‚å±•ç¤ºæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![é€šè¿‡github-readme-statsåŠ¨æ€ç”ŸæˆGitHubç»Ÿè®¡ä¿¡æ¯ ](statistic/é€šè¿‡github-readme-statsåŠ¨æ€ç”ŸæˆGitHubç»Ÿè®¡ä¿¡æ¯_.png)\n\nå…³äºä¸ªæ€§åŒ–é¦–é¡µè¿™ä¸ªå°±ä¸å¤šæäº†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´è‡ªè¡Œç ”ç©¶ä¸€ä¸‹ã€‚\n\n## è‡ªå®šä¹‰é¡¹ç›®å¾½ç« \n\nä½ åœ¨ Github ä¸Šçœ‹åˆ°çš„é¡¹ç›®å¾½ç« éƒ½æ˜¯é€šè¿‡ [https://shields.io/](https://shields.io/) è¿™ä¸ªç½‘ç«™ç”Ÿæˆçš„ã€‚æˆ‘çš„ JavaGuide è¿™ä¸ªé¡¹ç›®çš„å¾½ç« å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![é¡¹ç›®å¾½ç« ](statistic/é¡¹ç›®å¾½ç« .png)\n\nå¹¶ä¸”ï¼Œä½ ä¸å…‰å¯ä»¥ç”Ÿæˆé™æ€å¾½ç« ï¼Œshield. Io è¿˜å¯ä»¥åŠ¨æ€è¯»å–ä½ é¡¹ç›®çš„çŠ¶æ€å¹¶ç”Ÿæˆå¯¹åº”çš„å¾½ç« ã€‚\n\n![è‡ªå®šä¹‰é¡¹ç›®å¾½ç« ](statistic/è‡ªå®šä¹‰é¡¹ç›®å¾½ç« .png)\n\nç”Ÿæˆçš„æè¿°é¡¹ç›®çŠ¶æ€çš„å¾½ç« æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![æè¿°é¡¹ç›®çŠ¶æ€çš„å¾½ç« ](statistic/æè¿°é¡¹ç›®çŠ¶æ€çš„å¾½ç« .png)\n\n## è‡ªåŠ¨ä¸ºé¡¹ç›®æ·»åŠ è´¡çŒ®æƒ…å†µå›¾æ ‡\n\né€šè¿‡ repobeats è¿™ä¸ªå·¥å…·å¯ä»¥ä¸º Github é¡¹ç›®æ·»åŠ å¦‚ä¸‹å›¾æ‰€ç¤ºçš„é¡¹ç›®è´¡çŒ®åŸºæœ¬æƒ…å†µå›¾è¡¨ï¼ŒæŒºä¸é”™çš„ ğŸ‘\n\n![](statistic/repobeats.png)\n\nåœ°å€ï¼š\u003chttps://repobeats.axiom.co/\u003e ã€‚\n\n## Github è¡¨æƒ…\n\n![Githubè¡¨æƒ…](statistic/Githubè¡¨æƒ….png)\n\nå¦‚æœä½ æƒ³è¦åœ¨ Github ä½¿ç”¨è¡¨æƒ…çš„è¯ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰¾æ‰¾ï¼š[www.webfx.com/tools/emoji-cheat-sheet/](https://www.webfx.com/tools/emoji-cheat-sheet/)ã€‚\n\n![åœ¨çº¿Githubè¡¨æƒ…](statistic/åœ¨çº¿Githubè¡¨æƒ….png)\n\n## é«˜æ•ˆé˜…è¯» Github é¡¹ç›®çš„æºä»£ç \n\nGithub å‰æ®µæ—¶é—´æ¨å‡ºçš„ Codespaces å¯ä»¥æä¾›ç±»ä¼¼ VS Code çš„åœ¨çº¿ IDEï¼Œä¸è¿‡ç›®å‰è¿˜æ²¡æœ‰å®Œå…¨å¼€å‘ä½¿ç”¨ã€‚\n\nç®€å•ä»‹ç»å‡ ç§æˆ‘æœ€å¸¸ç”¨çš„é˜…è¯» Github é¡¹ç›®æºä»£ç çš„æ–¹å¼ã€‚\n\n### Chrome æ’ä»¶ Octotree\n\nè¿™ä¸ªå·²ç»è€ç”Ÿå¸¸è°ˆäº†ï¼Œæ˜¯æˆ‘æœ€å–œæ¬¢çš„ä¸€ç§æ–¹å¼ã€‚ä½¿ç”¨äº† Octotree ä¹‹åç½‘é¡µä¾§è¾¹æ ä¼šæŒ‰ç…§æ ‘å½¢ç»“æ„å±•ç¤ºé¡¹ç›®ï¼Œä¸ºæˆ‘ä»¬å¸¦æ¥ IDE èˆ¬çš„é˜…è¯»æºä»£ç çš„æ„Ÿå—ã€‚\n\n![Chromeæ’ä»¶Octotree](statistic/Chromeæ’ä»¶Octotree.png)\n\n### Chrome æ’ä»¶ SourceGraph\n\næˆ‘ä¸æƒ³å°†é¡¹ç›® clone åˆ°æœ¬åœ°çš„æ—¶å€™ä¸€èˆ¬å°±ä¼šä½¿ç”¨è¿™ç§æ–¹å¼æ¥é˜…è¯»é¡¹ç›®æºä»£ç ã€‚SourceGraph ä¸ä»…å¯ä»¥è®©æˆ‘ä»¬åœ¨ Github ä¼˜é›…çš„æŸ¥çœ‹ä»£ç ï¼Œå®ƒè¿˜æ”¯æŒä¸€äº›éªšæ“ä½œï¼Œæ¯”å¦‚ï¼šç±»ä¹‹é—´çš„è·³è½¬ã€ä»£ç æœç´¢ç­‰åŠŸèƒ½ã€‚\n\nå½“ä½ ä¸‹è½½äº†è¿™ä¸ªæ’ä»¶ä¹‹åï¼Œä½ çš„é¡¹ç›®ä¸»é¡µä¼šå¤šå‡ºä¸€ä¸ªå°å›¾æ ‡å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ç‚¹å‡»è¿™ä¸ªå°å›¾æ ‡å³å¯åœ¨çº¿é˜…è¯»é¡¹ç›®æºä»£ç ã€‚\n\n![](statistic/image-20201107145749659.png)\n\nä½¿ç”¨ SourceGraph é˜…è¯»ä»£ç çš„å°±åƒä¸‹é¢è¿™æ ·ï¼ŒåŒæ ·æ˜¯æ ‘å½¢ç»“æ„å±•ç¤ºä»£ç ï¼Œä½†æ˜¯æˆ‘ä¸ªäººæ„Ÿè§‰æ²¡æœ‰ Octotree çš„æ‰‹æ„Ÿèˆ’æœã€‚ä¸è¿‡ï¼ŒSourceGraph å†…ç½®äº†å¾ˆå¤šæ’ä»¶ï¼Œè€Œä¸”è¿˜æ”¯æŒç±»ä¹‹é—´çš„è·³è½¬ï¼\n\n![](statistic/image-20201107150307314.png)\n\n### å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°\n\nå…ˆæŠŠé¡¹ç›®å…‹éš†åˆ°æœ¬åœ°ï¼Œç„¶åä½¿ç”¨è‡ªå·±å–œæ¬¢çš„ IDE æ¥é˜…è¯»ã€‚å¯ä»¥è¯´æ˜¯æœ€é…¸çˆ½çš„æ–¹å¼äº†ï¼\n\nå¦‚æœä½ æƒ³è¦æ·±å…¥äº†è§£æŸä¸ªé¡¹ç›®çš„è¯ï¼Œé¦–é€‰è¿™ç§æ–¹å¼ã€‚ä¸€ä¸ª `git clone` å°±å®Œäº‹äº†ã€‚\n\n## æ‰©å±• Github çš„åŠŸèƒ½\n\n**Enhanced GitHub** å¯ä»¥è®©ä½ çš„ Github æ›´å¥½ç”¨ã€‚è¿™ä¸ª Chrome æ’ä»¶å¯ä»¥å¯è§†åŒ–ä½ çš„ Github ä»“åº“å¤§å°ï¼Œæ¯ä¸ªæ–‡ä»¶çš„å¤§å°å¹¶ä¸”å¯ä»¥è®©ä½ å¿«é€Ÿä¸‹è½½å•ä¸ªæ–‡ä»¶ã€‚\n\n![](statistic/image-20201107160817672.png)\n\n## è‡ªåŠ¨ä¸º Markdown æ–‡ä»¶ç”Ÿæˆç›®å½•\n\nå¦‚æœä½ æƒ³ä¸º Github ä¸Šçš„ Markdown æ–‡ä»¶ç”Ÿæˆç›®å½•çš„è¯ï¼Œé€šè¿‡ VS Code çš„ **Markdown Preview Enhanced** è¿™ä¸ªæ’ä»¶å°±å¯ä»¥äº†ã€‚\n\nç”Ÿæˆçš„ç›®å½•æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä½ ç›´æ¥ç‚¹å‡»ç›®å½•ä¸­çš„é“¾æ¥å³å¯è·³è½¬åˆ°æ–‡ç« å¯¹åº”çš„ä½ç½®ï¼Œå¯ä»¥ä¼˜åŒ–é˜…è¯»ä½“éªŒã€‚\n\n![](\u003chttps://oss.javaguide.cn/2020-11/iShot2020-11-07%2016.14.14%20(1).png\u003e)\n\nä¸è¿‡ï¼Œç›®å‰ Github å·²ç»è‡ªåŠ¨ä¸º Markdown æ–‡ä»¶ç”Ÿæˆäº†ç›®å½•ï¼Œåªæ˜¯éœ€è¦é€šè¿‡ç‚¹å‡»çš„æ–¹å¼æ‰èƒ½æ˜¾ç¤ºå‡ºæ¥ã€‚\n\n![](statistic/image-20211227093215005.png)\n\n## å–„ç”¨ Github Explore\n\nå…¶å®ï¼ŒGithub è‡ªå¸¦çš„ Explore æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§ä¸”å¥½ç”¨çš„åŠŸèƒ½ã€‚ä¸è¿‡ï¼Œæ®æˆ‘è§‚å¯Ÿï¼Œå›½å†…å¾ˆå¤š Github ç”¨æˆ·éƒ½ä¸çŸ¥é“è¿™ä¸ªåˆ°åº•æ˜¯å¹²å•¥çš„ã€‚\n\nç®€å•æ¥è¯´ï¼ŒGithub Explore å¯ä»¥ä¸ºä½ å¸¦æ¥ä¸‹é¢è¿™äº›æœåŠ¡ï¼š\n\n1. å¯ä»¥æ ¹æ®ä½ çš„ä¸ªäººå…´è¶£ä¸ºä½ æ¨èé¡¹ç›®ï¼›\n2. Githunb Topics æŒ‰ç…§ç±»åˆ«/è¯é¢˜å°†ä¸€äº›é¡¹ç›®è¿›è¡Œäº†åˆ†ç±»æ±‡æ€»ã€‚æ¯”å¦‚ [Data visualization](https://github.com/topics/data-visualization) æ±‡æ€»äº†æ•°æ®å¯è§†åŒ–ç›¸å…³çš„ä¸€äº›å¼€æºé¡¹ç›®ï¼Œ[Awesome Lists](https://github.com/topics/awesome) æ±‡æ€»äº† Awesome ç³»åˆ—çš„ä»“åº“ï¼›\n3. é€šè¿‡ Github Trending æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ€è¿‘æ¯”è¾ƒçƒ­é—¨çš„ä¸€äº›å¼€æºé¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§è¯­è¨€ç±»å‹ä»¥åŠæ—¶é—´ç»´åº¦å¯¹é¡¹ç›®è¿›è¡Œç­›é€‰ï¼›\n4. Github Collections ç±»ä¼¼ä¸€ä¸ªæ”¶è—å¤¹é›†åˆã€‚æ¯”å¦‚ [Teaching materials for computational social science](https://github.com/collections/teaching-computational-social-science) è¿™ä¸ªæ”¶è—å¤¹å°±æ±‡æ€»äº†è®¡ç®—æœºè¯¾ç¨‹ç›¸å…³çš„å¼€æºèµ„æºï¼Œ[Learn to Code](https://github.com/collections/learn-to-code) è¿™ä¸ªæ”¶è—å¤¹å°±æ±‡æ€»äº†å¯¹ä½ å­¦ä¹ ç¼–ç¨‹æœ‰å¸®åŠ©çš„ä¸€äº›ä»“åº“ï¼›\n5. ......\n\n![](statistic/github-explore.png)\n\n## GitHub Actions å¾ˆå¼ºå¤§\n\nä½ å¯ä»¥ç®€å•åœ°å°† GitHub Actions ç†è§£ä¸º Github è‡ªå¸¦çš„ CI/CD ï¼Œé€šè¿‡ GitHub Actions ä½ å¯ä»¥ç›´æ¥åœ¨ GitHub æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ä»£ç ï¼Œä½ è¿˜å¯ä»¥å¯¹ä»£ç è¿›è¡Œå®¡æŸ¥ã€ç®¡ç† APIã€åˆ†æé¡¹ç›®ä¾èµ–é¡¹ã€‚æ€»ä¹‹ï¼ŒGitHub Actions å¯ä»¥è‡ªåŠ¨åŒ–åœ°å¸®ä½ å®Œæˆå¾ˆå¤šäº‹æƒ…ã€‚\n\nå…³äº GitHub Actions çš„è¯¦ç»†ä»‹ç»ï¼Œæ¨èçœ‹ä¸€ä¸‹é˜®ä¸€å³°è€å¸ˆå†™çš„ [GitHub Actions å…¥é—¨æ•™ç¨‹](https://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html) ã€‚\n\nGitHub Actions æœ‰ä¸€ä¸ªå®˜æ–¹å¸‚åœºï¼Œä¸Šé¢æœ‰éå¸¸å¤šåˆ«äººæäº¤çš„ Actions ï¼Œä½ å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨ã€‚\n\n![](statistic/image-20211227100147433.png)\n\n## åè®°\n\nè¿™ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘æ¯«æ— ä¿ç•™åœ°æŠŠè‡ªå·±è¿™äº›å¹´æ€»ç»“çš„ Github å°æŠ€å·§åˆ†äº«äº†å‡ºæ¥ï¼ŒçœŸå¿ƒå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ï¼ŒçœŸå¿ƒå¸Œæœ›å¤§å®¶ä¸€å®šè¦åˆ©ç”¨å¥½ Github è¿™ä¸ªä¸“å±ç¨‹åºå‘˜çš„å®è—ã€‚\n\nå¦å¤–ï¼Œè¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å¹¶æ²¡æœ‰æåˆ° Github æœç´¢æŠ€å·§ã€‚åœ¨æˆ‘çœ‹æ¥ï¼ŒGithub æœç´¢æŠ€å·§ä¸å¿…è¦è®°ç½‘ä¸Šé‚£äº›æ–‡ç« è¯´çš„å„ç§å‘½ä»¤å•¥çš„ï¼ŒçœŸæ²¡å•¥åµç”¨ã€‚ä½ ä¼šå‘ç°ä½ ç”¨çš„æœ€å¤šçš„è¿˜æ˜¯å…³é”®å­—æœç´¢ä»¥åŠ Github è‡ªå¸¦çš„ç­›é€‰åŠŸèƒ½ã€‚\n\n\n\n## å­¦ä¹ èµ„æ–™æ¨è\n\n**åœ¨çº¿æ¼”ç¤ºå­¦ä¹ å·¥å…·ï¼š**\n\nã€Œè¡¥å……ï¼Œæ¥è‡ª [issue729](https://github.com/Snailclimb/JavaGuide/issues/729) ã€Learn Git Branching \u003chttps://oschina.gitee.io/learn-git-branching/\u003e ã€‚è¯¥ç½‘ç«™å¯ä»¥æ–¹ä¾¿çš„æ¼”ç¤ºåŸºæœ¬çš„ git æ“ä½œï¼Œè®²è§£å¾—æ˜æ˜ç™½ç™½ã€‚æ¯ä¸€ä¸ªåŸºæœ¬å‘½ä»¤çš„ä½œç”¨å’Œç»“æœã€‚\n\n**æ¨èé˜…è¯»ï¼š**\n\n- [Git å…¥é—¨å›¾æ–‡æ•™ç¨‹(1.5W å­— 40 å›¾)](https://www.cnblogs.com/anding/p/16987769.html)ï¼šè¶…ç”¨å¿ƒçš„ä¸€ç¯‡æ–‡ç« ï¼Œå†…å®¹å…¨é¢ä¸”é™„å¸¦è¯¦ç»†çš„å›¾è§£ï¼Œå¼ºçƒˆæ¨èï¼\n- [Git - ç®€æ˜æŒ‡å—](https://rogerdudler.github.io/git-guide/index.zh.html)ï¼šæ¶µç›– Git å¸¸è§æ“ä½œï¼Œéå¸¸æ¸…æ™°ã€‚\n- [å›¾è§£ Git](https://marklodato.github.io/visual-git-guide/index-zh-cn.html)ï¼šå›¾è§£ Git ä¸­çš„æœ€å¸¸ç”¨å‘½ä»¤ã€‚å¦‚æœä½ ç¨å¾®ç†è§£ git çš„å·¥ä½œåŸç†ï¼Œè¿™ç¯‡æ–‡ç« èƒ½å¤Ÿè®©ä½ ç†è§£çš„æ›´é€å½»ã€‚\n- [çŒ´å­éƒ½èƒ½æ‡‚å¾— Git å…¥é—¨](https://backlog.com/git-tutorial/cn/intro/intro1_1.html)ï¼šæœ‰è¶£çš„è®²è§£ã€‚\n- [Pro Git book](https://git-scm.com/book/zh/v2)ï¼šå›½å¤–çš„ä¸€æœ¬ Git ä¹¦ç±ï¼Œè¢«ç¿»è¯‘æˆå¤šå›½è¯­è¨€ï¼Œè´¨é‡å¾ˆé«˜ã€‚","lastmodified":"2023-08-07T15:43:18.70778422Z","tags":[]},"/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E5%9C%BA%E6%99%AF%E9%A2%98/%E5%A6%82%E4%BD%95":{"title":"å¦‚ä½•","content":"\n![](statistic/Pasted%20image%2020230802012455.png)","lastmodified":"2023-08-07T15:43:18.715784374Z","tags":[]},"/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E5%9C%BA%E6%99%AF%E9%A2%98/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E6%8E%92%E8%A1%8C%E6%A6%9C":{"title":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ’è¡Œæ¦œï¼Ÿ","content":"![](statistic/Pasted%20image%2020230802012459.png)","lastmodified":"2023-08-07T15:43:18.715784374Z","tags":[]},"/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/PPT-%E6%95%99%E6%9D%90":{"title":"PPT  æ•™æ","content":"\n\n\n![](statistic/ç¼–è¯‘åŸç†.pdf)\n\n\n\n\n![](statistic/ç¼–è¯‘åŸç†â€”å§œå®ˆæ—­@å“ˆå·¥å¤§.pdf)","lastmodified":"2023-08-07T15:43:18.715784374Z","tags":[]},"/%E8%B5%84%E6%BA%90/%E8%B5%84%E6%BA%90%E6%B1%87%E6%80%BB":{"title":"èµ„æºæ±‡æ€»","content":"","lastmodified":"2023-08-07T15:43:18.723784527Z","tags":[]},"/Java/%E9%87%8D%E8%A6%81%E7%9F%A5%E8%AF%86%E7%82%B9/SPI":{"title":"SPI","content":"","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/Obsidian/%E4%BD%BF%E7%94%A8quartz%E5%8F%91%E5%B8%83obsidian-vault":{"title":"ä½¿ç”¨quartzå‘å¸ƒobsidian  vault","content":"","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/Obsidian/Front-Matter":{"title":"Front Matter","content":"\n\nä½¿ç”¨ Front Matter å¯ä»¥ä¿å­˜ note å¾…å…ƒæ•°æ®ï¼Œæ¨èä½¿ç”¨ Hugo çš„é…ç½® [Front matter | Hugo (gohugo.io)](https://gohugo.io/content-management/front-matter/)\n\n","lastmodified":"2023-08-07T15:43:15.151715665Z","tags":["Obsidian"]},"/Obsidian/Obsidian-plugin":{"title":"Obsidian-plugin","content":"\n* [advanced-table](https://github.com/tgrosinger/advanced-tables-obsidian)\n* [banners](https://github.com/noatpad/obsidian-banners)\n* [calendar](https://github.com/liamcain/obsidian-calendar-plugin)\n* [commander](https://github.com/phibr0/obsidian-commander)\n* [dataview](https://github.com/blacksmithgu/obsidian-dataview)\n* [emoji-shortcodes](https://github.com/phibr0/obsidian-emoji-shortcodes)\n* [emoji-toolbar](https://github.com/oliveryh/obsidian-emoji-toolbar)\n* [excel-to-markdown-table](https://github.com/ganesshkumar/obsidian-excel-to-markdown-table)\n* [homepage](https://github.com/mirnovov/obsidian-homepage)\n* [hover-editor](https://github.com/nothingislost/obsidian-hover-editor)\n* [icon-folder)](https://github.com/FlorianWoelki/obsidian-icon-folder)\n* [icons](https://github.com/visini/obsidian-icons-plugin)\n* [image-toolkit](https://github.com/sissilab/obsidian-image-toolkit)\n* [minimal-settings](https://github.com/kepano/obsidian-minimal-settings)\n* [obsidian-git](https://github.com/denolehov/obsidian-git)\n* [recent-files](https://github.com/tgrosinger/recent-files-obsidian)\n* [settings-search](https://github.com/javalent/settings-search)\n* [style-settings](https://github.com/mgmeyers/obsidian-style-settings)\n* [tag-wrangler](https://github.com/pjeby/tag-wrangler)\n* [excalidraw](https://github.com/zsviczian/obsidian-excalidraw-plugin)","lastmodified":"2023-08-07T15:43:15.151715665Z","tags":["Obsidian"]},"/Obsidian/dataview":{"title":"dataview","content":"\n\n# å®˜æ–¹åœ°å€\n\n* [ä»£ç ä»“åº“](https://github.com/blacksmithgu/obsidian-dataview)\n* [æ–‡æ¡£åœ°å€](https://blacksmithgu.github.io/obsidian-dataview/)\n\n# å…¶ä»–æ•™ç¨‹\n*  [Obsidian DataView å…¥é—¨ä¿å§†çº§å¼•å¯¼æ‰‹å†Œ](https://zhuanlan.zhihu.com/p/614881764)\n\n# å…ƒæ•°æ®\n\nå…ƒæ•°æ®æ˜¯ä¸€ç³»åˆ—çš„é”®å€¼å¯¹,å¯ä»¥ç»™ç¬”è®°ï¼Œå¯ä»¥ç»™note,list item ,task æ·»åŠ å…ƒæ•°æ®\n\n## å¦‚ä½•æ·»åŠ å…ƒæ•°æ®\n\n### Frontmatter\n\n* frontmatter æ˜¯markdownçš„ä¸€ç§æ‰©å±•ï¼Œå¯ä»¥ä½¿ç”¨yaml æ¥æ·»åŠ å…ƒæ•°æ®\n\n```\n --- \n alias: \"document\" \n last-reviewed: 2021-08-17 \n thoughts: \n\t rating: 8 \n\t reviewable: false \n ---\n```\n\n###  inline fields\n* ä½¿ç”¨æ–¹æ³•ä¸ºåœ¨æ–‡ä»¶çš„ä»»æ„ä½ç½®æ·»åŠ \n```text\n\nBasic Field:: Some random Value \n**Bold Field**:: Nice!\n  \n```\n\n* å¦‚æœä½ éœ€è¦æ ‡æ³¨list itme æˆ–è€… task éœ€è¦ä½¿ç”¨ä¸­æ‹¬å·\n```\n- [ ] Send an mail to David about the deadline [due:: 2022-04-05].\n```\n\n\n# å¦å¤–è¿˜æœ‰éšå«çš„å…ƒæ•°æ®\n\n## page ä¸­çš„å…ƒæ•°æ®\n\n\n[# Metadata on Pages](https://blacksmithgu.github.io/obsidian-dataview/annotation/metadata-pages/)\n\n\n| Field Name       | Data Type      | Description                                                                                                                                                                   |\n|------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| file.name        | Text           | The file name as seen in Obsidians sidebar.                                                                                                                                   |\n| file.folder      | Text           | The path of the folder this file belongs to.                                                                                                                                  |\n| file.path        | Text           | The full file path, including the files name.                                                                                                                                 |\n| file.ext         | Text           | The extension of the file type; generally md.                                                                                                                                 |\n| file.link        | Link           | A link to the file.                                                                                                                                                           |\n| file.size        | Number         | The size (in bytes) of the file.                                                                                                                                              |\n| file.ctime       | Date with Time | The date that the file was created.                                                                                                                                           |\n| file.cday        | Date           | The date that the file was created.                                                                                                                                           |\n| file.mtime       | Date with Time | The date that the file was last modified.                                                                                                                                     |\n| file.mday        | Date           | The date that the file was last modified.                                                                                                                                     |\n| file.tags        | List           | A list of all unique tags in the note. Subtags are broken down by each level, so #Tag/1/A will be stored in the list as [#Tag, #Tag/1, #Tag/1/A].                             |\n| file.etags       | List           | A list of all explicit tags in the note; unlike file.tags, does not break subtags down, i.e. [#Tag/1/A]                                                                       |\n| file.inlinks     | List           | A list of all incoming links to this file, meaning all files that contain a link to this file.                                                                                |\n| file.outlinks    | List           | A list of all outgoing links from this file, meaning all links the file contains.                                                                                             |\n| file.aliases     | List           | A list of all aliases for the note as defined via the YAML frontmatter.                                                                                                       |\n| file.tasks       | List           | A list of all tasks (I.e., \\| [ ] some task) in this file.                                                                                                                    |\n| file.lists       | List           | A list of all list elements in the file (including tasks); these elements are effectively tasks and can be rendered in task views.                                            |\n| file.frontmatter | List           | Contains the raw values of all frontmatter in form of key \\| value text values; mainly useful for checking raw frontmatter values or for dynamically listing frontmatter keys. |\n| file.day         | Date           | Only available if the file has a date inside its file name (of form yyyy-mm-dd or yyyymmdd), or has a Date field/inline field.                                                |\n| file.starred     | Boolean        | if this file has been starred via the Obsidian Core Plugin \"Starred Files\".                                                                                                   |\n\n\n## åˆ—è¡¨å’Œä»»åŠ¡ä¸­çš„å…ƒæ•°æ®\n\n[# Metadata on Tasks and Lists](https://blacksmithgu.github.io/obsidian-dataview/annotation/metadata-tasks/)\n\n| Field name     | Data Type | Description                                                                                                                                                                                                                                                                                               |\n|----------------|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| status         | Text      | The completion status of this task, as determined by the character inside the [ ] brackets. Generally a space \" \" for incomplete tasks and a \"x\" for complete tasks, but allows for plugins which support alternative task statuses.                                                                      |\n| checked        | Boolean   | Whether or not this task status is empty, meaning it has a space in its [ ] brackets                                                                                                                                                                                                                      |\n| completed      | Boolean   | Whether or not this specific task has been completed; this does not consider the completionnon-completion of any child tasks. A task is explicitly considered \"completed\" if it has been marked with an 'x'. If you use a custom status, i.e. [-], checked will be true, whereas completed will be false. |\n| fullyCompleted | Boolean   | Whether or not this task and all of its subtasks are completed.                                                                                                                                                                                                                                           |\n| text           | Text      | The plain text of this task, including any metadata field annotations.                                                                                                                                                                                                                                    |\n| visual         | Text      | The text of this task, which is rendered by Dataview. It can be modified to render arbitary text.                                                                                                                                                                                                         |\n| line           | Number    | The line of the file this task shows up on.                                                                                                                                                                                                                                                               |\n| lineCount      | Number    | The number of Markdown lines that this task takes up.                                                                                                                                                                                                                                                     |\n| path           | Text      | The full path of the file this task is in. Equals to file.path for pages                                                                                                                                                                                                                                  |\n| section        | Link      | link to the section this task is contained in.                                                                                                                                                                                                                                                            |\n| tags           | List      | Any tags inside of the text task.                                                                                                                                                                                                                                                                         |\n| outlinks       | List      | Any links defined in this task.                                                                                                                                                                                                                                                                           |\n| link           | Link      | link to the closest linkable block near this task; useful for making links which go to the task.                                                                                                                                                                                                          |\n| children       | List      | ny subtasks or sublists of this task.                                                                                                                                                                                                                                                                     |\n| task           | Boolean   | If true, this is a task; otherwise, it is a regular list element.                                                                                                                                                                                                                                         |\n| annotated      | Boolean   | True if the task text contains any metadata fields, false otherwise.                                                                                                                                                                                                                                      |\n| parent         | Number    | The line number of the task above this task, if present; will be null if this is a root-level task.                                                                                                                                                                                                       |\n| blockId        | Text      | The block ID of this task / list element, if one has been defined with the ^blockId syntax; otherwise null.                                                                                                                                                                                               |\n\n\n# DQL\n\næ¯”è¾ƒç±»ä¼¼äºsql, å¯æ˜¯å®ç°ä»¥ä¸‹çš„åŠŸèƒ½\n\n- Choosing anÂ **output format**Â of your output (theÂ [Query Type](https://blacksmithgu.github.io/obsidian-dataview/queries/query-types/))\n- Fetch pagesÂ **from a certainÂ [source](https://blacksmithgu.github.io/obsidian-dataview/reference/sources/)**, i.e. a tag, folder or link\n- **Filtering pages/data**Â by simple operations on fields, like comparison, existence checks, and so on\n- **Transforming fields**Â for displaying, i.e. with calculations or splitting up multi-value fields\n- **Sorting**Â results based on fields\n- **Grouping**Â results based on fields\n- **Limiting**Â your result count\n\n## æŸ¥è¯¢è¯­æ³•\n\n```text\n```dataview \n\t\u003cQUERY-TYPE\u003e \u003cfields\u003e \n\tFROM \u003csource\u003e \n\t\u003cDATA-COMMAND\u003e \u003cexpression\u003e \n\t\u003cDATA-COMMAND\u003e \u003cexpression\u003e \n\t...\n```\n```\t\n```\n\n\n## è¾“å‡ºç±»å‹\n\n* **TABLE**: A table of results with one row per result and one or many columns of **field data**.\n* **LIST**: A bullet point list of **pages** which match the query. You can output one field for each page alongside their file links.\n* **TASK**: An interactive task list of **tasks** that match the given query.\n* **CALENDAR**: A calendar view displaying each hit via a dot on its referred date.\n\n\n```text\nLists all pages in your vault as a bullet point list\n\t```dataview \n\tLIST \n\t```\n\t\nLists all tasks (completed or not) in your vault \n\t```dataview \n\tTASK \n\t```\n\t\nRenders a Calendar view where each page is represented as a dot on its creation date. \n\t```dataview \n\tCALENDAR file.cday \n\t```\n\t\nShows a table with all pages of your vault, their field value of due, the files' tags and an average of the values of multi-value field working-hours \n\t```dataview \n\tTABLE due, file.tags AS \"tags\", average(working-hours)\n\t ```\n\n```\n\n\n## æ•°æ®æ¥æº\n\n* tags\n* folders\n* note\n* lint\n\n```\nLists all pages inside the folder Books and its sub folders \n\t```dataview \n\tLIST FROM \"Books\" \n\t``` \n\t\nLists all pages that include the tag #status/open or #status/wip \n\t```dataview \n\tLIST FROM #status/open OR #status/wip \n\t``` \n\t\nLists all pages that have either the tag #assignment and are inside folder \"30 School\" (or its sub folders), or are inside folder \"30 School/32 Homeworks\" and are linked on the page School Dashboard Current To Dos \n\n\t```dataview \n\tLIST FROM (#assignment AND \"30 School\") OR (\"30 School/32 Homeworks\" AND outgoing([[School Dashboard Current To Dos]])) \n\t```\n\n```\n\n\n## Filter, sort, group or limit results\n\n* ***FROM**Â like explainedÂ [above](https://blacksmithgu.github.io/obsidian-dataview/queries/structure/#choose-your-source).\n*  **WHERE**: Filter notes based on informationÂ **inside**Â notes, the meta data fields.\n*  **SORT**: Sorts your results depending on a field and a direction.\n*  **GROUP BY**: Bundles up several results into one result row per group.\n*  **LIMIT**: Limits the result count of your query to the given number.\n*  **FLATTEN**: Splits up one result into multiple results based on a field or calculation.\n\n\n```\nLists all pages that have a metadata field `due` and where `due` is before today \n\n\t```dataview \n\tLIST WHERE due AND due \u003c date(today) \n\t``` \nLists the 10 most recently created pages in your vault that have the tag #status/open \n\t```dataview \n\tLIST FROM #status/open SORT file.ctime DESC LIMIT 10 \n\t``` \nLists the 10 oldest and incompleted tasks of your vault as an interactive task list, grouped by their containing file and sorted from oldest to newest file. \n\t```dataview \n\tTASK WHERE !completed SORT created ASC LIMIT 10 GROUP BY file.link SORT rows.file.ctime ASC \n\t```\n\n\n```","lastmodified":"2023-08-07T15:43:15.151715665Z","tags":["Obsidian"]},"/Obsidian/excalidraw":{"title":"excalidraw","content":"\n*  [ä»£ç ä»“åº“](https://github.com/zsviczian/obsidian-excalidraw-plugin)\n* note ä¸­æ’å…¥excalidraw è¯­æ³•\n\n```\n![[excalidraw]]\n```","lastmodified":"2023-08-07T15:43:15.151715665Z","tags":["Obsidian"]},"/Obsidian/obsidian-overview":{"title":"obsidian overview","content":"\n# ä¸»é¡µå†…å®¹\n\nobsidian ç›¸å…³å†…å®¹ï¼ŒåŒ…æ‹¬æ’ä»¶\n\n\n# ç»“æ„\n\n","lastmodified":"2023-08-07T15:43:15.151715665Z","tags":["Obsidian"]},"/Obsidian/publish":{"title":"publish","content":"\n\n\n[obsidian ç›®å‰æœ€å®Œç¾çš„å…è´¹å‘å¸ƒæ–¹æ¡ˆ æ¸è¿›å¼æ•™ç¨‹ by oldwinter](https://publish.obsidian.md/chinesehelp/01+2021%E6%96%B0%E6%95%99%E7%A8%8B/obsidian+%E7%9B%AE%E5%89%8D%E6%9C%80%E5%AE%8C%E7%BE%8E%E7%9A%84%E5%85%8D%E8%B4%B9%E5%8F%91%E5%B8%83%E6%96%B9%E6%A1%88+%E6%B8%90%E8%BF%9B%E5%BC%8F%E6%95%99%E7%A8%8B+by+oldwinter#%E5%87%A0%E4%B8%AA%E5%8F%91%E5%B8%83%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94)","lastmodified":"2023-08-07T15:43:15.151715665Z","tags":["Obsidian"]},"/Obsidian/template":{"title":"template","content":"\n* *[æ¨¡æ¿çš„ä½¿ç”¨æ–¹æ³•](https://publish.obsidian.md/help-zh/%E6%8F%92%E4%BB%B6/%E6%A8%A1%E6%9D%BF)\n* é»˜è®¤å­˜æ”¾çš„æ–‡ä»¶å¤¹ `/template`\n\n","lastmodified":"2023-08-07T15:43:15.151715665Z","tags":["Obsidian"]},"/awesome/JavaGuide-%E7%9F%A5%E8%AF%86%E6%98%9F%E7%90%83%E4%BC%98%E8%B4%A8%E4%B8%BB%E9%A2%98%E6%B1%87%E6%80%BB":{"title":"JavaGuide çŸ¥è¯†æ˜Ÿçƒä¼˜è´¨ä¸»é¢˜æ±‡æ€»","content":"ä¸ºäº†é¿å…è¿™é‡Œæˆä¸ºçŸ¥è¯†æ‚è´§é“ºï¼Œæˆ‘ä¼šå¯¹ä¸¥æ ¼ç­›é€‰å…¥é€‰çš„ä¼˜è´¨ä¸»é¢˜ã€‚  \n  \næ›´æ–°æ—¥æœŸï¼š2023-06-11  \n  \n\né¢è¯•  \n  \nâ—[Javaé¢è¯•å¸¸è§é—®é¢˜æ€»ç»“ï¼ˆ2023æœ€æ–°ç‰ˆï¼‰](https://t.zsxq.com/0eRq7EJPy)  \nâ—[ä¸€ä½ HR åˆ†äº«çš„æ±‚èŒå»ºè®®](https://t.zsxq.com/0dSKX0jkK)  \nâ—[é¢è¯•å’Œç®€å†ä¸Šçš„ä¸€äº›å¤§å¿Œ](https://t.zsxq.com/0eOgYt3qU)  \nâ—é¡¹ç›®ï¼š  \nâ—‹[å¦‚ä½•å›ç­”é¡¹ç›®é‡åˆ°ä»€ä¹ˆå›°éš¾ï¼Œå¦‚ä½•è§£å†³è¿™ç±»é—®é¢˜](https://t.zsxq.com/0dduy9CeQ)  \nâ—‹[é¡¹ç›®å¤ªç®€å•æ€ä¹ˆåŠ?](https://t.zsxq.com/0eV4BksDb)  \nâ—‹[å•†åŸé¡¹ç›®åˆ°åº•èƒ½ä¸èƒ½åšï¼Ÿ](https://t.zsxq.com/0eBcCNhbB)  \n  \n\nå®‰æŠšå¿ƒæ€  \n  \nå¦‚æœä½ é™·å…¥ç²¾ç¥å†…è€—æˆ–è€…è‡ªæˆ‘æ€€ç–‘ï¼Œä¸ç„¶çœ‹çœ‹ä¸‹é¢è¿™äº›å†…å®¹ï¼š  \n  \nâ—[ç¼–ç¨‹æ‰¾å·¥ä½œç°çŠ¶ - å“”å“©å“”å“©](https://t.zsxq.com/0edKnfcZW)  \n  \n\næŠ€æœ¯èµ„æº  \n  \nå­¦ä¹ è·¯çº¿ï¼š[Java ç³»ç»Ÿå­¦ä¹ è·¯çº¿](https://t.zsxq.com/0dupYAEaq)  \n  \næ€»ç»“ ï¼š  \n  \nâ—[Java åç«¯å¼€å‘å¸¸ç”¨çš„æŠ€æœ¯ä¹¦ç±+åŸåˆ›é¢è¯•èµ„æ–™ PDF ç‰ˆæœ¬](https://t.zsxq.com/0bWeUrBVq)  \nâ—[JavaGuide ç½‘ç«™æ€»ç»“çš„å…«è‚¡æ–‡åˆé›† Â - å¿µç¥](https://t.zsxq.com/0biGG9UlX)  \nâ—[Java åç«¯å¸¸è§çŸ¥è¯†ç‚¹æ€ç»´å¯¼å›¾åˆ†äº« - å´ä¸å·](https://t.zsxq.com/0bHk3wEDs)  \n  \nå¸¸ç”¨æŠ€æœ¯ï¼š  \n  \nâ—[SpringBoot å­¦ä¹ èµ„æºæ¨è](https://t.zsxq.com/0eEGBV1Md)  \nâ—[å•æµ‹æŠ€æœ¯é€‰å‹+å­¦ä¹ èµ„æºæ¨è](https://t.zsxq.com/0d7jOz9Vm)  \nâ—[Redis å­¦ä¹ èµ„æºæ¨è](https://t.zsxq.com/0dwd4ONZ9)  \nâ—[Elasticsearch å­¦ä¹ èµ„æºæ¨è](https://t.zsxq.com/0dEWEThKR)  \nâ—[Kafkaã€RocketMQã€RabbitMQ å­¦ä¹ èµ„æºæ¨è](https://t.zsxq.com/0bEDFwgon)  \nâ—[åˆ†å¸ƒå¼å­¦ä¹ èµ„æºæ¨èï¼ˆåç†è®ºæ–¹å‘ï¼‰](https://t.zsxq.com/0euwZ8uiP)  \nâ—[Git å­¦ä¹ èµ„æºæ¨è](https://t.zsxq.com/0bTheL01q)  \nâ—[ã€Šé˜¿é‡Œå¼€å‘è€…æ‰‹å†Œ - Redis ä¸“é¢˜ã€‹PDF æ–‡æ¡£](https://t.zsxq.com/0bEiLJIVW)  \n  \n\nä»£ç è´¨é‡  \n  \nâ—[24 ä¸ªå†™å‡ºæ¼‚äº®ä»£ç çš„å°æŠ€å·§](https://t.zsxq.com/0foGrZIc7)  \nâ—[ç¨‹åºå‘˜â€œèµ·åâ€å¤´ç—›æ ¹æ²»æŒ‡å—](https://t.zsxq.com/0d8ODCefj)  \nâ—[5å¤©å¸¦ä½ è¯»å®Œã€ŠEffective Javaã€‹](https://t.zsxq.com/0dIkpk8AV)  \nâ—[æé«˜ä»£ç è´¨é‡çš„ä¹¦ç±å’Œæ–‡ç« æ¨è](https://t.zsxq.com/0dWEHSiBW)  \nâ—[ä¸€ä¸ªç»ƒä¹ é‡æ„çš„å¼€æºæ•™ç¨‹](https://t.zsxq.com/0d221QNao)  \nâ—[åˆ†äº«3æœ¬å¯¹äºæé«˜ä»£ç è´¨é‡æœ‰å®é™…å¸®åŠ©çš„ä¹¦ç±](https://t.zsxq.com/0dFLaE2Lp)ï¼ˆã€Šç¼–å†™å¯è¯»ä»£ç çš„è‰ºæœ¯ã€‹ã€ã€ŠClean Codeã€‹ã€ã€ŠThe Clean Coderã€‹ï¼‰  \n  \n\nè¿›é˜¶æ”»ç•¥  \n  \nâ—[å¦‚ä½•æ’°å†™ä¸€ä»½ä»¤äººèµå¹çš„è½¯ä»¶ä¸“åˆ©æŠ€æœ¯äº¤åº•ä¹¦ï¼Ÿ](https://articles.zsxq.com/id_2kdw0o0ovc44.html)  \nâ—[æ ¡æ‹›ç”Ÿå¦‚ä½•å‚ä¸å¼€æºé¡¹ç›®ï¼Ÿå¦‚ä½•è·å¾—å¼€æºç»å†ï¼Ÿ](https://articles.zsxq.com/id_q0g14e71eqc3.html)  \nâ—[ä¸€äº›è¯»ä¹¦å¿ƒå¾—å’Œçœ‹ä¹¦åšç¬”è®°çš„ç»éªŒ](https://t.zsxq.com/0cpx9pkIE)  \nâ—[ä¸€ä¸ªå…³äºæå‡å­¦ä¹ èƒ½åŠ›å’Œæ•ˆç‡çš„è§†é¢‘](https://t.zsxq.com/0c2OboF1Q)ï¼ˆæ”¶ç›ŠåŒªæµ…ï¼‰  \nâ—[å¦‚ä½•æœ‰æ•ˆæå‡ä¸“æ³¨åŠ›ï¼Ÿ](https://t.zsxq.com/0eIuSBARU)  \nâ—[å¿«é€Ÿç†Ÿæ‚‰ä¸šåŠ¡é€»è¾‘å¹¶ä»˜è¯¸è½åœ°çš„å»ºè®® - å¿µç¥](https://t.zsxq.com/0cGu9HjPQ)  \nâ—[ç»™åˆçº§ Java å·¥ç¨‹å¸ˆçš„ä¸€äº›å­¦ä¹ å»ºè®® - å¿µç¥](https://t.zsxq.com/0ckNvT31a)  \nâ—[é¡¹ç›®æŠ€æœ¯é€‰å‹çš„å»ºè®®](https://t.zsxq.com/0ciPGdBoZ)ï¼ˆå¬äº†ä¸€ä¸ªæŠ€æœ¯é€‰å‹åˆ†äº«ä¹‹åçš„ä¸€äº›å¿ƒå¾—ä½“ä¼šï¼‰  \nâ—[ä½¿ç”¨ Google æœç´¢çš„å®ç”¨å»ºè®®](https://t.zsxq.com/0c0K3zPRk)  \nâ—[ä¸è¦æŠŠè‡ªå·±å±€é™åœ¨æŠ€æœ¯ä¸Š!](https://t.zsxq.com/0cdHCFWNw) ï¼ˆé‡è§†æŠ€æœ¯èƒ½åŠ›ï¼Œä½†ä½ çš„ä¸–ç•Œä¸èƒ½ä»…ä»…åªæœ‰æŠ€æœ¯ï¼‰  \nâ—[ç»™ä¸€äº›æƒ³è¦æ¢èŒä¸šæ–¹å‘çš„æœ‹å‹ä¸€äº›å®¢è§‚çš„å»ºè®®](https://t.zsxq.com/0crTLD2hY)  \nâ—[å¦‚ä½•åšç¼–ç¨‹çŸ¥è¯†æŠ•èµ„åŠå‡å°‘çŸ¥è¯†å¤±æ•ˆçš„å½±å“](https://t.zsxq.com/0ccagnzao) ï¼ˆæ„Ÿè§¦å¾ˆæ·±çš„ä¸€ç¯‡æ–‡ç« ï¼Œå¼ºçƒˆæ¨èé˜…è¯»ï¼‰  \nâ—[ç¢ç‰‡åŒ–çŸ¥è¯†å¯èƒ½ä¼šå¸¦æ¥çš„åå¤„](https://t.zsxq.com/0cdfq7iR4)ï¼ˆç¢ç‰‡åŒ–çŸ¥è¯†æ³›æ»¥çš„æ—¶ä»£ï¼Œåº”è¯¥æ³¨æ„å…¶å¯¹è‡ªèº«çš„å½±å“ï¼‰  \n  \n\nå¼€æºé¡¹ç›®  \n  \nâ—[ä¸€ä¸ªç®€æ˜“ç‰ˆçš„IoCçš„è½®å­ï¼ˆçƒå‹è‡ªåˆ¶ï¼Œé™„ç¬”è®°ï¼‰](https://t.zsxq.com/0eCVtaUND)  \nâ—[Java è¯­è¨€æ‰‹å†™çš„ä¸€æ¬¾ç®€æ˜“ç‰ˆ Gitï¼ˆçƒå‹è‡ªåˆ¶ï¼‰](https://t.zsxq.com/0ekLd7XaX)  \nâ—[åŸºäº SpringBoot çš„å›½å¯†å‰åç«¯åˆ†ç¦»å¿«é€Ÿå¼€å‘å¹³å°](https://t.zsxq.com/0b3wlSfjS)  \nâ—[ã€Šé«˜å¹¶å‘çš„å“²å­¦åŸç†ã€‹å¼€æºå›¾ä¹¦](https://t.zsxq.com/0bmQXO4bf)  \nâ—[zyplayer-docï¼šé€‚åˆå›¢é˜Ÿå’Œä¸ªäººä½¿ç”¨çš„WIKIæ–‡æ¡£ç®¡ç†å·¥å…·ï¼ŒåŒæ—¶è¿˜åŒ…å«æ•°æ®åº“æ–‡æ¡£ã€Apiæ¥å£æ–‡æ¡£ã€‚](https://t.zsxq.com/0bcfjG15v)  \nâ—[ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹é˜…è¯»ç¬”è®°ï¼ŒåŸºäºç¬¬äºŒç‰ˆï¼ˆç›®å‰æœ€æ–°ç‰ˆæ˜¯ç¬¬ä¸‰ç‰ˆï¼‰](https://t.zsxq.com/0b1CDmh5H)  \nâ—[thinkï¼šä¸€æ¬¾å¼€æºçŸ¥è¯†ç®¡ç†å·¥å…·ï¼Œæ”¯æŒåˆ›å»ºçŸ¥è¯†åº“ã€å¤šäººåä½œã€åˆ†äº«çŸ¥è¯†åº“ã€ç»˜åˆ¶æ€ç»´å¯¼å›¾ã€æ·»åŠ é™„åŠ é™„ä»¶ç­‰åŠŸèƒ½](https://wx.zsxq.com/dweb2/index/group/48418884588288)  \nâ—[ip2regionï¼šé«˜æ€§èƒ½ç¦»çº¿IPåœ°å€å®šä½åº“ï¼Œ10å¾®ç§’çº§åˆ«çš„æŸ¥è¯¢æ•ˆç‡ï¼Œå¼€ç®±å³ç”¨ï¼Œæä¾›äº†å¤šç§ä¸»æµç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ Goï¼ŒJavaï¼ŒPythonï¼‰çš„ xdb æ•°æ®ç”Ÿæˆå’ŒæŸ¥è¯¢å®¢æˆ·ç«¯ APIã€‚](https://t.zsxq.com/0b6BYX1rp)  \nâ—[novelï¼šä¸€å¥—åŸºäºæ—¶ä¸‹æœ€æ–° Java æŠ€æœ¯æ ˆ Spring Boot 3 + Vue 3 å¼€å‘çš„å‰åç«¯åˆ†ç¦»å­¦ä¹ å‹å°è¯´é¡¹ç›®](https://t.zsxq.com/0b71m4luD)  \nâ—[lu-raft-kvï¼šåˆ†å¸ƒå¼ KV å­˜å‚¨è½®å­](https://t.zsxq.com/0baOCvT01)  \nâ—[MYDBï¼šç®€æ˜“ç‰ˆæ•°æ®åº“](https://t.zsxq.com/0b0d5pFHt)  \nâ—[mini-spring-cloudï¼šæ‰‹å†™çš„ç®€åŒ–ç‰ˆçš„ Spring Cloud](https://t.zsxq.com/0bai0TuJX)  \nâ—[SurveyKingï¼šå·ç§°åŠŸèƒ½æœ€å¼ºå¤§çš„è°ƒæŸ¥é—®å·ç³»ç»Ÿå’Œè€ƒè¯•ç³»ç»Ÿ](https://t.zsxq.com/0bJaH3GSP)  \nâ—[cs-self-learningï¼šè®¡ç®—æœºè‡ªå­¦æŒ‡å—](https://t.zsxq.com/0biDtoOF7)  \nâ—[upuporï¼šå°ä¼—ä½†æ˜¯åŠŸèƒ½å¼ºå¤§çš„å¼€æºç¤¾åŒº](https://t.zsxq.com/0bZrBeqMg)  \nâ—[Easy-Esï¼š Elasticsearch å·¥å…·åº“](https://t.zsxq.com/0bWdejp6D)  \n  \n\nå·¥å…·ç½‘ç«™  \n  \nâ—[ä¸¤ä¸ªå·¨å¥½ç”¨çš„ Linux å‘½ä»¤ç½‘ç«™](https://t.zsxq.com/0eKkOJPDA)  \nâ—[GitHub Web IDEï¼šç›´æ¥é€šè¿‡å¤šç§åœ¨çº¿ IDE æ‰“å¼€Githubé¡¹ç›®](https://t.zsxq.com/0eDXSZsBw)","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/elastic/KQL":{"title":"KQL","content":"\nKibana  Query Language\n\n\nhttps://juejin.cn/post/7003201901382598686\n\n\nhttps://www.elastic.co/guide/en/kibana/7.14/kuery-query.html#kuery-query\n\n\n","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/lua/%E7%94%A8Go%E5%AE%9E%E7%8E%B0Lua/%E5%89%8D%E8%A8%80":{"title":"å‰è¨€","content":"\n# å‚è€ƒèµ„æ–™\n\n*  *[è‡ªå·±åŠ¨æ‰‹å®ç°Lua:è™šæ‹Ÿæœºã€ç¼–è¯‘å™¨å’Œæ ‡å‡†åº“](https://weread.qq.com/web/bookDetail/40032ae07164852040038d3)\n* ã€ŠProgramming in Lua, Fourth Editionã€‹\n* ã€ŠLua 5.3 Reference Manualã€‹\n* ã€ŠThe Evolution of Luaã€‹\n* ã€ŠThe Implementation of Lua 5.0ã€‹\n* ã€ŠA No-Frills Introduction to Lua 5.1 VM Instructionsã€‹\n* ã€ŠLua 5.3 Bytecode Referenceã€‹\n\n\n\n# å…³äº Lua çš„è¯­æ³•\n\n* [luaåŸºç¡€](lua/luaåŸºç¡€.md)\n* [Luaé«˜çº§](lua/Luaé«˜çº§.md)\n\n\n# å‚è€ƒä»£ç \n\n* [è‡ªå·±åŠ¨æ‰‹å®ç°Lua:è™šæ‹Ÿæœºã€ç¼–è¯‘å™¨å’Œæ ‡å‡†åº“](https://weread.qq.com/web/bookDetail/40032ae07164852040038d3) çš„éšä¹¦ä»£ç  [luago-book](https://github.com/zxh0/luago-book)\n\n## æˆ‘çš„ä»£ç \n\n* [golua](https://github.com/googoo-s/golua)\n\n\n\n\n\n","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/lua/%E7%94%A8Go%E5%AE%9E%E7%8E%B0Lua/1.%E4%BA%8C%E8%BF%9B%E5%88%B6Chunk":{"title":"1.äºŒè¿›åˆ¶Chunk","content":"\n# ä»€ä¹ˆæ˜¯äºŒè¿›åˆ¶ chunk\nLua è„šæœ¬å¹¶.ä¸æ˜¯ç›´æ¥è¢« Lua è§£é‡Šå™¨è§£é‡Šæ‰§è¡Œï¼Œè€Œæ˜¯ç±»ä¼¼ Java è¯­è¨€é‚£æ ·ï¼Œå…ˆç”± Lua ç¼–è¯‘å™¨ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œç„¶åå†äº¤ç»™ Lua è™šæ‹Ÿæœºå»æ‰§è¡Œ\n\nLua å­—èŠ‚ç éœ€è¦ä¸€ä¸ªè½½ä½“ï¼Œè¿™ä¸ªè½½ä½“å°±æ˜¯äºŒè¿›åˆ¶ chunkï¼Œå¯¹ Java è™šæ‹Ÿæœºæ¯”è¾ƒç†Ÿæ‚‰çš„è¯»è€…å¯ä»¥æŠŠäºŒè¿›åˆ¶ chunk çœ‹ä½œ Lua ç‰ˆçš„ class æ–‡ä»¶\n\n\n#  lunc å‘½ä»¤\n\n\nLuac å‘½ä»¤ä¸»è¦æœ‰ä¸¤ä¸ªç”¨é€”ï¼š\n\n* ç¬¬ä¸€ï¼Œä½œä¸ºç¼–è¯‘å™¨ï¼ŒæŠŠ Lua æºæ–‡ä»¶ç¼–è¯‘æˆäºŒè¿›åˆ¶ chunk æ–‡ä»¶ï¼š\n* ç¬¬äºŒï¼Œä½œä¸ºåç¼–è¯‘å™¨ï¼Œåˆ†æäºŒè¿›åˆ¶ chunkï¼Œå°†ä¿¡æ¯è¾“å‡ºåˆ°æ§åˆ¶å°\n\n\n```\nâœ  will ~ luac\nC:\\Program Files (x86)\\Lua\\5.1\\luac.exe: no input files given\nusage: C:\\Program Files (x86)\\Lua\\5.1\\luac.exe [options] [filenames].\nAvailable options are:\n  -        process stdin\n  -l       list\n  -o name  output to file 'name' (default is \"luac.out\")\n  -p       parse only\n  -s       strip debug information\n  -v       show version information\n  --       stop handling options\n```\n\n## ç¼–è¯‘ lua æºæ–‡ä»¶\n\nå°†ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶åä½œä¸ºå‚æ•°è°ƒç”¨ luac å‘½ä»¤å°±å¯ä»¥ç¼–è¯‘æŒ‡å®šçš„ Lua æºæ–‡ä»¶ï¼Œå¦‚æœç¼–è¯‘æˆåŠŸï¼Œåœ¨å½“å‰ç›®å½•ä¸‹ä¼šå‡ºç° luac. Out æ–‡ä»¶ï¼Œé‡Œé¢çš„å†…å®¹å°±æ˜¯å¯¹åº”çš„äºŒè¿›åˆ¶ chunk\n\n\n```\n$ luac hello_world.lua              # ç”Ÿæˆluac.out\n$ luac -o hw.luac hello_world.lua   # ç”Ÿæˆhw.luac\n$ luac -s hello_world.lua           # ä¸åŒ…å«è°ƒè¯•ä¿¡æ¯\n$ luac -p hello_world.lua           # åªè¿›è¡Œè¯­æ³•æ£€æŸ¥\n```\n\n\n## Luac çš„ç®€å•å·¥ä½œåŸç†\n\n\nLua ç¼–è¯‘å™¨ä»¥å‡½æ•°ä¸ºå•ä½è¿›è¡Œç¼–è¯‘ï¼Œæ¯ä¸€ä¸ªå‡½æ•°éƒ½ä¼šè¢« Lua ç¼–è¯‘å™¨ç¼–è¯‘ä¸ºä¸€ä¸ªå†…éƒ¨ç»“æ„ï¼Œè¿™ä¸ªç»“æ„å«ä½œâ€œåŸå‹â€ï¼ˆPrototypeï¼‰ã€‚åŸå‹ä¸»è¦åŒ…å« 6 éƒ¨åˆ†å†…å®¹ï¼Œåˆ†åˆ«æ˜¯ï¼š\n\n* å‡½æ•°åŸºæœ¬ä¿¡æ¯ï¼ˆåŒ…æ‹¬å‚æ•°æ•°é‡ã€å±€éƒ¨å˜é‡æ•°é‡ç­‰ï¼‰\n* å­—èŠ‚ç \n* å¸¸é‡è¡¨\n* Upvalue è¡¨\n* è°ƒå¼ä¿¡æ¯\n* å­å‡½æ•°åŸå‹åˆ—è¡¨\n\n**å‡½æ•°åŸå‹æ˜¯ä¸€ç§é€’å½’ç»“æ„**ï¼Œå¹¶ä¸” Lua æºç ä¸­å‡½æ•°çš„åµŒå¥—å…³ç³»ä¼šç›´æ¥åæ˜ åœ¨ç¼–è¯‘åçš„åŸå‹é‡Œ\n\nå¯¹äºè„šæœ¬ï¼Œ**Lua ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬çš„è„šæœ¬æ·»åŠ ä¸€ä¸ª main å‡½æ•°**ï¼ˆåæ–‡ç§°å…¶ä¸ºä¸»å‡½æ•°ï¼‰ï¼Œå¹¶ä¸”æŠŠæ•´ä¸ªç¨‹åºéƒ½æ”¾è¿›è¿™ä¸ªå‡½æ•°é‡Œï¼Œç„¶åå†ä»¥å®ƒä¸ºèµ·ç‚¹è¿›è¡Œç¼–è¯‘ï¼Œé‚£ä¹ˆè‡ªç„¶å°±æŠŠæ•´ä¸ªç¨‹åºéƒ½ç¼–è¯‘å‡ºæ¥äº†\n\n\nç»¼ä¸Šæ‰€è¿°ï¼Œå‡½æ•°åŸå‹å’ŒäºŒè¿›åˆ¶ chunk çš„å†…éƒ¨ç»“æ„\n\n![](statistic/Pasted%20image%2020230805015642.png)\n\n\n## åç¼–è¯‘äºŒè¿›åˆ¶ chunk \n\n\nLuc å‘½ä»¤å…¼å…·ç¼–è¯‘å’Œåç¼–è¯‘åŠŸèƒ½ï¼Œä½¿ç”¨â€œ-lâ€é€‰é¡¹å¯ä»¥å°† luac åˆ‡æ¢åˆ°åç¼–è¯‘æ¨¡å¼ã€‚æ­£å¦‚ javap å‘½ä»¤æ˜¯æŸ¥çœ‹ class æ–‡ä»¶çš„åˆ©å™¨ï¼Œluac å‘½ä»¤æ­é…â€œ-lâ€é€‰é¡¹åˆ™æ˜¯æŸ¥çœ‹äºŒè¿›åˆ¶ chunk çš„åˆ©å™¨\n\n\nä»¥å‰é¢ç¼–è¯‘å‡ºæ¥çš„ hello_world. Luac æ–‡ä»¶ä¸ºä¾‹ï¼Œå…¶åç¼–è¯‘è¾“å‡ºå¦‚ä¸‹ã€‚\n\n\n```\n$ luac -l hello_world.luac\n\nmain \u003chello_world.lua:0,0\u003e (4 instructions at 0x7fb4dbc030f0)\n0+ params, 2 slots, 1 upvalue, 0 locals, 2 constants, 0 functions\n\t1    [1]GETTABUP  0 0-1 ; _ENV \"print\"\n\t2    [1]LOADK      1-2       ; \"Hello, World! \"\n\t3    [1]CALL       0 2 1\n\t4    [1]RETURN     0 1\n```\n\n\nç”±äºâ€œHello, World! â€ç¨‹åºåªæœ‰ä¸€æ¡æ‰“å°è¯­å¥ï¼Œæ‰€ä»¥ç¼–è¯‘å‡ºæ¥çš„äºŒè¿›åˆ¶ chunk é‡Œä¹Ÿåªæœ‰ä¸€ä¸ªä¸»å‡½æ•°åŸå‹ï¼ˆæ²¡æœ‰å­å‡½æ•°ï¼‰ï¼Œå› æ­¤åç¼–è¯‘è¾“å‡ºé‡Œä¹Ÿåªæœ‰ä¸»å‡½æ•°ä¿¡æ¯\n\n\nå¤šå‡½æ•°çš„ lua\n\n```\nfunction foo()\n\tfunction bar() end\nend\n```\n\nåç¼–è¯‘ç»“æœï¼Œåç¼–è¯‘è¾“å‡ºä¸­ä¼šä¾æ¬¡åŒ…å« mainã€foo å’Œ bar å‡½æ•°çš„ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\n\n\n```\n$ luac -l foo_bar.lua\n\nmain \u003cfoo_bar.lua:0,0\u003e (3 instructions at 0x7fc43fc02b20)\n0+ params, 2 slots, 1 upvalue, 0 locals, 1 constant, 1 function\n\t1  [4] CLOSURE    0 0     ; 0x7fc43fc02cc0\n\t2  [1] SETTABUP  0-1 0 ; _ENV \"foo\"\n\t3  [4] RETURN     0 1\n\nfunction \u003cfoo_bar.lua:1,4\u003e (3 instructions at 0x7fc43fc02cc0)\n0 params, 2 slots, 1 upvalue, 0 locals, 1 constant, 1 function\n\t1  [3] CLOSURE    0 0     ; 0x7fc43fc02e40\n\t2  [2] SETTABUP  0-1 0 ; _ENV \"bar\"\n\t3  [4] RETURN     0 1\n\nfunction \u003cfoo_bar.lua:2,3\u003e (1 instruction at 0x7fc43fc02e40)\n0 params, 2 slots, 0 upvalues, 0 locals, 0 constants, 0 functions\n\t1  [3] RETURN     0 1\n\n```\n\n\nåç¼–è¯‘æ‰“å°å‡ºçš„å‡½æ•°ä¿¡æ¯åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š\n\n* å‰é¢ä¸¤è¡Œæ˜¯å‡½æ•°åŸºæœ¬ä¿¡æ¯ï¼Œ\n\t* ç¬¬ä¸€è¡Œ\n\t\t* å¦‚æœä»¥ main å¼€å¤´ï¼Œè¯´æ˜è¿™æ˜¯ç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„ä¸»å‡½æ•°ï¼Œä»¥ function å¼€å¤´ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°\n\t\t* æ¥ç€æ˜¯å®šä¹‰å‡½æ•°çš„æºæ–‡ä»¶åå’Œå‡½æ•°åœ¨æ–‡ä»¶é‡Œçš„**èµ·æ­¢è¡Œå·**ï¼ˆå¯¹äºä¸»å‡½æ•°ï¼Œèµ·æ­¢è¡Œå·éƒ½æ˜¯ 0ï¼‰ï¼Œç„¶åæ˜¯æŒ‡ä»¤æ•°é‡å’Œå‡½æ•°åœ°å€ã€‚\n\t* ç¬¬äºŒè¡Œä¾æ¬¡ç»™å‡º\n\t\t* å‡½æ•°çš„å›ºå®šå‚æ•°æ•°é‡ï¼ˆå¦‚æœæœ‰+å·ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª vararg å‡½æ•°ï¼‰\n\t\t* è¿è¡Œå‡½æ•°æ‰€å¿…è¦çš„å¯„å­˜å™¨æ•°é‡\n\t\t* upvalue æ•°é‡\n\t\t* å±€éƒ¨å˜é‡æ•°é‡\n\t\t* å¸¸é‡æ•°é‡\n\t\t* å­å‡½æ•°æ•°é‡\n* åé¢æ˜¯æŒ‡ä»¤åˆ—è¡¨ã€‚æ¯ä¸€æ¡éƒ½åŒ…å«\n\t* æŒ‡ä»¤åºå·\n\t* å¯¹åº”è¡Œå·\n\t* æ“ä½œç  \n\t* æ“ä½œæ•°\n\t* åˆ†å·åé¢æ˜¯ luac æ ¹æ®æŒ‡ä»¤æ“ä½œæ•°ç”Ÿæˆçš„æ³¨é‡Šï¼Œä»¥ä¾¿äºæˆ‘ä»¬ç†è§£æŒ‡ä»¤\n\n## äºŒè¿›åˆ¶ chunk çš„æ ¼å¼\n\nå’Œ Java çš„ class æ–‡ä»¶ç±»ä¼¼ï¼ŒLua çš„äºŒè¿›åˆ¶ chunk æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªå­—èŠ‚æµ\n\n* äºŒè¿›åˆ¶ chunk æ ¼å¼ï¼ˆåŒ…æ‹¬ Lua è™šæ‹ŸæœºæŒ‡ä»¤ï¼‰å±äº Lua è™šæ‹Ÿæœºå†…éƒ¨å®ç°ç»†èŠ‚ï¼Œå¹¶æ²¡æœ‰æ ‡å‡†åŒ–ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•å®˜æ–¹æ–‡æ¡£å¯¹å…¶è¿›è¡Œè¯´æ˜ï¼Œä¸€åˆ‡ä»¥ Lua å®˜æ–¹å®ç°çš„æºä»£ç ä¸ºå‡†\n* **äºŒè¿›åˆ¶ chunk æ ¼å¼çš„è®¾è®¡æ²¡æœ‰è€ƒè™‘è·¨å¹³å°çš„éœ€æ±‚**ï¼Œä½¿ç”¨è¶…è¿‡ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºçš„æ•°æ®ï¼Œå¿…é¡»è¦è€ƒè™‘å¤§å°ç«¯ï¼ˆEndiannessï¼‰é—®é¢˜ã€‚\n\t* Lua å®˜æ–¹å®ç°çš„åšæ³•æ¯”è¾ƒç®€å•ï¼šç¼–è¯‘ Lua è„šæœ¬æ—¶ï¼Œ**ç›´æ¥æŒ‰ç…§æœ¬æœºçš„å¤§å°ç«¯æ–¹å¼**ç”ŸæˆäºŒè¿›åˆ¶ chunk æ–‡ä»¶ï¼Œå½“åŠ è½½äºŒè¿›åˆ¶ chunk æ–‡ä»¶æ—¶ï¼Œä¼šæ¢æµ‹è¢«åŠ è½½æ–‡ä»¶çš„å¤§å°ç«¯æ–¹å¼ï¼Œå¦‚æœå’Œæœ¬æœºä¸åŒ¹é…ï¼Œå°±æ‹’ç»åŠ è½½\n* äºŒè¿›åˆ¶ chunk æ ¼å¼çš„è®¾è®¡ä¹Ÿæ²¡æœ‰è€ƒè™‘ä¸åŒ Lua ç‰ˆæœ¬ä¹‹é—´çš„å…¼å®¹é—®é¢˜\n\t* ç¼–è¯‘ Lua è„šæœ¬æ—¶ï¼Œç›´æ¥æŒ‰ç…§å½“æ—¶çš„ Lua ç‰ˆæœ¬ç”ŸæˆäºŒè¿›åˆ¶ chunk æ–‡ä»¶ï¼Œå½“åŠ è½½äºŒè¿›åˆ¶ chunk æ–‡ä»¶æ—¶ï¼Œä¼šæ£€æµ‹è¢«åŠ è½½æ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼Œå¦‚æœå’Œå½“å‰ Lua ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œåˆ™æ‹’ç»åŠ è½½\n* äºŒè¿›åˆ¶ chunk æ ¼å¼å¹¶æ²¡æœ‰è¢«åˆ»æ„è®¾è®¡å¾—å¾ˆç´§å‡‘\n\t* lua è„šæœ¬é¢„ç¼–è¯‘æˆäºŒè¿›åˆ¶ chunk çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è·å¾—æ›´å¿«çš„åŠ è½½é€Ÿåº¦ï¼Œæ‰€ä»¥è¿™ä¹Ÿä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ã€‚\n\n### æ•°æ®ç±»å‹ \n\nåœ¨è®¨è®ºäºŒè¿›åˆ¶ chunk æ ¼å¼æ—¶ï¼Œæˆ‘ä»¬ç§°è¿™ç§è¢«ç¼–ç ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªå­—èŠ‚çš„ä¿¡æ¯å•ä½ä¸ºæ•°æ®ç±»å‹\nç”±äº Lua å®˜æ–¹å®ç°æ˜¯ç”¨ C è¯­è¨€ç¼–å†™çš„ï¼Œæ‰€ä»¥ **C è¯­è¨€çš„ä¸€äº›æ•°æ®ç±»å‹ï¼ˆæ¯”å¦‚ size_tï¼‰ä¼šç›´æ¥åæ˜ åœ¨äºŒè¿›åˆ¶ chunk çš„æ ¼å¼**é‡Œ\n\näºŒè¿›åˆ¶ chunk å†…éƒ¨ä½¿ç”¨çš„æ•°æ®ç±»å‹å¤§è‡´å¯ä»¥åˆ†ä¸º**æ•°å­—ã€å­—ç¬¦ä¸²å’Œåˆ—è¡¨**ä¸‰ç§ã€‚\n\n\n#### æ•°å­—\n\næ•°å­—ç±»å‹ä¸»è¦åŒ…æ‹¬**å­—èŠ‚ã€C è¯­è¨€æ•´å‹ï¼ˆåæ–‡ç®€ç§° cintï¼‰ã€C è¯­è¨€ size_t ç±»å‹ï¼ˆç®€ç§° size_tï¼‰ã€Lua æ•´æ•°ã€Lua æµ®ç‚¹æ•°**äº”ç§\n\n* å­—èŠ‚ç±»å‹ç”¨æ¥å­˜æ”¾ä¸€äº›æ¯”è¾ƒå°çš„æ•´æ•°å€¼ï¼Œæ¯”å¦‚ Lua ç‰ˆæœ¬å·ã€å‡½æ•°çš„å‚æ•°ä¸ªæ•°ç­‰ï¼›\n* cint ç±»å‹ä¸»è¦ç”¨æ¥è¡¨ç¤ºåˆ—è¡¨é•¿åº¦ï¼›\n* size_t åˆ™ä¸»è¦ç”¨æ¥è¡¨ç¤ºé•¿å­—ç¬¦ä¸²é•¿åº¦ï¼›\n* Lua æ•´æ•°å’Œ Lua æµ®ç‚¹æ•°åˆ™ä¸»è¦åœ¨å¸¸é‡è¡¨é‡Œå‡ºç°ï¼Œè®°å½• Lua è„šæœ¬ä¸­å‡ºç°çš„æ•´æ•°å’Œæµ®ç‚¹æ•°å­—é¢é‡\n\næ•°å­—ç±»å‹åœ¨äºŒè¿›åˆ¶ chunk é‡Œéƒ½æŒ‰ç…§å›ºå®šé•¿åº¦å­˜å‚¨ã€‚é™¤å­—èŠ‚ç±»å‹å¤–ï¼Œå…¶ä½™å››ç§æ•°å­—ç±»å‹éƒ½ä¼šå ç”¨å¤šä¸ªå­—èŠ‚ï¼Œå…·ä½“å ç”¨å‡ ä¸ªå­—èŠ‚åˆ™ä¼šè®°å½•åœ¨å¤´éƒ¨é‡Œ\n\nLua å®˜æ–¹å®ç°ï¼ˆ64 ä½å¹³å°ï¼‰é‡Œå¯¹åº”çš„ C è¯­è¨€ç±»å‹ã€åœ¨æœ¬ä¹¦ä¸­ä½¿ç”¨çš„ Go è¯­è¨€ç±»å‹ï¼Œä»¥åŠå ç”¨çš„å­—èŠ‚æ•°\n\n![](statistic/Pasted%20image%2020230805155327.png)\n\n\n#### å­—ç¬¦ä¸²\n\nå­—ç¬¦ä¸²åœ¨äºŒè¿›åˆ¶ chunk é‡Œï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ª**å­—èŠ‚æ•°ç»„**ã€‚\n\n\nå› ä¸ºå­—ç¬¦ä¸²é•¿åº¦æ˜¯ä¸å›ºå®šçš„ï¼Œæ‰€ä»¥éœ€è¦æŠŠå­—èŠ‚æ•°ç»„çš„é•¿åº¦ä¹Ÿè®°å½•åˆ°äºŒè¿›åˆ¶ chunk é‡Œã€‚**ä½œä¸ºä¼˜åŒ–ï¼Œå­—ç¬¦ä¸²ç±»å‹åˆå¯ä»¥è¿›ä¸€æ­¥åˆ†ä¸ºçŸ­å­—ç¬¦ä¸²å’Œé•¿å­—ç¬¦ä¸²ä¸¤ç§ï¼Œå…·ä½“æœ‰ä¸‰ç§æƒ…å†µ**\n\n\n* å¯¹äº NULL å­—ç¬¦ä¸²ï¼Œåªç”¨ 0 x 00 è¡¨ç¤ºå°±å¯ä»¥äº†ã€‚\n* å¯¹äºé•¿åº¦å°äºç­‰äº 253ï¼ˆ0 xFDï¼‰çš„å­—ç¬¦ä¸²ï¼Œ**å…ˆä½¿ç”¨ä¸€ä¸ªå­—èŠ‚è®°å½•é•¿åº¦+1**ï¼Œç„¶åæ˜¯å­—èŠ‚æ•°ç»„ã€‚\n* å¯¹äºé•¿åº¦å¤§äºç­‰äº 254ï¼ˆ0 xFEï¼‰çš„å­—ç¬¦ä¸²ï¼Œ**ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ 0 xFFï¼Œåé¢è·Ÿä¸€ä¸ª size_t è®°å½•é•¿åº¦+1**ï¼Œæœ€åæ˜¯å­—èŠ‚æ•°ç»„ã€‚\n\n\n![](statistic/Pasted%20image%2020230805155714.png)\n\n\n#### åˆ—è¡¨\n\nåœ¨äºŒè¿›åˆ¶ chunk å†…éƒ¨ï¼Œ**æŒ‡ä»¤è¡¨ã€å¸¸é‡è¡¨ã€å­å‡½æ•°åŸå‹è¡¨ç­‰ä¿¡æ¯éƒ½æ˜¯æŒ‰ç…§åˆ—è¡¨çš„æ–¹å¼å­˜å‚¨çš„**ã€‚\n\n* ç”¨ä¸€ä¸ª cint ç±»å‹è®°å½•åˆ—è¡¨é•¿åº¦ï¼Œ\n* ç„¶åç´§æ¥ç€å­˜å‚¨ n ä¸ªåˆ—è¡¨å…ƒç´ ï¼Œ\n* è‡³äºåˆ—è¡¨å…ƒç´ å¦‚ä½•å­˜å‚¨é‚£å°±è¦å…·ä½“æƒ…å†µå…·ä½“åˆ†æäº†\n\n### æ€»ä½“ç»“æœ\n\næ€»ä½“è€Œè¨€ï¼ŒäºŒè¿›åˆ¶ chunk åˆ†ä¸ºå¤´éƒ¨å’Œä¸»å‡½æ•°åŸå‹ä¸¤éƒ¨åˆ†\n\n![](statistic/Pasted%20image%2020230805015642.png)\n\n\nå®šä¹‰ç»“æ„ä½“ binaryChunk \n\n\n```\ntype binaryChunk struct {\nÂ  Â  // å¤´éƒ¨\nÂ  Â  header\nÂ  Â  // ä¸»å‡½æ•°upvalues å’Œé—­åŒ…æœ‰å…³\nÂ  Â  sizeUpvalues byte\nÂ  Â  // ä¸»å‡½æ•°åŸå‹\nÂ  Â  mainFunc *Prototype\n}\n```\n\n### å¤´éƒ¨\n\n\n```\ntype header struct {\n\t// ç­¾åï¼Œç›¸å¯¹äºJavaçš„æ¨¡å¼,ä¸»è¦èµ·å¿«é€Ÿè¯†åˆ«æ–‡ä»¶æ ¼å¼çš„ä½œç”¨\n\tsignature [4]byte\n\t// ç‰ˆæœ¬å·ï¼Œè®°å½•äºŒè¿›åˆ¶chunkæ–‡ä»¶æ‰€å¯¹åº”çš„Luaç‰ˆæœ¬å·\n\tversion byte\n\t// æ ¼å¼å·ï¼Œå¦‚æœå’Œè™šæ‹Ÿæœºæœ¬èº«çš„æ ¼å¼å·ä¸åŒ¹é…ï¼Œå°±æ‹’ç»åŠ è½½è¯¥æ–‡ä»¶\n\tformat          byte\n\t// LUAC_DATA æ ¼å¼å·ä¹‹åçš„6ä¸ªå­—èŠ‚åœ¨Luaå®˜æ–¹å®ç°é‡Œå«ä½œLUAC_DATAã€‚\n\t// å…¶ä¸­å‰ä¸¤ä¸ªå­—èŠ‚æ˜¯0x1993ï¼Œè¿™æ˜¯Lua 1.0å‘å¸ƒçš„å¹´ä»½ï¼›\n\t// åå››ä¸ªå­—èŠ‚ä¾æ¬¡æ˜¯å›è½¦ç¬¦ï¼ˆ0x0Dï¼‰ã€æ¢è¡Œç¬¦ï¼ˆ0x0Aï¼‰ã€æ›¿æ¢ç¬¦ï¼ˆ0x1Aï¼‰å’Œå¦ä¸€ä¸ªæ¢è¡Œç¬¦\n\t// 6ä¸ªå­—èŠ‚ä¸»è¦èµ·è¿›ä¸€æ­¥æ ¡éªŒçš„ä½œç”¨ã€‚å¦‚æœLuaè™šæ‹Ÿæœºåœ¨åŠ è½½äºŒè¿›åˆ¶chunkæ—¶å‘ç°è¿™6ä¸ªå­—èŠ‚å’Œé¢„æœŸçš„ä¸ä¸€æ ·ï¼Œå°±ä¼šè®¤ä¸ºæ–‡ä»¶å·²ç»æŸåï¼Œæ‹’ç»åŠ è½½\n\tluacData        [6]byte\n\t// æ¥ä¸‹æ¥çš„5ä¸ªå­—èŠ‚åˆ†åˆ«è®°å½•cintã€size_tã€Luaè™šæ‹ŸæœºæŒ‡ä»¤ã€Luaæ•´æ•°å’ŒLuaæµ®ç‚¹æ•°è¿™5ç§æ•°æ®ç±»å‹åœ¨äºŒè¿›åˆ¶chunké‡Œå ç”¨çš„å­—èŠ‚æ•°\n\tcintSize        byte\n\tsizetSize       byte\n\tinstructionSize byte\n\tluaIntegerSize  byte\n\tluaNumberSize   byte\n\t// LUAC_INTï¼Œ nä¸ªå­—èŠ‚å­˜æ”¾Luaæ•´æ•°å€¼0x5678ï¼Œå­˜å‚¨è¿™ä¸ªLuaæ•´æ•°çš„ç›®çš„æ˜¯ä¸ºäº†æ£€æµ‹äºŒè¿›åˆ¶chunkçš„å¤§å°ç«¯æ–¹å¼\n\tluacInt         int64\n\t// LUAC_NUMï¼Œå¤´éƒ¨çš„æœ€ånä¸ªå­—èŠ‚å­˜æ”¾Luaæµ®ç‚¹æ•°370.5ï¼Œå¤´éƒ¨çš„æœ€ånä¸ªå­—èŠ‚å­˜æ”¾Luaæµ®ç‚¹æ•°370.5\n\tluacNum         float64\n}\n```\n\n### å‡½æ•°åŸå‹\n\n\nå‡½æ•°åŸå‹ä¸»è¦åŒ…å«å‡½æ•°åŸºæœ¬ä¿¡æ¯ã€æŒ‡ä»¤è¡¨ã€å¸¸é‡è¡¨ã€upvalue è¡¨ã€å­å‡½æ•°åŸå‹è¡¨ä»¥åŠè°ƒè¯•ä¿¡æ¯ï¼›\n\n* åŸºæœ¬ä¿¡æ¯\n\t* æºæ–‡ä»¶åã€èµ·æ­¢è¡Œå·ã€å›ºå®šå‚æ•°ä¸ªæ•°ã€æ˜¯å¦æ˜¯ vararg å‡½æ•°ä»¥åŠè¿è¡Œå‡½æ•°æ‰€å¿…è¦çš„å¯„å­˜å™¨æ•°é‡ï¼›\n\t* è°ƒè¯•ä¿¡æ¯åˆåŒ…æ‹¬è¡Œå·è¡¨ã€å±€éƒ¨å˜é‡è¡¨ä»¥åŠ upvalue ååˆ—è¡¨ã€‚\n\n![](statistic/Pasted%20image%2020230805162248.png)\n\n```\ntype Prototype struct {\n\t// æºæ–‡ä»¶åï¼Œåªæœ‰åœ¨ä¸»å‡½æ•°åŸå‹é‡Œï¼Œè¯¥å­—æ®µæ‰çœŸæ­£æœ‰å€¼ï¼Œåœ¨å…¶ä»–åµŒå¥—çš„å‡½æ•°åŸå‹é‡Œï¼Œè¯¥å­—æ®µå­˜æ”¾ç©ºå­—ç¬¦ä¸²\n\tSource string\n\t// Prototype,ç”¨äºè®°å½•åŸå‹å¯¹åº”çš„å‡½æ•°åœ¨æºæ–‡ä»¶ä¸­çš„èµ·æ­¢è¡Œå·ã€‚å¦‚æœæ˜¯æ™®é€šçš„å‡½æ•°ï¼Œèµ·æ­¢è¡Œå·éƒ½åº”è¯¥å¤§äº0ï¼›\n\t//  å¦‚æœæ˜¯ä¸»å‡½æ•°ï¼Œåˆ™èµ·æ­¢è¡Œå·éƒ½æ˜¯0\n\tLineDefined     uint32\n\tLastLineDefined uint32\n\t// å‡½æ•°å›ºå®šå‚æ•°ä¸ªæ•°ã€‚è¿™é‡Œçš„å›ºå®šå‚æ•°ï¼Œæ˜¯ç›¸å¯¹äºå˜é•¿å‚æ•°ï¼ˆVarargï¼‰è€Œè¨€çš„\n\tNumParams byte\n\t// ç”¨æ¥è®°å½•å‡½æ•°æ˜¯å¦ä¸ºVarargå‡½æ•°ï¼Œå³æ˜¯å¦æœ‰å˜é•¿å‚æ•°\n\tIsVararg byte\n\t// è®°å½•çš„æ˜¯å¯„å­˜å™¨æ•°é‡ã€‚Luaç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘å‡½æ•°æ—¶å°†è¿™ä¸ªæ•°é‡è®¡ç®—å¥½ï¼Œå¹¶ä»¥å­—èŠ‚ç±»å‹ä¿å­˜åœ¨å‡½æ•°åŸå‹\n\tMaxStackSize byte\n\t// å‡½æ•°åŸºæœ¬ä¿¡æ¯ä¹‹åæ˜¯æŒ‡ä»¤è¡¨\n\tCode []uint32\n\t// æŒ‡ä»¤è¡¨ä¹‹åæ˜¯å¸¸é‡è¡¨ã€‚å¸¸é‡è¡¨ç”¨äºå­˜æ”¾Luaä»£ç é‡Œå‡ºç°çš„å­—é¢é‡ï¼ŒåŒ…æ‹¬nilã€å¸ƒå°”å€¼ã€æ•´æ•°ã€æµ®ç‚¹æ•°å’Œå­—ç¬¦ä¸²äº”ç§ã€‚\n\t// æ¯ä¸ªå¸¸é‡éƒ½ä»¥1å­—èŠ‚tagå¼€å¤´ï¼Œç”¨æ¥æ ‡è¯†åç»­å­˜å‚¨çš„æ˜¯å“ªç§ç±»å‹çš„å¸¸é‡å€¼ã€‚å¸¸é‡tagå€¼,tagç±»å‹ä¸ºTAG_NILï¼ŒTAG_BOOLEANï¼Œï¼Œ\n\tConstants []interface{}\n\t// Upvalues å æœ‰ä¸¤ä¸ªå­—èŠ‚\n\tUpvalues []Upvalue\n\t// å­å‡½æ•°åŸå‹è¡¨\n\tProtos []*Prototype\n\t// è¡Œå·è¡¨ å­å‡½æ•°åŸå‹è¡¨ä¹‹åæ˜¯è¡Œå·è¡¨ï¼Œå…¶ä¸­è¡Œå·æŒ‰cintç±»å‹å­˜å‚¨ã€‚è¡Œå·è¡¨ä¸­çš„è¡Œå·å’ŒæŒ‡ä»¤è¡¨ä¸­çš„æŒ‡ä»¤ä¸€ä¸€å¯¹åº”\n\tLineInfo []uint32\n\t// å·è¡¨ä¹‹åæ˜¯å±€éƒ¨å˜é‡è¡¨ï¼Œç”¨äºè®°å½•å±€éƒ¨å˜é‡åï¼Œ\n\t// è¡¨ä¸­æ¯ä¸ªå…ƒç´ éƒ½åŒ…å«å˜é‡åï¼ˆæŒ‰å­—ç¬¦ä¸²ç±»å‹å­˜å‚¨ï¼‰å’Œèµ·æ­¢æŒ‡ä»¤ç´¢å¼•ï¼ˆæŒ‰cintç±»å‹å­˜å‚¨\n\tLocVars []LocVar\n\t// æ•°åŸå‹çš„æœ€åä¸€éƒ¨åˆ†å†…å®¹æ˜¯Upvalueååˆ—è¡¨ã€‚è¯¥åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼ˆæŒ‰å­—ç¬¦ä¸²ç±»å‹å­˜å‚¨ï¼‰\n\t// å’Œå‰é¢Upvalueè¡¨ä¸­çš„å…ƒç´ ä¸€ä¸€å¯¹åº”ï¼Œåˆ†åˆ«è®°å½•æ¯ä¸ªUpvalueåœ¨æºä»£ç ä¸­çš„åå­—\n\tUpvalueNames []string\n}\n\ntype LocVar struct {\n\tVarName string\n\tStartPC uint32\n\tEndPC   uint32\n}\n\n\n// Upvalue å’Œé—­åŒ…ç›¸å…³\ntype Upvalue struct {\n\tInstack byte\n\tInx     byte\n}\n\n// å¸¸é‡ç±»å‹\nconst (\n\tTAG_NIL       = 0x00\n\tTAG_BOOLEAN   = 0x01\n\tTAG_NUMBER    = 0x03\n\tTAG_INTEGER   = 0x13\n\tTAG_SHORT_STR = 0x04\n\tTAG_LONG_STR  = 0x14\n)\n\n```\n\n## è§£æäºŒè¿›åˆ¶ chunk\n\nåœ¨ `binary_chunk.go` ä¸­å®šä¹‰äº† chunk çš„è§£æå‡½æ•°`Undump`\n\n```\nfunc Undump(data []byte) * Prototype {\n\treader := \u0026reader{data}\n\treader.checkHeader()\n\treader.readByte()\n\t\n\treader.readProto(\"\")\n}\n```\n\nè§£æ chunk ä¸»è¦çœ‹ reader ï¼Œå®šä¹‰ ` binchunk/reader.go`\n\n\n```\npackage binchunk\n\nimport \"encoding/binary\"\nimport \"math\"\n\ntype reader struct {\n\tdata []byte\n}\n```\n\n### è¯»å–åŸºæœ¬æ•°æ®ç±»å‹\n\nå®šä¹‰äº† 7 ç§è¯»å–æ•°æ®ç±»å‹çš„æ–¹æ³•\n\n\n```\n// readByte ä»å­—èŠ‚æµé‡Œè¯»å–ä¸€ä¸ªå­—èŠ‚\nfunc (self *reader) readByte() byte \n// readUint32 ä½¿ç”¨å°ç«¯æ–¹å¼ä»å­—èŠ‚æµé‡Œè¯»å–ä¸€ä¸ªcintå­˜å‚¨ç±»å‹ï¼ˆå 4ä¸ªå­—èŠ‚ï¼Œæ˜ å°„ä¸ºGoè¯­è¨€uint32ç±»å‹ï¼‰çš„æ•´æ•°\nfunc (self *reader) readUint32() uint32 \n// readUint64 ä½¿ç”¨å°ç«¯æ–¹å¼ä»å­—èŠ‚æµé‡Œè¯»å–ä¸€ä¸ªcintå­˜å‚¨ç±»å‹ï¼ˆå 4ä¸ªå­—èŠ‚ï¼Œæ˜ å°„ä¸ºGoè¯­è¨€uint32ç±»å‹ï¼‰çš„æ•´æ•°\nfunc (self *reader) readUint64() uint64 \n// readLuaInteger ä»å­—èŠ‚æµé‡Œè¯»å–ä¸€ä¸ªLuaæ•´æ•°ï¼ˆå 8ä¸ªå­—èŠ‚ï¼Œæ˜ å°„ä¸ºGoè¯­è¨€int64ç±»å‹\nfunc (self *reader) readLuaInteger() int64 \n// readLuaNumber ä»å­—èŠ‚æµé‡Œè¯»å–ä¸€ä¸ªLuaæµ®ç‚¹æ•°ï¼ˆå 8ä¸ªå­—èŠ‚ï¼Œæ˜ å°„ä¸ºGoè¯­è¨€float64ç±»å‹ï¼‰\nfunc (self *reader) readLuaNumber() float64 \n// readString()æ–¹æ³•ä»å­—èŠ‚æµé‡Œè¯»å–å­—ç¬¦ä¸²ï¼ˆæ˜ å°„ä¸ºGoè¯­è¨€stringç±»å‹ï¼‰\nfunc (self *reader) readString() string \n// readBytes()æ–¹æ³•ä»å­—èŠ‚æµé‡Œè¯»å–nä¸ªå­—èŠ‚\nfunc (self *reader) readBytes(n uint) []byte \n\n```\n\n### æ£€æŸ¥å¤´éƒ¨\n\nCheckHeader ()æ–¹æ³•ä»å­—èŠ‚æµé‡Œè¯»å–å¹¶æ£€æŸ¥äºŒè¿›åˆ¶ chunk å¤´éƒ¨çš„å„ä¸ªå­—æ®µï¼Œå¦‚æœå‘ç°æŸä¸ªå­—æ®µå’ŒæœŸæœ›ä¸ç¬¦ï¼Œåˆ™è°ƒç”¨ panic å‡½æ•°ç»ˆæ­¢åŠ è½½\n\n\n### è¯»å–å‡½æ•°åŸå‹\n\nReadProto ()æ–¹æ³•ä»å­—èŠ‚æµé‡Œè¯»å–å‡½æ•°åŸå‹","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/lua/%E7%94%A8Go%E5%AE%9E%E7%8E%B0Lua/2.%E6%8C%87%E4%BB%A4%E9%9B%86":{"title":"2.æŒ‡ä»¤é›†","content":"\n\n# æŒ‡ä»¤é›†ä»‹ç»\n\næŒ‰ç…§å®ç°æ–¹å¼ï¼Œè™šæ‹Ÿæœºå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š\n\n* åŸºäºæ ˆï¼ˆStack Basedï¼‰ã€‚ \n\t* Java è™šæ‹Ÿæœºã€. NET CLRã€Python è™šæ‹Ÿæœºï¼Œä»¥åŠåœ¨ç¬¬ 2 ç« ä¸­æåˆ°è¿‡çš„ Ruby YARV è™šæ‹Ÿæœºéƒ½æ˜¯åŸºäºæ ˆçš„è™šæ‹Ÿæœºï¼›\n* åŸºäºå¯„å­˜å™¨ï¼ˆRegister Basedï¼‰ã€‚\n\t* ä»¥åŠæœ¬ä¹¦è®¨è®ºçš„ Lua è™šæ‹Ÿæœºåˆ™æ˜¯åŸºäºå¯„å­˜å™¨çš„è™šæ‹Ÿæœº\n\n\nå¦‚åŒçœŸå®æœºå™¨æœ‰ä¸€å¥—æŒ‡ä»¤é›†ï¼ˆInstruction Setï¼‰ä¸€æ ·ï¼Œè™šæ‹Ÿæœºä¹Ÿæœ‰è‡ªå·±çš„æŒ‡ä»¤é›†ï¼š\n\n* åŸºäºæ ˆçš„è™šæ‹Ÿæœºéœ€è¦ä½¿ç”¨ PUSH ç±»æŒ‡ä»¤å¾€æ ˆé¡¶æ¨å…¥å€¼ï¼Œä½¿ç”¨ POP ç±»æŒ‡ä»¤ä»æ ˆé¡¶å¼¹å‡ºå€¼, å…¶ä»–æŒ‡ä»¤åˆ™æ˜¯å¯¹æ ˆé¡¶å€¼è¿›è¡Œæ“ä½œï¼Œå› æ­¤**æŒ‡ä»¤é›†ç›¸å¯¹æ¯”è¾ƒå¤§ï¼Œ**\n* å…¶ä»–æŒ‡ä»¤åˆ™æ˜¯å¯¹æ ˆé¡¶å€¼è¿›è¡Œæ“ä½œï¼Œå› æ­¤æŒ‡ä»¤é›†ç›¸å¯¹æ¯”è¾ƒå¤§ï¼Œä½†æ˜¯ç”±äºéœ€è¦æŠŠå¯„å­˜å™¨åœ°å€ç¼–ç è¿›æŒ‡ä»¤é‡Œï¼Œ**æ‰€ä»¥æŒ‡ä»¤çš„å¹³å‡é•¿åº¦æ¯”è¾ƒé•¿**ã€‚\n\n\næŒ‰ç…§æŒ‡ä»¤é•¿åº¦æ˜¯å¦å›ºå®šï¼ŒæŒ‡ä»¤é›†å¯ä»¥åˆ†ä¸º**å®šé•¿ï¼ˆFixed-widthï¼‰æŒ‡ä»¤é›†**å’Œ**å˜é•¿ï¼ˆVariable-widthï¼‰æŒ‡ä»¤é›†**ä¸¤ç§\n\n* Java è™šæ‹Ÿæœºä½¿ç”¨çš„æ˜¯å˜é•¿æŒ‡ä»¤é›†ï¼ŒæŒ‡ä»¤é•¿åº¦ä» 1 åˆ°å¤šä¸ªå­—èŠ‚ä¸ \n* Lua è™šæ‹Ÿæœºé‡‡ç”¨çš„åˆ™æ˜¯å®šé•¿æŒ‡ä»¤é›†ï¼Œæ¯æ¡æŒ‡ä»¤å  4 ä¸ªå­—èŠ‚ï¼ˆå…± 32 æ¯”ç‰¹ï¼‰ï¼Œ\n\t* å…¶ä¸­ 6 æ¯”ç‰¹ç”¨äºæ“ä½œç ï¼ˆOpcodeï¼‰ï¼Œ\n\t* å…¶ä½™ 26 æ¯”ç‰¹ç”¨äºæ“ä½œæ•°ï¼ˆOperandï¼‰\n\n\nLua 5.3 ä¸€å…±å®šä¹‰äº† 47 æ¡æŒ‡ä»¤ï¼ŒæŒ‰ç…§ä½œç”¨ï¼Œè¿™äº›æŒ‡ä»¤å¤§è‡´å¯ä»¥åˆ†ä¸º 6 å¤§ç±»\n\n* å¸¸é‡åŠ è½½æŒ‡ä»¤ã€\n* è¿ç®—ç¬¦ç›¸å…³æŒ‡ä»¤ã€\n* å¾ªç¯å’Œè·³è½¬æŒ‡ä»¤ã€\n* å‡½æ•°è°ƒç”¨ç›¸å…³æŒ‡ä»¤ã€\n* è¡¨æ“ä½œæŒ‡ä»¤ä»¥åŠ \n* Upvalue æ“ä½œæŒ‡ä»¤ \n\n\n#  æŒ‡ä»¤ç¼–ç æ ¼å¼\n\n## ç¼–ç æ¨¡å¼\n\næ¡ Lua è™šæ‹ŸæœºæŒ‡ä»¤å ç”¨ 4 ä¸ªå­—èŠ‚ï¼Œå…± 32 ä¸ªæ¯”ç‰¹ï¼ˆå¯ä»¥ç”¨ Go è¯­è¨€ uint 32 ç±»å‹è¡¨ç¤ºï¼‰ï¼Œ\n\n*  6 ä¸ªæ¯”ç‰¹ç”¨äºæ“ä½œç ï¼Œ\n* é«˜ 26 ä¸ªæ¯”ç‰¹ç”¨äºæ“ä½œæ•°\n\nLua è™šæ‹ŸæœºæŒ‡ä»¤å¯ä»¥åˆ†ä¸ºå››ç±»ï¼Œåˆ†åˆ«å¯¹åº”å››ç§ç¼–ç æ¨¡å¼ï¼ˆModeï¼‰: \n\n* iABC\n\t* å¯ä»¥æºå¸¦ Aã€Bã€C ä¸‰ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«å ç”¨ 8ã€9ã€9 ä¸ªæ¯”ç‰¹\n\t* æœ‰ 39 æ¡ä½¿ç”¨ iABC æ¨¡å¼\n* iABxã€\n\t* å¯ä»¥æºå¸¦ A å’Œ Bx ä¸¤ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«å ç”¨ 8 å’Œ 18 ä¸ªæ¯”ç‰¹\n\t*  3 æ¡ä½¿ç”¨ iABx æŒ‡ä»¤\n* iAsBxã€\n\t* å¯ä»¥æºå¸¦ A å’Œ sBx ä¸¤ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«å ç”¨ 8 å’Œ 18 ä¸ªæ¯”ç‰¹\n\t* 4 æ¡ä½¿ç”¨ iAsBx æ¨¡å¼\n* iAx \n\t* åªæºå¸¦ä¸€ä¸ªæ“ä½œæ•°ï¼Œå ç”¨å…¨éƒ¨çš„ 26 ä¸ªæ¯”ç‰¹\n\t* 1 æ¡ä½¿ç”¨ iAx æ ¼å¼ï¼ˆå®é™…ä¸Šè¿™æ¡æŒ‡ä»¤å¹¶ä¸æ˜¯çœŸæ­£çš„æŒ‡ä»¤ï¼Œåªæ˜¯ç”¨æ¥æ‰©å±•å…¶ä»–æŒ‡ä»¤æ“ä½œæ•°çš„ï¼‰\n\n![](statistic/Pasted%20image%2020230806010858.png)\n\n### æ“ä½œç \n\n\nç”±äº Lua è™šæ‹ŸæœºæŒ‡ä»¤ä½¿ç”¨ 6 ä¸ªæ¯”ç‰¹è¡¨ç¤ºæ“ä½œç ï¼Œæ‰€ä»¥æœ€å¤šåªèƒ½æœ‰ 64 æ¡æŒ‡ä»¤\n\n\næ“ä½œç ä» 0 å¼€å§‹ï¼Œåˆ° 46 æˆªæ­¢ã€‚\n\nå®šä¹‰å¦‚ä¸‹\n\n\n```\nconst (\n\tOP_MOVE = iota\n\tOP_LOADK\n\tOP_LOADKX\n\tOP_LOADBOOL\n\tOP_LOADNIL\n\tOP_GETUPVAL\n\tOP_GETTABUP\n\tOP_GETTABLE\n\tOP_SETTABUP\n\tOP_SETUPVAL\n\tOP_SETTABLE\n\tOP_NEWTABLE\n\tOP_SELF\n\tOP_ADD\n\tOP_SUB\n\tOP_MUL\n\tOP_MOD\n\tOP_POW\n\tOP_DIV\n\tOP_IDIV\n\tOP_BAND\n\tOP_BOR\n\tOP_BXOR\n\tOP_SHL\n\tOP_SHR\n\tOP_UNM\n\tOP_BNOT\n\tOP_NOT\n\tOP_LEN\n\tOP_CONCAT\n\tOP_JMP\n\tOP_EQ\n\tOP_LT\n\tOP_LE\n\tOP_TEST\n\tOP_TESTSET\n\tOP_CALL\n\tOP_TAILCALL\n\tOP_RETURN\n\tOP_FORLOOP\n\tOP_FORPREP\n\tOP_TFORCALL\n\tOP_TFORLOOP\n\tOP_SETLIST\n\tOP_CLOSURE\n\tOP_VARARG\n\tOP_EXTRAARG\n)\n```\n\n### æ“ä½œæ•°\n\næ“ä½œæ•°æ˜¯æŒ‡ä»¤çš„å‚æ•°ï¼Œæ¯æ¡æŒ‡ä»¤ï¼ˆå› ç¼–ç æ¨¡å¼è€Œå¼‚ï¼‰å¯ä»¥æºå¸¦ 1 åˆ° 3 ä¸ªæ“ä½œæ•°ã€‚\n\n* å…¶ä¸­æ“ä½œæ•° A ä¸»è¦ç”¨æ¥è¡¨ç¤ºç›®æ ‡å¯„å­˜å™¨ç´¢å¼•ï¼Œ\n* å…¶ä»–æ“ä½œæ•°æŒ‰ç…§å…¶è¡¨ç¤ºçš„ä¿¡æ¯ï¼Œå¯ä»¥ç²—ç•¥åˆ†ä¸ºå››ç§ç±»å‹ï¼š\n\t* OpArgN\n\t\t* ä¸è¡¨ç¤ºä»»ä½•ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šè¢«ä½¿ç”¨ã€‚æ¯”å¦‚ MOVE æŒ‡ä»¤ï¼ˆiABC æ¨¡å¼ï¼‰åªä½¿ç”¨ A å’Œ B æ“ä½œæ•°ï¼Œä¸ä½¿ç”¨ C æ“ä½œæ•°ï¼ˆOpArgN ç±»å‹\n\t* OpArgU\n\t\t* æ“ä½œæ•°ä¹Ÿå¯èƒ½è¡¨ç¤ºå¸ƒå°”å€¼ã€æ•´æ•°å€¼ã€upvalue ç´¢å¼•ã€å­å‡½æ•°ç´¢å¼•ç­‰ï¼Œè¿™äº›æƒ…å†µéƒ½å¯ä»¥å½’åˆ° OpArgU ç±»å‹é‡Œ\n\t* OpArgR\n\t\t* åœ¨ iABC æ¨¡å¼ä¸‹è¡¨ç¤ºå¯„å­˜å™¨ç´¢å¼•ï¼Œ\n\t\t* åœ¨ iAsBx æ¨¡å¼ä¸‹è¡¨ç¤ºè·³è½¬åç§»\n\t* OpArgK \n\t\t* è¡¨ç¤ºå¸¸é‡è¡¨ç´¢å¼•æˆ–è€…å¯„å­˜å™¨ç´¢å¼•\n\t\t* ç¬¬ä¸€ç§æƒ…å†µæ˜¯ LOADK æŒ‡ä»¤ï¼ˆiABx æ¨¡å¼ï¼Œç”¨äºå°†å¸¸é‡è¡¨ä¸­çš„å¸¸é‡åŠ è½½åˆ°å¯„å­˜å™¨ä¸­ï¼‰ï¼Œè¯¥æŒ‡ä»¤çš„ Bx æ“ä½œæ•°è¡¨ç¤º**å¸¸é‡è¡¨ç´¢å¼•**ï¼Œå¦‚æœç”¨ Kst (N)è¡¨ç¤ºå¸¸é‡è¡¨è®¿é—®ï¼Œåˆ™ LOADK æŒ‡ä»¤å¯ä»¥è¡¨ç¤ºä¸ºä¼ªä»£ç  R (A) := Kst (Bx)\n\t\t* ç¬¬äºŒç§æƒ…å†µæ˜¯éƒ¨åˆ† iABC æ¨¡å¼æŒ‡ä»¤ï¼Œ**è¿™äº›æŒ‡ä»¤çš„ B æˆ– C æ“ä½œæ•°æ—¢å¯ä»¥è¡¨ç¤ºå¸¸é‡è¡¨ç´¢å¼•ä¹Ÿå¯ä»¥è¡¨ç¤ºå¯„å­˜å™¨ç´¢å¼•**ï¼Œä»¥åŠ æ³•æŒ‡ä»¤ ADD ä¸ºä¾‹ï¼Œå¦‚æœç”¨ RK (N)è¡¨ç¤ºå¸¸é‡è¡¨æˆ–è€…å¯„å­˜å™¨è®¿é—®ï¼Œåˆ™è¯¥æŒ‡ä»¤å¯ä»¥è¡¨ç¤ºä¸ºä¼ªä»£ç  R (A):= RK (B)+RK (C)ã€‚\n\n\n### æŒ‡ä»¤è¡¨ \n\nLua å®˜æ–¹å®ç°æŠŠæ¯ä¸€æ¡æŒ‡ä»¤çš„åŸºæœ¬ä¿¡æ¯ï¼ˆåŒ…æ‹¬ç¼–ç æ¨¡å¼ã€æ˜¯å¦è®¾ç½®å¯„å­˜å™¨ Aã€æ“ä½œæ•° B å’Œ C çš„ä½¿ç”¨ç±»å‹ç­‰ï¼‰éƒ½ç¼–ç æˆäº†ä¸€ä¸ªå­—èŠ‚ã€‚\n\næˆ‘ä»¬ä¹Ÿå¯¹å…¶è¿›è¡Œæ¨¡ä»¿ï¼Œåªä¸è¿‡æŠŠå­—èŠ‚æ¢æˆç»“æ„ä½“ï¼Œ\n\n\n```\n\ntype opcode struct {\n\t// operator is a test (next instruction must be a jump)\n\ttestFlag byte\n\t// æ˜¯å¦è®¾ç½®å¯„å­˜å™¨A\n\tsetAFlag byte\n\t// æ“ä½œæ•°Bä½¿ç”¨ç±»å‹\n\targBMode byte\n\t//  æ“ä½œæ•°Cä½¿ç”¨ç±»å‹\n\targCMode byte\n\t// æ“ä½œæ¨¡å¼\n\topMode byte\n\tname   string\n}\n```\n\næ‰€æœ‰çš„æŒ‡ä»¤\n\n```\nvar opcodes = []opcode{\n\t//T A    B       C     mode  \t   name\n\t{0, 1, OpArgR, OpArgN, IABC, \"MOVE     \"},\n\t{0, 1, OpArgK, OpArgN, IABx, \"LOADK    \"},\n\t{0, 1, OpArgN, OpArgN, IABx, \"LOADKX  \"},\n\t{0, 1, OpArgU, OpArgU, IABC, \"LOADBOOL\"},\n\t{0, 1, OpArgU, OpArgN, IABC, \"LOADNIL \"},\n\t{0, 1, OpArgU, OpArgN, IABC, \"GETUPVAL\"},\n\t{0, 1, OpArgU, OpArgK, IABC, \"GETTABUP\"},\n\t{0, 1, OpArgR, OpArgK, IABC, \"GETTABLE\"},\n\t{0, 0, OpArgK, OpArgK, IABC, \"SETTABUP\"},\n\t{0, 0, OpArgU, OpArgN, IABC, \"SETUPVAL\"},\n\t{0, 0, OpArgK, OpArgK, IABC, \"SETTABLE\"},\n\t{0, 1, OpArgU, OpArgU, IABC, \"NEWTABLE\"},\n\t{0, 1, OpArgR, OpArgK, IABC, \"SELF     \"},\n\t{0, 1, OpArgK, OpArgK, IABC, \"ADD      \"},\n\t{0, 1, OpArgK, OpArgK, IABC, \"SUB      \"},\n\t{0, 1, OpArgK, OpArgK, IABC, \"MUL      \"},\n\t{0, 1, OpArgK, OpArgK, IABC, \"MOD      \"},\n\t{0, 1, OpArgK, OpArgK, IABC, \"POW      \"},\n\t{0, 1, OpArgK, OpArgK, IABC, \"DIV      \"},\n\t{0, 1, OpArgK, OpArgK, IABC, \"IDIV     \"},\n\t{0, 1, OpArgK, OpArgK, IABC, \"BAND     \"},\n\t{0, 1, OpArgK, OpArgK, IABC, \"BOR      \"},\n\t{0, 1, OpArgK, OpArgK, IABC, \"BXOR     \"},\n\t{0, 1, OpArgK, OpArgK, IABC, \"SHL      \"},\n\t{0, 1, OpArgK, OpArgK, IABC, \"SHR      \"},\n\t{0, 1, OpArgR, OpArgN, IABC, \"UNM      \"},\n\t{0, 1, OpArgR, OpArgN, IABC, \"BNOT     \"},\n\t{0, 1, OpArgR, OpArgN, IABC, \"NOT      \"},\n\t{0, 1, OpArgR, OpArgN, IABC, \"LEN      \"},\n\t{0, 1, OpArgR, OpArgR, IABC, \"CONCAT  \"},\n\t{0, 0, OpArgR, OpArgN, IAsBx, \"JMP      \"},\n\t{1, 0, OpArgK, OpArgK, IABC, \"EQ       \"},\n\t{1, 0, OpArgK, OpArgK, IABC, \"LT       \"},\n\t{1, 0, OpArgK, OpArgK, IABC, \"LE       \"},\n\t{1, 0, OpArgN, OpArgU, IABC, \"TEST     \"},\n\t{1, 1, OpArgR, OpArgU, IABC, \"TESTSET \"},\n\t{0, 1, OpArgU, OpArgU, IABC, \"CALL     \"},\n\t{0, 1, OpArgU, OpArgU, IABC, \"TAILCALL\"},\n\t{0, 0, OpArgU, OpArgN, IABC, \"RETURN  \"},\n\t{0, 1, OpArgR, OpArgN, IAsBx, \"FORLOOP \"},\n\t{0, 1, OpArgR, OpArgN, IAsBx, \"FORPREP \"},\n\t{0, 0, OpArgN, OpArgU, IABC, \"TFORCALL\"},\n\t{0, 1, OpArgR, OpArgN, IAsBx, \"TFORLOOP\"},\n\t{0, 0, OpArgU, OpArgU, IABC, \"SETLIST \"},\n\t{0, 1, OpArgU, OpArgN, IABx, \"CLOSURE \"},\n\t{0, 1, OpArgU, OpArgN, IABC, \"VARARG  \"},\n\t{0, 0, OpArgU, OpArgU, IAx, \"EXTRAARG\"},\n}\n\n```\n\n## æŒ‡ä»¤è§£ç \n\nå®šä¹‰ Instruction ç±»å‹è¡¨ç¤ºæŒ‡ä»¤ï¼Œå®šä¹‰äº”ä¸ªæ–¹æ³•ï¼Œç”¨äºè§£ç æŒ‡ä»¤\n\n\n```\nype Instruction uint32\n  \n\n// Opcode()æ–¹æ³•ä»æŒ‡ä»¤ä¸­æå–æ“ä½œF\nfunc (self Instruction) Opcode() int {\n// ABC()æ–¹æ³•ä»iABCæ¨¡å¼æŒ‡ä»¤ä¸­æå–å‚æ•°\nfunc (self Instruction) ABC() (a, b, c int) {\n// ABx()æ–¹æ³•ä»iABxæ¨¡å¼æŒ‡ä»¤ä¸­æå–å‚æ•°ï¼Œ\nfunc (self Instruction) ABx() (a, bx int) {\n// AsBx()æ–¹æ³•ä»iAsBxæ¨¡å¼æŒ‡ä»¤ä¸­æå–å‚æ•°\nfunc (self Instruction) AsBx() (a, sbx int) {\n// Ax()æ–¹æ³•ä»iAxæ¨¡å¼æŒ‡ä»¤ä¸­æå–å‚æ•°\nfunc (self Instruction) Ax() int{\n```\n\n\nPcode ()ã€ABC ()ã€ABx ()ã€Ax ()è¿™ 4 ä¸ªæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œåªä½¿ç”¨ä½ç§»å’Œé€»è¾‘ä¸è¿ç®—ç¬¦ä»æŒ‡ä»¤ä¸­æå–ä¿¡æ¯\n\n\nSBx æ“ä½œæ•°ï¼ˆå…± 18 ä¸ªæ¯”ç‰¹ï¼‰è¡¨ç¤ºçš„æ˜¯**æœ‰ç¬¦å·æ•´æ•°**ã€‚æœ‰å¾ˆå¤šç§æ–¹å¼å¯ä»¥æŠŠæœ‰ç¬¦å·æ•´æ•°ç¼–ç æˆæ¯”ç‰¹åºåˆ—ï¼Œæ¯”å¦‚ **2 çš„è¡¥ç **ï¼ˆTwo's Complementï¼‰ç­‰ã€‚Lua è™šæ‹Ÿæœºè¿™é‡Œé‡‡ç”¨äº†ä¸€ç§å«ä½œ**åç§»äºŒè¿›åˆ¶ç ï¼ˆOffset Binaryï¼Œä¹Ÿå«ä½œ Excess-Kï¼‰çš„ç¼–ç æ¨¡å¼ã€‚**\n\n\u003e **åç§»äºŒè¿›åˆ¶ç ï¼ˆOffset Binaryï¼Œä¹Ÿå«ä½œ Excess-Kï¼‰\n\u003e å¦‚æœæŠŠ sBx è§£é‡Šæˆæ— ç¬¦å·æ•´æ•°æ—¶å®ƒçš„å€¼æ˜¯ xï¼Œé‚£ä¹ˆè§£é‡Šæˆæœ‰ç¬¦å·æ•´æ•°æ—¶å®ƒçš„å€¼å°±æ˜¯ x-Kã€‚é‚£ä¹ˆ K æ˜¯ä»€ä¹ˆå‘¢ï¼ŸK å– sBx æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§æ— ç¬¦å·æ•´æ•°å€¼çš„ä¸€åŠã€‚ä¹Ÿå°±æ˜¯ä¸Šé¢ä»£ç ä¸­çš„ MAXARG_sBx\n\n\n\n```\nconst MAXARG_Bx = 1\u003c\u003c18-1 // 2^18-1 = 262143 const MAXARG_sBx = MAXARG_Bx \u003e\u003e 1 // 262143 / 2 = 131071\n```\n","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/lua/%E7%94%A8Go%E5%AE%9E%E7%8E%B0Lua/3.lua-API":{"title":"3.lua API","content":"\nLua æ ¸å¿ƒæ˜¯ä»¥åº“ï¼ˆLibraryï¼‰çš„å½¢å¼è¢«å®ç°çš„ï¼Œå…¶ä»–åº”ç”¨ç¨‹åºåªéœ€è¦é“¾æ¥ Lua åº“å°±å¯ä»¥ä½¿ç”¨ Lua æä¾›çš„ API è½»æ¾è·å¾—è„šæœ¬æ‰§è¡Œèƒ½åŠ›\n\n\u003e  Lua å‘å¸ƒç‰ˆåŒ…å«çš„ä¸¤ä¸ªå‘½ä»¤è¡Œç¨‹åºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å·²ç»å¾ˆç†Ÿæ‚‰çš„ lua å’Œ luacï¼Œå®é™…ä¸Šå°±æ˜¯ Lua åº“çš„ä¸¤ä¸ªç‰¹æ®Šçš„å®¿ä¸»ç¨‹åºã€‚\n\n\n# Lua API ä»‹ç»\n\nå®˜æ–¹ Lua ä½¿ç”¨ Clean Cï¼ˆå…¶è¯­æ³•æ˜¯ C å’Œ C++è¯­è¨€çš„å­é›†ï¼‰ç¼–å†™ï¼ŒLua API ä¸»è¦æ˜¯æŒ‡ä¸€ç³»åˆ—ä»¥â€œlua_â€å¼€å¤´çš„ C è¯­è¨€å‡½æ•°ï¼ˆä¹Ÿå¯èƒ½æ˜¯å®å®šä¹‰ï¼Œåæ–‡ç»Ÿç§°ä¸ºå‡½æ•°ï¼‰ã€‚\n\n\n**Lua state çš„å‘å±•**\n\n1. æœ€å¼€å§‹ Lua è§£é‡Šå™¨çš„çŠ¶æ€æ˜¯å®Œå…¨éšè—åœ¨ API åé¢çš„ï¼Œæ•£è½åœ¨å„ç§å…¨å±€å˜é‡é‡Œã€‚\n\n2. ç”±äºæŸäº›å®¿ä¸»ç¯å¢ƒï¼ˆæ¯”å¦‚ Web æœåŠ¡å™¨ï¼‰éœ€è¦åŒæ—¶ä½¿ç”¨å¤šä¸ª Lua è§£é‡Šå™¨å®ä¾‹ Lua 3.1 å¼•å…¥äº† lua_State ç»“æ„ä½“ï¼Œå¯¹è§£é‡Šå™¨çŠ¶æ€è¿›è¡Œäº†å°è£…ï¼Œä»è€Œä½¿å¾—ç”¨æˆ·å¯ä»¥åœ¨å¤šä¸ªè§£é‡Šå™¨å®ä¾‹ä¹‹é—´åˆ‡æ¢ã€‚\n\n3. Lua 4.0 å¯¹ API è¿›è¡Œäº†é‡æ–°è®¾è®¡ï¼Œå¼•å…¥äº†è™šæ‹Ÿæ ˆçš„æ¦‚å¿µï¼Œå¹¶ä¸”è®© lua_State ç»“æ„ä½“ä»å¹•åèµ°åˆ°äº†å‰å°ã€‚\n\n4. ç”¨æˆ·ä½¿ç”¨ lua_newstate ()å‡½æ•°åˆ›å»º lua_State å®ä¾‹ï¼Œå…¶ä»–å‡½æ•°åˆ™ç”¨äºæ“ä½œ lua_State å®ä¾‹ã€‚\n\n\nLua APIã€Lua State ä»¥åŠå®¿ä¸»ç¨‹åºä¹‹é—´çš„å…³ç³»å¦‚å›¾ 4-1 æ‰€ç¤º\n\n![](statistic/Pasted%20image%2020230806021610.png)\n\nLua State æ˜¯ Lua API éå¸¸æ ¸å¿ƒçš„ä¸€ä¸ªæ¦‚å¿µï¼Œåœ¨æœ¬ç« ï¼Œæˆ‘ä»¬æš‚æ—¶å…ˆæŠŠ **Lua State ç†è§£æˆä¸€ä¸ªä¸é‚£ä¹ˆçº¯ç²¹çš„æ ˆï¼ˆStack )**, ä¹‹æ‰€ä»¥ä¸å¤Ÿçº¯ç²¹ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªæ ˆä¹Ÿå¯ä»¥é€šè¿‡ç´¢å¼•ç›´æ¥è¿›è¡Œè®¿é—®\n\n\n## Lua æ ˆ\n\n\nLua State æ˜¯ Lua API éå¸¸æ ¸å¿ƒçš„æ¦‚å¿µï¼Œå…¨éƒ¨çš„ API å‡½æ•°éƒ½æ˜¯å›´ç»• Lua State è¿›è¡Œæ“ä½œï¼Œè€Œ Lua State å†…éƒ¨å°è£…çš„æœ€ä¸ºåŸºç¡€çš„ä¸€ä¸ªçŠ¶æ€å°±æ˜¯**è™šæ‹Ÿæ ˆï¼ˆåé¢æˆ‘ä»¬ç§°å…¶ä¸º Lua æ ˆ**ï¼‰\n\n\n\nLua æ ˆæ˜¯å®¿ä¸»è¯­è¨€ï¼ˆå¯¹äºå®˜æ–¹ Lua æ¥è¯´æ˜¯ C è¯­è¨€ï¼Œæœ¬æ¬¡æ˜¯Go è¯­è¨€ï¼‰å’Œ Lua è¯­è¨€è¿›è¡Œæ²Ÿé€šçš„æ¡¥æ¢ï¼ŒLua API å‡½æ•°æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯ä¸“é—¨ç”¨æ¥æ“ä½œ Lua æ ˆçš„ã€‚å®¿ä¸»è¯­è¨€ã€Lua è¯­è¨€ã€Lua æ ˆä¹‹é—´çš„å…³ç³»å¦‚å›¾4-2æ‰€ç¤ºã€‚\n\n![](statistic/Pasted%20image%2020230806022038.png)","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/lua/Lua%E9%AB%98%E7%BA%A7":{"title":"Luaé«˜çº§","content":"\n# å…ƒè¡¨\n\nå…ƒè¡¨ _(metatable)_ çš„**è¡¨ç°è¡Œä¸ºç±»ä¼¼äº C++ è¯­è¨€ä¸­çš„æ“ä½œç¬¦é‡è½½**ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é‡è½½ \"__add\" å…ƒæ–¹æ³• _(metamethod)_ï¼Œæ¥è®¡ç®—ä¸¤ä¸ª Lua æ•°ç»„çš„å¹¶é›†ï¼›æˆ–è€…é‡è½½ \"__index\" æ–¹æ³•ï¼Œæ¥å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„ Hash å‡½æ•°ã€‚Lua æä¾›äº†ä¸¤ä¸ªååˆ†é‡è¦çš„ç”¨æ¥å¤„ç†å…ƒè¡¨çš„æ–¹æ³•\n\n- setmetatable(table, metatable)ï¼šæ­¤æ–¹æ³•ç”¨äºä¸ºä¸€ä¸ªè¡¨è®¾ç½®å…ƒè¡¨ã€‚\n    \n- getmetatable(table)ï¼šæ­¤æ–¹æ³•ç”¨äºè·å–è¡¨çš„å…ƒè¡¨å¯¹è±¡\n    \n\nè®¾ç½®å…ƒè¡¨\n\n```Lua\nlocal mytable = {}\nlocal mymetatable = {}\nsetmetatable(mytable, mymetatable)\n```\n\n  \n\n## **ä¿®æ”¹è¡¨çš„æ“ä½œç¬¦è¡Œä¸º**\n\n  \n\né€šè¿‡é‡è½½ \"__add\" å…ƒæ–¹æ³•æ¥è®¡ç®—é›†åˆçš„å¹¶é›†å®ä¾‹\n\n```Lua\nlocal set1 = {10, 20, 30}   -- é›†åˆ\nlocal set2 = {20, 40, 50}   -- é›†åˆ\n\n-- å°†ç”¨äºé‡è½½__addçš„å‡½æ•°ï¼Œæ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯self\nlocal union = function (self, another)\n    local set = {}\n    local result = {}\n\n    -- åˆ©ç”¨æ•°ç»„æ¥ç¡®ä¿é›†åˆçš„äº’å¼‚æ€§\n    for i, j in pairs(self) do set[j] = true end\n    for i, j in pairs(another) do set[j] = true end\n\n    -- åŠ å…¥ç»“æœé›†åˆ\n    for i, j in pairs(set) do table.insert(result, i) end\n    return result\nend\nsetmetatable(set1, {__add = union}) -- é‡è½½ set1 è¡¨çš„ __add å…ƒæ–¹æ³•\n\nlocal set3 = set1 + set2\nfor _, j in pairs(set3) do\n    io.write(j..\" \")               --\u003eoutputï¼š30 50 20 40 10\nend\n```\n\né™¤äº†åŠ æ³•å¯ä»¥è¢«é‡è½½ä¹‹å¤–ï¼ŒLua æä¾›çš„æ‰€æœ‰æ“ä½œç¬¦éƒ½å¯ä»¥è¢«é‡è½½ï¼š\n| å…ƒæ–¹æ³•        | å«ä¹‰                                                                         |\n|------------|----------------------------------------------------------------------------|\n| \"__add    | #NAME?                                                                     |\n| \"__sub   | - æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº \"add\" æ“ä½œ                                                       |\n| \"__mul    | * æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº \"add\" æ“ä½œ                                                       |\n| \"__div   | / æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº \"add\" æ“ä½œ                                                       |\n| \"__mod   | % æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº \"add\" æ“ä½œ                                                       |\n| \"__pow    | ^ ï¼ˆå¹‚ï¼‰æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº \"add\" æ“ä½œ                                                    |\n| \"__unm\"   | ä¸€å…ƒ - æ“ä½œ                                                                    |\n| \"__concat\" | .. ï¼ˆå­—ç¬¦ä¸²è¿æ¥ï¼‰æ“ä½œ                                                               |\n| \"__len\"    | # æ“ä½œ                                                                       |\n| \"__eq\"     | == æ“ä½œ å‡½æ•° getcomphandler å®šä¹‰äº† Lua æ€æ ·é€‰æ‹©ä¸€ä¸ªå¤„ç†å™¨æ¥ä½œæ¯”è¾ƒæ“ä½œ ä»…åœ¨ä¸¤ä¸ªå¯¹è±¡ç±»å‹ç›¸åŒä¸”æœ‰å¯¹åº”æ“ä½œç›¸åŒçš„å…ƒæ–¹æ³•æ—¶æ‰èµ·æ•ˆ |\n| \"__lt\"     | \u003c æ“ä½œ                                                                       |\n| \"__le\"     | \u003c= æ“ä½œ                                                                      |\n\n\né™¤äº†æ“ä½œç¬¦ä¹‹å¤–ï¼Œå¦‚ä¸‹å…ƒæ–¹æ³•ä¹Ÿå¯ä»¥è¢«é‡è½½ï¼Œä¸‹é¢ä¼šä¾æ¬¡è§£é‡Šä½¿ç”¨æ–¹æ³•ï¼š\n\n|   |   |\n|---|---|\n|å…ƒæ–¹æ³•|å«ä¹‰|\n|\"__index\"|å–ä¸‹æ ‡æ“ä½œç”¨äºè®¿é—® table[key]|\n|\"__newindex\"|èµ‹å€¼ç»™æŒ‡å®šä¸‹æ ‡ table[key] = value|\n|\"__tostring\"|è½¬æ¢æˆå­—ç¬¦ä¸²|\n|\"__call\"|å½“ Lua è°ƒç”¨ä¸€ä¸ªå€¼æ—¶è°ƒç”¨|\n|\"__mode\"|ç”¨äºå¼±è¡¨(week table)|\n|\"__metatable\"|ç”¨äºä¿æŠ¤metatableä¸è¢«è®¿é—®|\n\n## **__index å…ƒæ–¹æ³•**\n\n```Lua\nmytable = setmetatable({key1 = \"value1\"},   --åŸå§‹è¡¨\n{__index = function(self, key)            --é‡è½½å‡½æ•°\n    if key == \"key2\" then\n        return \"metatablevalue\"\n    end\nend\n})\n\nprint(mytable.key1,mytable.key2)  --\u003e outputï¼švalue1 metatablevalue\n```\n\nå…³äº __index å…ƒæ–¹æ³•ï¼Œæœ‰å¾ˆå¤šæ¯”è¾ƒé«˜é˜¶çš„æŠ€å·§ï¼Œä¾‹å¦‚ï¼š__index çš„å…ƒæ–¹æ³•ä¸éœ€è¦éæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä»–ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¡¨ã€‚\n\n```Lua\nt = setmetatable({[1] = \"hello\"}, {__index = {[2] = \"world\"}})\nprint(t[1], t[2])   --\u003ehello wor\n```\n\n## **__tostring å…ƒæ–¹æ³•**\n\n  \n\nä¸ Java ä¸­çš„ toString() å‡½æ•°ç±»ä¼¼ï¼Œå¯ä»¥å®ç°è‡ªå®šä¹‰çš„å­—ç¬¦ä¸²è½¬æ¢ã€‚\n\n```Lua\narr = {1, 2, 3, 4}\narr = setmetatable(arr, {__tostring = function (self)\n    local result = '{'\n    local sep = ''\n    for _, i in pairs(self) do\n        result = result ..sep .. i\n        sep = ', '\n    end\n    result = result .. '}'\n    return result\nend})\nprint(arr)  --\u003e {1, 2, 3, 4}\n```\n\n## **__call å…ƒæ–¹æ³•**\n\n__call å…ƒæ–¹æ³•çš„åŠŸèƒ½ç±»ä¼¼äº C++ ä¸­çš„ä»¿å‡½æ•°ï¼Œä½¿å¾—æ™®é€šçš„è¡¨ä¹Ÿå¯ä»¥è¢«è°ƒç”¨ã€‚\n\n  \n\n```Lua\nfunctor = {}\nfunction func1(self, arg)\n    print (\"called from\", arg)\nend\nsetmetatable(functor, {__call = func1})\n\nfunctor(\"functor\")  --\u003e called from functor\nprint(functor)      --\u003e outputï¼š0x00076fc8 ï¼ˆåé¢è¿™ä¸²æ•°å­—å¯èƒ½ä¸ä¸€æ ·ï¼‰\n```\n\n## **__metatable å…ƒæ–¹æ³•**\n\nå‡å¦‚æˆ‘ä»¬æƒ³ä¿æŠ¤æˆ‘ä»¬çš„å¯¹è±¡ä½¿å…¶ä½¿ç”¨è€…æ—¢çœ‹ä¸åˆ°ä¹Ÿä¸èƒ½ä¿®æ”¹ metatablesã€‚æˆ‘**ä»¬å¯ä»¥å¯¹ metatable è®¾ç½®äº† __metatable çš„å€¼ï¼Œgetmetatable å°†è¿”å›è¿™ä¸ªåŸŸçš„å€¼ï¼Œè€Œè°ƒç”¨ setmetatable å°†ä¼šå‡ºé”™**ï¼š\n\n```Lua\nbject = setmetatable({}, {__metatable = \"You cannot access here\"})\n\nprint(getmetatable(Object)) --\u003e You cannot access heresetmetatable(Object, {})    --\u003e å¼•å‘ç¼–è¯‘å™¨æŠ¥é”™\n```\n\n  \n\n# é¢å‘å¯¹è±¡\n\n## ç±»\n\nåœ¨ Lua ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¡¨å’Œå‡½æ•°å®ç°é¢å‘å¯¹è±¡ã€‚**å°†å‡½æ•°å’Œç›¸å…³çš„æ•°æ®æ”¾ç½®äºåŒä¸€ä¸ªè¡¨ä¸­å°±å½¢æˆäº†ä¸€ä¸ªå¯¹è±¡ã€‚**\n\n```Plaintext\nlocal _M = {}\n\nlocal mt = { __index = _M }\n\nfunction _M.deposit (self, v)\n    self.balance = self.balance + v\nend\n\nfunction _M.withdraw (self, v)\n    if self.balance \u003e v then\n        self.balance = self.balance - v\n    else\n        error(\"insufficient funds\")\n    end\nend\n\nfunction _M.new (self, balance)\n    balance = balance or 0\n    return setmetatable({balance = balance}, mt)\nend\n\nreturn _M\n```\n\nå¼•ç”¨\n\n```Lua\nlocal account = require(\"account\")\n\nlocal a = account:new()\na:deposit(100)\n\nlocal b = account:new()\nb:deposit(50)\n\nprint(a.balance)  --\u003e output: 100\nprint(b.balance)  --\u003e output: 50\n```\n\nä¸Šé¢è¿™æ®µä»£ç  \"setmetatable({balance = balance}, mt)\"ï¼Œå…¶ä¸­ mt ä»£è¡¨ `{ __index = _M }` ï¼Œè¿™å¥è¯å€¼å¾—æ³¨æ„ã€‚æ ¹æ®æˆ‘ä»¬åœ¨å…ƒè¡¨è¿™ä¸€ç« å­¦åˆ°çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬æ˜ç™½ï¼Œsetmetatable å°† `_M` ä½œä¸ºæ–°å»ºè¡¨çš„åŸå‹ï¼Œæ‰€ä»¥åœ¨è‡ªå·±çš„è¡¨å†…æ‰¾ä¸åˆ° 'deposit'ã€'withdraw' è¿™äº›æ–¹æ³•å’Œå˜é‡çš„æ—¶å€™ï¼Œä¾¿ä¼šåˆ° __index æ‰€æŒ‡å®šçš„ _M ç±»å‹ä¸­å»å¯»æ‰¾ã€‚\n\n  \n\n## ç»§æ‰¿\n\nç»§æ‰¿å¯ä»¥ç”¨å…ƒè¡¨å®ç°ï¼Œå®ƒæä¾›äº†åœ¨çˆ¶ç±»ä¸­æŸ¥æ‰¾å­˜åœ¨çš„æ–¹æ³•å’Œå˜é‡çš„æœºåˆ¶ã€‚åœ¨ Lua ä¸­æ˜¯ä¸æ¨èä½¿ç”¨ç»§æ‰¿æ–¹å¼å®Œæˆæ„é€ çš„ï¼Œè¿™æ ·åšå¼•å…¥çš„é—®é¢˜å¯èƒ½æ¯”è§£å†³çš„é—®é¢˜è¦å¤šï¼Œä¸‹é¢ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²æ“ä½œç±»åº“ï¼Œç»™å¤§å®¶æ¼”ç¤ºä¸€ä¸‹ã€‚\n\n```Lua\n---------- s_base.lualocal _M = {}\n\nlocal mt = { __index = _M }\n\nfunction _M.upper (s)return string.upper(s)\nendreturn _M\n\n---------- s_more.lualocal s_base = require(\"s_base\")\n\nlocal _M = {}\n_M = setmetatable(_M, { __index = s_base })\n\n\nfunction _M.lower (s)return string.lower(s)\nendreturn _M\n\n---------- test.lualocal s_more = require(\"s_more\")\n\nprint(s_more.upper(\"Hello\"))   -- output: HELLOprint(s_more.lower(\"Hello\"))   -- output: hello\n```\n\n  \n\n## æˆå‘˜ç§æœ‰æ€§\n\nåœ¨åŠ¨æ€è¯­è¨€ä¸­å¼•å…¥æˆå‘˜ç§æœ‰æ€§å¹¶æ²¡æœ‰å¤ªå¤§çš„å¿…è¦ï¼Œåè€Œä¼šæ˜¾è‘—å¢åŠ è¿è¡Œæ—¶çš„å¼€é”€ï¼Œæ¯•ç«Ÿè¿™ç§æ£€æŸ¥æ— æ³•åƒè®¸å¤šé™æ€è¯­è¨€é‚£æ ·åœ¨ç¼–è¯‘æœŸå®Œæˆã€‚ä¸‹é¢çš„æŠ€å·§æŠŠå¯¹è±¡ä½œä¸ºå„æ–¹æ³•çš„ upvalueï¼Œæœ¬èº«æ˜¯å¾ˆå·§å¦™çš„ï¼Œä½†ä¼šè®©å­ç±»ç»§æ‰¿å˜å¾—å›°éš¾ï¼ŒåŒæ—¶æ„é€ å‡½æ•°åŠ¨æ€åˆ›å»ºäº†å‡½æ•°ï¼Œä¼šå¯¼è‡´æ„é€ å‡½æ•°æ— æ³•è¢« JIT ç¼–è¯‘ã€‚\n\nåœ¨ Lua ä¸­ï¼Œæˆå‘˜çš„ç§æœ‰æ€§ï¼Œä½¿ç”¨ç±»ä¼¼äºå‡½æ•°é—­åŒ…çš„å½¢å¼æ¥å®ç°ã€‚åœ¨æˆ‘ä»¬ä¹‹å‰çš„é“¶è¡Œè´¦æˆ·çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå·¥å‚æ–¹æ³•æ¥åˆ›å»ºæ–°çš„è´¦æˆ·å®ä¾‹ï¼Œé€šè¿‡å·¥å‚æ–¹æ³•å¯¹å¤–æä¾›çš„é—­åŒ…æ¥æš´éœ²å¯¹å¤–æ¥å£ã€‚è€Œä¸æƒ³æš´éœ²åœ¨å¤–çš„ä¾‹å¦‚ balance æˆå‘˜å˜é‡ï¼Œåˆ™è¢«å¾ˆå¥½çš„éšè—èµ·æ¥ã€‚\n\n```Lua\nfunction newAccount (initialBalance)\n    local self = {balance = initialBalance}\n    local withdraw = function (v)\n        self.balance = self.balance - v\n    end\n    local deposit = function (v)\n        self.balance = self.balance + v\n    end\n    local getBalance = function () \n        return self.balance \n    end\n    \n    return {\n        withdraw = withdraw,\n        deposit = deposit,\n        getBalance = getBalance\n    }\nend\n\na = newAccount(100)\na.deposit(100)\nprint(a.getBalance()) --\u003e 200print(a.balance)      --\u003e nil\n```\n\n  \n\n# å±€éƒ¨å˜é‡\n\nLua çš„è®¾è®¡æœ‰ä¸€ç‚¹å¾ˆå¥‡æ€ªï¼Œ**åœ¨ä¸€ä¸ª block ä¸­çš„å˜é‡ï¼Œå¦‚æœä¹‹å‰æ²¡æœ‰å®šä¹‰è¿‡ï¼Œé‚£ä¹ˆè®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡**ï¼Œ**è€Œä¸æ˜¯è¿™ä¸ª block çš„å±€éƒ¨å˜é‡**ã€‚è¿™ä¸€ç‚¹å’Œåˆ«çš„è¯­è¨€ä¸åŒã€‚**å®¹æ˜“é€ æˆä¸å°å¿ƒè¦†ç›–äº†å…¨å±€åŒåå˜é‡çš„é”™è¯¯**ã€‚\n\n## **å®šä¹‰**\n\nLua ä¸­çš„å±€éƒ¨å˜é‡è¦ç”¨ local å…³é”®å­—æ¥æ˜¾å¼å®šä¹‰ï¼Œä¸ä½¿ç”¨ local æ˜¾å¼å®šä¹‰çš„å˜é‡å°±æ˜¯å…¨å±€å˜é‡\n\n```Lua\ng_var = 1         -- global var\nlocal l_var = 2   -- local var\n```\n\n## **ä½œç”¨åŸŸ**\n\n**å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æœ‰é™çš„ï¼Œå®ƒçš„ä½œç”¨åŸŸä»…é™äºå£°æ˜å®ƒçš„å—ï¼ˆblockï¼‰**ã€‚ä¸€ä¸ªå—æ˜¯ä¸€ä¸ªæ§åˆ¶ç»“æ„çš„æ‰§è¡Œä½“ã€æˆ–è€…æ˜¯ä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œä½“å†æˆ–è€…æ˜¯ä¸€ä¸ªç¨‹åºå—ï¼ˆchunkï¼‰ã€‚\n\n```Lua\nx = 10\nlocal i = 1         -- ç¨‹åºå—ä¸­çš„å±€éƒ¨å˜é‡ i\n\nwhile i \u003c=x do\n    local x = i * 2   -- while å¾ªç¯ä½“ä¸­çš„å±€éƒ¨å˜é‡ x\n    print(x)          -- outputï¼š 2, 4, 6, 8, ...\n    i = i + 1\nend\n\nif i \u003e 20 then\n    local x           -- then ä¸­çš„å±€éƒ¨å˜é‡ x\n    x = 20\n    print(x + 2)      -- å¦‚æœi \u003e 20 å°†ä¼šæ‰“å° 22ï¼Œæ­¤å¤„çš„ x æ˜¯å±€éƒ¨å˜é‡\nelse\n    print(x)          -- æ‰“å° 10ï¼Œè¿™é‡Œ x æ˜¯å…¨å±€å˜é‡\nend\n\nprint(x)            -- æ‰“å° 10\n```\n\n  \n\n## ä½¿ç”¨å±€éƒ¨å˜é‡çš„å¥½å¤„\n\n  \n\n1. å±€éƒ¨å˜é‡å¯ä»¥é¿å…å› ä¸ºå‘½åé—®é¢˜æ±¡æŸ“äº†å…¨å±€ç¯å¢ƒ\n    \n2. local å˜é‡çš„è®¿é—®æ¯”å…¨å±€å˜é‡æ›´å¿«\n    \n3. ç”±äºå±€éƒ¨å˜é‡å‡ºäº†ä½œç”¨åŸŸä¹‹åç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œè¿™æ ·å¯ä»¥è¢«åƒåœ¾å›æ”¶å™¨åŠæ—¶é‡Šæ”¾\n    \n\n  \n\n  \n\n## æ£€æµ‹æ¨¡å—çš„å‡½æ•°ä½¿ç”¨å±€éƒ¨å˜é‡\n\nfoo.lua\n\n```Lua\nlocal _M = { _VERSION = '0.01' }\n\nfunction _M.add(a, b)     --ä¸¤ä¸ªnumberå‹å˜é‡ç›¸åŠ \n    return a + b\nend\n\nfunction _M.update_A()    --æ›´æ–°å˜é‡å€¼\n    A = 365               -- A æ˜¯å…¨å±€å˜é‡\nend\n\nreturn _M\n```\n\nuse_foo.lua\n\n```Lua\nA = 360     --å®šä¹‰å…¨å±€å˜é‡\n\nlocal foo = require(\"foo\")\n\nlocal b = foo.add(A, A)\nprint(\"b = \", b)\n\nfoo.update_A()\nprint(\"A = \", A)\n```\n\nå› ä¸ºA æ˜¯å…¨å±€å˜é‡ï¼Œæ”¹å˜äº†Açš„å€¼\n\nLua ä¸Šä¸‹æ–‡ä¸­åº”å½“ä¸¥æ ¼é¿å…ä½¿ç”¨è‡ªå·±å®šä¹‰çš„å…¨å±€å˜é‡ã€‚**å¯ä»¥ä½¿ç”¨ä¸€ä¸ª lj-releng å·¥å…·æ¥æ‰«æ Lua ä»£ç ï¼Œå®šä½ä½¿ç”¨ Lua å…¨å±€å˜é‡çš„åœ°æ–¹**ã€‚lj-releng çš„ç›¸å…³é“¾æ¥ï¼š[https://github.com/openresty/openresty-devel-utils/blob/master/lj-releng](https://github.com/openresty/openresty-devel-utils/blob/master/lj-releng)\n\nWindows ç”¨æˆ·æŠŠ lj-releng æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•çš„ç»å¯¹è·¯å¾„æ·»åŠ è¿› PATH ç¯å¢ƒå˜é‡ã€‚ç„¶åè¿›å…¥ä½ è‡ªå·±çš„ Lua æ–‡ä»¶æ‰€åœ¨çš„å·¥ä½œç›®å½•ï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š\n\n```Lua\n#  lj-releng\nfoo.lua: 0.01 (0.01)\nChecking use of Lua global variables in file foo.lua...\nop no.  line  instruction args  ; code\n2  [8] SETGLOBAL 0 -1  ; A\nChecking line length exceeding 80...\nWARNING: No \"_VERSION\" or \"version\" field found in `use_foo.lua`.\nChecking use of Lua global variables in file use_foo.lua...\nop no.  line  instruction args  ; code\n2  [1] SETGLOBAL 0 -1  ; A\n7  [4] GETGLOBAL 2 -1  ; A\n8  [4] GETGLOBAL 3 -1  ; A\n18 [8] GETGLOBAL 4 -1  ; A\n```\n\nå½“ç„¶ï¼Œæ›´æ¨èé‡‡ç”¨ **luacheck æ¥æ£€æŸ¥é¡¹ç›®ä¸­å…¨å±€å˜é‡ï¼Œä¹‹åçš„â€œä»£ç é™æ€åˆ†æâ€ä¸€èŠ‚ï¼Œæˆ‘ä»¬è¿˜ä¼šè®²åˆ°å¦‚ä½•ä½¿ç”¨ luacheck**ã€‚\n\n  \n\n# åˆ¤æ–­æ•°ç»„çš„å¤§å°\n\n- table.getn(t) ç­‰ä»·äº t ä½†**è®¡ç®—çš„æ˜¯æ•°ç»„å…ƒç´ ï¼Œä¸åŒ…æ‹¬ hash é”®å€¼**ã€‚è€Œä¸”æ•°ç»„æ˜¯ä»¥ç¬¬ä¸€ä¸ª nil å…ƒç´ æ¥åˆ¤æ–­æ•°ç»„ç»“æŸã€‚\n    \n- `#` åªè®¡ç®— array çš„å…ƒç´ ä¸ªæ•°ï¼Œå®ƒå®é™…ä¸Šè°ƒç”¨äº†å¯¹è±¡çš„ metatable çš„ `__len` å‡½æ•°ã€‚å¯¹äºæœ‰ `__len` æ–¹æ³•çš„å‡½æ•°è¿”å›å‡½æ•°è¿”å›å€¼ï¼Œä¸ç„¶å°±è¿”å›æ•°ç»„æˆå‘˜æ•°ç›®\n    \n- _Lua_ å†…éƒ¨å®é™…é‡‡ç”¨å“ˆå¸Œè¡¨å’Œæ•°ç»„åˆ†åˆ«ä¿å­˜é”®å€¼å¯¹ã€æ™®é€šå€¼ï¼Œæ‰€ä»¥ä¸æ¨èæ··åˆä½¿ç”¨è¿™ä¸¤ç§èµ‹å€¼æ–¹å¼ã€‚\n    \n- Lua æ•°ç»„ä¸­å…è®¸ nil å€¼çš„å­˜åœ¨ï¼Œä½†æ˜¯æ•°ç»„é»˜è®¤ç»“æŸæ ‡å¿—å´æ˜¯ nilã€‚è¿™ç±»æ¯”äº C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¸­å…è®¸ '\\0' å­˜åœ¨ï¼Œä½†å½“è¯»åˆ° '\\0' æ—¶ï¼Œå°±è®¤ä¸ºå­—ç¬¦ä¸²å·²ç»ç»“æŸäº†ã€‚\n    \n- åˆå§‹åŒ–æ˜¯ä¾‹å¤–ï¼Œåœ¨ Lua ç›¸å…³æºç ä¸­ï¼Œåˆå§‹åŒ–æ•°ç»„æ—¶é¦–å…ˆåˆ¤æ–­æ•°ç»„çš„é•¿åº¦ï¼Œè‹¥é•¿åº¦å¤§äº 0 ï¼Œå¹¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸ä¸º nilï¼Œè¿”å›åŒ…æ‹¬ nil çš„é•¿åº¦ï¼›è‹¥æœ€åä¸€ä¸ªå€¼ä¸º nilï¼Œåˆ™è¿”å›æˆªè‡³ç¬¬ä¸€ä¸ªé nil å€¼çš„é•¿åº¦ã€‚\n    \n- **å¦‚æœä½ è¦åˆ é™¤ä¸€ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ ï¼Œè¯·ä½¿ç”¨ remove å‡½æ•°ï¼Œè€Œä¸æ˜¯ç”¨ nil èµ‹å€¼**\n    \n\n```Lua\n-- test.lua\nlocal tblTest1 = { 1, a = 2, 3 }\nprint(\"Test1 \" .. #(tblTest1))\n\nlocal tblTest2 = { 1, nil }\nprint(\"Test2 \" .. #(tblTest2))\n\nlocal tblTest3 = { 1, nil, 2 }\nprint(\"Test3 \" .. #(tblTest3))\n\nlocal tblTest4 = { 1, nil, 2, nil }\nprint(\"Test4 \" .. #(tblTest4))\n\nlocal tblTest5 = { 1, nil, 2, nil, 3, nil }\nprint(\"Test5 \" .. #(tblTest5))\n\nlocal tblTest6 = { 1, nil, 2, nil, 3, nil, 4, nil }\nprint(\"Test6 \" .. #(tblTest6))\n```\n\næˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨ Lua å’Œ LuaJIT æ¥æ‰§è¡Œä¸€ä¸‹ï¼š\n\n```Lua\nâœ luajit test.lua\nTest1 2\nTest2 1\nTest3 1\nTest4 1\nTest5 1\nTest6 1\n\nâœ lua test.lua\nTest1 2\nTest2 1\nTest3 3\nTest4 1\nTest5 3\nTest6 1\n```\n\nè¿™ä¸€æ®µçš„è¾“å‡ºç»“æœï¼Œå°±æ˜¯è¿™ä¹ˆ **åŒªå¤·æ‰€æ€**ã€‚ä¸è¦åœ¨ Lua çš„ table ä¸­ä½¿ç”¨ nil å€¼ï¼Œ**å¦‚æœä¸€ä¸ªå…ƒç´ è¦åˆ é™¤ï¼Œç›´æ¥ removeï¼Œä¸è¦ç”¨ nil å»ä»£æ›¿**ã€‚\n\n  \n\n# éç©ºåˆ¤æ–­\n\n  \n\næœ‰æ—¶å€™ä¸å°å¿ƒå¼•ç”¨äº†ä¸€ä¸ªæ²¡æœ‰èµ‹å€¼çš„å˜é‡ï¼Œè¿™æ—¶å®ƒçš„å€¼é»˜è®¤ä¸º nilã€‚å¦‚æœå¯¹ä¸€ä¸ª nil è¿›è¡Œç´¢å¼•çš„è¯ï¼Œä¼šå¯¼è‡´å¼‚å¸¸ã€‚\n\n```Plaintext\nlocal person = {name = \"Bob\", sex = \"M\"}\n\n-- do something\nperson = nil\n-- do something\nprint(person.name)\n```\n\nä¼šæŠ¥é”™\n\n```Lua\nstdin:1:attempt to index global 'person' (a nil value)\nstack traceback:\n   stdin:1: in main chunk\n   [C]: ?\n```\n\nåœ¨å®é™…çš„å·¥ç¨‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¾ˆéš¾è¿™ä¹ˆè½»æ˜“åœ°å‘ç°æˆ‘ä»¬å¼•ç”¨äº† nil å˜é‡ã€‚å› æ­¤ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬åœ¨è®¿é—®ä¸€äº› table å‹å˜é‡æ—¶ï¼Œéœ€è¦å…ˆåˆ¤æ–­è¯¥å˜é‡æ˜¯å¦ä¸º nilï¼Œä¾‹å¦‚å°†ä¸Šé¢çš„ä»£ç æ”¹æˆ\n\n```Lua\nlocal person = {name = \"Bob\", sex = \"M\"}\n\n-- do something\nperson = nil\n-- do something\nif person ~= nil and person.name ~= nil then\n    print(person.name)\nelse\n-- do somethingend\n```\n\nå¯¹äºç®€å•ç±»å‹çš„å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ _if (var == nil) then_ è¿™æ ·çš„ç®€å•å¥å­æ¥åˆ¤æ–­ã€‚**ä½†æ˜¯å¯¹äº table å‹çš„ Lua å¯¹è±¡ï¼Œå°±ä¸èƒ½è¿™ä¹ˆç®€å•åˆ¤æ–­å®ƒæ˜¯å¦ä¸ºç©ºäº†ã€‚ä¸€ä¸ª table å‹å˜é‡çš„å€¼å¯èƒ½æ˜¯** **`{}`**ï¼Œè¿™æ—¶å®ƒä¸ç­‰äº nilã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š\n\n```Lua\nlocal next = next\nlocal a = {}\nlocal b = {name = \"Bob\", sex = \"Male\"}\nlocal c = {\"Male\", \"Female\"}\nlocal d = nil\n\nprint(#a)\nprint(#b)\nprint(#c)\n--print(#d)    -- error\n\nif a == nil then\n    print(\"a == nil\")\nend\n\nif b == nil then\n    print(\"b == nil\")\nend\n\nif c == nil then\n    print(\"c == nil\")\nend\n\nif d== nil then\n    print(\"d == nil\")\nend\n\nif next(a) == nil then\n    print(\"next(a) == nil\")\nend\n\nif next(b) == nil then\n    print(\"next(b) == nil\")\nend\n\nif next(c) == nil then\n    print(\"next(c) == nil\")\nend\n```\n\nè¾“å‡º\n\n```Lua\n0\n0\n2\nd == nil\nnext(a) == nil\n```\n\nå› æ­¤ï¼Œæˆ‘ä»¬è¦åˆ¤æ–­ä¸€ä¸ª table æ˜¯å¦ä¸º `{}`ï¼Œä¸èƒ½é‡‡ç”¨ `#table == 0` çš„æ–¹å¼æ¥åˆ¤æ–­ã€‚å¯ä»¥ç”¨ä¸‹é¢è¿™æ ·çš„æ–¹æ³•æ¥åˆ¤æ–­ï¼š\n\n```Plaintext\nfunction isTableEmpty(t)\n    return t == nil or next(t) == nil\nend\n```\n\næ³¨æ„ï¼š**`next`** **æŒ‡ä»¤æ˜¯ä¸èƒ½è¢« LuaJIT çš„ JIT ç¼–è¯‘ä¼˜åŒ–ï¼Œå¹¶ä¸” LuaJIT è²Œä¼¼æ²¡æœ‰æ˜ç¡®è®¡åˆ’æ”¯æŒè¿™ä¸ªæŒ‡ä»¤ä¼˜åŒ–ï¼Œåœ¨ä¸æ˜¯å¿…é¡»çš„æƒ…å†µä¸‹ï¼Œå°½é‡å°‘ç”¨ã€‚**\n\n  \n\n# æ­£åˆ™è¡¨è¾¾å¼\n\nåŒæ—¶å­˜åœ¨ä¸¤å¥—æ­£åˆ™è¡¨è¾¾å¼è§„èŒƒï¼š_Lua_ è¯­è¨€çš„è§„èŒƒå’Œ `ngx.re.*` çš„è§„èŒƒï¼Œå³ä½¿æ‚¨å¯¹ _Lua_ è¯­è¨€ä¸­çš„è§„èŒƒéå¸¸ç†Ÿæ‚‰ï¼Œæˆ‘ä»¬ä»ä¸å»ºè®®ä½¿ç”¨ _Lua_ ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚\n\n- ä¸€æ˜¯å› ä¸º _Lua_ ä¸­æ­£åˆ™è¡¨è¾¾å¼çš„æ€§èƒ½å¹¶ä¸å¦‚ `ngx.re.*` ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ä¼˜ç§€ï¼›\n    \n- äºŒæ˜¯ _Lua_ ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼å¹¶ä¸ç¬¦åˆ _POSIX_ è§„èŒƒï¼Œè€Œ `ngx.re.*` ä¸­å®ç°çš„æ˜¯æ ‡å‡†çš„ _POSIX_ è§„èŒƒï¼Œåè€…æ˜æ˜¾æ›´å…·å¤‡é€šç”¨æ€§ã€‚\n    \n\n`ngx.re.*` ä¸­çš„ `o` é€‰é¡¹ï¼ŒæŒ‡æ˜è¯¥å‚æ•°ï¼Œè¢«ç¼–è¯‘çš„ Pattern å°†ä¼šåœ¨å·¥ä½œè¿›ç¨‹ä¸­ç¼“å­˜ï¼Œå¹¶ä¸”è¢«å½“å‰å·¥ä½œè¿›ç¨‹çš„æ¯æ¬¡è¯·æ±‚æ‰€å…±äº«ã€‚Pattern ç¼“å­˜çš„ä¸Šé™å€¼é€šè¿‡ `lua_regex_cache_max_entries` æ¥ä¿®æ”¹ï¼Œå®ƒçš„é»˜è®¤å€¼ä¸º1024ã€‚\n\n`ngx.re.*` ä¸­çš„ `j` é€‰é¡¹ï¼ŒæŒ‡æ˜è¯¥å‚æ•°ï¼Œå¦‚æœä½¿ç”¨çš„ PCRE åº“æ”¯æŒ JITï¼ŒOpenResty ä¼šåœ¨ç¼–è¯‘ Pattern æ—¶å¯ç”¨ JITã€‚å¯ç”¨ JIT åæ­£åˆ™åŒ¹é…ä¼šæœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ã€‚è¾ƒæ–°çš„å¹³å°ï¼Œè‡ªå¸¦çš„ PCRE åº“å‡æ”¯æŒ JITã€‚å¦‚æœç³»ç»Ÿè‡ªå¸¦çš„ PCRE åº“ä¸æ”¯æŒ JITï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œæœ€å¥½è‡ªå·±ç¼–è¯‘ä¸€ä»½ libpcre.soï¼Œç„¶ååœ¨ç¼–è¯‘ OpenResty æ—¶é“¾æ¥è¿‡å»ã€‚è¦æƒ³éªŒè¯å½“å‰ PCRE åº“æ˜¯å¦æ”¯æŒ JITï¼Œå¯ä»¥è¿™ä¹ˆåš\n\n1. ç¼–è¯‘ OpenResty æ—¶åœ¨ `./configure` ä¸­æŒ‡å®š `--with-debug` é€‰é¡¹\n    \n2. åœ¨ `error_log` æŒ‡ä»¤ä¸­æŒ‡å®šæ—¥å¿—çº§åˆ«ä¸º `debug`\n    \n3. è¿è¡Œæ­£åˆ™åŒ¹é…ä»£ç ï¼ŒæŸ¥çœ‹æ—¥å¿—ä¸­æ˜¯å¦æœ‰ `pcre JIT compiling result: 1`\n    \n\nå³ä½¿è¿è¡Œåœ¨ä¸æ”¯æŒ JIT çš„ OpenResty ä¸Šï¼ŒåŠ ä¸Š `j` é€‰é¡¹ä¹Ÿä¸ä¼šå¸¦æ¥åçš„å½±å“ã€‚åœ¨ OpenResty å®˜æ–¹çš„ Lua åº“ä¸­ï¼Œæ­£åˆ™åŒ¹é…è‡³å°‘éƒ½ä¼šå¸¦ä¸Š `jo` è¿™ä¸¤ä¸ªé€‰é¡¹ã€‚\n\n```Lua\nlocation /test {\n    content_by_lua_block {\n        local regex = [[\\d+]]\n\n        -- å‚æ•° \"j\" å¯ç”¨ JIT ç¼–è¯‘ï¼Œå‚æ•° \"o\" æ˜¯å¼€å¯ç¼“å­˜å¿…é¡»çš„\n        local m = ngx.re.match(\"hello, 1234\", regex, \"jo\")\n        if m then\n            ngx.say(m[0])\n        else\n            ngx.say(\"not matched!\")\n        end\n    }\n}\n```\n\n#### **Lua æ­£åˆ™ç®€å•æ±‡æ€»**\n\n_Lua_ ä¸­æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ä¸Šæœ€å¤§çš„åŒºåˆ«ï¼Œ_Lua_ ä½¿ç”¨ _'%'_ æ¥è¿›è¡Œè½¬ä¹‰ï¼Œè€Œå…¶ä»–è¯­è¨€çš„æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨ _'\\'_ ç¬¦å·æ¥è¿›è¡Œè½¬ä¹‰ã€‚å…¶æ¬¡ï¼Œ_Lua_ ä¸­å¹¶ä¸ä½¿ç”¨ _'?'_ æ¥è¡¨ç¤ºéè´ªå©ªåŒ¹é…ï¼Œè€Œæ˜¯å®šä¹‰äº†ä¸åŒçš„å­—ç¬¦æ¥è¡¨ç¤ºæ˜¯å¦æ˜¯è´ªå©ªåŒ¹é…ã€‚å®šä¹‰å¦‚ä¸‹ï¼š\n\n|ç¬¦å·|åŒ¹é…æ¬¡æ•°|åŒ¹é…æ¨¡å¼|\n|---|---|---|\n|+|åŒ¹é…å‰ä¸€å­—ç¬¦ 1 æ¬¡æˆ–å¤šæ¬¡|éè´ªå©ª|\n|`*`|åŒ¹é…å‰ä¸€å­—ç¬¦ 0 æ¬¡æˆ–å¤šæ¬¡|è´ªå©ª|\n|-|åŒ¹é…å‰ä¸€å­—ç¬¦ 0 æ¬¡æˆ–å¤šæ¬¡|éè´ªå©ª|\n|?|åŒ¹é…å‰ä¸€å­—ç¬¦ 0 æ¬¡æˆ–1æ¬¡|ä»…ç”¨äºæ­¤ï¼Œä¸ç”¨äºæ ‡è¯†æ˜¯å¦è´ªå©ª|\n\n|ç¬¦å·|åŒ¹é…æ¨¡å¼|\n|---|---|\n|.|ä»»æ„å­—ç¬¦|\n|%a|å­—æ¯|\n|%c|æ§åˆ¶å­—ç¬¦|\n|%d|æ•°å­—|\n|%l|å°å†™å­—æ¯|\n|%p|æ ‡ç‚¹å­—ç¬¦|\n|%s|ç©ºç™½ç¬¦|\n|%u|å¤§å†™å­—æ¯|\n|%w|å­—æ¯å’Œæ•°å­—|\n|%x|åå…­è¿›åˆ¶æ•°å­—|\n|%z|ä»£è¡¨ 0 çš„å­—ç¬¦|\n\n  \n\n# è™šå˜é‡\n\nå½“ä¸€ä¸ªæ–¹æ³•è¿”å›å¤šä¸ªå€¼æ—¶ï¼Œæœ‰äº›è¿”å›å€¼æœ‰æ—¶å€™ç”¨ä¸åˆ°ï¼Œè¦æ˜¯å£°æ˜å¾ˆå¤šå˜é‡æ¥ä¸€ä¸€æ¥æ”¶ï¼Œæ˜¾ç„¶ä¸å¤ªåˆé€‚ï¼ˆä¸æ˜¯ä¸èƒ½ï¼‰ã€‚**Lua æä¾›äº†ä¸€ä¸ªè™šå˜é‡(dummy variable)çš„æ¦‚å¿µï¼Œ æŒ‰ç…§****[æƒ¯ä¾‹](https://www.lua.org/pil/1.3.html)****ä»¥ä¸€ä¸ªä¸‹åˆ’çº¿ï¼ˆâ€œ_â€ï¼‰æ¥å‘½åï¼Œç”¨å®ƒæ¥è¡¨ç¤ºä¸¢å¼ƒä¸éœ€è¦çš„æ•°å€¼ï¼Œä»…ä»…èµ·åˆ°å ä½çš„ä½œç”¨ã€‚**\n\n  \n\n## è¿”å›å€¼\n\n```Lua\n-- string.find (s,p) ä»string å˜é‡sçš„å¼€å¤´å‘ååŒ¹é… string\n-- pï¼Œè‹¥åŒ¹é…ä¸æˆåŠŸï¼Œè¿”å›nilï¼Œè‹¥åŒ¹é…æˆåŠŸï¼Œè¿”å›ç¬¬ä¸€æ¬¡åŒ¹é…æˆåŠŸ\n-- çš„èµ·æ­¢ä¸‹æ ‡ã€‚\n\nlocal start, finish = string.find(\"hello\", \"he\") --start å€¼ä¸ºèµ·å§‹ä¸‹æ ‡ï¼Œfinish\n--å€¼ä¸ºç»“æŸä¸‹æ ‡\nprint ( start, finish )                          --è¾“å‡º 1   2\n\nlocal start = string.find(\"hello\", \"he\")      -- startå€¼ä¸ºèµ·å§‹ä¸‹æ ‡\nprint ( start )                               -- è¾“å‡º 1\n\n\nlocal _,finish = string.find(\"hello\", \"he\")   --é‡‡ç”¨è™šå˜é‡ï¼ˆå³ä¸‹åˆ’çº¿ï¼‰ï¼Œæ¥æ”¶èµ·\n--å§‹ä¸‹æ ‡å€¼ï¼Œç„¶åä¸¢å¼ƒï¼Œfinishæ¥æ”¶\n--ç»“æŸä¸‹æ ‡å€¼\nprint ( finish )                              --è¾“å‡º 2\nprint ( _ )    \n```\n\n  \n\n## è¿­ä»£\n\n```Lua\n-- test.lua æ–‡ä»¶\nlocal t = {1, 3, 5}\n\nprint(\"all  data:\")\nfor i,v in ipairs(t) do\n    print(i,v)\nend\n\nprint(\"\")\nprint(\"part data:\")\nfor _,v in ipairs(t) do\n    print(v)\nend\n```\n\nè¾“å‡º\n\n```Lua\n# luajit test.lua\nall  data:\n1   1\n2   3\n3   5\n\npart data:\n1\n3\n5\n```\n\n# **æŠµåˆ¶ä½¿ç”¨ module() å®šä¹‰æ¨¡å—**\n\næ—§å¼çš„æ¨¡å—å®šä¹‰æ–¹å¼æ˜¯é€šè¿‡ `module(\"filename\"[,package.seeall])*` æ¥æ˜¾å¼å£°æ˜ä¸€ä¸ªåŒ…ï¼Œç°åœ¨å®˜æ–¹ä¸æ¨èå†ä½¿ç”¨è¿™ç§æ–¹å¼\n\nè¿™ç§æ–¹å¼å°†ä¼šè¿”å›ä¸€ä¸ªç”± `filename` æ¨¡å—å‡½æ•°ç»„æˆçš„ `table`ï¼Œå¹¶ä¸”è¿˜ä¼šå®šä¹‰ä¸€ä¸ªåŒ…å«è¯¥ `table` çš„å…¨å±€å˜é‡ã€‚\n\n  \n\n1. `package.seeall` è¿™ç§æ–¹å¼ç ´åäº†æ¨¡å—çš„é«˜å†…èšï¼ŒåŸæœ¬å¼•å…¥ \"filename\" æ¨¡å—åªæƒ³è°ƒç”¨å®ƒçš„ _foobar()_ å‡½æ•°ï¼Œä½†æ˜¯å®ƒå´å¯ä»¥è¯»å†™å…¨å±€å±æ€§ï¼Œä¾‹å¦‚ `\"filename.os\"`ã€‚\n    \n2. `module` å‡½æ•°å‹æ ˆæ“ä½œå¼•å‘çš„å‰¯ä½œç”¨ï¼Œæ±¡æŸ“äº†å…¨å±€ç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚ `module(\"filename\")` ä¼šåˆ›å»ºä¸€ä¸ª `filename` çš„ `table`ï¼Œå¹¶å°†è¿™ä¸ª `table` æ³¨å…¥å…¨å±€ç¯å¢ƒå˜é‡ä¸­ï¼Œè¿™æ ·ä½¿å¾—æ²¡æœ‰å¼•ç”¨å®ƒçš„æ–‡ä»¶ä¹Ÿèƒ½è°ƒç”¨ `filename` æ¨¡å—çš„æ–¹æ³•ã€‚\n    \n\n  \n\næ¨èçš„æ¨¡å—å®šä¹‰\n\n```Lua\n-- square.lua é•¿æ–¹å½¢æ¨¡å—\nlocal _M = {}           -- å±€éƒ¨çš„å˜é‡\n_M._VERSION = '1.0'     -- æ¨¡å—ç‰ˆæœ¬\n\nlocal mt = { __index = _M }\n\nfunction _M.new(self, width, height)\n    return setmetatable({ width=width, height=height }, mt)\nend\n\nfunction _M.get_square(self)\n    return self.width * self.height\nend\n\nfunction _M.get_circumference(self)\n    return (self.width + self.height) * 2\nend\n\nreturn _M\n```\n\nä½¿ç”¨\n\n```Lua\nlocal square = require \"square\"\nlocal s1 = square:new(1, 2)\nprint(s1:get_square())          --output: 2\nprint(s1:get_circumference())   --output: 6\n```\n\nå¦ä¸€ä¸ªè·Ÿ Lua çš„ module æ¨¡å—ç›¸å…³éœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼Œå½“ lua_code_cache on å¼€å¯æ—¶ï¼Œrequire åŠ è½½çš„æ¨¡å—æ˜¯ä¼šè¢«ç¼“å­˜ä¸‹æ¥çš„ï¼Œè¿™æ ·æˆ‘ä»¬çš„æ¨¡å—å°±ä¼šä»¥æœ€é«˜æ•ˆçš„æ–¹å¼è¿è¡Œï¼Œç›´åˆ°è¢«æ˜¾å¼åœ°è°ƒç”¨å¦‚ä¸‹è¯­å¥ï¼ˆè¿™é‡Œæœ‰ç‚¹åƒæ¨¡å—å¸è½½ï¼‰ï¼š\n\n```Plaintext\npackage.loaded[\"square\"] = nil\n```\n\n  \n\n## è°ƒç”¨å‡½æ•°å‰å…ˆå®šä¹‰å‡½æ•°\n\nLua é‡Œé¢çš„å‡½æ•°å¿…é¡»æ”¾åœ¨è°ƒç”¨çš„ä»£ç ä¹‹å‰ï¼Œä¸‹é¢çš„ä»£ç æ˜¯ä¸€ä¸ªå¸¸è§çš„é”™è¯¯ï¼š\n\n```Lua\n-- test.lua æ–‡ä»¶local i = 100\ni = add_one(i)\n\nfunction add_one(i)\n    return i + 1\nend\n```\n\nå› æ­¤åœ¨å‡½æ•°å®šä¹‰ä¹‹å‰ä½¿ç”¨å‡½æ•°ç›¸å½“äºåœ¨å˜é‡èµ‹å€¼ä¹‹å‰ä½¿ç”¨å˜é‡ï¼ŒLua ä¸–ç•Œå¯¹äºæ²¡æœ‰èµ‹å€¼çš„å˜é‡ï¼Œé»˜è®¤éƒ½æ˜¯ nilï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿå°±äº§ç”Ÿäº†ä¸€ä¸ª nil çš„é”™è¯¯ã€‚\n\n  \n\n# ç‚¹å·æ“ä½œç¬¦å’Œå†’å·æ“ä½œç¬¦çš„åŒºåˆ«\n\n```Plaintext\nlocal str = \"abcde\"\n\nprint(\"case 1:\", str:sub(1, 2))\nprint(\"case 2:\", str.sub(str, 1, 2))\n```\n\nè¾“å‡º\n\n```Lua\ncase 1: ab\ncase 2: ab\n```\n\n- **å†’å·æ“ä½œä¼šå¸¦å…¥ä¸€ä¸ª** **`self`** **å‚æ•°ï¼Œç”¨æ¥ä»£è¡¨** **`è‡ªå·±`****ã€‚**\n    \n- è€Œç‚¹å·æ“ä½œï¼Œåªæ˜¯ `å†…å®¹` çš„å±•å¼€ã€‚\n    \n\nåœ¨å‡½æ•°å®šä¹‰æ—¶ï¼Œä½¿ç”¨å†’å·å°†é»˜è®¤æ¥æ”¶ä¸€ä¸ª `self` å‚æ•°ï¼Œè€Œä½¿ç”¨ç‚¹å·åˆ™éœ€è¦æ˜¾å¼ä¼ å…¥ `self` å‚æ•°\n\nç¤ºä¾‹ä»£ç ï¼š\n\n```Plaintext\nobj = { x = 20 }\n\nfunction obj:fun1()\n    print(self.x)\nend\n```\n\nç­‰ä»·äº\n\n```Plaintext\nobj = { x = 20 }\n\nfunction obj.fun1(self)\n    print(self.x)\nend\n```\n\n# moduleçš„ç¼ºç‚¹\n\nç”±äº `lua_code_cache off` æƒ…å†µä¸‹ï¼Œç¼“å­˜çš„ä»£ç ä¼šä¼´éšè¯·æ±‚å®Œç»“è€Œé‡Šæ”¾ã€‚module çš„æœ€å¤§å¥½å¤„ç¼“å­˜è¿™æ—¶å€™æ˜¯æ— æ³•å‘æŒ¥çš„ï¼Œæ‰€ä»¥æœ¬ç« çš„å†…å®¹éƒ½æ˜¯åŸºäº `lua_code_cache on` çš„æƒ…å†µä¸‹ã€‚\n\nå…ˆçœ‹çœ‹ä¸‹é¢ä»£ç ï¼š\n\n```Plaintext\nlocal ngx_socket_tcp = ngx.socket.tcp           -- â‘ \n\nlocal _M = { _VERSION = '0.06' }                -- â‘¡\nlocal mt = { __index = _M }                     -- â‘¢\n\nfunction _M.new(self)\n    local sock, err = ngx_socket_tcp()          -- â‘£\n    if not sock then\n        return nil, err\n    end\n    return setmetatable({ sock = sock }, mt)    -- â‘¤\nend\n\nfunction _M.set_timeout(self, timeout)\n    local sock = self.sock\n    if not sock then\n        return nil, \"not initialized\"\n    end\n\n    return sock:settimeout(timeout)\nend\n\n-- ... å…¶ä»–åŠŸèƒ½ä»£ç ï¼Œè¿™é‡Œç®€ç•¥\n\nreturn _M\n```\n\n1. å¯¹äºæ¯”è¾ƒåº•å±‚çš„æ¨¡å—ï¼Œå†…éƒ¨ä½¿ç”¨åˆ°çš„éæœ¬åœ°å‡½æ•°ï¼Œéƒ½éœ€è¦ local æœ¬åœ°åŒ–ï¼Œè¿™æ ·åšçš„å¥½å¤„ï¼š\n    \n    1. é¿å…å‘½åå†²çªï¼šé˜²æ­¢å¤–éƒ¨æ˜¯ `require(...)` çš„æ–¹æ³•è°ƒç”¨é€ æˆå…¨å±€å˜é‡æ±¡æŸ“\n        \n    2. è®¿é—®å±€éƒ¨å˜é‡çš„é€Ÿåº¦æ¯”å…¨å±€å˜é‡æ›´å¿«ã€æ›´å¿«ã€æ›´å¿«ï¼ˆé‡è¦äº‹æƒ…è¯´ä¸‰éï¼‰\n        \n\n  \n\n2. æ¯ä¸ªåŸºç¡€æ¨¡å—æœ€å¥½æœ‰è‡ªå·± `_VERSION` æ ‡è¯†ï¼Œæ–¹ä¾¿åæœŸåˆ©ç”¨ `_VERSION` å®Œæˆçƒ­ä»£ç éƒ¨ç½²ç­‰é«˜çº§ç‰¹æ€§ï¼Œä¹Ÿä¾¿äºä½¿ç”¨è€…å¯¹ç‰ˆæœ¬æœ‰æ•´ä½“æ„è¯†ã€‚\n    \n3. å…¶å® `_M` å’Œ `mt` å¯¹äºä¸åŒçš„è¯·æ±‚å®ä¾‹ï¼ˆrequire æ–¹æ³•å¾—åˆ°çš„å¯¹è±¡ï¼‰æ˜¯ç›¸åŒçš„ï¼Œå› ä¸º module ä¼šè¢«ç¼“å­˜åˆ°å…¨å±€ç¯å¢ƒä¸­ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªä½ç½®åƒä¸‡ä¸è¦æ”¾å•è¯·æ±‚å†…ä¸ªæ€§ä¿¡æ¯ï¼Œä¾‹å¦‚ ngx.ctx ç­‰å˜é‡ã€‚\n    \n4. **è¿™é‡Œéœ€è¦å®ç°çš„æ˜¯ç»™æ¯ä¸ªå®ä¾‹ç»‘å®šä¸åŒçš„ tcp å¯¹è±¡**ï¼Œå**é¢ setmetatable ç¡®ä¿äº†æ¯ä¸ªå®ä¾‹æ‹¥æœ‰è‡ªå·±çš„ socket å¯¹è±¡ï¼Œæ‰€ä»¥å¿…é¡»æ”¾åœ¨ new å‡½æ•°ä¸­**ã€‚å¦‚æœæ”¾åœ¨ â‘¢ çš„ä¸‹é¢ï¼Œé‚£ä¹ˆè¿™æ—¶å€™æ‰€æœ‰çš„ä¸åŒå®ä¾‹å†…éƒ¨å°†ç»‘å®šäº†åŒä¸€ä¸ª socket å¯¹è±¡ã€‚\n    \n\n```Plaintext\nlocal mt = { __index = _M }                     -- â‘¢\nlocal sock = ngx_socket_tcp()                   -- â‘£ é”™è¯¯çš„\n\nfunction _M.new(self)\n    return setmetatable({ sock = sock }, mt)    -- â‘¤\nend\n```\n\n5. Lua çš„ module æœ‰ä¸¤ç§ç±»å‹ï¼š\n    \n    1. æ”¯æŒé¢å‘å¯¹è±¡ç—•è¿¹å¯ä»¥ä¿ç•™ç§æœ‰å±æ€§ï¼›é™æ€æ–¹æ³•æä¾›è€…ï¼Œæ²¡æœ‰ä»»ä½•ç§æœ‰å±æ€§ã€‚\n        \n    2. çœŸæ­£èµ·åˆ°åŒºåˆ«ä½œç”¨çš„å°±æ˜¯ setmetatable å‡½æ•°ï¼Œæ˜¯å¦æœ‰è‡ªå·±çš„ä¸ªæ€§å…ƒè¡¨ï¼Œæœ€ç»ˆå¯¼è‡´ä¸¤ç§ä¸åŒçš„å½¢æ€ã€‚\n        \n\n# FFI\n\nhttps://moonbingbing.gitbooks.io/openresty-best-practices/content/lua/FFI.html\n\nFFI åº“ï¼Œæ˜¯ LuaJIT ä¸­æœ€é‡è¦çš„ä¸€ä¸ªæ‰©å±•åº“ã€‚å®ƒå…è®¸ä»çº¯ Lua ä»£ç è°ƒç”¨å¤–éƒ¨ C å‡½æ•°ï¼Œä½¿ç”¨ C æ•°æ®ç»“æ„ã€‚\n\n  \n\nFFI åº“æœ€å¤§é™åº¦çš„çœå»äº†ä½¿ç”¨ C æ‰‹å·¥ç¼–å†™ç¹é‡çš„ `Lua/C` ç»‘å®šçš„éœ€è¦ã€‚ä¸éœ€è¦å­¦ä¹ ä¸€é—¨ç‹¬ç«‹/é¢å¤–çš„ç»‘å®šè¯­è¨€â€”â€”å®ƒè§£ææ™®é€š C å£°æ˜ã€‚è¿™æ ·å¯ä»¥ä» C å¤´æ–‡ä»¶æˆ–å‚è€ƒæ‰‹å†Œä¸­ï¼Œç›´æ¥å‰ªåˆ‡ï¼Œç²˜è´´ã€‚å®ƒçš„ä»»åŠ¡å°±æ˜¯ç»‘å®šå¾ˆå¤§çš„åº“ï¼Œä½†ä¸éœ€è¦æ£é¼“è„†å¼±çš„ç»‘å®šç”Ÿæˆå™¨ã€‚\n\nFFI ç´§ç´§çš„æ•´åˆè¿›äº† LuaJITï¼ˆå‡ ä¹ä¸å¯èƒ½ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼‰ã€‚`JIT` ç¼–è¯‘å™¨åœ¨ C æ•°æ®ç»“æ„ä¸Šæ‰€äº§ç”Ÿçš„ä»£ç ï¼Œç­‰åŒäºä¸€ä¸ª C ç¼–è¯‘å™¨åº”è¯¥ç”Ÿäº§çš„ä»£ç ã€‚åœ¨ `JIT` ç¼–è¯‘è¿‡çš„ä»£ç ä¸­ï¼Œè°ƒç”¨ C å‡½æ•°ï¼Œå¯ä»¥è¢«å†…è¿å¤„ç†ï¼Œä¸åŒäºåŸºäº `Lua/C API` å‡½æ•°è°ƒç”¨ã€‚\n\n  \n\n## **ffi åº“ è¯æ±‡**\n\n|   |   |\n|---|---|\n|noun|Explanation|\n|cdecl|A definition of an abstract C type(actually, is a lua string)|\n|ctype|C type object|\n|cdata|C data object|\n|ct|C type format, is a template object, may be cdecl, cdata, ctype|\n|cb|callback object|\n|VLA|An array of variable length|\n|VLS|A structure of variable length|\n\n## **ffi.* API**\n\n**åŠŸèƒ½ï¼š** _Lua ffi åº“çš„ APIï¼Œä¸ LuaJIT ä¸å¯åˆ†å‰²ã€‚_\n\næ¯«æ— ç–‘é—®ï¼Œåœ¨ `lua` æ–‡ä»¶ä¸­ä½¿ç”¨ `ffi` åº“çš„æ—¶å€™ï¼Œå¿…é¡»è¦æœ‰ä¸‹é¢çš„ä¸€è¡Œã€‚\n\n```Plaintext\nlocal ffi = require \"ffi\"\n```\n\n# JIT\n\nçœ‹ä¸€ä¸‹ LuaJIT å®˜æ–¹çš„è§£é‡Šï¼šLuaJIT is a Just-In-Time Compilerfor the Lua programming languageã€‚\n\n**LuaJIT çš„è¿è¡Œæ—¶ç¯å¢ƒåŒ…æ‹¬ä¸€ä¸ªç”¨æ‰‹å†™æ±‡ç¼–å®ç°çš„ Lua è§£é‡Šå™¨å’Œä¸€ä¸ªå¯ä»¥ç›´æ¥ç”Ÿæˆæœºå™¨ä»£ç çš„ JIT ç¼–è¯‘å™¨**\n\n- ä¸€å¼€å§‹çš„æ—¶å€™ï¼ŒLua å­—èŠ‚ç æ€»æ˜¯è¢« LuaJIT çš„è§£é‡Šå™¨è§£é‡Šæ‰§è¡Œã€‚LuaJIT çš„è§£é‡Šå™¨ä¼šåœ¨æ‰§è¡Œå­—èŠ‚ç æ—¶åŒæ—¶è®°å½•ä¸€äº›è¿è¡Œæ—¶çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ¯”å¦‚æ¯ä¸ª Lua å‡½æ•°è°ƒç”¨å…¥å£çš„å®é™…è¿è¡Œæ¬¡æ•°ï¼Œè¿˜æœ‰æ¯ä¸ª Lua å¾ªç¯çš„å®é™…æ‰§è¡Œæ¬¡æ•°ã€‚\n    \n- å½“è¿™äº›æ¬¡æ•°è¶…è¿‡æŸä¸ªé¢„è®¾çš„é˜ˆå€¼æ—¶ï¼Œä¾¿è®¤ä¸ºå¯¹åº”çš„ Lua å‡½æ•°å…¥å£æˆ–è€…å¯¹åº”çš„ Lua å¾ªç¯è¶³å¤Ÿçš„â€œçƒ­â€ï¼Œè¿™æ—¶ä¾¿ä¼šè§¦å‘ JIT ç¼–è¯‘å™¨å¼€å§‹å·¥ä½œã€‚\n    \n- JIT ç¼–è¯‘å™¨ä¼šä»çƒ­å‡½æ•°çš„å…¥å£æˆ–è€…çƒ­å¾ªç¯çš„æŸä¸ªä½ç½®å¼€å§‹å°è¯•ç¼–è¯‘å¯¹åº”çš„ Lua ä»£ç è·¯å¾„ã€‚ç¼–è¯‘çš„è¿‡ç¨‹æ˜¯æŠŠ LuaJIT å­—èŠ‚ç å…ˆè½¬æ¢æˆ LuaJIT è‡ªå·±å®šä¹‰çš„ä¸­é—´ç ï¼ˆIRï¼‰ï¼Œç„¶åå†ç”Ÿæˆé’ˆå¯¹ç›®æ ‡ä½“ç³»ç»“æ„çš„æœºå™¨ç ï¼ˆæ¯”å¦‚ x86_64 æŒ‡ä»¤ç»„æˆçš„æœºå™¨ç ï¼‰\n    \n- å¦‚æœå½“å‰ Lua ä»£ç è·¯å¾„ä¸Šçš„æ‰€æœ‰çš„æ“ä½œéƒ½å¯ä»¥è¢« JIT ç¼–è¯‘å™¨é¡ºåˆ©ç¼–è¯‘ï¼Œåˆ™è¿™æ¡ç¼–è¯‘è¿‡çš„ä»£ç è·¯å¾„ä¾¿è¢«ç§°ä¸ºä¸€ä¸ªâ€œtraceâ€ï¼Œåœ¨ç‰©ç†ä¸Šå¯¹åº”ä¸€ä¸ª `trace` ç±»å‹çš„ GC å¯¹è±¡ï¼ˆå³å‚ä¸ Lua GC çš„å¯¹è±¡ï¼‰ã€‚\n    \n\n  \n\nJIT ç¼–è¯‘å™¨ä¸æ”¯æŒçš„åŸè¯­è¢«ç§°ä¸º **NYIï¼ˆNot Yet Implementedï¼‰åŸè¯­**ã€‚æ¯”è¾ƒå®Œæ•´çš„ NYI åˆ—è¡¨åœ¨è¿™ç¯‡æ–‡æ¡£é‡Œé¢ï¼š\n\n```Plaintext\nhttp://wiki.luajit.org/NYI\n```\n\næ‰€è°“â€œè®©æ›´å¤šçš„ Lua ä»£ç è¢« JIT ç¼–è¯‘â€ï¼Œå…¶å®å°±æ˜¯å¸®åŠ©æ›´å¤šçš„ Lua ä»£ç è·¯å¾„èƒ½ä¸º JIT ç¼–è¯‘å™¨æ‰€æ¥å—ã€‚è¿™ä¸€èˆ¬é€šè¿‡ä¸¤ç§é€”å¾„æ¥å®ç°ï¼š\n\n1. è°ƒæ•´å¯¹åº”çš„ Lua ä»£ç ï¼Œ**é¿å…ä½¿ç”¨ NYI åŸè¯­**ã€‚\n    \n2. å¢å¼º JIT ç¼–è¯‘å™¨ï¼Œè®©è¶Šæ¥è¶Šå¤šçš„ NYI åŸè¯­èƒ½å¤Ÿè¢«ç¼–è¯‘ã€‚\n    \n\n## **å¯ä»¥è¢« JIT ç¼–è¯‘çš„å…ƒæ“ä½œ**\n\nä¸‹é¢ç»™å¤§å®¶åˆ—ä¸€ä¸‹æˆªæ­¢åˆ°ç›®å‰å·²ç»å¯ä»¥è¢« JIT ç¼–è¯‘çš„å…ƒæ“ä½œã€‚ å…¶ä»–è¿˜æœ‰ IOã€Bitã€FFIã€Coroutineã€OSã€Packageã€Debugã€JIT ç­‰åˆ†ç±»ï¼Œä½¿ç”¨é¢‘ç‡ç›¸å¯¹è¾ƒä½ï¼Œè¿™é‡Œå°±ä¸ç½—åˆ—äº†ï¼Œå¯ä»¥å‚è€ƒå®˜ç½‘ï¼š[http://wiki.luajit.org/NYI](http://wiki.luajit.org/NYI)ã€‚\n\n### **åŸºç¡€åº“çš„æ”¯æŒæƒ…å†µ**\n\n|   |   |   |\n|---|---|---|\n|å‡½æ•°|ç¼–è¯‘?|å¤‡æ³¨|\n|assert|yes||\n|collectgarbage|no||\n|dofile|never||\n|error|never||\n|getfenv|2.1 partial|åªæœ‰ getfenv(0) èƒ½ç¼–è¯‘|\n|getmetatable|yes||\n|ipairs|yes||\n|load|never||\n|loadfile|never||\n|loadstring|never||\n|next|no||\n|pairs|no||\n|pcall|yes||\n|print|no||\n|rawequal|yes||\n|rawget|yes||\n|rawlen (5.2)|yes||\n|rawset|yes||\n|select|partial|ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é™æ€å˜é‡çš„æ—¶å€™å¯ä»¥ç¼–è¯‘|\n|setfenv|no||\n|setmetatable|yes||\n|tonumber|partial|ä¸èƒ½ç¼–è¯‘é10è¿›åˆ¶ï¼Œéé¢„æœŸçš„å¼‚å¸¸è¾“å…¥|\n|tostring|partial|åªèƒ½ç¼–è¯‘ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”ã€nil ä»¥åŠæ”¯æŒ __tostringå…ƒæ–¹æ³•çš„ç±»å‹|\n|type|yes||\n|unpack|no||\n|xpcall|yes||\n\n### **å­—ç¬¦ä¸²åº“**\n\n|   |   |   |\n|---|---|---|\n|å‡½æ•°|ç¼–è¯‘?|å¤‡æ³¨|\n|string.byte|yes||\n|string.char|2.1||\n|string.dump|never||\n|string.find|2.1 partial|åªæœ‰å­—ç¬¦ä¸²æ ·å¼æŸ¥æ‰¾ï¼ˆæ²¡æœ‰æ ·å¼ï¼‰|\n|string.format|2.1 partial|ä¸æ”¯æŒ %p æˆ– éå­—ç¬¦ä¸²å‚æ•°çš„ %s|\n|string.gmatch|no||\n|string.gsub|no||\n|string.len|yes||\n|string.lower|2.1||\n|string.match|no||\n|string.rep|2.1||\n|string.reverse|2.1||\n|string.sub|yes||\n|string.upper|2.1||\n\n### **è¡¨**\n\n|   |   |   |\n|---|---|---|\n|å‡½æ•°|ç¼–è¯‘?|å¤‡æ³¨|\n|table.concat|2.1||\n|table.foreach|no|2.1: å†…éƒ¨ç¼–è¯‘ï¼Œä½†è¿˜æ²¡æœ‰å¤–æ”¾|\n|table.foreachi|2.1||\n|table.getn|yes||\n|table.insert|partial|åªæœ‰ push æ“ä½œ|\n|table.maxn|no||\n|table.pack (5.2)|no||\n|table.remove|2.1|éƒ¨åˆ†ï¼Œåªæœ‰ pop æ“ä½œ|\n|table.sort|no||\n|table.unpack (5.2)|no||\n\n### **math åº“**\n\n|   |   |   |\n|---|---|---|\n|å‡½æ•°|ç¼–è¯‘?|å¤‡æ³¨|\n|math.abs|yes||\n|math.acos|yes||\n|math.asin|yes||\n|math.atan|yes||\n|math.atan2|yes||\n|math.ceil|yes||\n|math.cos|yes||\n|math.cosh|yes||\n|math.deg|yes||\n|math.exp|yes||\n|math.floor|yes||\n|math.fmod|no||\n|math.frexp|no||\n|math.ldexp|yes||\n|math.log|yes||\n|math.log10|yes||\n|math.max|yes||\n|math.min|yes||\n|math.modf|yes||\n|math.pow|yes||\n|math.rad|yes||\n|math.random|yes||\n|math.randomseed|no||\n|math.sin|yes||\n|math.sinh|yes||\n|math.sqrt|yes||\n|math.tan|yes||\n|math.tanh|yes||","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":["lua"]},"/lua/lua%E5%9F%BA%E7%A1%80":{"title":"luaåŸºç¡€","content":"\n\n# Lua ç®€ä»‹\n\nLua æ˜¯ä¸€ä¸ªå°å·§çš„è„šæœ¬è¯­è¨€ã€‚æ˜¯å·´è¥¿é‡Œçº¦çƒ­å†…å¢å¤©ä¸»æ•™å¤§å­¦ï¼ˆPontifical Catholic University of Rio de Janeiroï¼‰é‡Œçš„ä¸€ä¸ªç ”ç©¶å°ç»„å¹¶äº 1993 å¹´å¼€å‘ã€‚**å…¶è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½**ã€‚Lua ç”±æ ‡å‡† C ç¼–å†™è€Œæˆï¼Œå‡ ä¹åœ¨æ‰€æœ‰æ“ä½œç³»ç»Ÿå’Œå¹³å°ä¸Šéƒ½å¯ä»¥ç¼–è¯‘ã€è¿è¡Œã€‚Lua å¹¶æ²¡æœ‰æä¾›å¼ºå¤§çš„åº“ï¼Œè¿™æ˜¯ç”±å®ƒçš„å®šä½å†³å®šçš„ã€‚æ‰€ä»¥ Lua ä¸é€‚åˆä½œä¸ºå¼€å‘ç‹¬ç«‹åº”ç”¨ç¨‹åºçš„è¯­è¨€ã€‚**Lua æœ‰ä¸€ä¸ªåŒæ—¶è¿›è¡Œçš„ JIT é¡¹ç›®ï¼Œæä¾›åœ¨ç‰¹å®šå¹³å°ä¸Šçš„å³æ—¶ç¼–è¯‘åŠŸèƒ½**ã€‚\n\n- **Lua è„šæœ¬å¯ä»¥å¾ˆå®¹æ˜“çš„è¢« C/C++ ä»£ç è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥è°ƒç”¨ C/C++ çš„å‡½æ•°ï¼Œè¿™ä½¿å¾— Lua åœ¨åº”ç”¨ç¨‹åºä¸­å¯ä»¥è¢«å¹¿æ³›åº”ç”¨**ã€‚\n    \n- **ä¸ä»…ä»…ä½œä¸ºæ‰©å±•è„šæœ¬ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæ™®é€šçš„é…ç½®æ–‡ä»¶ï¼Œä»£æ›¿ XMLã€ini ç­‰æ–‡ä»¶æ ¼å¼ï¼Œå¹¶ä¸”æ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤**ã€‚\n    \n- æ ‡å‡† Lua 5.1 è§£é‡Šå™¨ç”±æ ‡å‡† C ç¼–å†™è€Œæˆï¼Œä»£ç ç®€æ´ä¼˜ç¾ï¼Œå‡ ä¹åœ¨æ‰€æœ‰æ“ä½œç³»ç»Ÿå’Œå¹³å°ä¸Šéƒ½å¯ä»¥ç¼–è¯‘å’Œè¿è¡Œï¼›\n    \n- ä¸€ä¸ªå®Œæ•´çš„æ ‡å‡† Lua 5.1 è§£é‡Šå™¨ä¸è¶³ 200 KBã€‚è€Œæœ¬ä¹¦æ¨èä½¿ç”¨çš„ LuaJIT 2 çš„ä»£ç å¤§å°ä¹Ÿåªæœ‰ä¸è¶³ 500 KB\n    \n- åŒæ—¶ä¹Ÿæ”¯æŒå¤§éƒ¨åˆ†å¸¸è§çš„ä½“ç³»ç»“æ„ã€‚åœ¨ç›®å‰æ‰€æœ‰è„šæœ¬è¯­è¨€å¼•æ“ä¸­ï¼ŒLuaJIT 2 å®ç°çš„é€Ÿåº¦åº”è¯¥ç®—æ˜¯æœ€å¿«çš„ä¹‹ä¸€ã€‚è¿™ä¸€åˆ‡éƒ½å†³å®šäº† Lua æ˜¯ä½œä¸ºåµŒå…¥å¼è„šæœ¬çš„æœ€ä½³é€‰æ‹©ã€‚\n    \n\nLua è¯­è¨€çš„å„ä¸ªç‰ˆæœ¬æ˜¯ä¸ç›¸å…¼å®¹çš„ã€‚å› æ­¤æœ¬ä¹¦åªä»‹ç» Lua 5.1 è¯­è¨€ï¼Œè¿™æ˜¯ä¸ºæ ‡å‡† Lua 5.1 è§£é‡Šå™¨å’Œ LuaJIT 2 æ‰€å…±åŒæ”¯æŒçš„ã€‚LuaJIT æ”¯æŒçš„å¯¹ Lua 5.1 å‘åå…¼å®¹çš„ Lua 5.2 å’Œ Lua 5.3 çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¹Ÿä¼šåœ¨æ–¹ä¾¿çš„æ—¶å€™äºˆä»¥ä»‹ç»ã€‚\n\n  \n\n# Lua ç¯å¢ƒæ­å»º\n\n[http://openresty.org](http://openresty.org/)\n\n  \n\n## Helloworld\n\n```Go\n# cat hello.lua\nprint(\"hello world\")\n# luajit hello.lua\nhello world\n```\n\n  \n\n# åŸºæœ¬æ•°æ®ç±»å‹\n\n  \n\n```Go\nprint(type(\"helloworld\"))\nprint(type('helloworld'))\nprint(type('true'))\nprint(type(1))\nprint(type(2.1))\nprint(type(nil))\nfunction hello()\n    print(\"hello\")\nend\nprint(type(hello))\n```\n\nè¾“å‡º\n\n```Go\nstring\nstring\nstring\nnumber\nnumber\nnil\nfunction\n```\n\n## Nil\n\nNil æ˜¯ä¸€ç§ç±»å‹ï¼ŒLua å°† nil ç”¨äºè¡¨ç¤ºâ€œæ— æ•ˆå€¼â€ã€‚\n\n- ä¸€ä¸ªå˜é‡åœ¨ç¬¬ä¸€æ¬¡èµ‹å€¼å‰çš„é»˜è®¤å€¼æ˜¯ nilï¼Œ\n    \n- å°† nil èµ‹äºˆç»™ä¸€ä¸ªå…¨å±€å˜é‡å°±ç­‰åŒäºåˆ é™¤å®ƒã€‚\n    \n\n```Go\nlocal num\nprint(num)        --\u003eoutput:nil\n\nnum = 100\nprint(num)        --\u003eoutput:100\n```\n\n## Boolean (å¸ƒå°”)\n\nå¸ƒå°”ç±»å‹ï¼Œå¯é€‰å€¼ true/falseï¼›\n\n- Lua ä¸­ nil å’Œ false ä¸ºâ€œå‡â€\n    \n- å…¶å®ƒæ‰€æœ‰å€¼å‡ä¸ºâ€œçœŸâ€ã€‚æ¯”å¦‚ 0 å’Œç©ºå­—ç¬¦ä¸²å°±æ˜¯â€œçœŸâ€ï¼›\n    \n\n```Go\nlocal a = true\nlocal b = 0\nlocal c = nil\nif a then\n    print(\"a\")        --\u003eoutput:a\nelse\n    print(\"not a\")    --è¿™ä¸ªæ²¡æœ‰æ‰§è¡Œ\nend\n\nif b then\n    print(\"b\")        --\u003eoutput:b\nelse\n    print(\"not b\")    --è¿™ä¸ªæ²¡æœ‰æ‰§è¡Œ\nend\n\nif c then\n    print(\"c\")        --è¿™ä¸ªæ²¡æœ‰æ‰§è¡Œ\nelse\n    print(\"not c\")    --\u003eoutput:not c\nend\n```\n\n## **numberï¼ˆæ•°å­—ï¼‰**\n\nNumber ç±»å‹ç”¨äºè¡¨ç¤ºå®æ•°ï¼Œå’Œ C/C++ é‡Œé¢çš„ double ç±»å‹å¾ˆç±»ä¼¼ã€‚å¯ä»¥ä½¿ç”¨æ•°å­¦å‡½æ•° math. Floorï¼ˆå‘ä¸‹å–æ•´ï¼‰å’Œ math. Ceilï¼ˆå‘ä¸Šå–æ•´ï¼‰è¿›è¡Œå–æ•´æ“ä½œã€‚\n\nä¸€èˆ¬åœ°ï¼ŒLua çš„ number ç±»å‹å°±æ˜¯ç”¨åŒç²¾åº¦æµ®ç‚¹æ•°æ¥å®ç°çš„ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒLuaJIT æ”¯æŒæ‰€è°“çš„â€œdual-numberâ€ï¼ˆåŒæ•°ï¼‰æ¨¡å¼ï¼Œ\n\n- å³ **LuaJIT ä¼šæ ¹æ®ä¸Šä¸‹æ–‡ç”¨æ•´å‹æ¥å­˜å‚¨æ•´æ•°ï¼Œè€Œç”¨åŒç²¾åº¦æµ®ç‚¹æ•°æ¥å­˜æ”¾æµ®ç‚¹æ•°ã€‚**\n    \n\n```Go\nlocal order = 3.99\nlocal score = 98.01\nprint(math.floor(order))   --\u003eoutput:3\nprint(math.ceil(score))    --\u003eoutput:99\nprint(9223372036854775807LL - 1)  --\u003eoutput:9223372036854775806LL\n```\n\n## Stringï¼ˆå­—ç¬¦ä¸²ï¼‰\n\nLua ä¸­æœ‰ä¸‰ç§æ–¹å¼è¡¨ç¤ºå­—ç¬¦ä¸²:\n\n1. ä½¿ç”¨ä¸€å¯¹åŒ¹é…çš„å•å¼•å·ã€‚ä¾‹ï¼š'hello'ã€‚\n    \n2. ä½¿ç”¨ä¸€å¯¹åŒ¹é…çš„åŒå¼•å·ã€‚ä¾‹ï¼š\"abclua\"ã€‚\n    \n3. å­—ç¬¦ä¸²è¿˜å¯ä»¥ç”¨ä¸€ç§é•¿æ‹¬å·ï¼ˆå³ [[ ]]ï¼‰æ‹¬èµ·æ¥çš„æ–¹å¼å®šä¹‰\n    \n    1. æˆ‘ä»¬æŠŠä¸¤ä¸ªæ­£çš„æ–¹æ‹¬å·ï¼ˆå³[[ï¼‰é—´æ’å…¥ n ä¸ªç­‰å·å®šä¹‰ä¸ºç¬¬ n çº§æ­£é•¿æ‹¬å·ã€‚\n        \n    2. 0 çº§æ­£çš„é•¿æ‹¬å·å†™ä½œ [[ ï¼Œä¸€çº§æ­£çš„é•¿æ‹¬å·å†™ä½œ [=[\n        \n    3. åçš„é•¿æ‹¬å·ä¹Ÿä½œç±»ä¼¼å®šä¹‰ï¼›ä¸¾ä¸ªä¾‹å­ï¼Œ4 çº§åçš„é•¿æ‹¬å·å†™ä½œ ]====]\n        \n    4. **ä¸€ä¸ªé•¿å­—ç¬¦ä¸²å¯ä»¥ç”±ä»»ä½•ä¸€çº§çš„æ­£çš„é•¿æ‹¬å·å¼€å§‹ï¼Œè€Œç”±ç¬¬ä¸€ä¸ªç¢°åˆ°çš„åŒçº§åçš„é•¿æ‹¬å·ç»“æŸ**ã€‚æ•´ä¸ªè¯æ³•åˆ†æè¿‡ç¨‹å°†**ä¸å—åˆ†è¡Œé™åˆ¶ï¼Œä¸å¤„ç†ä»»ä½•è½¬ä¹‰ç¬¦ï¼Œå¹¶ä¸”å¿½ç•¥æ‰ä»»ä½•ä¸åŒçº§åˆ«çš„é•¿æ‹¬å·**\n        \n\n  \n\n```Plaintext\nlocal str1 = 'hello world'\nlocal str2 = \"hello lua\"\nlocal str3 = [[\"add\\name\",'hello']]\nlocal str4 = [=[string have a [[]].]=]\nlocal str5 = [=[asdfasd]=]\n\nprint(str1)    --\u003eoutput:hello world\nprint(str2)    --\u003eoutput:hello lua\nprint(str3)    --\u003eoutput:\"add\\name\",'hello'\nprint(str4)    --\u003eoutput:string have a [[]].\nprint(str5)    --\u003eoutput:asdfasd\n```\n\nåœ¨ Lua å®ç°ä¸­ï¼ŒLua å­—ç¬¦ä¸²ä¸€èˆ¬éƒ½ä¼šç»å†ä¸€ä¸ªâ€œå†…åŒ–â€ï¼ˆinternï¼‰çš„è¿‡ç¨‹ï¼Œ**å³ä¸¤ä¸ªå®Œå…¨ä¸€æ ·çš„ Lua å­—ç¬¦ä¸²åœ¨ Lua è™šæ‹Ÿæœºä¸­åªä¼šå­˜å‚¨ä¸€ä»½**ã€‚æ¯ä¸€ä¸ª Lua å­—ç¬¦ä¸²åœ¨åˆ›å»ºæ—¶éƒ½ä¼š**æ’å…¥åˆ° Lua è™šæ‹Ÿæœºå†…éƒ¨çš„ä¸€ä¸ªå…¨å±€çš„å“ˆå¸Œè¡¨**ä¸­\n\n1. åˆ›å»ºç›¸åŒçš„ Lua å­—ç¬¦ä¸²å¹¶ä¸ä¼šå¼•å…¥æ–°çš„åŠ¨æ€å†…å­˜åˆ†é…æ“ä½œï¼Œæ‰€ä»¥ç›¸å¯¹ä¾¿å®œï¼ˆä½†ä»æœ‰å…¨å±€å“ˆå¸Œè¡¨æŸ¥è¯¢çš„å¼€é”€ï¼‰ï¼Œ\n    \n2. å†…å®¹ç›¸åŒçš„ Lua å­—ç¬¦ä¸²ä¸ä¼šå ç”¨å¤šä»½å­˜å‚¨ç©ºé—´ï¼Œ\n    \n3. å·²ç»åˆ›å»ºå¥½çš„ Lua å­—ç¬¦ä¸²ä¹‹é—´è¿›è¡Œç›¸ç­‰æ€§æ¯”è¾ƒæ—¶æ˜¯ `O(1)` æ—¶é—´åº¦çš„å¼€é”€ï¼Œè€Œä¸æ˜¯é€šå¸¸è§åˆ°çš„ `O(n)`.\n    \n\n## Table (è¡¨)\n\nTable ç±»å‹å®ç°äº†ä¸€ç§æŠ½è±¡çš„â€œå…³è”æ•°ç»„â€ã€‚â€œå…³è”æ•°ç»„â€æ˜¯ä¸€ç§å…·æœ‰ç‰¹æ®Šç´¢å¼•æ–¹å¼çš„æ•°ç»„ï¼Œ\n\n- ç´¢å¼•é€šå¸¸æ˜¯**å­—ç¬¦ä¸²ï¼ˆstringï¼‰æˆ–è€… number ç±»å‹ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯é™¤** **`nil`** **ä»¥å¤–çš„ä»»æ„ç±»å‹çš„å€¼**\n    \n\n```Go\n\nlocal corp = {\n    web = \"www.google.com\",   --ç´¢å¼•ä¸ºå­—ç¬¦ä¸²ï¼Œkey = \"web\",\n    --            value = \"www.google.com\"\n    telephone = \"12345678\",   --ç´¢å¼•ä¸ºå­—ç¬¦ä¸²\n    staff = {\"Jack\", \"Scott\", \"Gary\"}, --ç´¢å¼•ä¸ºå­—ç¬¦ä¸²ï¼Œå€¼ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨\n    100876,              --ç›¸å½“äº [1] = 100876ï¼Œæ­¤æ—¶ç´¢å¼•ä¸ºæ•°å­—\n    --      key = 1, value = 100876\n    100191,              --ç›¸å½“äº [2] = 100191ï¼Œæ­¤æ—¶ç´¢å¼•ä¸ºæ•°å­—\n    [10] = 360,          --ç›´æ¥æŠŠæ•°å­—ç´¢å¼•ç»™å‡º\n    [\"city\"] = \"Beijing\" --ç´¢å¼•ä¸ºå­—ç¬¦ä¸²\n}\n\nprint(corp.web)               --\u003eoutput:www.google.com\nprint(corp[\"web\"])               --\u003eoutput:www.google.com\nprint(corp[\"telephone\"])      --\u003eoutput:12345678\nprint(corp[2])                --\u003eoutput:100191\nprint(corp[\"city\"])           --\u003eoutput:\"Beijing\"\nprint(corp.staff[1])          --\u003eoutput:Jack\nprint(corp[\"staff\"][1])          --\u003eoutput:Jack\nprint(corp[10])               --\u003eoutput:360\n```\n\nåœ¨å†…éƒ¨å®ç°ä¸Šï¼Œtable é€šå¸¸å®ç°ä¸ºä¸€ä¸ªå“ˆå¸Œè¡¨ã€ä¸€ä¸ªæ•°ç»„ã€æˆ–è€…ä¸¤è€…çš„æ··åˆã€‚å…·ä½“çš„å®ç°ä¸ºä½•ç§å½¢å¼ï¼ŒåŠ¨æ€ä¾èµ–äºå…·ä½“çš„ table çš„é”®åˆ†å¸ƒç‰¹ç‚¹ã€‚\n\n## Function (å‡½æ•°)\n\nåœ¨ Lua ä¸­ï¼Œ**å‡½æ•°** ä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œå‡½æ•°å¯ä»¥å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œå¯ä»¥é€šè¿‡å‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼Œè¿˜å¯ä»¥ä½œä¸ºå…¶ä»–å‡½æ•°çš„è¿”å›å€¼\n\n```Go\nlocal function foo()\n    print(\"in the function\")\n    --dosomething()\n    local x = 10\n    local y = 20\n    return x + y\nend\n\nlocal a = foo    --æŠŠå‡½æ•°èµ‹ç»™å˜é‡\n\nprint(a())\n\n--output:\n--in the function\n--30\n\nfunction foo()\nend\n--ç­‰ä»·äº\n\nfoo = function ()\nend\n\nlocal function foo()\nend\n-- ç­‰ä»·äº\n\nlocal foo = function ()\nend\n```\n\n  \n\n# è¡¨è¾¾å¼\n\n## ç®—æœ¯è¿ç®—ç¬¦\n\n|            |      |\n| ---------- | ---- |\n| ç®—æœ¯è¿ç®—ç¬¦ | è¯´æ˜ |\n| +          | åŠ æ³• |\n| -          | å‡æ³• |\n| *          | ä¹˜æ³• |\n| /          | é™¤æ³• |\n| ^          | æŒ‡æ•° |\n| %          | å–æ¨¡ |\n\n```Go\nprint(1 + 2)       --\u003eæ‰“å° 3\nprint(5 / 10)      --\u003eæ‰“å° 0.5ã€‚ è¿™æ˜¯Luaä¸åŒäºcè¯­è¨€çš„\nprint(5.0 / 10)    --\u003eæ‰“å° 0.5ã€‚ æµ®ç‚¹æ•°ç›¸é™¤çš„ç»“æœæ˜¯æµ®ç‚¹æ•°\n-- print(10 / 0)   --\u003eæ³¨æ„é™¤æ•°ä¸èƒ½ä¸º0ï¼Œè®¡ç®—çš„ç»“æœä¼šå‡ºé”™\nprint(2 ^ 10)      --\u003eæ‰“å° 1024ã€‚ æ±‚2çš„10æ¬¡æ–¹\n\nlocal num = 1357\nprint(num % 2)       --\u003eæ‰“å° 1\nprint((num % 2) == 1) --\u003eæ‰“å° trueã€‚ åˆ¤æ–­numæ˜¯å¦ä¸ºå¥‡æ•°\n```\n\n## å…³ç³»è¿ç®—ç¬¦\n\n  \n\n|            |          |\n| ---------- | -------- |\n| å…³ç³»è¿ç®—ç¬¦ | è¯´æ˜     |\n| \u003c          | å°äº     |\n| \u003e          | å¤§äº     |\n| \u003c=         | å°äºç­‰äº |\n| \u003e=         | å¤§äºç­‰äº |\n| ==         | ç­‰äº     |\n| ~=         | ä¸ç­‰äº   |\n\n  \n\n```Go\nprint(1 \u003c 2)    --\u003eæ‰“å° true\nprint(1 == 2)   --\u003eæ‰“å° false\nprint(1 ~= 2)   --\u003eæ‰“å° true\nlocal a, b = true, false\nprint(a == b)  --\u003eæ‰“å° false\n```\n\n- åœ¨ä½¿ç”¨â€œ==â€åšç­‰äºåˆ¤æ–­æ—¶ï¼Œè¦æ³¨æ„å¯¹äº table, userdate å’Œå‡½æ•°ï¼Œ Lua æ˜¯ä½œå¼•ç”¨æ¯”è¾ƒçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰å½“ä¸¤ä¸ªå˜é‡å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œæ‰è®¤ä¸ºå®ƒä»¬ç›¸ç­‰\n    \n\n```Go\nlocal a = { x = 1, y = 0}\nlocal b = { x = 1, y = 0}\nif a == b then\n    print(\"a==b\")\nelse\n    print(\"a~=b\")\nend\n---output:\na~=b\n```\n\n- Lua å­—ç¬¦ä¸²æ€»æ˜¯ä¼šè¢«â€œå†…åŒ–â€ï¼Œå³ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²åªä¼šè¢«ä¿å­˜ä¸€ä»½ï¼Œå› æ­¤ Lua å­—ç¬¦ä¸²ä¹‹é—´çš„ç›¸ç­‰æ€§æ¯”è¾ƒå¯ä»¥ç®€åŒ–ä¸ºå…¶å†…éƒ¨å­˜å‚¨åœ°å€çš„æ¯”è¾ƒã€‚\n    \n- è¿™æ„å‘³ç€ Lua å­—ç¬¦ä¸²çš„ç›¸ç­‰æ€§æ¯”è¾ƒæ€»æ˜¯ä¸º O (1)\n    \n\n## é€»è¾‘è¿ç®—ç¬¦\n\n|            |        |\n| ---------- | ------ |\n| é€»è¾‘è¿ç®—ç¬¦ | è¯´æ˜   |\n| and        | é€»è¾‘ä¸ |\n| or         | é€»è¾‘æˆ– |\n| not        | é€»è¾‘é |\n\nåœ¨ c è¯­è¨€ä¸­ï¼Œand å’Œ or åªå¾—åˆ°ä¸¤ä¸ªå€¼ 1 å’Œ 0ï¼Œå…¶ä¸­ 1 è¡¨ç¤ºçœŸï¼Œ0 è¡¨ç¤ºå‡ã€‚è€Œ Lua ä¸­ and çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š\n\n- `a and b` å¦‚æœ a ä¸º nilï¼Œåˆ™è¿”å› aï¼Œå¦åˆ™è¿”å› b;\n    \n- `a or b` å¦‚æœ a ä¸º nilï¼Œåˆ™è¿”å› bï¼Œå¦åˆ™è¿”å› aã€‚\n    \n- **æ‰€æœ‰é€»è¾‘æ“ä½œç¬¦å°† false å’Œ nil è§†ä½œå‡ï¼Œå…¶ä»–ä»»ä½•å€¼è§†ä½œçœŸï¼Œå¯¹äº and å’Œ orï¼Œâ€œçŸ­è·¯æ±‚å€¼â€ï¼Œå¯¹äº notï¼Œæ°¸è¿œåªè¿”å› true æˆ–è€… falseã€‚**\n    \n\n```Go\nlocal c = nil\nlocal d = 0\nlocal e = 100\nprint(c and d)  --\u003eæ‰“å° nil\nprint(c and e)  --\u003eæ‰“å° nil\nprint(d and e)  --\u003eæ‰“å° 100\nprint(c or d)   --\u003eæ‰“å° 0\nprint(c or e)   --\u003eæ‰“å° 100\nprint(not c)    --\u003eæ‰“å° true\nprint(not d)    --\u003eæ‰“å° false\n```\n\n## å­—ç¬¦ä¸²è¿æ¥\n\nLua ä¸­è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨æ“ä½œç¬¦â€œ..â€ï¼ˆä¸¤ä¸ªç‚¹ï¼‰\n\n- å¦‚æœå…¶ä»»æ„ä¸€ä¸ªæ“ä½œæ•°æ˜¯æ•°å­—çš„è¯ï¼ŒLua ä¼šå°†è¿™ä¸ªæ•°å­—è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚\n    \n- æ³¨æ„ï¼Œè¿æ¥æ“ä½œç¬¦åªä¼šåˆ›å»ºä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œè€Œä¸ä¼šæ”¹å˜åŸæ“ä½œæ•°\n    \n- ä¹Ÿå¯ä»¥ä½¿ç”¨ string åº“å‡½æ•° `string.format` è¿æ¥å­—ç¬¦ä¸²\n    \n\n```Go\nprint(\"Hello \" .. \"World\")    --\u003eæ‰“å° Hello Worldprint(0 .. 1)                 --\u003eæ‰“å° 01\n\nstr1 = string.format(\"%s-%s\",\"hello\",\"world\")\nprint(str1)              --\u003eæ‰“å° hello-world\n\nstr2 = string.format(\"%d-%s-%.2f\",123,\"world\",1.21)\nprint(str2)              --\u003eæ‰“å° 123-world-1.21\n```\n\näº Lua å­—ç¬¦ä¸²æœ¬è´¨ä¸Šæ˜¯åªè¯»çš„ï¼Œ**å› æ­¤å­—ç¬¦ä¸²è¿æ¥è¿ç®—ç¬¦å‡ ä¹æ€»ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ï¼ˆæ›´å¤§çš„ï¼‰å­—ç¬¦ä¸²**ã€‚è¿™æ„å‘³ç€å¦‚æœæœ‰å¾ˆå¤šè¿™æ ·çš„è¿æ¥æ“ä½œï¼ˆæ¯”å¦‚åœ¨å¾ªç¯ä¸­ä½¿ç”¨ .. æ¥æ‹¼æ¥æœ€ç»ˆç»“æœï¼‰ï¼Œåˆ™æ€§èƒ½æŸè€—ä¼šéå¸¸å¤§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨ table å’Œ `table.concat()` æ¥è¿›è¡Œå¾ˆå¤šå­—ç¬¦ä¸²çš„æ‹¼æ¥\n\n```Go\nlocal pieces = {}\nfor i, elem in ipairs(my_list) do\n    pieces[i] = my_process(elem)\nend\nlocal res = table.concat(pieces)\n```\n\nä¸Šé¢çš„ä¾‹å­è¿˜å¯ä»¥ä½¿ç”¨ LuaJIT ç‹¬æœ‰çš„ `table.new` æ¥æ°å½“åœ°åˆå§‹åŒ– `pieces` è¡¨çš„ç©ºé—´ï¼Œä»¥é¿å…è¯¥è¡¨çš„åŠ¨æ€ç”Ÿé•¿ã€‚\n\n## ä¼˜å…ˆçº§\n\n| f               |     |\n| --------------- | --- |\n| ^               |     |\n| not # -         |     |\n| * / %           |     |\n| + -             |     |\n| ..              |     |\n| \u003c \u003e \u003c= \u003e= == ~= |     |\n| and             |     |\n| or              |     |\n  \n\n```Go\nlocal a, b = 1, 2\nlocal x, y = 3, 4\nlocal i = 10\nlocal res = 0\nres = a + i \u003c b/2 + 1  --\u003eç­‰ä»·äºres =  (a + i) \u003c ((b/2) + 1)\nres = 5 + x^2*8        --\u003eç­‰ä»·äºres =  5 + ((x^2) * 8)\nres = a \u003c y and y \u003c=x  --\u003eç­‰ä»·äºres =  (a \u003c y) and (y \u003c= x)\n```\n\n  \n\n# æ§åˆ¶ç»“æ„\n\n## If-else\n\n### **å•ä¸ª if åˆ†æ”¯å‹**\n\n```Go\nx = 10\nif x \u003e 0 then\n    print(\"x is a positive number\")\nend\n```\n\n### **ä¸¤ä¸ªåˆ†æ”¯ if-else å‹**\n\n```Go\nx = 10\nif x \u003e 0 then\n    print(\"x is a positive number\")\nelse\n    print(\"x is a non-positive number\")\nend\n```\n\n### å¤šä¸ªåˆ†æ”¯çš„ if-elseif-else\n\n```Go\n\nscore = 90\nif score == 100 then\n    print(\"Very good!Your score is 100\")\nelseif score \u003e= 60 then\n    print(\"Congratulations, you have passed it,your score greater or equal to 60\")\n    --æ­¤å¤„å¯ä»¥æ·»åŠ å¤šä¸ªelseif\nelse\n    print(\"Sorry, you do not pass the exam! \")\nend\n```\n\nä¸ C è¯­è¨€çš„ä¸åŒä¹‹å¤„æ˜¯ else ä¸ if æ˜¯è¿åœ¨ä¸€èµ·çš„ï¼Œè‹¥å°† else ä¸ if å†™æˆ \"else if\" åˆ™ç›¸å½“äºåœ¨ else é‡ŒåµŒå¥—å¦ä¸€ä¸ª if è¯­å¥ï¼Œå¦‚ä¸‹ä»£ç ï¼š\n\n```Go\nscore = 0\nif score == 100 then\n    print(\"Very good!Your score is 100\")\nelseif score \u003e= 60 then\n    print(\"Congratulations, you have passed it,your score greater or equal to 60\")\nelse\n    if score \u003e 0 then\n        print(\"Your score is better than 0\")\n    else\n        print(\"My God, your score turned out to be 0\")\n    end --ä¸ä¸Šä¸€ç¤ºä¾‹ä»£ç ä¸åŒçš„æ˜¯ï¼Œæ­¤å¤„è¦æ·»åŠ ä¸€ä¸ªend\nend\n```\n\n## While\n\n```Go\nwhile è¡¨è¾¾å¼ do\n    --body\nend\n```\n\n  \n\n## Repeat\n\nLua ä¸­çš„ repeat æ§åˆ¶ç»“æ„ç±»ä¼¼äºå…¶ä»–è¯­è¨€ï¼ˆå¦‚ï¼šC++ è¯­è¨€ï¼‰ä¸­çš„ do-whileï¼Œä½†æ˜¯æ§åˆ¶æ–¹å¼æ˜¯åˆšå¥½ç›¸åçš„ã€‚ç®€å•ç‚¹è¯´ï¼Œ**æ‰§è¡Œ repeat å¾ªç¯ä½“åï¼Œç›´åˆ° until çš„æ¡ä»¶ä¸ºçœŸæ—¶æ‰ç»“æŸ**\n\n```Lua\n-- ä»¥ä¸‹ä»£ç ä¼šæ­»å¾ªç¯\nx = 10\nrepeat\n    print(x)\nuntil false\n```\n\n  \n\n## For\n\n### **for æ•°å­—å‹**\n\n```Lua\nfor var = begin, finish, step do\n    --body\nend\n```\n\n1. Var ä» begin å˜åŒ–åˆ° finishï¼Œæ¯æ¬¡å˜åŒ–éƒ½ä»¥ step ä½œä¸ºæ­¥é•¿é€’å¢ var\n    \n2. Beginã€finishã€step ä¸‰ä¸ªè¡¨è¾¾å¼åªä¼šåœ¨å¾ªç¯å¼€å§‹æ—¶æ‰§è¡Œä¸€æ¬¡\n    \n3. ç¬¬ä¸‰ä¸ªè¡¨è¾¾å¼ step æ˜¯å¯é€‰çš„ï¼Œé»˜è®¤ä¸º 1\n    \n4. æ§åˆ¶å˜é‡ var çš„ä½œç”¨åŸŸä»…åœ¨ for å¾ªç¯å†…ï¼Œéœ€è¦åœ¨å¤–é¢æ§åˆ¶ï¼Œåˆ™éœ€å°†å€¼èµ‹ç»™ä¸€ä¸ªæ–°çš„å˜é‡\n    \n5. å¾ªç¯è¿‡ç¨‹ä¸­ä¸è¦æ”¹å˜æ§åˆ¶å˜é‡çš„å€¼ï¼Œé‚£æ ·ä¼šå¸¦æ¥ä¸å¯é¢„çŸ¥çš„å½±å“\n    \n\n```Lua\nfor i = 1, 5 do\n    print(i)\nend\n-- output:\n1\n2\n3\n4\n5\n\nfor i = 1, 10, 2 do\n    print(i)\nend\n-- output:\n1\n3\n5\n7\n9\n```\n\n## For æ³›å‹\n\næ³›å‹ for å¾ªç¯é€šè¿‡ä¸€ä¸ªè¿­ä»£å™¨ï¼ˆiteratorï¼‰å‡½æ•°æ¥éå†æ‰€æœ‰å€¼ï¼š\n\n```Lua\n-- æ‰“å°æ•°ç»„açš„æ‰€æœ‰å€¼local a = {\"a\", \"b\", \"c\", \"d\"}\nfor i, v in ipairs(a) do\n    print(\"index:\", i, \" value:\", v)\nend\n-- output:\nindex:  1  value: a\nindex:  2  value: b\nindex:  3  value: c\nindex:  4  value: d\n```\n\nLua çš„åŸºç¡€åº“æä¾›äº† **ipairsï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºéå†æ•°ç»„çš„è¿­ä»£å™¨å‡½æ•°**ã€‚åœ¨æ¯æ¬¡å¾ªç¯ä¸­ï¼Œi ä¼šè¢«èµ‹äºˆä¸€ä¸ªç´¢å¼•å€¼ï¼ŒåŒæ—¶ v è¢«èµ‹äºˆä¸€ä¸ªå¯¹åº”äºè¯¥ç´¢å¼•çš„æ•°ç»„å…ƒç´ å€¼ã€‚\n\n```Lua\n-- æ‰“å°table tä¸­æ‰€æœ‰çš„\nkeyfor k in pairs(t) do\n    print(k)\nend\n```\n\né€šè¿‡ä¸åŒçš„è¿­ä»£å™¨ï¼Œå‡ ä¹å¯ä»¥éå†æ‰€æœ‰çš„ä¸œè¥¿ï¼Œè€Œä¸”å†™å‡ºçš„ä»£ç æå…·å¯è¯»æ€§ã€‚æ ‡å‡†åº“æä¾›äº†å‡ ç§è¿­ä»£å™¨ï¼ŒåŒ…æ‹¬ç”¨äºè¿­ä»£æ–‡ä»¶ä¸­æ¯è¡Œçš„ï¼ˆio. Linesï¼‰ã€è¿­ä»£ table å…ƒç´ çš„ï¼ˆpairsï¼‰ã€è¿­ä»£æ•°ç»„å…ƒç´ çš„ï¼ˆipairsï¼‰ã€è¿­ä»£å­—ç¬¦ä¸²ä¸­å•è¯çš„ï¼ˆstring. Gmatchï¼‰\n\næ³›å‹ for å¾ªç¯ä¸æ•°å­—å‹ for å¾ªç¯æœ‰ä¸¤ä¸ªç›¸åŒç‚¹ï¼š\n\n1. å¾ªç¯å˜é‡æ˜¯å¾ªç¯ä½“çš„å±€éƒ¨å˜é‡ï¼›\n    \n2. å†³ä¸åº”è¯¥å¯¹å¾ªç¯å˜é‡ä½œä»»ä½•èµ‹å€¼ã€‚\n    \n\nåœ¨ LuaJIT 2.1 ä¸­ï¼Œ**`ipairs()`** **å†…å»ºå‡½æ•°æ˜¯å¯ä»¥è¢« JIT ç¼–è¯‘çš„ï¼Œè€Œ** **`pairs()`** **åˆ™åªèƒ½è¢«è§£é‡Šæ‰§è¡Œã€‚å› æ­¤åœ¨æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ï¼Œåº”å½“åˆç†å®‰æ’æ•°æ®ç»“æ„ï¼Œé¿å…å¯¹å“ˆå¸Œè¡¨è¿›è¡Œéå†**\n\n  \n\n## Break\n\nè¯­å¥ `break` ç”¨æ¥ç»ˆæ­¢ `while`ã€`repeat` å’Œ `for` ä¸‰ç§å¾ªç¯çš„æ‰§è¡Œï¼Œå¹¶è·³å‡ºå½“å‰å¾ªç¯ä½“ï¼Œç»§ç»­æ‰§è¡Œå½“å‰å¾ªç¯ä¹‹åçš„è¯­å¥\n\n```Lua\n-- è®¡ç®—æœ€å°çš„x,ä½¿ä»1åˆ°xçš„æ‰€æœ‰æ•°ç›¸åŠ å’Œå¤§äº100\nsum = 0\ni = 1while true do\n    sum = sum + i\n    if sum \u003e 100 then\n        break\n    end\n    i = i + 1\nend\nprint(\"The result is \" .. i)  \n--\u003eoutput:The result is 14\n```\n\n## Return\n\n  \n\n`return` ä¸»è¦ç”¨äºä»å‡½æ•°ä¸­è¿”å›ç»“æœï¼Œæˆ–è€…ç”¨äºç®€å•çš„ç»“æŸä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œã€‚\n\n```Lua\nlocal function add(x, y)\n    return x + y\n    --print(\"add: I will return the result \" .. (x + y))\n    --å› ä¸ºå‰é¢æœ‰ä¸ªreturnï¼Œè‹¥ä¸æ³¨é‡Šè¯¥è¯­å¥ï¼Œåˆ™ä¼šæŠ¥é”™\nend\n\nlocal function is_positive(x)\n    if x \u003e 0 then\n        return x .. \" is positive\"\n    else\n        return x .. \" is non-positive\"\n    end\n\n    --ç”±äºreturnåªå‡ºç°åœ¨å‰é¢æ˜¾å¼çš„è¯­å¥å—ï¼Œæ‰€ä»¥æ­¤è¯­å¥ä¸æ³¨é‡Šä¹Ÿä¸ä¼šæŠ¥é”™\n    --ï¼Œä½†æ˜¯ä¸ä¼šè¢«æ‰§è¡Œï¼Œæ­¤å¤„ä¸ä¼šäº§ç”Ÿè¾“å‡º\n    print(\"function end!\")\nend\n\nlocal sum = add(10, 20)\nprint(\"The sum is \" .. sum)  --\u003eoutput:The sum is 30\nlocal answer = is_positive(-10)\nprint(answer)                --\u003eoutput:-10 is non-positive\n```\n\n  \n\n## Goto\n\næœ‰äº† `goto`ï¼Œæˆ‘ä»¬å¯ä»¥å®ç° `continue` çš„åŠŸèƒ½ï¼š\n\n```Lua\nfor i=1, 3 do\n    if i \u003c= 2 then\n        print(i, \"yes continue\")\n        goto continue\n    end\n    print(i, \" no continue\")\n\n    ::continue::\n    print([[i'm end]])\nend\n```\n\nè¾“å‡ºç»“æœ\n\n```Lua\n$ luajit test.lua\n1   yes continue\ni'm end\n2   yes continue\ni'm end\n3    no continue\ni'm end\n```\n\n# å‡½æ•°\n\n## å®šä¹‰\n\n```Lua\nfunction function_name (arc)  -- arc è¡¨ç¤ºå‚æ•°åˆ—è¡¨ï¼Œå‡½æ•°çš„å‚æ•°åˆ—è¡¨å¯ä»¥ä¸ºç©º\n    -- body\nend\n```\n\nä¸Šé¢çš„è¯­æ³•å®šä¹‰äº†ä¸€ä¸ªå…¨å±€å‡½æ•°ï¼Œåä¸º `function_name`. å…¨å±€å‡½æ•°æœ¬è´¨ä¸Šå°±æ˜¯å‡½æ•°ç±»å‹çš„å€¼èµ‹ç»™äº†ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå³ä¸Šé¢çš„è¯­æ³•ç­‰ä»·äº\n\n```Lua\nfunction_name = function (arc)\n     -- body\nend\n```\n\nç”±äºå…¨å±€å˜é‡ä¸€èˆ¬ä¼šæ±¡æŸ“å…¨å±€åå­—ç©ºé—´ï¼ŒåŒæ—¶ä¹Ÿæœ‰æ€§èƒ½æŸè€—ï¼ˆå³æŸ¥è¯¢å…¨å±€ç¯å¢ƒè¡¨çš„å¼€é”€ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬åº”å½“å°½é‡ä½¿ç”¨â€œå±€éƒ¨å‡½æ•°â€ï¼Œå…¶è®°æ³•æ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯å¼€å¤´åŠ ä¸Š `local` ä¿®é¥°ç¬¦ï¼š\n\n```Lua\nlocal function function_name (arc)\n    -- body\nend\n```\n\nå®šä¹‰å‡½æ•°\n\n1. åˆ©ç”¨åå­—æ¥è§£é‡Šå‡½æ•°ã€å˜é‡çš„ç›®çš„ï¼Œä½¿äººé€šè¿‡åå­—å°±èƒ½çœ‹å‡ºæ¥å‡½æ•°ã€å˜é‡çš„ä½œç”¨ã€‚\n    \n2. æ¯ä¸ªå‡½æ•°çš„é•¿åº¦è¦å°½é‡æ§åˆ¶åœ¨ä¸€ä¸ªå±å¹•å†…ï¼Œä¸€çœ¼å¯ä»¥çœ‹æ˜ç™½ã€‚\n    \n3. è®©ä»£ç è‡ªå·±è¯´è¯ï¼Œä¸éœ€è¦æ³¨é‡Šæœ€å¥½ã€‚\n    \n\n  \n\nç”±äºå‡½æ•°å®šä¹‰ç­‰ä»·äºå˜é‡èµ‹å€¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå‡½æ•°åæ›¿æ¢ä¸ºæŸä¸ª Lua è¡¨çš„æŸä¸ªå­—æ®µï¼Œä¾‹å¦‚\n\n```Lua\nlocal foo = {}\nfunction foo.pr()\n    print(\"ssss\")\nend\n\nfoo.pr()\n```\n\n  \n\n## å‚æ•°\n\n### æŒ‰å€¼ä¼ é€’\n\n**Lua å‡½æ•°çš„å‚æ•°å¤§éƒ¨åˆ†æ˜¯æŒ‰å€¼ä¼ é€’çš„**ã€‚**å½“å‡½æ•°å‚æ•°æ˜¯ table ç±»å‹æ—¶ï¼Œä¼ é€’è¿›æ¥çš„æ˜¯å®é™…å‚æ•°çš„å¼•ç”¨**\n\nå€¼ä¼ é€’å°±æ˜¯è°ƒç”¨å‡½æ•°æ—¶ï¼Œå®å‚æŠŠå®ƒçš„å€¼é€šè¿‡èµ‹å€¼è¿ç®—ä¼ é€’ç»™å½¢å‚ï¼Œç„¶åå½¢å‚çš„æ”¹å˜å’Œå®å‚å°±æ²¡æœ‰å…³ç³»äº†ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®å‚æ˜¯é€šè¿‡å®ƒåœ¨å‚æ•°è¡¨ä¸­çš„ä½ç½®ä¸å½¢å‚åŒ¹é…èµ·æ¥çš„ã€‚\n\n```Lua\nlocal function swap(a, b) --å®šä¹‰å‡½æ•°swap,å‡½æ•°å†…éƒ¨è¿›è¡Œäº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼\n    local temp = a\n    a = b\n    b = temp\n    print(a, b)\nend\n\nlocal x = \"hello\"\nlocal y = 20\nprint(x, y)\nswap(x, y)    --è°ƒç”¨swapå‡½æ•°\nprint(x, y)   --è°ƒç”¨swapå‡½æ•°åï¼Œxå’Œyçš„å€¼å¹¶æ²¡æœ‰äº¤æ¢\n\n--\u003eoutput\nhello 20\n20  hello\nhello 20\n```\n\nåœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œ**è‹¥å½¢å‚ä¸ªæ•°å’Œå®å‚ä¸ªæ•°ä¸åŒæ—¶ï¼ŒLua ä¼šè‡ªåŠ¨è°ƒæ•´å®å‚ä¸ªæ•°**ã€‚è°ƒæ•´è§„åˆ™ï¼š\n\n- è‹¥å®å‚ä¸ªæ•°å¤§äºå½¢å‚ä¸ªæ•°ï¼Œä»å·¦å‘å³ï¼Œå¤šä½™çš„å®å‚è¢«å¿½ç•¥ï¼›\n    \n- è‹¥å®å‚ä¸ªæ•°å°äºå½¢å‚ä¸ªæ•°ï¼Œä»å·¦å‘å³ï¼Œ**æ²¡æœ‰è¢«å®å‚åˆå§‹åŒ–çš„å½¢å‚ä¼šè¢«åˆå§‹åŒ–ä¸º nil**\n    \n\n```Lua\nlocal function fun1(a, b)       --ä¸¤ä¸ªå½¢å‚ï¼Œå¤šä½™çš„å®å‚è¢«å¿½ç•¥æ‰\n    print(a, b)\nend\n\nlocal function fun2(a, b, c, d) --å››ä¸ªå½¢å‚ï¼Œæ²¡æœ‰è¢«å®å‚åˆå§‹åŒ–çš„å½¢å‚ï¼Œç”¨nilåˆå§‹åŒ–\n    print(a, b, c, d)\nend\n\nlocal x = 1\nlocal y = 2\nlocal z = 3\n\nfun1(x, y, z)         -- zè¢«å‡½æ•°fun1å¿½ç•¥æ‰äº†ï¼Œå‚æ•°å˜æˆ x, y\nfun2(x, y, z)         -- åé¢è‡ªåŠ¨åŠ ä¸Šä¸€ä¸ªnilï¼Œå‚æ•°å˜æˆ x, y, z, nil\n\n--\u003eoutput\n1   2\n1   2   3   nil\n```\n\n### å˜é•¿å‚æ•°\n\nå…¶å® Lua è¿˜æ”¯æŒå˜é•¿å‚æ•°ã€‚è‹¥å½¢å‚ä¸º `...`ï¼Œè¡¨ç¤ºè¯¥å‡½æ•°å¯ä»¥æ¥æ”¶ä¸åŒé•¿åº¦çš„å‚æ•°ã€‚è®¿é—®å‚æ•°çš„æ—¶å€™ä¹Ÿè¦ä½¿ç”¨ `...`\n\n```Lua\n\nlocal function func( ... )                -- å½¢å‚ä¸º ... ,è¡¨ç¤ºå‡½æ•°é‡‡ç”¨å˜é•¿å‚æ•°\n\n    local temp = {...}                     -- è®¿é—®çš„æ—¶å€™ä¹Ÿè¦ä½¿ç”¨ ...\n    local ans = table.concat(temp, \" \")    -- ä½¿ç”¨ table.concat åº“å‡½æ•°å¯¹æ•°\n    -- ç»„å†…å®¹ä½¿ç”¨ \" \" æ‹¼æ¥æˆå­—ç¬¦ä¸²ã€‚\n    print(ans)\nend\n\nfunc(1, 2)        -- ä¼ é€’äº†ä¸¤ä¸ªå‚æ•°\nfunc(1, 2, 3, 4)  -- ä¼ é€’äº†å››ä¸ªå‚æ•°\n\n--\u003eoutput\n1 2\n\n1 2 3 4\n```\n\n### **å…·åå‚æ•°**\n\nLua è¿˜æ”¯æŒé€šè¿‡åç§°æ¥æŒ‡å®šå®å‚ï¼Œè¿™æ—¶å€™è¦æŠŠæ‰€æœ‰çš„å®å‚ç»„ç»‡åˆ°ä¸€ä¸ª table ä¸­ï¼Œå¹¶å°†è¿™ä¸ª table ä½œä¸ºå”¯ä¸€çš„å®å‚ä¼ ç»™å‡½æ•°ã€‚\n\n```Lua\nlocal function change(arg) -- change å‡½æ•°ï¼Œæ”¹å˜é•¿æ–¹å½¢çš„é•¿å’Œå®½ï¼Œä½¿å…¶å„å¢é•¿ä¸€å€\n  arg.width = arg.width * 2\n  arg.height = arg.height * 2return arg\nendlocal rectangle = { width = 20, height = 15 }\nprint(\"before change:\", \"width  =\", rectangle.width,\n                        \"height =\", rectangle.height)\nrectangle = change(rectangle)\nprint(\"after  change:\", \"width  =\", rectangle.width,\n                        \"height =\", rectangle.height)\n\n--\u003eoutput\nbefore change: width = 20  height =  15\nafter  change: width = 40  height =  30\n```\n\n  \n\n### æŒ‰å¼•ç”¨ä¼ é€’\n\n**å½“å‡½æ•°å‚æ•°æ˜¯ table ç±»å‹æ—¶ï¼Œä¼ é€’è¿›æ¥çš„æ˜¯å®é™…å‚æ•°çš„å¼•ç”¨**ï¼Œæ­¤æ—¶åœ¨å‡½æ•°å†…éƒ¨å¯¹è¯¥ table æ‰€åšçš„ä¿®æ”¹ï¼Œä¼šç›´æ¥å¯¹è°ƒç”¨è€…æ‰€ä¼ é€’çš„å®é™…å‚æ•°ç”Ÿæ•ˆï¼Œè€Œæ— éœ€è‡ªå·±è¿”å›ç»“æœå’Œè®©è°ƒç”¨è€…è¿›è¡Œèµ‹å€¼\n\n```Plaintext\nfunction change(arg) --changeå‡½æ•°ï¼Œæ”¹å˜é•¿æ–¹å½¢çš„é•¿å’Œå®½ï¼Œä½¿å…¶å„å¢é•¿ä¸€å€\n  arg.width = arg.width * 2  --è¡¨argä¸æ˜¯è¡¨rectangleçš„æ‹·è´ï¼Œä»–ä»¬æ˜¯åŒä¸€ä¸ªè¡¨\n  arg.height = arg.height * 2end                  -- æ²¡æœ‰returnè¯­å¥äº†local rectangle = { width = 20, height = 15 }\nprint(\"before change:\", \"width = \", rectangle.width,\n                        \" height = \", rectangle.height)\nchange(rectangle)\nprint(\"after change:\", \"width = \", rectangle.width,\n                       \" height =\", rectangle.height)\n\n--\u003e output\nbefore change: width = 20  height = 15\nafter  change: width = 40  height = 30\n```\n\n## å‡½æ•°è¿”å›å€¼\n\nLua å…·æœ‰ä¸€é¡¹ä¸ä¼—ä¸åŒçš„ç‰¹æ€§ï¼Œå…è®¸å‡½æ•°è¿”å›å¤šä¸ªå€¼ã€‚\n\n```Lua\nlocal function swap(a, b)   \n    -- å®šä¹‰å‡½æ•° swapï¼Œå®ç°ä¸¤ä¸ªå˜é‡äº¤æ¢å€¼\n    return b, a              \n    -- æŒ‰ç›¸åé¡ºåºè¿”å›å˜é‡çš„å€¼\nend\n\nlocal x = 1\nlocal y = 20\nx, y = swap(x, y)           -- è°ƒç”¨ swap å‡½æ•°\nprint(x, y)                 --\u003e output   20     1\n```\n\n  \n\nå½“å‡½æ•°è¿”å›å€¼çš„ä¸ªæ•°å’Œæ¥æ”¶è¿”å›å€¼çš„å˜é‡çš„ä¸ªæ•°ä¸ä¸€è‡´æ—¶ï¼ŒLua ä¹Ÿä¼šè‡ªåŠ¨è°ƒæ•´å‚æ•°ä¸ªæ•°è°ƒæ•´è§„åˆ™ï¼š\n\n- è‹¥è¿”å›å€¼ä¸ªæ•°å¤§äºæ¥æ”¶å˜é‡çš„ä¸ªæ•°ï¼Œå¤šä½™çš„è¿”å›å€¼ä¼šè¢«å¿½ç•¥æ‰ï¼›\n    \n- è‹¥è¿”å›å€¼ä¸ªæ•°å°äºå‚æ•°ä¸ªæ•°ï¼Œä»å·¦å‘å³ï¼Œæ²¡æœ‰è¢«è¿”å›å€¼åˆå§‹åŒ–çš„å˜é‡ä¼šè¢«åˆå§‹åŒ–ä¸º nilã€‚\n    \n\n```Lua\nfunction init()             \n    --init å‡½æ•° è¿”å›ä¸¤ä¸ªå€¼ 1 å’Œ \"lua\"\n    return 1, \"lua\"\nend\n\nx = init()\nprint(x)\n\nx, y, z = init()\nprint(x, y, z)\n\n--output\n1\n1 lua nil\n```\n\n  \n\nå½“ä¸€ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªä»¥ä¸Šè¿”å›å€¼ï¼Œä¸”å‡½æ•°è°ƒç”¨ä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨è¡¨è¾¾å¼çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå‡½æ•°è°ƒç”¨åªä¼šäº§ç”Ÿä¸€ä¸ªè¿”å›å€¼, ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªè¿”å›å€¼ã€‚\n\n```Lua\nlocal function init()       -- init å‡½æ•° è¿”å›ä¸¤ä¸ªå€¼ 1 å’Œ \"lua\"\n    return 1, \"lua\"\nend\n\nlocal x, y, z = init(), 2   -- init å‡½æ•°çš„ä½ç½®ä¸åœ¨æœ€åï¼Œæ­¤æ—¶åªè¿”å› 1\nprint(x, y, z)              --\u003eoutput  1  2  nil\n\nlocal a, b, c = 2, init()   -- init å‡½æ•°çš„ä½ç½®åœ¨æœ€åï¼Œæ­¤æ—¶è¿”å› 1 å’Œ \"lua\"\nprint(a, b, c)              --\u003eoutput  2  1  lua\n```\n\nå‡½æ•°è°ƒç”¨çš„å®å‚åˆ—è¡¨ä¹Ÿæ˜¯ä¸€ä¸ªåˆ—è¡¨è¡¨è¾¾å¼ã€‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```Lua\nlocal function init()\n    return 1, \"lua\"\nend\n\nprint(init(), 2)   --\u003eoutput  1  2\nprint(2, init())   --\u003eoutput  2  1  lua\n```\n\nå¦‚æœä½ ç¡®ä¿åªå–å‡½æ•°è¿”å›å€¼çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨æ‹¬å·è¿ç®—ç¬¦\n\n```Lua\nlocal function init()\n    return 1, \"lua\"\nend\nprint((init()), 2)   --\u003eoutput  1  2\nprint(2, (init()))   --\u003eoutput  2  1\n```\n\n**å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœå®å‚åˆ—è¡¨ä¸­æŸä¸ªå‡½æ•°ä¼šè¿”å›å¤šä¸ªå€¼ï¼ŒåŒæ—¶è°ƒç”¨è€…åˆæ²¡æœ‰æ˜¾å¼åœ°ä½¿ç”¨æ‹¬å·è¿ç®—ç¬¦æ¥ç­›é€‰å’Œè¿‡æ»¤ï¼Œåˆ™è¿™æ ·çš„è¡¨è¾¾å¼æ˜¯ä¸èƒ½è¢« LuaJIT 2 æ‰€ JIT ç¼–è¯‘çš„ï¼Œè€Œåªèƒ½è¢«è§£é‡Šæ‰§è¡Œã€‚**\n\n  \n\n  \n\n# å…¨åŠ¨æ€å‡½æ•°è°ƒç”¨\n\nè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå¹¶æŠŠä¸€ä¸ªæ•°ç»„å‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ã€‚\n\n```Lua\nlocal args = {...} or {}\nmethod_name(unpack(args, 1, table.maxn(args)))\n```\n\n```Lua\nlocal function run(x, y)\n    print('run', x, y)\nend\n\nlocal function attack(targetId)\n    print('targetId', targetId)\nend\n\nlocal function do_action(method, ...)\n    local args = {...} or {}\n    method(unpack(args, 1, table.maxn(args)))\nend\n\ndo_action(run, 1, 2)         -- output: run 1 2\ndo_action(attack, 1111)      -- output: targetId    1111\n```\n\n  \n\n# æ¨¡å—\n\nä» Lua 5.1 è¯­è¨€æ·»åŠ äº†å¯¹æ¨¡å—å’ŒåŒ…çš„æ”¯æŒã€‚ä¸€**ä¸ª Lua æ¨¡å—çš„æ•°æ®ç»“æ„æ˜¯ç”¨ä¸€ä¸ª Lua å€¼ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ª Lua è¡¨æˆ–è€… Lua å‡½æ•°ï¼‰**ã€‚**ä¸€ä¸ª Lua æ¨¡å—ä»£ç å°±æ˜¯ä¸€ä¸ªä¼šè¿”å›è¿™ä¸ª Lua å€¼çš„ä»£ç å—**\n\n- å¯ä»¥ä½¿ç”¨å†…å»ºå‡½æ•° `require()` æ¥åŠ è½½å’Œç¼“å­˜æ¨¡å—ã€‚\n    \n- ç®€å•çš„è¯´ï¼Œä¸€ä¸ªä»£ç æ¨¡å—å°±æ˜¯ä¸€ä¸ªç¨‹åºåº“ï¼Œå¯ä»¥é€šè¿‡ `require` æ¥åŠ è½½ã€‚**æ¨¡å—åŠ è½½åçš„ç»“æœé€šè¿‡æ˜¯ä¸€ä¸ª Lua table**\n    \n- **è¿™ä¸ªè¡¨å°±åƒæ˜¯ä¸€ä¸ªå‘½åç©ºé—´**ï¼Œå…¶å†…å®¹å°±æ˜¯æ¨¡å—ä¸­å¯¼å‡ºçš„æ‰€æœ‰ä¸œè¥¿ï¼Œ**æ¯”å¦‚å‡½æ•°å’Œå˜é‡**ã€‚`require` å‡½æ•°ä¼šè¿”å› Lua æ¨¡å—åŠ è½½åçš„ç»“æœï¼Œå³ç”¨äºè¡¨ç¤ºè¯¥ Lua æ¨¡å—çš„ Lua å€¼ã€‚\n    \n\n  \n\n  \n\nLua æä¾›äº†ä¸€ä¸ªåä¸º `require` çš„å‡½æ•°ç”¨æ¥åŠ è½½æ¨¡å—ã€‚**è¦åŠ è½½ä¸€ä¸ªæ¨¡å—ï¼Œåªéœ€è¦ç®€å•åœ°è°ƒç”¨** **`require`** **\"file\" å°±å¯ä»¥äº†ï¼Œfile æŒ‡æ¨¡å—æ‰€åœ¨çš„æ–‡ä»¶å**ã€‚è¿™ä¸ªè°ƒç”¨ä¼šè¿”å›ä¸€ä¸ªç”±æ¨¡å—å‡½æ•°ç»„æˆçš„ tableï¼Œå¹¶ä¸”è¿˜ä¼šå®šä¹‰ä¸€ä¸ªåŒ…å«è¯¥ table çš„å…¨å±€å˜é‡ã€‚\n\nåœ¨ Lua ä¸­åˆ›å»ºä¸€ä¸ªæ¨¡å—æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼š**åˆ›å»ºä¸€ä¸ª tableï¼Œå¹¶å°†æ‰€æœ‰éœ€è¦å¯¼å‡ºçš„å‡½æ•°æ”¾å…¥å…¶ä¸­ï¼Œæœ€åè¿”å›è¿™ä¸ª table å°±å¯ä»¥äº†ã€‚ç›¸å½“äºå°†å¯¼å‡ºçš„å‡½æ•°ä½œä¸º table çš„ä¸€ä¸ªå­—æ®µï¼Œåœ¨ Lua ä¸­å‡½æ•°æ˜¯ç¬¬ä¸€ç±»å€¼ï¼Œæä¾›äº†å¤©ç„¶çš„ä¼˜åŠ¿ã€‚**\n\n- åˆ›å»º my. Lua\n    \n\n```Lua\nlocal _M = {}\n\nlocal function get_name()\n    return \"Lucy\"\n    end\nfunction _M.greeting()\n    print(\"hello \" .. get_name())\nend\n\nreturn _M\n```\n\n- æŠŠä¸‹é¢ä»£ç ä¿å­˜åœ¨æ–‡ä»¶ main. Lua ä¸­ï¼Œç„¶åæ‰§è¡Œ main. Luaï¼Œè°ƒç”¨ä¸Šè¿°æ¨¡å—ã€‚\n    \n\n```Lua\nlocal my_module = require(\"my\")\nmy_module.greeting()     --\u003eoutput: hello Lucy\n```\n\n  \n\n\u003e - å¯¹äºéœ€è¦å¯¼å‡ºç»™å¤–éƒ¨ä½¿ç”¨çš„å…¬å…±æ¨¡å—ï¼Œå¤„äºå®‰å…¨è€ƒè™‘ï¼Œ**æ˜¯è¦é¿å…å…¨å±€å˜é‡çš„å‡ºç°**ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ lj-releng æˆ– luacheck å·¥å…·å®Œæˆå…¨å±€å˜é‡çš„æ£€æµ‹ã€‚è‡³äºå¦‚ä½•åšï¼Œåˆ°åé¢å†è®²ã€‚\n\u003e     \n\u003e - å¦ä¸€ä¸ªè¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºåœ¨ LuaJIT ä¸­ï¼Œ**require å‡½æ•°å†…ä¸èƒ½è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢**ï¼Œ**æ‰€ä»¥ä¸èƒ½å¤Ÿåœ¨æ¨¡å—çš„é¡¶çº§ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ cosocket ä¸€ç±»çš„ API**ã€‚å¦åˆ™ä¼šæŠ¥ `attempt to yield across C-call boundary` é”™è¯¯ã€‚\n\u003e     \n\n  \n\n# String\n\nLua å­—ç¬¦ä¸²æ€»æ˜¯ç”±å­—èŠ‚æ„æˆçš„ã€‚Lua æ ¸å¿ƒå¹¶ä¸å°è¯•ç†è§£å…·ä½“çš„å­—ç¬¦é›†ç¼–ç ï¼ˆæ¯”å¦‚ GBK å’Œ UTF-8 è¿™æ ·çš„å¤šå­—èŠ‚å­—ç¬¦ç¼–ç ï¼‰\n\nLua å­—ç¬¦ä¸²å†…éƒ¨ç”¨æ¥æ ‡è¯†å„ä¸ªç»„æˆå­—èŠ‚çš„ä¸‹æ ‡æ˜¯ä» 1 å¼€å§‹çš„ï¼Œè¿™ä¸åŒäºåƒ C å’Œ Perl è¿™æ ·çš„ç¼–ç¨‹è¯­è¨€ã€‚è¿™æ ·æ•°å­—ç¬¦ä¸²ä½ç½®çš„æ—¶å€™å†ä¹Ÿä¸ç”¨è°ƒæ•´ï¼Œå¯¹äºéä¸“ä¸šçš„å¼€å‘è€…æ¥è¯´å¯èƒ½ä¹Ÿæ˜¯ä¸€ä¸ªå¥½äº‹æƒ…ï¼Œ**string.Sub (str, 3, 7) ç›´æ¥è¡¨ç¤ºä»ç¬¬ä¸‰ä¸ªå­—ç¬¦å¼€å§‹åˆ°ç¬¬ä¸ƒä¸ªå­—ç¬¦ï¼ˆå«ï¼‰ä¸ºæ­¢çš„å­ä¸²ã€‚**\n\n## **string.Byte (s [, i [, j ]])**\n\nè¿”å›å­—ç¬¦ s[i]ã€s[i + 1]ã€s[i + 2]ã€Â·Â·Â·Â·Â·Â·ã€s[j] æ‰€å¯¹åº”çš„ ASCII ç \n\n```Lua\nprint(string.byte(\"abc\", 1, 3))\nprint(string.byte(\"abc\", 3)) -- ç¼ºå°‘ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°é»˜è®¤ä¸ç¬¬äºŒä¸ªç›¸åŒï¼Œæ­¤æ—¶ä¸º 3\nprint(string.byte(\"abc\"))    -- ç¼ºå°‘ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œæ­¤æ—¶è¿™ä¸¤ä¸ªå‚æ•°éƒ½é»˜è®¤ä¸º 1\n\n--\u003eoutput\n97    98    99\n99\n97\n```\n\n## **string. Char (...)**\n\næ¥æ”¶ 0 ä¸ªæˆ–æ›´å¤šçš„æ•´æ•°ï¼ˆæ•´æ•°èŒƒå›´ï¼š0~255ï¼‰ï¼Œè¿”å›è¿™äº›æ•´æ•°æ‰€å¯¹åº”çš„ ASCII ç å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ã€‚å½“å‚æ•°ä¸ºç©ºæ—¶ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ª 0ã€‚\n\n```Lua\nprint(string.char(96, 97, 98))\nprint(string.char())        -- å‚æ•°ä¸ºç©ºï¼Œé»˜è®¤æ˜¯ä¸€ä¸ª0ï¼Œ-- ä½ å¯ä»¥ç”¨string.byte(string.char())æµ‹è¯•ä¸€ä¸‹print(string.char(65, 66))\n\n--\u003e output\n`ab\n\nAB\n```\n\n## **string.Upper (s)**\n\næ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œè¿”å›ä¸€ä¸ªæŠŠæ‰€æœ‰å°å†™å­—æ¯å˜æˆå¤§å†™å­—æ¯çš„å­—ç¬¦ä¸²ã€‚\n\n```Lua\nprint(string.upper(\"Hello Lua\"))  --\u003eoutput  HELLO LUA\n```\n\n## **string.Lower (s)**\n\næ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œè¿”å›ä¸€ä¸ªæŠŠæ‰€æœ‰å¤§å†™å­—æ¯å˜æˆå°å†™å­—æ¯çš„å­—ç¬¦ä¸²ã€‚\n\n```Lua\nprint(string.lower(\"Hello Lua\"))  --\u003eoutput   hello lua\n```\n\n## **string.Len (s)**\n\næ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿”å›å®ƒçš„é•¿åº¦ã€‚\n\n```Lua\nprint(string.len(\"hello lua\")) --\u003eoutput  9\n```\n\nä½¿ç”¨æ­¤å‡½æ•°æ˜¯ä¸æ¨èçš„ã€‚åº”å½“æ€»æ˜¯ä½¿ç”¨ `#` è¿ç®—ç¬¦æ¥è·å– Lua å­—ç¬¦ä¸²çš„é•¿åº¦\n\n## **string.Find (s, p [, init [, plain]])**\n\nåœ¨ s å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡åŒ¹é… p å­—ç¬¦ä¸²ã€‚è‹¥åŒ¹é…æˆåŠŸï¼Œåˆ™è¿”å› p å­—ç¬¦ä¸²åœ¨ s å­—ç¬¦ä¸²ä¸­å‡ºç°çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ï¼›è‹¥åŒ¹é…å¤±è´¥ï¼Œåˆ™è¿”å› nil,\n\nç¬¬ä¸‰ä¸ªå‚æ•°ç¬¬ä¸‰ä¸ªå‚æ•° init é»˜è®¤ä¸º 1ï¼Œå¹¶ä¸”å¯ä»¥ä¸ºè´Ÿæ•´æ•°ï¼Œ\n\nå½“ init ä¸ºè´Ÿæ•°æ—¶ï¼Œè¡¨ç¤ºä» s å­—ç¬¦ä¸²çš„ string.Len (s) + init + 1 ç´¢å¼•å¤„å¼€å§‹å‘ååŒ¹é…å­—ç¬¦ä¸² p ã€‚\n\nç¬¬å››ä¸ªå‚æ•°é»˜è®¤ä¸º falseï¼Œå½“å…¶ä¸º true æ—¶ï¼Œåªä¼šæŠŠ p çœ‹æˆä¸€ä¸ªå­—ç¬¦ä¸²å¯¹å¾…ã€‚\n\n```Lua\nlocal find = string.find\nprint(find(\"abc cba\", \"ab\"))\nprint(find(\"abc cba\", \"ab\", 2))     -- ä»ç´¢å¼•ä¸º2çš„ä½ç½®å¼€å§‹åŒ¹é…å­—ç¬¦ä¸²ï¼šab\nprint(find(\"abc cba\", \"ba\", -1))    -- ä»ç´¢å¼•ä¸º7çš„ä½ç½®å¼€å§‹åŒ¹é…å­—ç¬¦ä¸²ï¼šba\nprint(find(\"abc cba\", \"ba\", -3))    -- ä»ç´¢å¼•ä¸º5çš„ä½ç½®å¼€å§‹åŒ¹é…å­—ç¬¦ä¸²ï¼šba\nprint(find(\"abc cba\", \"(%a+)\", 1))  -- ä»ç´¢å¼•ä¸º1å¤„åŒ¹é…æœ€é•¿è¿ç»­ä¸”åªå«å­—æ¯çš„å­—ç¬¦ä¸²\nprint(find(\"abc cba\", \"(%a+)\", 1, true)) --ä»ç´¢å¼•ä¸º1çš„ä½ç½®å¼€å§‹åŒ¹é…å­—ç¬¦ä¸²ï¼š(%a+)\n\n--\u003eoutput\n1   2\nnil\nnil\n6   7\n1   3   abc\nnil\n```\n\n## **string.Format (formatstring, ...)**\n\næŒ‰ç…§æ ¼å¼åŒ–å‚æ•° formatstringï¼Œè¿”å›åé¢ `...` å†…å®¹çš„æ ¼å¼åŒ–ç‰ˆæœ¬\n\n```Plaintext\nprint(string.format(\"%.4f\", 3.1415926))     -- ä¿ç•™4ä½å°æ•°\nprint(string.format(\"%d %x %o\", 31, 31, 31))-- åè¿›åˆ¶æ•°31è½¬æ¢æˆä¸åŒè¿›åˆ¶\nd = 29; m = 7; y = 2015                     -- ä¸€è¡ŒåŒ…å«å‡ ä¸ªè¯­å¥ï¼Œç”¨ï¼›åˆ†å¼€\nprint(string.format(\"%s %02d/%02d/%d\", \"today is:\", d, m, y))\n\n--\u003eoutput\n3.1416\n31 1f 37\ntoday is: 29/07/2015\n```\n\n## **string.Match (s, p [, init])**\n\nåœ¨å­—ç¬¦ä¸² s ä¸­åŒ¹é…ï¼ˆæ¨¡å¼ï¼‰å­—ç¬¦ä¸² pï¼Œè‹¥åŒ¹é…æˆåŠŸï¼Œåˆ™è¿”å›ç›®æ ‡å­—ç¬¦ä¸²ä¸­ä¸æ¨¡å¼åŒ¹é…çš„å­ä¸²ï¼›å¦åˆ™è¿”å› nilã€‚ç¬¬ä¸‰ä¸ªå‚æ•° init é»˜è®¤ä¸º 1ï¼Œå¹¶ä¸”å¯ä»¥ä¸ºè´Ÿæ•´æ•°ï¼Œå½“ init ä¸ºè´Ÿæ•°æ—¶ï¼Œè¡¨ç¤ºä» s å­—ç¬¦ä¸²çš„ string.Len (s) + init + 1 ç´¢å¼•å¤„å¼€å§‹å‘ååŒ¹é…å­—ç¬¦ä¸² pã€‚\n\n```Lua\nprint(string.match(\"hello lua\", \"lua\"))\nprint(string.match(\"lua lua\", \"lua\", 2))  --åŒ¹é…åé¢é‚£ä¸ªluaprint(string.match(\"lua lua\", \"hello\"))\nprint(string.match(\"today is 27/7/2015\", \"%d+/%d+/%d+\"))\n\n--\u003eoutput\nlua\nlua\nnil27/7/2015\n```\n\n## **string.Gmatch (s, p)**\n\nè¿”å›ä¸€ä¸ªè¿­ä»£å™¨å‡½æ•°ï¼Œé€šè¿‡è¿™ä¸ªè¿­ä»£å™¨å‡½æ•°å¯ä»¥éå†åˆ°åœ¨å­—ç¬¦ä¸² s ä¸­å‡ºç°æ¨¡å¼ä¸² p çš„æ‰€æœ‰åœ°æ–¹ã€‚\n\n```Lua\ns = \"hello world from Lua\"\nfor w in string.gmatch(s, \"%a+\") do  --åŒ¹é…æœ€é•¿è¿ç»­ä¸”åªå«å­—æ¯çš„å­—ç¬¦ä¸²\n    print(w)\nend\n\n--\u003eoutput\nhello\nworld\nfrom\nLua\n\n\nt = {}\ns = \"from=world, to=Lua\"\nfor k, v in string.gmatch(s, \"(%a+)=(%a+)\") do  --åŒ¹é…ä¸¤ä¸ªæœ€é•¿è¿ç»­ä¸”åªå«å­—æ¯çš„\n    t[k] = v                                    --å­—ç¬¦ä¸²ï¼Œå®ƒä»¬ä¹‹é—´ç”¨ç­‰å·è¿æ¥\nend\nfor k, v in pairs(t) do\n    print (k,v)\nend\n\n--\u003eoutput\nto      Lua\nfrom    worl\n```\n\n## **string.Rep (s, n)**\n\nè¿”å›å­—ç¬¦ä¸² s çš„ n æ¬¡æ‹·è´ã€‚\n\n```Lua\nprint(string.rep(\"abc\", 3)) \n\n--æ‹·è´3æ¬¡\"abc\"--\u003eoutput  abcabcabc\n```\n\n## **string.Sub (s, i [, j])**\n\nè¿”å›å­—ç¬¦ä¸² s ä¸­ï¼Œç´¢å¼• i åˆ°ç´¢å¼• j ä¹‹é—´çš„å­å­—ç¬¦ä¸²ã€‚å½“ j ç¼ºçœæ—¶ï¼Œé»˜è®¤ä¸º -1ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸² s çš„æœ€åä½ç½®ã€‚I å¯ä»¥ä¸ºè´Ÿæ•°ã€‚å½“ç´¢å¼• i åœ¨å­—ç¬¦ä¸² s çš„ä½ç½®åœ¨ç´¢å¼• j çš„åé¢æ—¶ï¼Œå°†è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚\n\n```Lua\nprint(string.sub(\"Hello Lua\", 4, 7))\nprint(string.sub(\"Hello Lua\", 2))\nprint(string.sub(\"Hello Lua\", 2, 1))    --çœ‹åˆ°è¿”å›ä»€ä¹ˆäº†å—print(string.sub(\"Hello Lua\", -3, -1))\n\n--\u003eoutput\nlo L\nello Lua\n\nLua\n```\n\n## **string.Gsub (s, p, r [, n])**\n\nå°†ç›®æ ‡å­—ç¬¦ä¸² s ä¸­æ‰€æœ‰çš„å­ä¸² p æ›¿æ¢æˆå­—ç¬¦ä¸² rã€‚å¯é€‰å‚æ•° nï¼Œè¡¨ç¤ºé™åˆ¶æ›¿æ¢æ¬¡æ•°ã€‚è¿”å›å€¼æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€ä¸ªæ˜¯è¢«æ›¿æ¢åçš„å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªæ˜¯æ›¿æ¢äº†å¤šå°‘æ¬¡ã€‚\n\n```Plaintext\nprint(string.gsub(\"Lua Lua Lua\", \"Lua\", \"hello\"))\nprint(string.gsub(\"Lua Lua Lua\", \"Lua\", \"hello\", 2)) --æŒ‡æ˜ç¬¬å››ä¸ªå‚æ•°--\u003eoutput\nhello hello hello   3\nhello hello Lua     2\n```\n\n## **string. Reverse (s)**\n\næ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œè¿”å›è¿™ä¸ªå­—ç¬¦ä¸²çš„åè½¬\n\n```Lua\nprint(string.reverse(\"Hello Lua\"))  --\u003e output: auL olleH\n```\n\n  \n\n# Table\n\n## **ä¸‹æ ‡ä» 1 å¼€å§‹**\n\næ•°ç»„ä¸‹æ ‡ä» 1 å¼€å§‹è®¡æ•°ã€‚\n\nè€Œ Lua æœ€åˆè®¾è®¡æ˜¯ä¸€ç§ç±»ä¼¼ XML çš„æ•°æ®æè¿°è¯­è¨€ï¼Œæ‰€ä»¥ç´¢å¼•ï¼ˆindexï¼‰ååº”çš„æ˜¯æ•°æ®åœ¨é‡Œé¢çš„ä½ç½®ï¼Œè€Œä¸æ˜¯åç§»é‡ã€‚\n\n  \n\nåœ¨åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„çš„æ—¶å€™ï¼Œ**è‹¥ä¸æ˜¾å¼åœ°ç”¨é”®å€¼å¯¹æ–¹å¼èµ‹å€¼ï¼Œåˆ™ä¼šé»˜è®¤ç”¨æ•°å­—ä½œä¸ºä¸‹æ ‡**ï¼Œä» 1 å¼€å§‹ã€‚ç”±äºåœ¨ _Lua_ å†…éƒ¨å®é™…é‡‡ç”¨å“ˆå¸Œè¡¨å’Œæ•°ç»„åˆ†åˆ«ä¿å­˜é”®å€¼å¯¹ã€æ™®é€šå€¼ï¼Œæ‰€ä»¥ä¸æ¨èæ··åˆä½¿ç”¨è¿™ä¸¤ç§èµ‹å€¼æ–¹å¼\n\n```Lua\nlocal color={first=\"red\", \"blue\", third=\"green\", \"yellow\"}\nprint(color[\"first\"])                 --\u003e output: red\nprint(color[1])                       --\u003e output: blue\nprint(color[\"third\"])                 --\u003e output: green\nprint(color[2])                       --\u003e output: yellow\nprint(color[3])                       --\u003e output: nil\n```\n\n- **å½“æˆ‘ä»¬æŠŠ table å½“ä½œæ ˆæˆ–è€…é˜Ÿåˆ—ä½¿ç”¨çš„æ—¶å€™ï¼Œå®¹æ˜“çŠ¯é”™ï¼Œè¿½åŠ åˆ° table çš„æœ«å°¾ç”¨çš„æ˜¯** **`s[#s+1] = something`****, è€Œä¸æ˜¯** **`s[#s] = something`**\n    \n- è€Œä¸”å¦‚æœè¿™ä¸ª something æ˜¯ä¸€ä¸ª nil çš„è¯**ï¼Œä¼šå¯¼è‡´è¿™ä¸€æ¬¡å‹æ ˆï¼ˆæˆ–è€…å…¥é˜Ÿåˆ—ï¼‰æ²¡æœ‰å­˜å…¥ä»»ä½•ä¸œè¥¿**ï¼Œ s çš„å€¼æ²¡æœ‰å˜\n    \n- å¦‚æœ `s = { 1, 2, 3, 4, 5, 6 }`ï¼Œä½ ä»¤ `s[4] = nil`ï¼Œ s ä¼šä»¤ä½ â€œåŒªå¤·æ‰€æ€â€åœ°å˜æˆ 3ã€‚\n    \n\n## **table. Getn è·å–é•¿åº¦**\n\nå–é•¿åº¦æ“ä½œç¬¦å†™ä½œä¸€å…ƒæ“ä½œ ã€‚å­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯å®ƒçš„å­—èŠ‚æ•°ï¼ˆå°±æ˜¯ä»¥ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—èŠ‚è®¡ç®—çš„å­—ç¬¦ä¸²é•¿åº¦ï¼‰\n\n- å¯¹äºå¸¸è§„çš„æ•°ç»„ï¼Œé‡Œé¢ä» 1 åˆ° n æ”¾ç€ä¸€äº›éç©ºçš„å€¼çš„æ—¶å€™ï¼Œå®ƒçš„é•¿åº¦å°±ç²¾ç¡®çš„ä¸º nï¼Œå³æœ€åä¸€ä¸ªå€¼çš„ä¸‹æ ‡\n    \n- å¦‚æœæ•°ç»„æœ‰ä¸€ä¸ªâ€œç©ºæ´â€ï¼ˆ**å°±æ˜¯è¯´ï¼Œnil å€¼è¢«å¤¹åœ¨éç©ºå€¼ä¹‹é—´**ï¼‰ï¼Œ**é‚£ä¹ˆ t å¯èƒ½æ˜¯æŒ‡å‘ä»»ä½•ä¸€ä¸ªæ˜¯ nil å€¼çš„å‰ä¸€ä¸ªä½ç½®çš„ä¸‹æ ‡**\n    \n- è¿™ä¹Ÿå°±è¯´æ˜å¯¹äºæœ‰â€œç©ºæ´â€çš„æƒ…å†µï¼Œtable çš„é•¿åº¦å­˜åœ¨ä¸€å®šçš„ **ä¸å¯ç¡®å®šæ€§**\n    \n\n```Lua\nlocal tblTest1 = { 1, a = 2, 3 }\nprint(\"Test1 \" .. table.getn(tblTest1))\n\nlocal tblTest2 = { 1, nil }\nprint(\"Test2 \" .. table.getn(tblTest2))\n\nlocal tblTest3 = { 1, nil, 2 }\nprint(\"Test3 \" .. table.getn(tblTest3))\n\nlocal tblTest4 = { 1, nil, 2, nil }\nprint(\"Test4 \" .. table.getn(tblTest4))\n\nlocal tblTest5 = { 1, nil, 2, nil, 3, nil }\nprint(\"Test5 \" .. table.getn(tblTest5))\n\nlocal tblTest6 = { 1, nil, 2, nil, 3, nil, 4, nil }\nprint(\"Test6 \" .. table.getn(tblTest6))\n```\n\næˆ‘ä»¬ä½¿ç”¨ Lua 5.1 å’Œ LuaJIT 2.1 åˆ†åˆ«æ‰§è¡Œè¿™ä¸ªç”¨ä¾‹ï¼Œç»“æœå¦‚ä¸‹ï¼š\n\n```Lua\n# lua test.lua\nTest1 2\nTest2 1\nTest3 3\nTest4 1\nTest5 3\nTest6 1\n# luajit test.lua\nTest1 2\nTest2 1\nTest3 1\nTest4 1\nTest5 1\nTest6 1\n```\n\nä¸è¦åœ¨ Lua çš„ table ä¸­ä½¿ç”¨ nil å€¼ï¼Œ**å¦‚æœä¸€ä¸ªå…ƒç´ è¦åˆ é™¤ï¼Œç›´æ¥ removeï¼Œä¸è¦ç”¨ nil å»ä»£æ›¿**ã€‚\n\n## **table. Concat (table [, sep [, i [, j ] ] ])**\n\nå¯¹äºå…ƒç´ æ˜¯ string æˆ–è€… number ç±»å‹çš„è¡¨ tableï¼Œè¿”å› `table[i]..sep..table[i+1] Â·Â·Â· sep..table[j]` è¿æ¥æˆçš„å­—ç¬¦ä¸²ã€‚å¡«å……å­—ç¬¦ä¸² sep é»˜è®¤ä¸ºç©ºç™½å­—ç¬¦ä¸²ã€‚èµ·å§‹ç´¢å¼•ä½ç½® i é»˜è®¤ä¸º 1ï¼Œç»“æŸç´¢å¼•ä½ç½® j é»˜è®¤æ˜¯ table çš„é•¿åº¦ã€‚\n\n```Lua\nlocal a = {1, 3, 5, \"hello\" }\nprint(table.concat(a))              -- output: 135hello\nprint(table.concat(a, \"|\"))         -- output: 1|3|5|hello\nprint(table.concat(a, \" \", 4, 2))   -- output:\nprint(table.concat(a, \" \", 2, 4))   -- output: 3 5 hello\n```\n\n## **table. Insert (table, [pos ,] value)**\n\nåœ¨ï¼ˆæ•°ç»„å‹ï¼‰è¡¨ table çš„ pos ç´¢å¼•ä½ç½®æ’å…¥ valueï¼Œå…¶å®ƒå…ƒç´ å‘åç§»åŠ¨åˆ°ç©ºçš„åœ°æ–¹ã€‚Pos çš„é»˜è®¤å€¼æ˜¯è¡¨çš„é•¿åº¦åŠ ä¸€ï¼Œå³é»˜è®¤æ˜¯æ’åœ¨è¡¨çš„æœ€å\n\n```Lua\nlocal a = {1, 8}             --a[1] = 1,a[2] = 8\ntable.insert(a, 1, 3)   --åœ¨è¡¨ç´¢å¼•ä¸º1å¤„æ’å…¥3\nprint(a[1], a[2], a[3])\ntable.insert(a, 10)    --åœ¨è¡¨çš„æœ€åæ’å…¥10\nprint(a[1], a[2], a[3], a[4])\n\n--\u003eoutput\n3    1    8\n3    1    8    10\n```\n\n## **table. Maxn (table)**\n\nè¿”å›ï¼ˆæ•°ç»„å‹ï¼‰è¡¨ table çš„æœ€å¤§ç´¢å¼•ç¼–å·ï¼›å¦‚æœæ­¤è¡¨æ²¡æœ‰æ­£çš„ç´¢å¼•ç¼–å·ï¼Œè¿”å› 0ã€‚\n\n```Lua\nlocal a = {}\na[-1] = 10\nprint(table.maxn(a))\na[5] = 10\nprint(table.maxn(a))\n\n--\u003eoutput05\n```\n\n## **table. Remove (table [, pos])**\n\nåœ¨è¡¨ table ä¸­åˆ é™¤ç´¢å¼•ä¸º posï¼ˆpos åªèƒ½æ˜¯ number å‹ï¼‰çš„å…ƒç´ ï¼Œå¹¶è¿”å›è¿™ä¸ªè¢«åˆ é™¤çš„å…ƒç´ ï¼Œå®ƒåé¢æ‰€æœ‰å…ƒç´ çš„ç´¢å¼•å€¼éƒ½ä¼šå‡ä¸€ã€‚Pos çš„é»˜è®¤å€¼æ˜¯è¡¨çš„é•¿åº¦ï¼Œå³é»˜è®¤æ˜¯åˆ é™¤è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚\n\n```Lua\nlocal a = { 1, 2, 3, 4}\nprint(table.remove(a, 1)) --åˆ é™¤é€Ÿç´¢å¼•ä¸º1çš„å…ƒç´ print(a[1], a[2], a[3], a[4])\n\nprint(table.remove(a))   --åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ print(a[1], a[2], a[3], a[4])\n\n--\u003eoutput12    3    4    nil42    3    nil    nil\n```\n\n## **table. Sort (table [, comp])**\n\næŒ‰ç…§ç»™å®šçš„æ¯”è¾ƒå‡½æ•° comp ç»™è¡¨ table æ’åºï¼Œä¹Ÿå°±æ˜¯ä» table[1] åˆ° table[n]ï¼Œè¿™é‡Œ n è¡¨ç¤º table çš„é•¿åº¦ã€‚æ¯”è¾ƒå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå¦‚æœå¸Œæœ›ç¬¬ä¸€ä¸ªå‚æ•°æ’åœ¨ç¬¬äºŒä¸ªçš„å‰é¢ï¼Œå°±åº”è¯¥è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚å¦‚æœæ¯”è¾ƒå‡½æ•° comp æ²¡æœ‰ç»™å‡ºï¼Œé»˜è®¤ä»å°åˆ°å¤§æ’åºã€‚\n\n```Lua\n\nlocal function compare(x, y) --ä»å¤§åˆ°å°æ’åº\n    return x \u003e y         --å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å¤§äºç¬¬äºŒä¸ªå°±è¿”å›trueï¼Œå¦åˆ™è¿”å›false\nend\n\nlocal a = { 1, 7, 3, 4, 25}\ntable.sort(a)           --é»˜è®¤ä»å°åˆ°å¤§æ’åº\nprint(a[1], a[2], a[3], a[4], a[5])\ntable.sort(a, compare) --ä½¿ç”¨æ¯”è¾ƒå‡½æ•°è¿›è¡Œæ’åº\nprint(a[1], a[2], a[3], a[4], a[5])\n\n--\u003eoutput\n1    3    4    7    25\n25    7    4    3    1\n```\n\n## å…¶ä»–\n\nLuaJIT 2.1 æ–°å¢åŠ çš„ `table.new` å’Œ `table.clear` å‡½æ•°æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚å‰è€…ä¸»è¦ç”¨æ¥é¢„åˆ†é… Lua table ç©ºé—´ï¼Œåè€…ä¸»è¦ç”¨æ¥é«˜æ•ˆçš„é‡Šæ”¾ table ç©ºé—´ï¼Œå¹¶ä¸”å®ƒä»¬éƒ½æ˜¯å¯ä»¥è¢« JIT ç¼–è¯‘çš„\n\n  \n\n# æ—¥æœŸæ—¶é—´\n\nå‡½æ•° timeã€date å’Œ difftime æä¾›äº†æ‰€æœ‰çš„æ—¥æœŸå’Œæ—¶é—´åŠŸèƒ½ã€‚\n\nåœ¨ OpenResty çš„ä¸–ç•Œé‡Œï¼Œä¸æ¨èä½¿ç”¨è¿™é‡Œçš„æ ‡å‡†æ—¶é—´å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°é€šå¸¸ä¼šå¼•å‘ä¸æ­¢ä¸€ä¸ªæ˜‚è´µçš„ç³»ç»Ÿè°ƒç”¨ï¼ŒåŒæ—¶æ— æ³•ä¸º LuaJIT JIT ç¼–è¯‘ï¼Œå¯¹æ€§èƒ½é€ æˆè¾ƒå¤§å½±å“ã€‚æ¨èä½¿ç”¨ ngx_lua æ¨¡å—æä¾›çš„å¸¦ç¼“å­˜çš„æ—¶é—´æ¥å£ï¼Œå¦‚ `ngx.today`, `ngx.time`, `ngx.utctime`, `ngx.localtime`, `ngx.now`, `ngx.http_time`ï¼Œä»¥åŠ `ngx.cookie_time` ç­‰ã€‚\n\n  \n\n## **os. Time ([table])**\n\nå¦‚æœä¸ä½¿ç”¨å‚æ•° table è°ƒç”¨ time å‡½æ•°ï¼Œ\n\n- å®ƒä¼šè¿”å›å½“å‰çš„æ—¶é—´å’Œæ—¥æœŸï¼ˆå®ƒè¡¨ç¤ºä»æŸä¸€æ—¶åˆ»åˆ°ç°åœ¨çš„ç§’æ•°ï¼‰ã€‚\n    \n- å¦‚æœç”¨ table å‚æ•°ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºè¯¥ table ä¸­æ‰€æè¿°çš„æ—¥æœŸå’Œæ—¶é—´ï¼ˆå®ƒè¡¨ç¤ºä»æŸä¸€æ—¶åˆ»åˆ° table ä¸­æè¿°æ—¥æœŸå’Œæ—¶é—´çš„ç§’æ•°ï¼‰ã€‚Table çš„å­—æ®µå¦‚ä¸‹ï¼š\n    \n\n|          |                            |\n| -------- | -------------------------- |\n| å­—æ®µåç§° | å–å€¼èŒƒå›´                   |\n| year     | å››ä½æ•°å­—                   |\n| month    | 1--12                      |\n| day      | 1--31                      |\n| hour     | 0--23                      |\n| min      | 0--59                      |\n| sec      | 0--61                      |\n| isdst    | booleanï¼ˆtrue è¡¨ç¤ºå¤ä»¤æ—¶ï¼‰ |\n\nå¯¹äº time å‡½æ•°ï¼Œå¦‚æœå‚æ•°ä¸º tableï¼Œé‚£ä¹ˆ table ä¸­å¿…é¡»å«æœ‰ yearã€monthã€day å­—æ®µã€‚å…¶ä»–å­—ç¼ºçœæ—¶æ®µé»˜è®¤ä¸ºä¸­åˆï¼ˆ12:00:00ï¼‰ã€‚\n\n\u003e ç¤ºä¾‹ä»£ç ï¼šï¼ˆåœ°ç‚¹ä¸ºåŒ—äº¬ï¼‰\n\n```Plaintext\nprint(os.time())    --\u003eoutput  1438243393\na = { year = 1970, month = 1, day = 1, hour = 8, min = 1 }\nprint(os.time(a))   --\u003eoutput  60\n```\n\n## **os. Difftime (t 2, t 1)**\n\nè¿”å› t 1 åˆ° t 2 çš„æ—¶é—´å·®ï¼Œå•ä½ä¸ºç§’ã€‚\n\n\u003e ç¤ºä¾‹ä»£ç :\n\n```Plaintext\nlocal day1 = { year = 2015, month = 7, day = 30 }\nlocal t1 = os.time(day1)\n\nlocal day2 = { year = 2015, month = 7, day = 31 }\nlocal t2 = os.time(day2)\nprint(os.difftime(t2, t1))   --\u003eoutput  86400\n```\n\n## **os. Date ([format [, time]])**\n\næŠŠä¸€ä¸ªè¡¨ç¤ºæ—¥æœŸå’Œæ—¶é—´çš„æ•°å€¼ï¼Œè½¬æ¢æˆæ›´é«˜çº§çš„è¡¨ç°å½¢å¼ã€‚\n\n- å…¶ç¬¬ä¸€ä¸ªå‚æ•° format æ˜¯ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæè¿°äº†è¦è¿”å›çš„æ—¶é—´å½¢å¼ã€‚\n    \n- ç¬¬äºŒä¸ªå‚æ•° time å°±æ˜¯æ—¥æœŸå’Œæ—¶é—´çš„æ•°å­—è¡¨ç¤ºï¼Œç¼ºçœæ—¶é»˜è®¤ä¸ºå½“å‰çš„æ—¶é—´ã€‚\n    \n- ä½¿ç”¨æ ¼å¼å­—ç¬¦ \"*t\"ï¼Œåˆ›å»ºä¸€ä¸ªæ—¶é—´è¡¨ã€‚\n    \n\n\u003e ç¤ºä¾‹ä»£ç ï¼š\n\n```Plaintext\nlocal tab1 = os.date(\"*t\")  --è¿”å›ä¸€ä¸ªæè¿°å½“å‰æ—¥æœŸå’Œæ—¶é—´çš„è¡¨\nlocal ans1 = \"{\"\nfor k, v in pairs(tab1) do  --æŠŠtab1è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²\n    ans1 = string.format(\"%s %s = %s,\", ans1, k, tostring(v))\nend\n\nans1 = ans1 .. \"}\"\nprint(\"tab1 = \", ans1)\n\n\nlocal tab2 = os.date(\"*t\", 360)  --è¿”å›ä¸€ä¸ªæè¿°æ—¥æœŸå’Œæ—¶é—´æ•°ä¸º360ç§’çš„è¡¨\nlocal ans2 = \"{\"\nfor k, v in pairs(tab2) do      --æŠŠtab2è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²\n    ans2 = string.format(\"%s %s = %s,\", ans2, k, tostring(v))\nend\n\nans2 = ans2 .. \"}\"\nprint(\"tab2 = \", ans2)\n\n--\u003eoutput\ntab1 = { hour = 17, min = 28, wday = 5, day = 30, month = 7, year = 2015, sec = 10, yday = 211, isdst = false,}\ntab2 = { hour = 8, min = 6, wday = 5, day = 1, month = 1, year = 1970, sec = 0, yday = 1, isdst = false,}\n```\n\nè¯¥è¡¨ä¸­é™¤äº†ä½¿ç”¨åˆ°äº† time å‡½æ•°å‚æ•° table çš„å­—æ®µå¤–ï¼Œè¿™è¿˜æä¾›äº†æ˜ŸæœŸï¼ˆwdayï¼Œæ˜ŸæœŸå¤©ä¸º 1ï¼‰å’Œä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©ï¼ˆydayï¼Œä¸€æœˆä¸€æ—¥ä¸º 1ï¼‰ã€‚é™¤äº†ä½¿ç”¨ \"*t\" æ ¼å¼å­—ç¬¦ä¸²å¤–ï¼Œå¦‚æœä½¿ç”¨å¸¦æ ‡è®°ï¼ˆè§ä¸‹è¡¨ï¼‰çš„ç‰¹æ®Šå­—ç¬¦ä¸²ï¼Œos. Date å‡½æ•°ä¼šå°†ç›¸åº”çš„æ ‡è®°ä½ä»¥æ—¶é—´ä¿¡æ¯è¿›è¡Œå¡«å……ï¼Œå¾—åˆ°ä¸€ä¸ªåŒ…å«æ—¶é—´çš„å­—ç¬¦ä¸²ã€‚è¡¨å¦‚ä¸‹ï¼š\n\n|          |                                           |\n| -------- | ----------------------------------------- |\n| æ ¼å¼å­—ç¬¦ | å«ä¹‰                                      |\n| %a       | ä¸€æ˜ŸæœŸä¸­å¤©æ•°çš„ç®€å†™ï¼ˆä¾‹å¦‚ï¼šWedï¼‰           |\n| %A       | ä¸€æ˜ŸæœŸä¸­å¤©æ•°çš„å…¨ç§°ï¼ˆä¾‹å¦‚ï¼šWednesdayï¼‰     |\n| %b       | æœˆä»½çš„ç®€å†™ï¼ˆä¾‹å¦‚ï¼šSepï¼‰                   |\n| %B       | æœˆä»½çš„å…¨ç§°ï¼ˆä¾‹å¦‚ï¼šSeptemberï¼‰             |\n| %c       | æ—¥æœŸå’Œæ—¶é—´ï¼ˆä¾‹å¦‚ï¼š07/30/15 16:57:24ï¼‰     |\n| %d       | ä¸€ä¸ªæœˆä¸­çš„ç¬¬å‡ å¤©[01 ~ 31]                 |\n| %H       | 24 å°æ—¶åˆ¶ä¸­çš„å°æ—¶æ•°[00 ~ 23]              |\n| %I       | 12 å°æ—¶åˆ¶ä¸­çš„å°æ—¶æ•°[01 ~ 12]              |\n| %j       | ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©[001 ~ 366]                 |\n| %M       | åˆ†é’Ÿæ•°[00 ~ 59]                           |\n| %m       | æœˆä»½æ•°[01 ~ 12]                           |\n| %p       | â€œä¸Šåˆï¼ˆamï¼‰â€æˆ–â€œä¸‹åˆï¼ˆpmï¼‰â€                |\n| %S       | ç§’æ•°[00 ~ 59]                             |\n| %w       | ä¸€æ˜ŸæœŸä¸­çš„ç¬¬å‡ å¤©[1 ~ 7 = æ˜ŸæœŸå¤© ~ æ˜ŸæœŸå…­] |\n| %x       | æ—¥æœŸï¼ˆä¾‹å¦‚ï¼š07/30/15ï¼‰                    |\n| %X       | æ—¶é—´ï¼ˆä¾‹å¦‚ï¼š16:57:24ï¼‰                    |\n| %y       | ä¸¤ä½æ•°çš„å¹´ä»½[00 ~ 99]                     |\n| %Y       | å®Œæ•´çš„å¹´ä»½ï¼ˆä¾‹å¦‚ï¼š2015ï¼‰                  |\n| %%       | å­—ç¬¦'%'                                   |\n\n\u003e ç¤ºä¾‹ä»£ç ï¼š\n\n```Plaintext\nprint(os.date(\"today is %A, in %B\"))\nprint(os.date(\"now is %x %X\"))\n\n--\u003eoutput\ntoday is Thursday, in July\nnow is 07/30/15 17:39:22\n```\n\n  \n\n# æ•°å­¦åº“\n\nUa æ•°å­¦åº“ç”±ä¸€ç»„æ ‡å‡†çš„æ•°å­¦å‡½æ•°æ„æˆã€‚æ•°å­¦åº“çš„å¼•å…¥ä¸°å¯Œäº† Lua ç¼–ç¨‹è¯­è¨€çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿äº†ç¨‹åºçš„ç¼–å†™ã€‚å¸¸ç”¨æ•°å­¦å‡½æ•°è§ä¸‹è¡¨ï¼š\n\n|               asd           |                                                                                        sdfa                                                                                                      | \n| ------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| å‡½æ•°å                   | å‡½æ•°åŠŸèƒ½                                                                                                                                                                                     |\n| math.Rad (x)             | è§’åº¦ x è½¬æ¢æˆå¼§åº¦                                                                                                                                                                            |\n| math.Deg (x)             | å¼§åº¦ x è½¬æ¢æˆè§’åº¦                                                                                                                                                                            |\n| math.Max (x, ...)        | è¿”å›å‚æ•°ä¸­å€¼æœ€å¤§çš„é‚£ä¸ªæ•°ï¼Œå‚æ•°å¿…é¡»æ˜¯ number å‹                                                                                                                                               |\n| math.Min (x, ...)        | è¿”å›å‚æ•°ä¸­å€¼æœ€å°çš„é‚£ä¸ªæ•°ï¼Œå‚æ•°å¿…é¡»æ˜¯ number å‹                                                                                                                                               |\n| math. Random ([m [, n]]) | ä¸ä¼ å…¥å‚æ•°æ—¶ï¼Œè¿”å›ä¸€ä¸ªåœ¨åŒºé—´[0,1)å†…å‡åŒ€åˆ†å¸ƒçš„ä¼ªéšæœºå®æ•°ï¼›åªä½¿ç”¨ä¸€ä¸ªæ•´æ•°å‚æ•° m æ—¶ï¼Œè¿”å›ä¸€ä¸ªåœ¨åŒºé—´[1, m]å†…å‡åŒ€åˆ†å¸ƒçš„ä¼ªéšæœºæ•´æ•°ï¼›ä½¿ç”¨ä¸¤ä¸ªæ•´æ•°å‚æ•°æ—¶ï¼Œè¿”å›ä¸€ä¸ªåœ¨åŒºé—´[m, n]å†…å‡åŒ€åˆ†å¸ƒçš„ä¼ªéšæœºæ•´æ•° |\n| math. Randomseed (x)     | ä¸ºä¼ªéšæœºæ•°ç”Ÿæˆå™¨è®¾ç½®ä¸€ä¸ªç§å­ xï¼Œç›¸åŒçš„ç§å­å°†ä¼šç”Ÿæˆç›¸åŒçš„æ•°å­—åºåˆ—                                                                                                                             |\n| math.Abs (x)             | è¿”å› x çš„ç»å¯¹å€¼                                                                                                                                                                              |\n| math.Fmod (x, y)         | è¿”å› x å¯¹ y å–ä½™æ•°                                                                                                                                                                           |\n| math.Pow (x, y)          | è¿”å› x çš„ y æ¬¡æ–¹                                                                                                                                                                             |\n| math.Sqrt (x)            | è¿”å› x çš„ç®—æœ¯å¹³æ–¹æ ¹                                                                                                                                                                          |\n| math.Exp (x)             | è¿”å›è‡ªç„¶æ•° e çš„ x æ¬¡æ–¹                                                                                                                                                                       |\n| math.Log (x)             | è¿”å› x çš„è‡ªç„¶å¯¹æ•°                                                                                                                                                                            |\n| math. Log 10 (x)         | è¿”å›ä»¥ 10 ä¸ºåº•ï¼Œx çš„å¯¹æ•°                                                                                                                                                                     |\n| math.Floor (x)           | è¿”å›æœ€å¤§ä¸”ä¸å¤§äº x çš„æ•´æ•°                                                                                                                                                                    |\n| math.Ceil (x)            | è¿”å›æœ€å°ä¸”ä¸å°äº x çš„æ•´æ•°                                                                                                                                                                    |\n| math. Pi                 | åœ†å‘¨ç‡                                                                                                                                                                                       |\n| math.Sin (x)             | æ±‚å¼§åº¦ x çš„æ­£å¼¦å€¼                                                                                                                                                                            |\n| math.Cos (x)             | æ±‚å¼§åº¦ x çš„ä½™å¼¦å€¼                                                                                                                                                                            |\n| math.Tan (x)             | æ±‚å¼§åº¦ x çš„æ­£åˆ‡å€¼                                                                                                                                                                            |\n| math.Asin (x)            | æ±‚ x çš„åæ­£å¼¦å€¼                                                                                                                                                                              |\n| math.Acos (x)            | æ±‚ x çš„åä½™å¼¦å€¼                                                                                                                                                                              |\n| math.Atan (x)            | æ±‚ x çš„åæ­£åˆ‡å€¼                                                                                                                                                                              |\n\n```Lua\nprint(math.pi)           --\u003eoutput  3.1415926535898\nprint(math.rad(180))     --\u003eoutput  3.1415926535898\nprint(math.deg(math.pi)) --\u003eoutput  180\n\nprint(math.sin(1))       --\u003eoutput  0.8414709848079\nprint(math.cos(math.pi)) --\u003eoutput  -1\nprint(math.tan(math.pi / 4))  --\u003eoutput  1\n\nprint(math.atan(1))      --\u003eoutput  0.78539816339745\nprint(math.asin(0))      --\u003eoutput  0\n\nprint(math.max(-1, 2, 0, 3.6, 9.1))     --\u003eoutput  9.1\nprint(math.min(-1, 2, 0, 3.6, 9.1))     --\u003eoutput  -1\n\nprint(math.fmod(10.1, 3))   --\u003eoutput  1.1\nprint(math.sqrt(360))      --\u003eoutput  18.97366596101\n\nprint(math.exp(1))         --\u003eoutput  2.718281828459\nprint(math.log(10))        --\u003eoutput  2.302585092994\nprint(math.log10(10))      --\u003eoutput  1\n\nprint(math.floor(3.1415))  --\u003eoutput  3\nprint(math.ceil(7.998))    --\u003eoutput  8\n```\n\nä½¿ç”¨ `math.random()` å‡½æ•°è·å¾—ä¼ªéšæœºæ•°æ—¶ï¼Œå¦‚æœä¸ä½¿ç”¨ `math.randomseed()` è®¾ç½®ä¼ªéšæœºæ•°ç”Ÿæˆç§å­æˆ–è€…è®¾ç½®ç›¸åŒçš„ä¼ªéšæœºæ•°ç”Ÿæˆç§å­ï¼Œé‚£ä¹ˆå¾—å¾—åˆ°çš„ä¼ªéšæœºæ•°åºåˆ—æ˜¯ä¸€æ ·çš„ã€‚\n\n```Lua\nmath.randomseed (100) --æŠŠç§å­è®¾ç½®ä¸º100\nprint(math.random())         --\u003eoutput  0.0012512588885159\nprint(math.random(100))      --\u003eoutput  57\nprint(math.random(100, 360)) --\u003eoutput  150\n```\n\nç¨ç­‰ç‰‡åˆ»ï¼Œå†æ¬¡è¿è¡Œä¸Šé¢çš„ä»£ç ã€‚\n\n```Lua\nmath.randomseed (100) --æŠŠç§å­è®¾ç½®ä¸º100\nprint(math.random())         --\u003eoutput  0.0012512588885159\nprint(math.random(100))      --\u003eoutput  57\nprint(math.random(100, 360)) --\u003eoutput  150\n```\n\nä¸¤æ¬¡è¿è¡Œçš„ç»“æœä¸€æ ·ã€‚ä¸ºäº†é¿å…æ¯æ¬¡ç¨‹åºå¯åŠ¨æ—¶å¾—åˆ°çš„éƒ½æ˜¯ç›¸åŒçš„ä¼ªéšæœºæ•°åºåˆ—ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨å½“å‰æ—¶é—´ä½œä¸ºç§å­ã€‚\n\n\u003e ä¿®æ”¹ä¸Šä¾‹ä¸­çš„ä»£ç ï¼š\n\n```Lua\nmath.randomseed (os.time())   --æŠŠ100æ¢æˆos.time()\nprint(math.random())          --\u003eoutput 0.88369396038697\nprint(math.random(100))       --\u003eoutput 66\nprint(math.random(100, 360))  --\u003eoutput 228\n```\n\nç¨ç­‰ç‰‡åˆ»ï¼Œå†æ¬¡è¿è¡Œä¸Šé¢çš„ä»£ç ã€‚\n\n```Plaintext\nmath.randomseed (os.time())   --æŠŠ100æ¢æˆos.time()\nprint(math.random())          --\u003eoutput 0.88946195867794\nprint(math.random(100))       --\u003eoutput 68\nprint(math.random(100, 360))  --\u003eoutput 129\n```\n\n  \n\n# æ–‡ä»¶\n\nLua I/O åº“æä¾›ä¸¤ç§ä¸åŒçš„æ–¹å¼å¤„ç†æ–‡ä»¶ï¼šéšå¼æ–‡ä»¶æè¿°ï¼Œæ˜¾å¼æ–‡ä»¶æè¿°ã€‚\n\nè¿™äº›æ–‡ä»¶ I/O æ“ä½œï¼Œ**åœ¨ OpenResty çš„ä¸Šä¸‹æ–‡ä¸­å¯¹äº‹ä»¶å¾ªç¯æ˜¯ä¼šäº§ç”Ÿé˜»å¡æ•ˆåº”**ã€‚OpenResty æ¯”è¾ƒæ“…é•¿çš„æ˜¯é«˜å¹¶å‘ç½‘ç»œå¤„ç†ï¼Œåœ¨è¿™ä¸ªç¯å¢ƒä¸­ï¼Œä»»ä½•æ–‡ä»¶çš„æ“ä½œï¼Œéƒ½å°†é˜»å¡å…¶ä»–å¹¶è¡Œæ‰§è¡Œçš„è¯·æ±‚ã€‚**å®é™…ä¸­çš„åº”ç”¨ï¼Œåœ¨ OpenResty é¡¹ç›®ä¸­åº”å°½å¯èƒ½è®©ç½‘ç»œå¤„ç†éƒ¨åˆ†ã€æ–‡ä»¶ I/0 æ“ä½œéƒ¨åˆ†ç›¸äº’ç‹¬ç«‹ï¼Œä¸è¦æ‰å’Œåœ¨ä¸€èµ·**ã€‚\n\n## **éšå¼æ–‡ä»¶æè¿°**\n\nè®¾ç½®ä¸€ä¸ªé»˜è®¤çš„è¾“å…¥æˆ–è¾“å‡ºæ–‡ä»¶ï¼Œç„¶ååœ¨è¿™ä¸ªæ–‡ä»¶ä¸Šè¿›è¡Œæ‰€æœ‰çš„è¾“å…¥æˆ–è¾“å‡ºæ“ä½œã€‚æ‰€æœ‰çš„æ“ä½œå‡½æ•°ç”± io è¡¨æä¾›ã€‚\n\n\u003e æ‰“å¼€å·²ç»å­˜åœ¨çš„ `test1.txt` æ–‡ä»¶ï¼Œå¹¶è¯»å–é‡Œé¢çš„å†…å®¹\n\n```Plaintext\nfile = io.input(\"test1.txt\")    -- ä½¿ç”¨ io.input() å‡½æ•°æ‰“å¼€æ–‡ä»¶repeat\n    line = io.read()            -- é€è¡Œè¯»å–å†…å®¹ï¼Œæ–‡ä»¶ç»“æŸæ—¶è¿”å›nil\n    if nil == line then\n        break\n    end\n    print(line)\nuntil (false)\n\nio.close(file)                  -- å…³é—­æ–‡ä»¶--\u003e output\nmy test file\nhello\nlua\n```\n\n\u003e åœ¨ `test1.txt` æ–‡ä»¶çš„æœ€åæ·»åŠ ä¸€è¡Œ \"hello world\"\n\n```Plaintext\nfile = io.open(\"test1.txt\", \"a+\")   -- ä½¿ç”¨ io.open() å‡½æ•°ï¼Œä»¥æ·»åŠ æ¨¡å¼æ‰“å¼€æ–‡ä»¶\nio.output(file)                     -- ä½¿ç”¨ io.output() å‡½æ•°ï¼Œè®¾ç½®é»˜è®¤è¾“å‡ºæ–‡ä»¶\nio.write(\"\\nhello world\")           -- ä½¿ç”¨ io.write() å‡½æ•°ï¼ŒæŠŠå†…å®¹å†™åˆ°æ–‡ä»¶\nio.close(file)\n```\n\nåœ¨ç›¸åº”ç›®å½•ä¸‹æ‰“å¼€ `test1.txt` æ–‡ä»¶ï¼ŒæŸ¥çœ‹æ–‡ä»¶å†…å®¹å‘ç”Ÿçš„å˜åŒ–ã€‚\n\n## **æ˜¾å¼æ–‡ä»¶æè¿°**\n\nä½¿ç”¨ file: XXX () å‡½æ•°æ–¹å¼è¿›è¡Œæ“ä½œ, å…¶ä¸­ file ä¸º io.Open () è¿”å›çš„æ–‡ä»¶å¥æŸ„ã€‚\n\n\u003e æ‰“å¼€å·²ç»å­˜åœ¨çš„ test 2. Txt æ–‡ä»¶ï¼Œå¹¶è¯»å–é‡Œé¢çš„å†…å®¹\n\n```Plaintext\nfile = io.open(\"test2.txt\", \"r\")    -- ä½¿ç”¨ io.open() å‡½æ•°ï¼Œä»¥åªè¯»æ¨¡å¼æ‰“å¼€æ–‡ä»¶\n\nfor line in file:lines() do         -- ä½¿ç”¨ file:lines() å‡½æ•°é€è¡Œè¯»å–æ–‡ä»¶\n    print(line)\nend\n\nfile:close()\n\n--\u003eoutput\nmy test2\nhello lua\n```\n\n\u003e åœ¨ test 2. Txt æ–‡ä»¶çš„æœ€åæ·»åŠ ä¸€è¡Œ \"hello world\"\n\n```Plaintext\nfile = io.open(\"test2.txt\", \"a\")  -- ä½¿ç”¨ io.open() å‡½æ•°ï¼Œä»¥æ·»åŠ æ¨¡å¼æ‰“å¼€æ–‡ä»¶\nfile:write(\"\\nhello world\")       -- ä½¿ç”¨ file:write() å‡½æ•°ï¼Œåœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ å†…å®¹\nfile:close()\n```\n\nåœ¨ç›¸åº”ç›®å½•ä¸‹æ‰“å¼€ `test2.txt` æ–‡ä»¶ï¼ŒæŸ¥çœ‹æ–‡ä»¶å†…å®¹å‘ç”Ÿçš„å˜åŒ–ã€‚\n\n## **æ–‡ä»¶æ“ä½œå‡½æ•°**\n\n#### **io. Open (filename [, mode])**\n\næŒ‰æŒ‡å®šçš„æ¨¡å¼ modeï¼Œæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åä¸º `filename` çš„æ–‡ä»¶ï¼ŒæˆåŠŸåˆ™è¿”å›æ–‡ä»¶å¥æŸ„ï¼Œå¤±è´¥åˆ™è¿”å› nil åŠ é”™è¯¯ä¿¡æ¯ã€‚æ¨¡å¼ï¼š\n\n|      |                                                |                     | \n| ---- | ---------------------------------------------- | ------------------- |\n| æ¨¡å¼ | å«ä¹‰                                           | æ–‡ä»¶ä¸å­˜åœ¨æ—¶        |\n| \"r\"  | è¯»æ¨¡å¼ (é»˜è®¤)                                  | è¿”å› nil åŠ é”™è¯¯ä¿¡æ¯ |\n| \"w\"  | å†™æ¨¡å¼                                         | åˆ›å»ºæ–‡ä»¶            |\n| \"a\"  | æ·»åŠ æ¨¡å¼                                       | åˆ›å»ºæ–‡ä»¶            |\n| \"r+\" | æ›´æ–°æ¨¡å¼ï¼Œä¿å­˜ä¹‹å‰çš„æ•°æ®                       | è¿”å› nil åŠ é”™è¯¯ä¿¡æ¯ |\n| \"w+\" | æ›´æ–°æ¨¡å¼ï¼Œæ¸…é™¤ä¹‹å‰çš„æ•°æ®                       | åˆ›å»ºæ–‡ä»¶            |\n| \"a+\" | æ·»åŠ æ›´æ–°æ¨¡å¼ï¼Œä¿å­˜ä¹‹å‰çš„æ•°æ®, åœ¨æ–‡ä»¶å°¾è¿›è¡Œæ·»åŠ  | åˆ›å»ºæ–‡ä»¶            |\n\næ¨¡å¼å­—ç¬¦ä¸²åé¢å¯ä»¥æœ‰ä¸€ä¸ª 'b'ï¼Œç”¨äºåœ¨æŸäº›ç³»ç»Ÿä¸­æ‰“å¼€äºŒè¿›åˆ¶æ–‡ä»¶ã€‚\n\næ³¨æ„ \"w\" å’Œ \"wb\" çš„åŒºåˆ«\n\n- \"w\" è¡¨ç¤ºæ–‡æœ¬æ–‡ä»¶ã€‚æŸäº›æ–‡ä»¶ç³»ç»Ÿ (å¦‚ Linux çš„æ–‡ä»¶ç³»ç»Ÿ)è®¤ä¸º 0 x 0 A ä¸ºæ–‡æœ¬æ–‡ä»¶çš„æ¢è¡Œç¬¦ï¼ŒWindows çš„æ–‡ä»¶ç³»ç»Ÿè®¤ä¸º 0 x 0 D 0 A ä¸ºæ–‡æœ¬æ–‡ä»¶çš„æ¢è¡Œç¬¦ã€‚ä¸ºäº†å…¼å®¹å…¶ä»–æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ä» Linux æ‹·è´æ¥çš„æ–‡ä»¶ï¼‰ï¼ŒWindows çš„æ–‡ä»¶ç³»ç»Ÿåœ¨å†™æ–‡ä»¶æ—¶ï¼Œä¼šåœ¨æ–‡ä»¶ä¸­ 0 x 0 A çš„å‰é¢åŠ ä¸Š 0 x 0 Dã€‚ä½¿ç”¨ \"w\"ï¼Œå…¶å±æ€§è¦çœ‹æ‰€åœ¨çš„å¹³å°ã€‚\n    \n- \"wb\" è¡¨ç¤ºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚æ–‡ä»¶ç³»ç»Ÿä¼šæŒ‰çº¯ç²¹çš„äºŒè¿›åˆ¶æ ¼å¼è¿›è¡Œå†™æ“ä½œï¼Œå› æ­¤ä¹Ÿå°±ä¸å­˜åœ¨æ ¼å¼è½¬æ¢çš„é—®é¢˜ã€‚ï¼ˆLinux æ–‡ä»¶ç³»ç»Ÿä¸‹ \"w\" å’Œ \"wb\" æ²¡æœ‰åŒºåˆ«ï¼‰\n    \n\n#### **file: close ()**\n\nå…³é—­æ–‡ä»¶ã€‚æ³¨æ„ï¼šå½“æ–‡ä»¶å¥æŸ„è¢«åƒåœ¾æ”¶é›†åï¼Œæ–‡ä»¶å°†è‡ªåŠ¨å…³é—­ã€‚å¥æŸ„å°†å˜ä¸ºä¸€ä¸ªä¸å¯é¢„çŸ¥çš„å€¼ã€‚\n\n#### **io. Close ([file])**\n\nå…³é—­æ–‡ä»¶ï¼Œå’Œ file: close () çš„ä½œç”¨ç›¸åŒã€‚æ²¡æœ‰å‚æ•° file æ—¶ï¼Œå…³é—­é»˜è®¤è¾“å‡ºæ–‡ä»¶ã€‚\n\n#### **file: flush ()**\n\næŠŠå†™å…¥ç¼“å†²åŒºçš„æ‰€æœ‰æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ file ä¸­ã€‚\n\n#### **io. Flush ()**\n\nç›¸å½“äº file: flush ()ï¼ŒæŠŠå†™å…¥ç¼“å†²åŒºçš„æ‰€æœ‰æ•°æ®å†™å…¥åˆ°é»˜è®¤è¾“å‡ºæ–‡ä»¶ã€‚\n\n#### **io. Input ([file])**\n\nå½“ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶åè°ƒç”¨æ—¶ï¼Œæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼ˆä»¥æ–‡æœ¬æ¨¡å¼ï¼‰ï¼Œå¹¶è®¾ç½®æ–‡ä»¶å¥æŸ„ä¸ºé»˜è®¤è¾“å…¥æ–‡ä»¶ï¼›å½“ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶å¥æŸ„è°ƒç”¨æ—¶ï¼Œè®¾ç½®æ­¤æ–‡ä»¶å¥æŸ„ä¸ºé»˜è®¤è¾“å…¥æ–‡ä»¶ï¼›å½“ä¸ä½¿ç”¨å‚æ•°è°ƒç”¨æ—¶ï¼Œè¿”å›é»˜è®¤è¾“å…¥æ–‡ä»¶å¥æŸ„ã€‚\n\n#### **file: lines ()**\n\nè¿”å›ä¸€ä¸ªè¿­ä»£å‡½æ•°, æ¯æ¬¡è°ƒç”¨å°†è·å¾—æ–‡ä»¶ä¸­çš„ä¸€è¡Œå†…å®¹, å½“åˆ°æ–‡ä»¶å°¾æ—¶ï¼Œå°†è¿”å› nilï¼Œä½†ä¸å…³é—­æ–‡ä»¶ã€‚\n\n#### **io. Lines ([filename])**\n\næ‰“å¼€æŒ‡å®šçš„æ–‡ä»¶ filename ä¸ºè¯»æ¨¡å¼å¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å‡½æ•°, æ¯æ¬¡è°ƒç”¨å°†è·å¾—æ–‡ä»¶ä¸­çš„ä¸€è¡Œå†…å®¹, å½“åˆ°æ–‡ä»¶å°¾æ—¶ï¼Œå°†è¿”å› nilï¼Œå¹¶è‡ªåŠ¨å…³é—­æ–‡ä»¶ã€‚è‹¥ä¸å¸¦å‚æ•°æ—¶ io.Lines () ç­‰ä»·äº io.Input (): lines () è¯»å–é»˜è®¤è¾“å…¥è®¾å¤‡çš„å†…å®¹ï¼Œç»“æŸæ—¶ä¸å…³é—­æ–‡ä»¶ã€‚\n\n#### **io. Output ([file])**\n\nç±»ä¼¼äº io. Inputï¼Œä½†æ“ä½œåœ¨é»˜è®¤è¾“å‡ºæ–‡ä»¶ä¸Šã€‚\n\n#### **file: read (...)**\n\næŒ‰æŒ‡å®šçš„æ ¼å¼è¯»å–ä¸€ä¸ªæ–‡ä»¶ã€‚æŒ‰æ¯ä¸ªæ ¼å¼å°†è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–æ•°å­—, å¦‚æœä¸èƒ½æ­£ç¡®è¯»å–å°†è¿”å› nilï¼Œè‹¥æ²¡æœ‰æŒ‡å®šæ ¼å¼å°†æŒ‡é»˜è®¤æŒ‰è¡Œæ–¹å¼è¿›è¡Œè¯»å–ã€‚æ ¼å¼ï¼š\n\n|        |                                                                                                        |\n| ------ | ------------------------------------------------------------------------------------------------------ |\n| æ ¼å¼   | å«ä¹‰                                                                                                   |\n| \"*n\"   | è¯»å–ä¸€ä¸ªæ•°å­—                                                                                           |\n| \"*a\"   | ä»å½“å‰ä½ç½®è¯»å–æ•´ä¸ªæ–‡ä»¶ã€‚è‹¥å½“å‰ä½ç½®ä¸ºæ–‡ä»¶å°¾ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²                                             |\n| \"*l\"   | è¯»å–ä¸‹ä¸€è¡Œçš„å†…å®¹ã€‚è‹¥ä¸ºæ–‡ä»¶å°¾ï¼Œåˆ™è¿”å› nilã€‚(é»˜è®¤)                                                       |\n| number | è¯»å–æŒ‡å®šå­—èŠ‚æ•°çš„å­—ç¬¦ã€‚è‹¥ä¸ºæ–‡ä»¶å°¾ï¼Œåˆ™è¿”å› nilã€‚å¦‚æœ number ä¸º 0, åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œè‹¥ä¸ºæ–‡ä»¶å°¾, åˆ™è¿”å› nil |\n\n#### **io. Read (...)**\n\nç›¸å½“äº io.Input ():read\n\n#### **io. Type (obj)**\n\næ£€æµ‹ obj æ˜¯å¦ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶å¥æŸ„ã€‚å¦‚æœ obj æ˜¯ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ï¼Œåˆ™è¿”å› \"file\" å¦‚æœ obj æ˜¯ä¸€ä¸ªå·²å…³é—­çš„æ–‡ä»¶å¥æŸ„ï¼Œåˆ™è¿”å› \"closed file\" å¦‚æœ obj ä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼Œåˆ™è¿”å› nilã€‚\n\n#### **file: write (...)**\n\næŠŠæ¯ä¸€ä¸ªå‚æ•°çš„å€¼å†™å…¥æ–‡ä»¶ã€‚å‚æ•°å¿…é¡»ä¸ºå­—ç¬¦ä¸²æˆ–æ•°å­—ï¼Œè‹¥è¦è¾“å‡ºå…¶å®ƒå€¼ï¼Œåˆ™éœ€é€šè¿‡ tostring æˆ– string. Format è¿›è¡Œè½¬æ¢ã€‚\n\n#### **io. Write (...)**\n\nç›¸å½“äº io.Output (): writeã€‚\n\n#### **file: seek ([whence] [, offset])**\n\nè®¾ç½®å’Œè·å–å½“å‰æ–‡ä»¶ä½ç½®ï¼ŒæˆåŠŸåˆ™è¿”å›æœ€ç»ˆçš„æ–‡ä»¶ä½ç½® (æŒ‰å­—èŠ‚ï¼Œç›¸å¯¹äºæ–‡ä»¶å¼€å¤´), å¤±è´¥åˆ™è¿”å› nil åŠ é”™è¯¯ä¿¡æ¯ã€‚ç¼ºçœæ—¶ï¼Œwhence é»˜è®¤ä¸º \"cur\"ï¼Œoffset é»˜è®¤ä¸º 0 ã€‚å‚æ•° whenceï¼š\n\n|        |                     |\n| ------ | ------------------- |\n| whence | å«ä¹‰                |\n| \"set\"  | æ–‡ä»¶å¼€å§‹            |\n| \"cur\"  | æ–‡ä»¶å½“å‰ä½ç½® (é»˜è®¤) |\n| \"end\"  | æ–‡ä»¶ç»“æŸ            |\n\n#### **file: setvbuf (mode [, size])**\n\nè®¾ç½®è¾“å‡ºæ–‡ä»¶çš„ç¼“å†²æ¨¡å¼ã€‚æ¨¡å¼ï¼š\n\n|        |                                                              |\n| ------ | ------------------------------------------------------------ |\n| æ¨¡å¼   | å«ä¹‰                                                         |\n| \"no\"   | æ²¡æœ‰ç¼“å†²ï¼Œå³ç›´æ¥è¾“å‡º                                         |\n| \"full\" | å…¨ç¼“å†²ï¼Œå³å½“ç¼“å†²æ»¡åæ‰è¿›è¡Œè¾“å‡ºæ“ä½œ (ä¹Ÿå¯è°ƒç”¨ flush é©¬ä¸Šè¾“å‡º) |\n| \"line\" | ä»¥è¡Œä¸ºå•ä½ï¼Œè¿›è¡Œè¾“å‡º                                         |\n\næœ€åä¸¤ç§æ¨¡å¼ï¼Œsize å¯ä»¥æŒ‡å®šç¼“å†²çš„å¤§å°ï¼ˆæŒ‰å­—èŠ‚ï¼‰ï¼Œå¿½ç•¥ size å°†è‡ªåŠ¨è°ƒæ•´ä¸ºæœ€ä½³çš„å¤§å°ã€‚","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":["lua"]},"/netty/%E4%BC%A0%E8%BE%93%E5%92%8CChannel":{"title":"ä¼ è¾“å’ŒChannel","content":"åœ¨æŸäº›æ—¶å€™ï¼Œä½ éœ€è¦æ”¯æ’‘æ¯”é¢„æœŸå¤šå¾ˆå¤šçš„å¹¶å‘è¿æ¥ã€‚å¦‚æœä½ éšåå°è¯•ä»é˜»å¡ä¼ è¾“åˆ‡æ¢åˆ°éé˜»å¡ä¼ è¾“ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šå› ä¸ºè¿™ä¸¤ç§ç½‘ç»œ API çš„æˆªç„¶ä¸åŒè€Œé‡åˆ°é—®é¢˜ã€‚\n\n**Netty ä¸ºå®ƒæ‰€æœ‰çš„ä¼ è¾“å®ç°æä¾›äº†ä¸€ä¸ªé€šç”¨ APIï¼Œè¿™ä½¿å¾—è¿™ç§è½¬æ¢æ¯”ä½ ç›´æ¥ä½¿ç”¨ JDK æ‰€èƒ½å¤Ÿè¾¾åˆ°çš„ç®€å•å¾—å¤šã€‚**\n\n# ä¼ è¾“æ–¹å¼\n\n- OIO\n    \n- NIO\n    \n- AIO\n    \n\n  \n\n# Channel\n\nä¼ è¾“ API çš„æ ¸å¿ƒæ˜¯ interface Channelï¼Œå®ƒè¢«ç”¨äºæ‰€æœ‰çš„ I/O æ“ä½œ\n\n![](statistic/asynccode-670.png)\n\n- æ¯ä¸ª Channel éƒ½å°†ä¼šè¢«åˆ†é…ä¸€ä¸ª ChannelPipeline å’Œ ChannelConfigã€‚\n    \n    - ChannelConfig åŒ…å«äº†è¯¥ Channel çš„æ‰€æœ‰é…ç½®è®¾ç½®ï¼Œå¹¶ä¸”æ”¯æŒçƒ­æ›´æ–°ã€‚ç”±äºç‰¹å®šçš„ä¼ è¾“å¯èƒ½ å…·æœ‰ç‹¬ç‰¹çš„è®¾ç½®ï¼Œæ‰€ä»¥å®ƒå¯èƒ½ä¼šå®ç°ä¸€ä¸ª ChannelConfig çš„å­ç±»å‹ã€‚\n        \n- ç”±äº Channel æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯é¡ºåºå°† Channel å£°æ˜ä¸º java.lang.Comparable çš„ä¸€ä¸ªå­æ¥å£\n    \n- ChannelPipeline **æŒæœ‰æ‰€æœ‰å°†åº”ç”¨äºå…¥ç«™å’Œå‡ºç«™æ•°æ®ä»¥åŠäº‹ä»¶çš„ ChannelHandlerå®ä¾‹**ï¼Œè¿™äº› ChannelHandler å®ç°äº†åº”ç”¨ç¨‹åºç”¨äºå¤„ç†çŠ¶æ€å˜åŒ–ä»¥åŠæ•°æ®å¤„ç†çš„é€»è¾‘\n    \n    - ChannelHandler çš„å…¸å‹ç”¨é€”åŒ…æ‹¬ï¼š\n        \n        - ï® å°†æ•°æ®ä»ä¸€ç§æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼ï¼›\n            \n        - ï® æä¾›å¼‚å¸¸çš„é€šçŸ¥ï¼›\n            \n        - ï® æä¾› Channel å˜ä¸ºæ´»åŠ¨çš„æˆ–è€…éæ´»åŠ¨çš„é€šçŸ¥ï¼›\n            \n        - ï® æä¾›å½“ Channel æ³¨å†Œåˆ° EventLoop æˆ–è€…ä» EventLoop æ³¨é”€æ—¶çš„é€šçŸ¥ï¼›\n            \n        - ï® æä¾›æœ‰å…³ç”¨æˆ·è‡ªå®šä¹‰äº‹ä»¶çš„é€šçŸ¥ã€‚\n            \n- ä¹Ÿå¯ä»¥åˆ©ç”¨ Channel çš„å…¶ä»–æ–¹æ³•\n    \n\n![](statistic/asynccode-668.png)\n\nNetty çš„ **Channel å®ç°æ˜¯çº¿ç¨‹å®‰å…¨çš„.**\n\n# NIO\n\n  \n\nNIO æä¾›äº†ä¸€ä¸ªæ‰€æœ‰ I/O æ“ä½œçš„å…¨å¼‚æ­¥çš„å®ç°ã€‚\n\né€‰æ‹©å™¨èƒŒåçš„åŸºæœ¬æ¦‚å¿µæ˜¯å……å½“ä¸€ä¸ªæ³¨å†Œè¡¨ï¼Œåœ¨é‚£é‡Œä½ å°†å¯ä»¥è¯·æ±‚åœ¨ Channel çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶å¾—åˆ°é€šçŸ¥ã€‚å¯èƒ½çš„çŠ¶æ€å˜åŒ–æœ‰ï¼š\n\n- ï® æ–°çš„ Channel å·²è¢«æ¥å—å¹¶ä¸”å°±ç»ªï¼›\n    \n- ï® Channel è¿æ¥å·²ç»å®Œæˆï¼›\n    \n- ï® Channel æœ‰å·²ç»å°±ç»ªçš„å¯ä¾›è¯»å–çš„æ•°æ®ï¼›\n    \n- ï® Channel å¯ç”¨äºå†™æ•°æ®ã€‚\n    \n\n**é€‰æ‹©å™¨è¿è¡Œåœ¨ä¸€ä¸ªæ£€æŸ¥çŠ¶æ€å˜åŒ–å¹¶å¯¹å…¶åšå‡ºç›¸åº”å“åº”çš„çº¿ç¨‹ä¸Šï¼Œåœ¨åº”ç”¨ç¨‹åºå¯¹çŠ¶æ€çš„æ”¹å˜åšå‡ºå“åº”ä¹‹åï¼Œé€‰æ‹©å™¨å°†ä¼šè¢«é‡ç½®**ï¼Œå¹¶å°†é‡å¤è¿™ä¸ªè¿‡ç¨‹\n\nçš„å¸¸é‡å€¼ä»£è¡¨äº†ç”±class java.nio.channels.SelectionKeyå®šä¹‰çš„ä½æ¨¡å¼ã€‚è¿™äº›ä½æ¨¡å¼å¯ä»¥ç»„åˆèµ·æ¥å®šä¹‰ä¸€ç»„åº”ç”¨ç¨‹åºæ­£åœ¨è¯·æ±‚é€šçŸ¥çš„çŠ¶æ€å˜åŒ–é›†ã€‚\n\n![](statistic/asynccode-669.png)\n\n![](statistic/asynccode-667.png)\n\n# é›¶æ‹·è´\n\né›¶æ‹·è´ï¼ˆzero-copyï¼‰æ˜¯ä¸€ç§ç›®å‰åªæœ‰åœ¨ä½¿ç”¨ NIO å’Œ Epoll ä¼ è¾“æ—¶æ‰å¯ä½¿ç”¨çš„ç‰¹æ€§**ã€‚å®ƒä½¿ä½ å¯ä»¥å¿«é€Ÿ é«˜æ•ˆåœ°å°†æ•°æ®ä»æ–‡ä»¶ç³»ç»Ÿç§»åŠ¨åˆ°ç½‘ç»œæ¥å£ï¼Œè€Œä¸éœ€è¦å°†å…¶ä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼Œ**å…¶åœ¨åƒ FTP æˆ–è€… HTTP è¿™æ ·çš„åè®®ä¸­å¯ä»¥æ˜¾è‘—åœ°æå‡æ€§èƒ½ã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿéƒ½æ”¯æŒè¿™ä¸€ç‰¹æ€§ã€‚ç‰¹åˆ«åœ°ï¼Œå®ƒå¯¹äºå®ç°äº†æ•°æ®åŠ å¯†æˆ–è€…å‹ç¼©çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸å¯ç”¨çš„â€”â€”åªèƒ½ä¼ è¾“æ–‡ä»¶çš„åŸå§‹å†…å®¹ã€‚","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/netty/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AArpc%E6%A1%86%E6%9E%B6/8-Zookeeper-Curator":{"title":"8 Zookeeper Curator","content":"[guide-rpc-framework](https://github.com/Snailclimb/guide-rpc-framework) ä½¿ç”¨äº† Zookeeper æ¥å­˜å‚¨æœåŠ¡çš„ç›¸å…³ä¿¡æ¯ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯ ZooKeeper Java å®¢æˆ·ç«¯ Â Curator æ¥å¯¹ ZooKeeper è¿›è¡Œå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œã€‚  \n  \næ‰€ä»¥ï¼Œæœ¬æ–‡å°±ç®€å•ä»‹ç»ä¸€ä¸‹ ZooKeeperå¸¸ç”¨å‘½ä»¤ ä»¥åŠ Curator çš„åŸºæœ¬ä½¿ç”¨ã€‚\n\n# ZooKeeper å®‰è£…å’Œä½¿ç”¨  \n  \n# ä½¿ç”¨ Docker å®‰è£… zookeeper  \n  \na.ä½¿ç”¨ Docker ä¸‹è½½ ZooKeeper  \n  \n```\ndocker pull zookeeper:3.5.8\n```\n\n  \nb.è¿è¡Œ ZooKeeper  \n  \n  \n```\ndocker run -d --name zookeeper -p 2181:2181 zookeeper:3.5.8\n```\n\n## è¿æ¥ ZooKeeper æœåŠ¡  \n  \na.è¿›å…¥ ZooKeeper å®¹å™¨ä¸­  \n  \n\n```\nå…ˆä½¿ç”¨ docker ps æŸ¥çœ‹ ZooKeeper çš„ ContainerIDï¼Œç„¶åä½¿ç”¨ docker exec -it ContainerID /bin/bash å‘½ä»¤è¿›å…¥å®¹å™¨ä¸­ã€‚  \n```\n\n  \nb.å…ˆè¿›å…¥ bin ç›®å½•, ç„¶åé€šè¿‡ Â ./zkCli. Sh -server 127.0.0.1:2181 å‘½ä»¤è¿æ¥ ZooKeeper æœåŠ¡  \n\n\n```\ncd bin\nÂ ./zkCli. Sh -server 127.0.0.1:2181 \n```\n\n  \n  \nå¦‚æœä½ çœ‹åˆ°æ§åˆ¶å°æˆåŠŸæ‰“å°å‡ºå¦‚ä¸‹ä¿¡æ¯çš„è¯ï¼Œè¯´æ˜ä½ å·²ç»æˆåŠŸè¿æ¥ ZooKeeper æœåŠ¡ã€‚  \n  \n![](statistic/Pasted%20image%2020230807185602.png)\n  \n  \n## å¸¸ç”¨å‘½ä»¤æ¼”ç¤º  \n  \næŸ¥çœ‹å¸¸ç”¨å‘½ä»¤ (help å‘½ä»¤)  \n  \né€šè¿‡ help å‘½ä»¤æŸ¥çœ‹ ZooKeeper å¸¸ç”¨å‘½ä»¤  \n  \nåˆ›å»ºèŠ‚ç‚¹ (create å‘½ä»¤)  \n  \né€šè¿‡ create å‘½ä»¤åœ¨æ ¹ç›®å½•åˆ›å»ºäº† node 1 èŠ‚ç‚¹ï¼Œä¸å®ƒå…³è”çš„å­—ç¬¦ä¸²æ˜¯\"node 1\"  \n  \n  \né€šè¿‡ create å‘½ä»¤åœ¨æ ¹ç›®å½•åˆ›å»ºäº† node 1 èŠ‚ç‚¹ï¼Œä¸å®ƒå…³è”çš„å†…å®¹æ˜¯æ•°å­— 123  \n  \n  \næ›´æ–°èŠ‚ç‚¹æ•°æ®å†…å®¹ (set å‘½ä»¤)  \n  \n  \nè·å–èŠ‚ç‚¹çš„æ•°æ® (get å‘½ä»¤)  \n  \nGet å‘½ä»¤å¯ä»¥è·å–æŒ‡å®šèŠ‚ç‚¹çš„æ•°æ®å†…å®¹å’ŒèŠ‚ç‚¹çš„çŠ¶æ€, å¯ä»¥çœ‹å‡ºæˆ‘ä»¬é€šè¿‡ set å‘½ä»¤å·²ç»å°†èŠ‚ç‚¹æ•°æ®å†…å®¹æ”¹ä¸º \"set node 1\"ã€‚  \n  \n  \næŸ¥çœ‹æŸä¸ªç›®å½•ä¸‹çš„å­èŠ‚ç‚¹ (ls å‘½ä»¤)  \n  \né€šè¿‡ ls å‘½ä»¤æŸ¥çœ‹æ ¹ç›®å½•ä¸‹çš„èŠ‚ç‚¹  \n  \n  \né€šè¿‡ ls å‘½ä»¤æŸ¥çœ‹ node 1 ç›®å½•ä¸‹çš„èŠ‚ç‚¹  \n  \n  \nZooKeeper ä¸­çš„ ls å‘½ä»¤å’Œ linux å‘½ä»¤ä¸­çš„ ls ç±»ä¼¼ï¼Œè¿™ä¸ªå‘½ä»¤å°†åˆ—å‡ºç»å¯¹è·¯å¾„ path ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ä¿¡æ¯ï¼ˆåˆ—å‡º 1 çº§ï¼Œå¹¶ä¸é€’å½’ï¼‰  \n  \næŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ (stat å‘½ä»¤)  \n  \né€šè¿‡ stat å‘½ä»¤æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€  \n  \n  \nä¸Šé¢æ˜¾ç¤ºçš„ä¸€äº›ä¿¡æ¯æ¯”å¦‚ cversionã€aclVersionã€numChildren ç­‰ç­‰ï¼Œæˆ‘åœ¨ä¸Šé¢ â€œ[ZooKeeper ç›¸å…³æ¦‚å¿µæ€»ç»“(å…¥é—¨)](https://javaguide.cn/distributed-system/distributed-process-coordination/zookeeper/zookeeper-intro.html)â€ è¿™ç¯‡æ–‡ç« ä¸­å·²ç»ä»‹ç»åˆ°ã€‚  \n  \næŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯å’ŒçŠ¶æ€ (ls 2 å‘½ä»¤)  \n  \nLs 2 å‘½ä»¤æ›´åƒæ˜¯ Â ls å‘½ä»¤å’Œ stat å‘½ä»¤çš„ç»“åˆã€‚ Ls 2 å‘½ä»¤è¿”å›çš„ä¿¡æ¯åŒ…æ‹¬ 2 éƒ¨åˆ†ï¼š  \n  \n1 å­èŠ‚ç‚¹åˆ—è¡¨  \n2 å½“å‰èŠ‚ç‚¹çš„ stat ä¿¡æ¯ã€‚  \n  \n  \nåˆ é™¤èŠ‚ç‚¹ (delete å‘½ä»¤)  \n  \nè¿™ä¸ªå‘½ä»¤å¾ˆç®€å•ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯å¦‚æœä½ è¦åˆ é™¤æŸä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å¿…é¡»æ— å­èŠ‚ç‚¹æ‰è¡Œã€‚  \n  \n  \nåœ¨åé¢æˆ‘ä¼šä»‹ç»åˆ° Java å®¢æˆ·ç«¯ API çš„ä½¿ç”¨ä»¥åŠå¼€æº ZooKeeper å®¢æˆ·ç«¯ ZkClient å’Œ Curator çš„ä½¿ç”¨ã€‚  \n  \nZooKeeper Java å®¢æˆ·ç«¯ Curator ç®€å•ä½¿ç”¨  \n  \nCurator æ˜¯ Netflix å…¬å¸å¼€æºçš„ä¸€å¥— ZooKeeper Java å®¢æˆ·ç«¯æ¡†æ¶ï¼Œç›¸æ¯”äº Zookeeper è‡ªå¸¦çš„å®¢æˆ·ç«¯ zookeeper æ¥è¯´ï¼ŒCurator çš„å°è£…æ›´åŠ å®Œå–„ï¼Œå„ç§ API éƒ½å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿åœ°ä½¿ç”¨ã€‚  \n  \n\n![](https://www.yuque.com/api/filetransfer/images?url=https%3A%2F%2Fguide-blog-images.oss-cn-shenzhen.aliyuncs.com%2F2020-8%2Fph-quote.png\u0026sign=5563fbf4a79ae73ad2b471e0477c4f700b6130c35d565d117bcfb60cfd25cba6)\n\n  \n  \nä¸‹é¢æˆ‘ä»¬å°±æ¥ç®€å•åœ°æ¼”ç¤ºä¸€ä¸‹ Curator çš„ä½¿ç”¨å§ï¼  \n  \nCurator 4.0+ç‰ˆæœ¬å¯¹ ZooKeeper 3.5. X æ”¯æŒæ¯”è¾ƒå¥½ã€‚å¼€å§‹ä¹‹å‰ï¼Œè¯·å…ˆå°†ä¸‹é¢çš„ä¾èµ–æ·»åŠ è¿›ä½ çš„é¡¹ç›®ã€‚  \n  \n  \nè¿æ¥ ZooKeeper å®¢æˆ·ç«¯  \n  \né€šè¿‡ CuratorFrameworkFactory åˆ›å»º CuratorFramework å¯¹è±¡ï¼Œç„¶åå†è°ƒç”¨ Â CuratorFramework å¯¹è±¡çš„ start () æ–¹æ³•å³å¯ï¼  \n  \n  \nå¯¹äºä¸€äº›åŸºæœ¬å‚æ•°çš„è¯´æ˜ï¼š  \n  \nâ—baseSleepTimeMsï¼šé‡è¯•ä¹‹é—´ç­‰å¾…çš„åˆå§‹æ—¶é—´  \nâ—maxRetries ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°  \nâ—connectString ï¼šè¦è¿æ¥çš„æœåŠ¡å™¨åˆ—è¡¨  \nâ—retryPolicy ï¼šé‡è¯•ç­–ç•¥  \n  \næ•°æ®èŠ‚ç‚¹çš„å¢åˆ æ”¹æŸ¥  \n  \nåˆ›å»ºèŠ‚ç‚¹  \n  \næˆ‘ä»¬åœ¨ [ZooKeeperå¸¸è§æ¦‚å¿µè§£è¯»](https://javaguide.cn/distributed-system/distributed-process-coordination/zookeeper/zookeeper-intro/) ä¸­ä»‹ç»åˆ°ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯å°† znode åˆ†ä¸º 4 å¤§ç±»ï¼š  \n  \nâ—æŒä¹…ï¼ˆPERSISTENTï¼‰èŠ‚ç‚¹ ï¼šä¸€æ—¦åˆ›å»ºå°±ä¸€ç›´å­˜åœ¨å³ä½¿ ZooKeeper é›†ç¾¤å®•æœºï¼Œç›´åˆ°å°†å…¶åˆ é™¤ã€‚  \nâ—ä¸´æ—¶ï¼ˆEPHEMERALï¼‰èŠ‚ç‚¹ ï¼šä¸´æ—¶èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸å®¢æˆ·ç«¯ä¼šè¯ï¼ˆsessionï¼‰ ç»‘å®šçš„ï¼Œä¼šè¯æ¶ˆå¤±åˆ™èŠ‚ç‚¹æ¶ˆå¤±ã€‚å¹¶ä¸”ï¼Œä¸´æ—¶èŠ‚ç‚¹åªèƒ½åšå¶å­èŠ‚ç‚¹ï¼Œä¸èƒ½åˆ›å»ºå­èŠ‚ç‚¹ã€‚  \nâ—æŒä¹…é¡ºåºï¼ˆPERSISTENT\\_SEQUENTIALï¼‰èŠ‚ç‚¹ ï¼šé™¤äº†å…·æœ‰æŒä¹…ï¼ˆPERSISTENTï¼‰èŠ‚ç‚¹çš„ç‰¹æ€§ä¹‹å¤–ï¼Œå­èŠ‚ç‚¹çš„åç§°è¿˜å…·æœ‰é¡ºåºæ€§ã€‚æ¯”å¦‚ /node 1/app 0000000001 ã€/node 1/app 0000000002 ã€‚  \nâ—ä¸´æ—¶é¡ºåºï¼ˆEPHEMERAL\\_SEQUENTIALï¼‰èŠ‚ç‚¹ ï¼šé™¤äº†å…·å¤‡ä¸´æ—¶ï¼ˆEPHEMERALï¼‰èŠ‚ç‚¹çš„ç‰¹æ€§ä¹‹å¤–ï¼Œå­èŠ‚ç‚¹çš„åç§°è¿˜å…·æœ‰é¡ºåºæ€§ã€‚  \n  \nä½ åœ¨ä½¿ç”¨çš„ ZooKeeper çš„æ—¶å€™ï¼Œä¼šå‘ç° Â CreateMode ç±»ä¸­å®é™…æœ‰ 7 ç§ znode ç±»å‹ï¼Œä½†æ˜¯ç”¨çš„æœ€å¤šçš„è¿˜æ˜¯ä¸Šé¢ä»‹ç»çš„ 4 ç§ã€‚  \n  \na.åˆ›å»ºæŒä¹…åŒ–èŠ‚ç‚¹  \n  \nä½ å¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ç§æ–¹å¼åˆ›å»ºæŒä¹…åŒ–çš„èŠ‚ç‚¹ã€‚  \n  \n  \nä½†æ˜¯ï¼Œä½ è¿è¡Œä¸Šé¢çš„ä»£ç ä¼šæŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸ºçš„çˆ¶èŠ‚ç‚¹ node 1 è¿˜æœªåˆ›å»ºã€‚  \n  \nä½ å¯ä»¥å…ˆåˆ›å»ºçˆ¶èŠ‚ç‚¹ node 1 ï¼Œç„¶åå†æ‰§è¡Œä¸Šé¢çš„ä»£ç å°±ä¸ä¼šæŠ¥é”™äº†ã€‚  \n  \n  \næ›´æ¨èçš„æ–¹å¼æ˜¯é€šè¿‡ä¸‹é¢è¿™è¡Œä»£ç ï¼Œ creatingParentsIfNeeded () å¯ä»¥ä¿è¯çˆ¶èŠ‚ç‚¹ä¸å­˜åœ¨çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºçˆ¶èŠ‚ç‚¹ï¼Œè¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚  \n  \n  \nb.åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹  \n  \n  \nc.åˆ›å»ºèŠ‚ç‚¹å¹¶æŒ‡å®šæ•°æ®å†…å®¹  \n  \n  \nd.æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦åˆ›å»ºæˆåŠŸ  \n  \n  \nåˆ é™¤èŠ‚ç‚¹  \n  \na.åˆ é™¤ä¸€ä¸ªå­èŠ‚ç‚¹  \n  \n  \nb.åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ä»¥åŠå…¶ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹  \n  \n  \nè·å–/æ›´æ–°èŠ‚ç‚¹æ•°æ®å†…å®¹  \n  \n  \nè·å–æŸä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹è·¯å¾„  \n  \n  \nç›‘å¬å™¨  \n  \nä¸‹é¢ç®€å•æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•ç»™æŸä¸ªèŠ‚ç‚¹æ³¨å†Œå­èŠ‚ç‚¹ç›‘å¬å™¨ã€‚æ³¨å†Œäº†ç›‘å¬å™¨ä¹‹åï¼Œè¿™ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ¯”å¦‚å¢åŠ ã€å‡å°‘æˆ–è€…æ›´æ–°çš„æ—¶å€™ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰å›è°ƒæ“ä½œã€‚  \n  \n  \nå¦‚æœä½ è¦è·å–èŠ‚ç‚¹äº‹ä»¶ç±»å‹çš„è¯ï¼Œå¯ä»¥é€šè¿‡ï¼š  \n  \n  \nä¸€å…±æœ‰ä¸‹é¢å‡ ç§ç±»å‹ï¼š  \n  \n\n","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/netty/%E6%A6%82%E5%BF%B5%E5%92%8C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84":{"title":"æ¦‚å¿µå’Œä½“ç³»ç»“æ„","content":"# IO æ¨¡å‹\n\n[IOæ¨¡å‹è¯¦è§£](https://jovbd87bon.feishu.cn/wiki/wikcnlmBPltNAH5jI0rrD6bpNWf)\n\n  \n\n  \n\n# Java ç½‘ç»œç¼–ç¨‹\n\næœ€æ—©æœŸçš„ Java APIï¼ˆjava.netï¼‰åªæ”¯æŒç”±æœ¬åœ°ç³»ç»Ÿå¥—æ¥å­—åº“æä¾›çš„æ‰€è°“çš„é˜»å¡å‡½æ•°\n\n```Java\n//  åˆ›å»ºä¸€ä¸ªæ–°çš„ ServerSocketï¼Œç”¨ä»¥ ç›‘å¬æŒ‡å®šç«¯å£ä¸Šçš„è¿æ¥è¯·æ±‚\nServerSocket serverSocket = new ServerSocket(portNumber); \n// å¯¹accept é˜»å¡ï¼ŒçŸ¥é“åˆ›å»ºä¸€ä¸ª\nSocket clientSocket = serverSocket.accept(); \nBufferedReader in = new BufferedReader(new InputStreamReader(clientSocket.getInputStream())); \nPrintWriter out = new PrintWriter(clientSocket.getOutputStream(), true); \nString request, response; \nwhile ((request = in.readLine()) != null) { \n    if (\"Done\".equals(request)) { \n        break; \n    } \n    response = processRequest(request); \n    out.println(response); \n} \n```\n\n  \n\n# Java Nio\n\næœ¬åœ°å¥—æ¥å­—åº“å¾ˆæ—©å°±æä¾›äº†éé˜»å¡è°ƒç”¨ï¼Œ å…¶ä¸ºç½‘ç»œèµ„æºçš„åˆ©ç”¨ç‡æä¾›äº†ç›¸å½“å¤šçš„æ§åˆ¶ï¼š\n\n- å¯ä»¥ä½¿ç”¨ setsockopt()æ–¹æ³•é…ç½®å¥—æ¥å­—ï¼Œä»¥ä¾¿è¯»/å†™è°ƒç”¨åœ¨æ²¡æœ‰æ•°æ®çš„æ—¶å€™ç«‹å³è¿”å›ï¼Œ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªé˜»å¡è°ƒç”¨åº”è¯¥å·²ç»è¢«é˜»å¡äº†â‘  ï¼›\n    \n- å¯ä»¥ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„äº‹ä»¶é€šçŸ¥ APIâ‘¡æ³¨å†Œä¸€ç»„éé˜»å¡å¥—æ¥å­—ï¼Œä»¥ç¡®å®šå®ƒä»¬ä¸­æ˜¯å¦æœ‰ä»»ä½•çš„å¥—æ¥å­—å·²ç»æœ‰æ•°æ®å¯ä¾›è¯»å†™ã€‚\n    \n\nJava å¯¹äºéé˜»å¡ I/O çš„æ”¯æŒæ˜¯åœ¨ 2002 å¹´å¼•å…¥çš„ï¼Œä½äº JDK 1.4 çš„ java.nio åŒ…ä¸­\n\n  \n\n## é€‰æ‹©å™¨\n\n![](statistic/asynccode-657.png)\n\nclass java.nio.channels.Selector æ˜¯ Java çš„éé˜»å¡ I/O å®ç°çš„å…³é”®ã€‚å®ƒä½¿ç”¨äº†äº‹ä»¶é€šçŸ¥ API\n\nä»¥ç¡®å®šåœ¨ä¸€ç»„éé˜»å¡å¥—æ¥å­—ä¸­æœ‰å“ªäº›å·²ç»å°±ç»ªèƒ½å¤Ÿè¿› è¡Œ I/O ç›¸å…³çš„æ“ä½œã€‚**å› ä¸ºå¯ä»¥åœ¨ä»»ä½•çš„æ—¶é—´æ£€æŸ¥ä»»æ„**\n\n**çš„è¯»æ“ä½œæˆ–è€…å†™æ“ä½œçš„å®ŒæˆçŠ¶æ€ï¼Œä¸€ä¸ªå•ä¸€çš„çº¿ç¨‹ä¾¿å¯ä»¥å¤„ç†å¤šä¸ªå¹¶å‘çš„è¿æ¥ã€‚**\n\nä¸é˜»å¡ I/O æ¨¡å‹ç›¸æ¯”ï¼Œè¿™ç§æ¨¡å‹æä¾›äº†æ›´å¥½çš„èµ„æºç®¡ç†ï¼š\n\n- ä½¿ç”¨è¾ƒå°‘çš„çº¿ç¨‹ä¾¿å¯ä»¥å¤„ç†è®¸å¤šè¿æ¥ï¼Œå› æ­¤ä¹Ÿå‡å°‘äº†å†…å­˜ç®¡ç†å’Œä¸Šä¸‹æ–‡åˆ‡æ¢æ‰€å¸¦æ¥å¼€é”€ï¼›\n    \n- å½“æ²¡æœ‰ I/O æ“ä½œéœ€è¦å¤„ç†çš„æ—¶å€™ï¼Œçº¿ç¨‹ä¹Ÿå¯ä»¥è¢«ç”¨äºå…¶ä»–ä»»åŠ¡ã€‚\n    \n\n  \n\n# Netty\n\nåœ¨ç½‘ç»œç¼–ç¨‹é¢†åŸŸï¼ŒNettyæ˜¯Javaçš„å“è¶Šæ¡†æ¶ã€‚ å®ƒé©¾é©­äº†Javaé«˜çº§APIçš„èƒ½åŠ›ï¼Œå¹¶å°†å…¶éšè—åœ¨ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„APIä¹‹åã€‚\n\nNetty çš„å…³é”®ç‰¹æ€§\n\n![](statistic/asynccode-665.png)\n\n## Netty çš„ä¸»è¦æ„ä»¶å—\n\n- Channelï¼›\n    \n- å›è°ƒï¼›\n    \n- Futureï¼›\n    \n- äº‹ä»¶å’Œ ChannelHandlerã€‚\n    \n\nè¿™äº›æ„å»ºå—ä»£è¡¨äº†ä¸åŒç±»å‹çš„æ„é€ ï¼šèµ„æºã€é€»è¾‘ä»¥åŠé€šçŸ¥\n\n  \n\n### Channel\n\nChannel æ˜¯ Java NIO çš„ä¸€ä¸ªåŸºæœ¬æ„é€ ã€‚\n\n\u003e å®ƒä»£è¡¨ä¸€ä¸ªåˆ°å®ä½“ï¼ˆå¦‚ä¸€ä¸ªç¡¬ä»¶è®¾å¤‡ã€ä¸€ä¸ªæ–‡ä»¶ã€ä¸€ä¸ªç½‘ç»œå¥—æ¥å­—æˆ–è€…ä¸€ä¸ªèƒ½å¤Ÿæ‰§è¡Œä¸€ä¸ªæˆ–è€…å¤šä¸ªä¸åŒçš„I/Oæ“ä½œçš„ç¨‹åºç»„ä»¶ï¼‰çš„å¼€æ”¾è¿æ¥ï¼Œå¦‚è¯»æ“ä½œå’Œå†™æ“ä½œ â‘ \n\n**æŠŠ Channel çœ‹ä½œæ˜¯ä¼ å…¥ï¼ˆå…¥ç«™ï¼‰æˆ–è€…ä¼ å‡ºï¼ˆå‡ºç«™ï¼‰æ•°æ®çš„è½½ä½“ã€‚å› æ­¤ï¼Œå®ƒå¯ä»¥è¢«æ‰“å¼€æˆ–è€…è¢«å…³é—­ï¼Œè¿æ¥æˆ–è€…æ–­å¼€è¿æ¥ã€‚**\n\n### å›è°ƒ\n\nä¸€ä¸ªå›è°ƒå…¶å®å°±æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œ**ä¸€ä¸ªæŒ‡å‘å·²ç»è¢«æä¾›ç»™å¦å¤–ä¸€ä¸ªæ–¹æ³•çš„æ–¹æ³•çš„å¼•ç”¨**ã€‚\n\nNetty åœ¨å†…éƒ¨ä½¿ç”¨äº†å›è°ƒæ¥å¤„ç†äº‹ä»¶ï¼›å½“ä¸€ä¸ªå›è°ƒè¢«è§¦å‘æ—¶ï¼Œç›¸å…³çš„äº‹ä»¶å¯ä»¥è¢«ä¸€ä¸ª interface ChannelHandler çš„å®ç°å¤„ç†ã€‚\n\n![](statistic/asynccode-663.png)\n\nå½“ä¸€ä¸ªæ–°çš„è¿æ¥å·²ç»è¢«å»ºç«‹æ—¶ï¼ŒChannelHandler çš„ channelActive()å›è°ƒæ–¹æ³•å°†ä¼šè¢«è°ƒç”¨ï¼Œå¹¶å°†æ‰“å°å‡ºä¸€æ¡ä¿¡æ¯ã€‚\n\n  \n\n### Future\n\nFuture æä¾›äº†å¦ä¸€ç§åœ¨æ“ä½œå®Œæˆæ—¶é€šçŸ¥åº”ç”¨ç¨‹åºçš„æ–¹å¼ã€‚è¿™ä¸ªå¯¹è±¡å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„ç»“æœçš„å ä½ç¬¦ï¼›å®ƒå°†åœ¨æœªæ¥çš„æŸä¸ªæ—¶åˆ»å®Œæˆï¼Œå¹¶æä¾›å¯¹å…¶ç»“æœçš„è®¿é—®\n\n- JDK é¢„ç½®äº† interface java.util.concurrent.Futureï¼Œä½†æ˜¯å…¶æ‰€æä¾›çš„å®ç°ï¼Œåª å…è®¸æ‰‹åŠ¨æ£€æŸ¥å¯¹åº”çš„æ“ä½œæ˜¯å¦å·²ç»å®Œæˆï¼Œæˆ–è€…ä¸€ç›´é˜»å¡ç›´åˆ°å®ƒå®Œæˆã€‚è¿™æ˜¯éå¸¸ç¹ççš„ï¼Œ\n    \n- æ‰€ä»¥ Netty æä¾›äº†å®ƒè‡ªå·±çš„å®ç°â€”â€”ChannelFutureï¼Œç”¨äºåœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œçš„æ—¶å€™ä½¿ç”¨\n    \n\n  \n\n- ChannelFutureæä¾›äº†å‡ ç§é¢å¤–çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæ³¨å†Œä¸€ä¸ªæˆ–è€…å¤šä¸ª ChannelFutureListenerå®ä¾‹ã€‚ç›‘å¬å™¨çš„å›è°ƒæ–¹æ³•operationComplete()ï¼Œå°†ä¼šåœ¨å¯¹åº”çš„æ“ä½œå®Œæˆæ—¶è¢«è°ƒç”¨\n    \n- æ¯ä¸ª Netty çš„å‡ºç«™ I/O æ“ä½œéƒ½å°†è¿”å›ä¸€ä¸ª ChannelFutureï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬éƒ½ä¸ä¼šé˜»å¡ã€‚æ­£å¦‚æˆ‘ä»¬å‰é¢æ‰€æåˆ°è¿‡çš„ä¸€æ ·ï¼ŒNetty å®Œå…¨æ˜¯å¼‚æ­¥å’Œäº‹ä»¶é©±åŠ¨çš„\n    \n\n![](statistic/asynccode-656.png)\n\n  \n\nChannel å›è°ƒçš„ç”¨æ³•\n\n![](statistic/asynccode-662.png)\n\n### äº‹ä»¶å’ŒChannelHandler\n\nNetty ä½¿ç”¨ä¸åŒçš„äº‹ä»¶æ¥é€šçŸ¥æˆ‘ä»¬çŠ¶æ€çš„æ”¹å˜æˆ–è€…æ˜¯æ“ä½œçš„çŠ¶æ€ã€‚è¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤ŸåŸºäºå·²ç» =å‘ç”Ÿçš„äº‹ä»¶æ¥è§¦å‘é€‚å½“çš„åŠ¨ä½œã€‚\n\nNetty æ˜¯ä¸€ä¸ªç½‘ç»œç¼–ç¨‹æ¡†æ¶ï¼Œæ‰€ä»¥äº‹ä»¶æ˜¯æŒ‰ç…§å®ƒä»¬ä¸å…¥ç«™æˆ–å‡ºç«™æ•°æ®æµçš„ç›¸å…³æ€§è¿›è¡Œåˆ†ç±»çš„ã€‚\n\n  \n\nå¯èƒ½ç”±**å…¥ç«™**æ•°æ®æˆ–è€…ç›¸å…³çš„çŠ¶æ€æ›´æ”¹è€Œè§¦å‘çš„äº‹ä»¶åŒ…æ‹¬ï¼š\n\n- ï® è¿æ¥å·²è¢«æ¿€æ´»æˆ–è€…è¿æ¥å¤±æ´»ï¼›\n    \n- ï® æ•°æ®è¯»å–ï¼›\n    \n- ï® ç”¨æˆ·äº‹ä»¶ï¼›\n    \n- ï® é”™è¯¯äº‹ä»¶ã€‚\n    \n\n**å‡ºç«™äº‹ä»¶**æ˜¯æœªæ¥å°†ä¼šè§¦å‘çš„æŸä¸ªåŠ¨ä½œçš„æ“ä½œç»“æœï¼Œè¿™äº›åŠ¨ä½œåŒ…æ‹¬ï¼š\n\n- ï® æ‰“å¼€æˆ–è€…å…³é—­åˆ°è¿œç¨‹èŠ‚ç‚¹çš„è¿æ¥ï¼›\n    \n- ï® å°†æ•°æ®å†™åˆ°æˆ–è€…å†²åˆ·åˆ°å¥—æ¥å­—ã€‚\n    \n\næ¯ä¸ªäº‹ä»¶éƒ½å¯ä»¥è¢«åˆ†å‘ç»™ ChannelHandler ç±»ä¸­çš„æŸä¸ªç”¨æˆ·å®ç°çš„æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å°†äº‹ä»¶é©±åŠ¨èŒƒå¼ç›´æ¥è½¬æ¢ä¸ºåº”ç”¨ç¨‹åºæ„ä»¶å—çš„ä¾‹å­ã€‚\n\n![](statistic/asynccode-664.png)\n\n  \n\n## Netty çš„ç»„ä»¶å’Œè®¾è®¡\n\n- é¦–å…ˆï¼Œå®ƒçš„åŸºäº Java NIO çš„å¼‚æ­¥çš„å’Œäº‹ä»¶é©±åŠ¨çš„å®ç°ï¼Œä¿è¯äº†é«˜è´Ÿè½½ä¸‹åº”ç”¨ç¨‹åº æ€§èƒ½çš„æœ€å¤§åŒ–å’Œå¯ä¼¸ç¼©æ€§ã€‚\n    \n- å…¶æ¬¡ï¼ŒNetty ä¹ŸåŒ…å«äº†ä¸€ç»„è®¾è®¡æ¨¡å¼ï¼Œå°†åº”ç”¨ç¨‹åºé€»è¾‘ä»ç½‘ç»œå±‚è§£è€¦ï¼Œç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ï¼ŒåŒæ—¶ä¹Ÿæœ€å¤§é™åº¦åœ°æé«˜äº†å¯æµ‹è¯•æ€§ã€æ¨¡å—åŒ–ä»¥åŠä»£ç çš„å¯é‡ç”¨æ€§ã€‚\n    \n\n### Channel\n\nNetty çš„ Channel æ¥ å£æ‰€æä¾›çš„ APIï¼Œå¤§å¤§åœ°é™ä½äº†ç›´æ¥ä½¿ç”¨ Socket ç±»çš„å¤æ‚æ€§ã€‚å…¶åŸºæœ¬çš„æ„é€ æ˜¯ class Socketã€‚\n\nChannel ä¹Ÿæ˜¯æ‹¥æœ‰è®¸å¤š é¢„å®šä¹‰çš„ã€ä¸“é—¨åŒ–å®ç°çš„å¹¿æ³›ç±»å±‚æ¬¡ç»“æ„çš„æ ¹ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€çŸ­çš„éƒ¨åˆ†æ¸…å•ï¼š\n\n- EmbeddedChannelï¼›\n    \n- LocalServerChannelï¼›\n    \n- NioDatagramChannelï¼›\n    \n- NioSctpChannelï¼›\n    \n- NioSocketChannelã€‚\n    \n\n### EventLoop\n\nEventLoop å®šä¹‰äº† Netty çš„æ ¸å¿ƒæŠ½è±¡ï¼Œç”¨äºå¤„ç†è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸä¸­æ‰€å‘ç”Ÿçš„äº‹ä»¶\n\n![](statistic/asynccode-659.png)\n\nChannelã€EventLoopã€Thread ä»¥åŠ EventLoopGroup ä¹‹é—´çš„å…³ç³»\n\n- ä¸€ä¸ª EventLoopGroup åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ª EventLoopï¼›\n    \n- ä¸€ä¸ª EventLoop åœ¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸå†…åªå’Œä¸€ä¸ª Thread ç»‘å®šï¼›\n    \n- æ‰€æœ‰ç”± EventLoop å¤„ç†çš„ I/O äº‹ä»¶éƒ½å°†åœ¨å®ƒä¸“æœ‰çš„ Thread ä¸Šè¢«å¤„ç†ï¼›\n    \n- ä¸€ä¸ª Channel åœ¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸå†…åªæ³¨å†Œäºä¸€ä¸ª EventLoopï¼›\n    \n- ä¸€ä¸ª EventLoop å¯èƒ½ä¼šè¢«åˆ†é…ç»™ä¸€ä¸ªæˆ–å¤šä¸ª Channelã€‚\n    \n\n### ChannelFuture\n\n- Netty ä¸­æ‰€æœ‰çš„ I/O æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ã€‚å› ä¸ºä¸€ä¸ªæ“ä½œå¯èƒ½ä¸ä¼šç«‹å³è¿”å›ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§ç”¨äºåœ¨ä¹‹åçš„æŸä¸ªæ—¶é—´ç‚¹ç¡®å®šå…¶ç»“æœçš„æ–¹æ³•ã€‚\n    \n- Netty æä¾›äº† ChannelFuture æ¥å£ï¼Œå…¶ addListener()æ–¹æ³•æ³¨å†Œäº†ä¸€ä¸ª ChannelFutureListenerï¼Œä»¥ä¾¿åœ¨æŸä¸ªæ“ä½œå®Œæˆæ—¶ï¼ˆæ— è®ºæ˜¯å¦æˆåŠŸï¼‰å¾—åˆ°é€šçŸ¥ã€‚\n    \n\n### ChannelHandler\n\n- ä»åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜çš„è§’åº¦æ¥çœ‹ï¼ŒNetty çš„ä¸»è¦ç»„ä»¶æ˜¯ ChannelHandlerï¼Œå®ƒå……å½“äº†æ‰€æœ‰å¤„ç†å…¥ç«™å’Œå‡ºç«™æ•°æ®çš„åº”ç”¨ç¨‹åºé€»è¾‘çš„å®¹å™¨\n    \n- äº‹å®ä¸Šï¼ŒChannelHandler å¯ä¸“ é—¨ç”¨äºå‡ ä¹ä»»ä½•ç±»å‹çš„åŠ¨ä½œï¼Œä¾‹å¦‚å°†æ•°æ®ä»ä¸€ç§æ ¼å¼è½¬æ¢ä¸ºå¦å¤–ä¸€ç§æ ¼å¼ï¼Œæˆ–è€…å¤„ç†è½¬æ¢è¿‡ç¨‹ä¸­æ‰€æŠ›å‡ºçš„å¼‚å¸¸ã€‚\n    \n\n### ChannaelPipeline\n\n- ChannelPipeline æä¾›äº† ChannelHandler é“¾çš„å®¹å™¨ï¼Œå¹¶**å®šä¹‰äº†ç”¨äºåœ¨è¯¥é“¾ä¸Šä¼ æ’­å…¥ç«™å’Œå‡ºç«™äº‹ä»¶**æµçš„ API\n    \n- å½“ Channel è¢«åˆ›å»ºæ—¶ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨åœ°åˆ†é…åˆ°å®ƒä¸“å±çš„ ChannelPipelineã€‚\n    \n- ChannelHandler å®‰è£…åˆ° ChannelPipeline ä¸­çš„è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤º\n    \n    - ä¸€ä¸ªChannelInitializerçš„å®ç°è¢«æ³¨å†Œåˆ°äº†ServerBootstrapä¸­ â‘  ï¼›\n        \n    - å½“ ChannelInitializer.initChannel()æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼ŒChannelInitializerå°†åœ¨ ChannelPipeline ä¸­å®‰è£…ä¸€ç»„è‡ªå®šä¹‰çš„ ChannelHandlerï¼›\n        \n    - ChannelInitializer **å°†å®ƒè‡ªå·±ä» ChannelPipeline ä¸­ç§»é™¤**ã€‚\n        \n\n  \n\nä» ChannelHandler æ´¾ç”Ÿçš„ ChannelInboundHandler å’Œ ChannelOutboundHandler æ¥å£\n\n![](statistic/asynccode-661.png)\n\n  \n\n- ä¸Šé¢çš„æ¥å£ä½¿å¾—äº‹ä»¶æµç» ChannelPipeline æ˜¯ ChannelHandler çš„å·¥ä½œï¼Œå®ƒä»¬æ˜¯åœ¨åº”ç”¨ç¨‹åºçš„**åˆå§‹åŒ–æˆ–è€…å¼•å¯¼é˜¶æ®µè¢«å®‰è£…çš„**ã€‚\n    \n- è¿™äº›å¯¹è±¡æ¥æ”¶äº‹ä»¶ã€æ‰§è¡Œå®ƒä»¬æ‰€å®ç°çš„å¤„ç†é€»è¾‘ï¼Œå¹¶å°†æ•°æ®ä¼ é€’ç»™é“¾ä¸­çš„ä¸‹ä¸€ä¸ª ChannelHandlerã€‚\n    \n\n![](statistic/asynccode-658.png)\n\n- å®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯ç”±å®ƒä»¬è¢«æ·»åŠ çš„é¡ºåºæ‰€å†³å®šçš„ã€‚å®é™…ä¸Šï¼Œè¢«æˆ‘ä»¬ç§°ä¸º ChannelPipeline çš„æ˜¯è¿™äº› ChannelHandler çš„ç¼–æ’é¡ºåº\n    \n- è™½ç„¶ ChannelInboundHandle å’Œ ChannelOutboundHandle éƒ½æ‰©å±•è‡ª ChannelHandlerï¼Œä½†æ˜¯ Netty èƒ½åŒºåˆ† ChannelInboundHandler å®ç°å’Œ ChannelOutboundHandler å®ç°ï¼Œå¹¶ç¡®ä¿æ•°æ®åªä¼šåœ¨å…·æœ‰ç›¸åŒå®šå‘ç±»å‹çš„ä¸¤ä¸ª ChannelHandler ä¹‹é—´ä¼ é€’ã€‚\n    \n- åœ¨ Netty ä¸­ï¼Œæœ‰**ä¸¤ç§å‘é€æ¶ˆæ¯çš„æ–¹å¼ã€‚**\n    \n    - ä½ å¯ä»¥**ç›´æ¥å†™åˆ° Channel** ä¸­ï¼Œä¼šå¯¼è‡´æ¶ˆæ¯**ä»Channe-lPipeline çš„å°¾ç«¯å¼€å§‹æµåŠ¨**\n        \n    - ä¹Ÿå¯ä»¥å†™åˆ°å’Œ ChannelHandlerç›¸å…³è”çš„**ChannelHandlerContextå¯¹è±¡**ä¸­å°†å¯¼è‡´æ¶ˆæ¯ä» **ChannelPipeline ä¸­çš„ä¸‹ä¸€ä¸ª ChannelHandler å¼€å§‹æµåŠ¨ã€‚**\n        \n\n  \n\n#### é€‚é…å™¨\n\nNetty ä»¥é€‚é…å™¨ç±»çš„å½¢å¼æä¾›äº†å¤§é‡é»˜è®¤çš„ ChannelHandler å®ç°ï¼Œ\n\n- å…¶æ—¨åœ¨ç®€åŒ–åº”ç”¨ç¨‹åºå¤„ç†é€»è¾‘çš„å¼€å‘è¿‡ç¨‹ã€‚\n    \n- ä½ å·²ç»çœ‹åˆ°äº†ï¼ŒChannelPipelineä¸­çš„æ¯ä¸ªChannelHandler å°†è´Ÿè´£æŠŠäº‹ä»¶è½¬å‘åˆ°é“¾ä¸­çš„ä¸‹ä¸€ä¸ª ChannelHandlerã€‚è¿™äº›é€‚é…å™¨ç±»ï¼ˆåŠå®ƒä»¬çš„å­ç±»ï¼‰å°†è‡ªåŠ¨ æ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œæ‰€ä»¥ä½ å¯ä»¥åªé‡å†™é‚£äº›ä½ æƒ³è¦ç‰¹æ®Šå¤„ç†çš„æ–¹æ³•å’Œäº‹ä»¶ã€‚\n    \n- å¸¸ç”¨çš„é€‚é…å™¨\n    \n    - ï® ChannelHandlerAdapter\n        \n    - ï® ChannelInboundHandlerAdapter\n        \n    - ï® ChannelOutboundHandlerAdapter\n        \n    - ï® ChannelDuplexHandler\n        \n\n  \n\n#### ç¼–è§£ç å™¨\n\n- é€šå¸¸æ¥è¯´ï¼Œè¿™äº›åŸºç±»çš„åç§°å°†ç±»ä¼¼äº ByteToMessageDecoder æˆ– MessageToByteEncoderã€‚\n    \n- å¯¹äºç‰¹æ®Šçš„ç±»å‹ï¼Œä½ å¯èƒ½ä¼šå‘ç°ç±»ä¼¼äº ProtobufEncoder å’Œ ProtobufDecoder è¿™æ ·çš„åç§°â€”â€”é¢„ç½®çš„ç”¨æ¥æ”¯æŒ Google çš„ Protocol Buffersã€‚\n    \n- ä¸¥æ ¼åœ°è¯´ï¼Œå…¶ä»–çš„å¤„ç†å™¨ä¹Ÿå¯ä»¥å®Œæˆç¼–ç å™¨å’Œè§£ç å™¨çš„åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æœ‰ç”¨æ¥ç®€åŒ–ChannelHandler çš„åˆ›å»ºçš„é€‚é…å™¨ç±»ä¸€æ ·ï¼Œæ‰€æœ‰ç”± Netty æä¾›çš„ç¼–ç å™¨/è§£ç å™¨é€‚é…å™¨ç±»éƒ½å®ç° ChannelOutboundHandler æˆ–è€… ChannelInboundHandler æ¥å£ã€‚\n    \n\n  \n\n#### SimpleChannelInboundHandler\n\n- æœ€å¸¸è§çš„æƒ…å†µæ˜¯ï¼Œä½ çš„åº”ç”¨ç¨‹åºä¼šåˆ©ç”¨ä¸€ä¸ª ChannelHandler æ¥æ¥æ”¶è§£ç æ¶ˆæ¯ï¼Œå¹¶å¯¹è¯¥æ•°æ®åº”ç”¨ä¸šåŠ¡é€»è¾‘ã€‚\n    \n- è¦åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„ ChannelHandler,ä½ åªéœ€è¦æ‰©å±•åŸºç±» `SimpleChannelInboundHandler\u003cT\u003e`ï¼Œå…¶ä¸­ T æ˜¯ä½ è¦å¤„ç†çš„æ¶ˆæ¯çš„ Java ç±»å‹ ã€‚\n    \n    - åœ¨è¿™ç§ç±»å‹çš„ ChannelHandler ä¸­ï¼Œæœ€é‡è¦çš„æ–¹æ³•æ˜¯ channelRead0(ChannelHandlerContext,T)**ã€‚é™¤äº†è¦æ±‚ä¸è¦é˜»å¡å½“å‰çš„ I/O çº¿ç¨‹ä¹‹å¤–**ï¼Œå…¶å…·ä½“å®ç°å®Œå…¨å–å†³äºä½ \n        \n\n### BootStrap\n\nNetty çš„å¼•å¯¼ç±»ä¸ºåº”ç”¨ç¨‹åºçš„ç½‘ç»œå±‚é…ç½®æä¾›äº†å®¹å™¨ï¼Œ\n\n- è¿™æ¶‰åŠå°†ä¸€ä¸ªè¿›ç¨‹ç»‘å®šåˆ°æŸä¸ªæŒ‡å®šçš„ç«¯å£ï¼ŒServerBootStrap\n    \n- æˆ–è€…å°†ä¸€ä¸ªè¿›ç¨‹è¿æ¥åˆ°å¦ä¸€ä¸ªè¿è¡Œåœ¨æŸä¸ªæŒ‡å®šä¸»æœºçš„æŒ‡å®šç«¯å£ä¸Šçš„è¿›ç¨‹,BootStrap\n    \n\n![](statistic/asynccode-660.png)\n\nå¼•å¯¼ä¸€ä¸ªå®¢æˆ·ç«¯åªéœ€è¦ä¸€ä¸ª EventLoopGroupï¼Œä½†æ˜¯ä¸€ä¸ªServerBootstrap åˆ™éœ€è¦ä¸¤ä¸ªï¼ˆä¹Ÿå¯ä»¥æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼‰ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\n\nå› ä¸ºæœåŠ¡å™¨éœ€è¦ä¸¤ç»„ä¸åŒçš„ Channelã€‚\n\n- ç¬¬ä¸€ç»„å°†åªåŒ…å«ä¸€ä¸ª ServerChannelï¼Œä»£è¡¨æœåŠ¡å™¨è‡ªèº«çš„å·²ç»‘å®šåˆ°æŸä¸ªæœ¬åœ°ç«¯å£çš„æ­£åœ¨ç›‘å¬çš„å¥—æ¥å­—ã€‚\n    \n- è€Œç¬¬äºŒç»„å°†åŒ…å«æ‰€æœ‰å·²åˆ›å»ºçš„ç”¨æ¥å¤„ç†ä¼  å…¥å®¢æˆ·ç«¯è¿æ¥ï¼ˆ**å¯¹äºæ¯ä¸ªæœåŠ¡å™¨å·²ç»æ¥å—çš„è¿æ¥éƒ½æœ‰ä¸€ä¸ª**ï¼‰çš„ Channelã€‚\n    \n\n![](statistic/asynccode-666.png)","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/netty/%E7%BC%96%E8%A7%A3%E7%A0%81%E5%99%A8":{"title":"ç¼–è§£ç å™¨","content":"æ¯ä¸ªç½‘ç»œåº”ç”¨ç¨‹åºéƒ½å¿…é¡»å®šä¹‰å¦‚ä½•è§£æåœ¨\n\n- **ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´æ¥å›ä¼ è¾“çš„åŸå§‹å­—èŠ‚**\n    \n- **å…¶å’Œ ç›®æ ‡åº”ç”¨ç¨‹åºçš„æ•°æ®æ ¼å¼åšç›¸äº’è½¬æ¢**\n    \n\n  \n\n- ç¼–ç å™¨æ˜¯å°†æ¶ˆæ¯è½¬æ¢ä¸ºé€‚åˆäºä¼ è¾“çš„æ ¼å¼ï¼ˆæœ€æœ‰å¯èƒ½çš„å°±æ˜¯å­—èŠ‚æµï¼‰ï¼›\n    \n- è€Œå¯¹åº”çš„è§£ç å™¨åˆ™æ˜¯å°†ç½‘ç»œå­—èŠ‚æµè½¬æ¢å›åº”ç”¨ç¨‹åºçš„æ¶ˆæ¯æ ¼å¼\n    \n\n  \n\n# è§£ç å™¨\n\nå› ä¸ºè§£ç å™¨æ˜¯è´Ÿè´£å°†å…¥ç«™æ•°æ®ä»ä¸€ç§æ ¼å¼è½¬æ¢åˆ°å¦ä¸€ç§æ ¼å¼çš„ï¼Œæ‰€ä»¥çŸ¥é“ Netty çš„è§£ç å™¨å®ç°äº† **ChannelInboundHandler** ä¹Ÿä¸ä¼šè®©ä½ æ„Ÿåˆ°æ„å¤–ã€‚\n\næˆ‘ä»¬å°†ç ”ç©¶ Netty æ‰€æä¾›çš„è§£ç å™¨ç±»ï¼Œå¹¶æä¾›å…³äºä½•æ—¶ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬çš„å…· ä½“ç¤ºä¾‹ã€‚è¿™äº›ç±»è¦†ç›–äº†ä¸¤ä¸ªä¸åŒçš„ç”¨ä¾‹ï¼š\n\n- å°†å­—èŠ‚è§£ç ä¸ºæ¶ˆæ¯â€”â€”**ByteToMessageDecoder å’Œ ReplayingDecoderï¼›**\n    \n- å°†ä¸€ç§æ¶ˆæ¯ç±»å‹è§£ç ä¸ºå¦ä¸€ç§â€”â€”**MessageToMessageDecoder**\n    \n\n  \n\n## ByteToMessageDecoder\n\nå°†å­—èŠ‚è§£ç ä¸ºæ¶ˆæ¯ï¼ˆæˆ–è€…å¦ä¸€ä¸ªå­—èŠ‚åºåˆ—ï¼‰æ˜¯ä¸€é¡¹å¦‚æ­¤å¸¸è§çš„ä»»åŠ¡ï¼Œä»¥è‡³äº Netty ä¸ºå®ƒæä¾›äº†ä¸€ä¸ªæŠ½è±¡çš„åŸºç±»ï¼šByteToMessageDecoder\n\n![](statistic/asynccode-750.png)\n\n![](statistic/asynccode-745.png)\n\n![](statistic/asynccode-748.png)\n\nè™½ç„¶ ByteToMessageDecoder ä½¿å¾—å¯ä»¥å¾ˆç®€å•åœ°å®ç°è¿™ç§æ¨¡å¼ï¼Œä½†æ˜¯ä½ å¯èƒ½ä¼šå‘ç°ï¼Œ**åœ¨è°ƒç”¨ readInt()æ–¹æ³•å‰ä¸å¾—ä¸éªŒè¯æ‰€è¾“å…¥çš„ ByteBuf æ˜¯å¦å…·æœ‰è¶³å¤Ÿçš„æ•°æ®æœ‰ç‚¹ç¹ç**ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œ\n\næˆ‘ä»¬å°†è®¨è®º ReplayingDecoderï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è§£ç å™¨ï¼Œä»¥å°‘é‡çš„å¼€é”€æ¶ˆé™¤äº†è¿™ä¸ªæ­¥éª¤\n\n  \n\n## ReplayingDecoder\n\nReplayingDecoderæ‰©å±•äº†ByteToMessageDecoderç±»ï¼ˆå¦‚ä»£ç æ¸…å• 10-1 æ‰€ç¤ºï¼‰ï¼Œä½¿å¾—æˆ‘ä»¬ä¸å¿…è°ƒç”¨ readableBytes()æ–¹æ³•ï¼Œå®ƒé€šè¿‡ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„ByteBufå®ç° ï¼Œ\n\nReplayingDecoderByteBufï¼ŒåŒ…è£…ä¼ å…¥çš„ByteBufå®ç°äº†è¿™ä¸€ç‚¹ï¼Œå…¶å°†åœ¨å†…éƒ¨æ‰§è¡Œè¯¥è°ƒç”¨\n\n![](statistic/asynccode-750.png)\n\n- ByteBufä¸­æå–çš„intå°†ä¼šè¢«æ·»åŠ åˆ°Listä¸­ã€‚**å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å­—èŠ‚å¯ç”¨ï¼Œè¿™ä¸ªreadInt()æ–¹æ³•çš„å®ç°å°†ä¼šæŠ›å‡ºä¸€ä¸ªError**\n    \n- å¹¶ä¸æ˜¯æ‰€æœ‰çš„ ByteBuf æ“ä½œéƒ½è¢«æ”¯æŒï¼Œå¦‚æœè°ƒç”¨äº†ä¸€ä¸ªä¸è¢«æ”¯æŒçš„æ–¹æ³•ï¼Œå°†ä¼šæŠ›å‡ºä¸€ä¸ª UnsupportedOperationExceptionï¼›\n    \n- ReplayingDecoder ç¨æ…¢äº ByteToMessageDecoderã€‚\n    \n\n  \n\n## MessageToMessageDecoder\n\n```Go\npublic abstract class MessageToMessageDecoder\u003cI\u003e extends ChannelInboundHandlerAdapter\n```\n\n![](statistic/asynccode-750.png)\n\n  \n\n![](statistic/asynccode-745.png)\n\n![](statistic/asynccode-745.png)\n\n## TooLongFrameException ç±»\n\nç”±äº Netty æ˜¯ä¸€ä¸ªå¼‚æ­¥æ¡†æ¶ï¼Œæ‰€ä»¥éœ€è¦åœ¨å­—èŠ‚å¯ä»¥è§£ç ä¹‹å‰åœ¨å†…å­˜ä¸­ç¼“å†²å®ƒä»¬ã€‚å› æ­¤ï¼Œä¸èƒ½è®©è§£ç å™¨ç¼“å†²å¤§é‡çš„æ•°æ®ä»¥è‡³äºè€—å°½å¯ç”¨çš„å†…å­˜.Netty æä¾›äº†TooLongFrameException ç±»ï¼Œå…¶å°†ç”±è§£ç å™¨åœ¨å¸§è¶…å‡ºæŒ‡å®šçš„å¤§å°é™åˆ¶æ—¶æŠ›å‡ºã€‚\n\nByteToMessageDecoder æ˜¯å¦‚ä½•ä½¿ç”¨ TooLongFrameException æ¥é€šçŸ¥ ChannelPipeline ä¸­çš„å…¶ä»– ChannelHandler å‘ç”Ÿäº†å¸§å¤§å°æº¢å‡ºçš„ã€‚\n\n![](statistic/asynccode-745.png)\n\n  \n\n# ç¼–ç å™¨\n\nç¼–ç å™¨å®ç°äº† ChannelOutboundHandlerï¼Œå¹¶å°†å‡ºç«™æ•°æ®ä»ä¸€ç§æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼ï¼Œ\n\n- ï® å°†æ¶ˆæ¯ç¼–ç ä¸ºå­—èŠ‚ï¼›\n    \n- ï® å°†æ¶ˆæ¯ç¼–ç ä¸ºæ¶ˆæ¯ â‘ \n    \n\næˆ‘ä»¬å°†é¦–å…ˆä»æŠ½è±¡åŸºç±» MessageToByteEncoder å¼€å§‹æ¥å¯¹è¿™äº›ç±»è¿›è¡Œè€ƒå¯Ÿã€‚\n\n## MessageToByteEncoder\n\nä½¿ ç”¨ MessageToByteEncoder å°†æ¶ˆæ¯è½¬åŒ–ä¸ºå­—èŠ‚\n\n![](statistic/asynccode-744.png)\n\n![](statistic/asynccode-745.png)\n\n![](statistic/asynccode-743.png)\n\n## MessageToMessageEncoder\n\næ•°æ®å°†å¦‚ä½•ä»ä¸€ç§æ¶ˆæ¯ç¼–ç ä¸ºå¦ä¸€ç§\n\n![](statistic/asynccode-745.png)\n\n![](statistic/asynccode-745.png)\n\n![](statistic/asynccode-726.png)\n\n  \n\n  \n\n# æŠ½è±¡çš„ç¼–è§£ç \n\nä»¬ä¸€ç›´å°†è§£ç å™¨å’Œç¼–ç å™¨ä½œä¸ºå•ç‹¬çš„å®ä½“è®¨è®ºï¼Œä½†æ˜¯ä½ æœ‰æ—¶å°†ä¼šå‘ç°åœ¨åŒä¸€ä¸ªç±»ä¸­ç®¡ç†å…¥ç«™å’Œå‡ºç«™æ•°æ®å’Œæ¶ˆæ¯çš„è½¬æ¢æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚\n\nè¿™äº›ç±»åŒæ—¶å®ç°äº† ChannelInboundHandler å’Œ ChannelOutboundHandler æ¥å£ã€‚\n\n  \n\n## ByteToMessageCodec\n\n![](statistic/asynccode-728.png)\n\n## MessageToMessageCodec\n\n![](statistic/asynccode-727.png)\n\n## CombinedChannelDuplexHandler\n\nç»“åˆä¸€ä¸ªè§£ç å™¨å’Œç¼–ç å™¨å¯èƒ½ä¼šå¯¹å¯é‡ç”¨æ€§é€ æˆå½±å“ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ ç§æ–¹æ³•æ—¢èƒ½å¤Ÿé¿å…è¿™ç§æƒ©ç½šï¼Œåˆä¸ä¼šç‰ºç‰²å°†ä¸€ä¸ªè§£ç å™¨å’Œä¸€ä¸ªç¼–ç å™¨ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å•å…ƒéƒ¨ç½²æ‰€å¸¦æ¥çš„ä¾¿åˆ©æ€§ã€‚CombinedChannelDuplexHandler æä¾›äº†è¿™ä¸ªè§£å†³æ–¹æ¡ˆ\n\n```Go\npublic class CombinedChannelDuplexHandler \u003cI extends ChannelInboundHandler, O extends ChannelOutboundHandler\u003e\n```\n\nè¿™ä¸ªç±»å……å½“äº† ChannelInboundHandler å’Œ ChannelOutboundHandlerï¼ˆè¯¥ç±»çš„ç±»å‹ å‚æ•° I å’Œ Oï¼‰çš„å®¹å™¨ã€‚\n\né€šè¿‡æä¾›åˆ†åˆ«ç»§æ‰¿äº†è§£ç å™¨ç±»å’Œç¼–ç å™¨ç±»çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªç¼–è§£ç å™¨ï¼Œ**è€Œåˆä¸å¿…ç›´æ¥æ‰©å±•æŠ½è±¡çš„ç¼–è§£ç å™¨ç±»**\n\n![](statistic/asynccode-745.png)\n\n![](statistic/asynccode-745.png)\n\n![](statistic/asynccode-745.png)","lastmodified":"2023-08-07T15:43:17.939769467Z","tags":[]},"/netty/BootStrap":{"title":"BootStrap","content":"\nç®€å•æ¥è¯´ï¼Œ**å¼•å¯¼ä¸€ä¸ªåº”ç”¨ç¨‹åºæ˜¯æŒ‡å¯¹å®ƒè¿›è¡Œé…ç½®ï¼Œå¹¶ä½¿å®ƒè¿è¡Œèµ·æ¥çš„è¿‡ç¨‹**â€”å°½ç®¡è¯¥è¿‡ç¨‹çš„å…·ä½“ç»†èŠ‚å¯èƒ½å¹¶ä¸å¦‚å®ƒçš„å®šä¹‰é‚£æ ·ç®€å•ï¼Œå°¤å…¶æ˜¯å¯¹äºä¸€ä¸ªç½‘ç»œåº”ç”¨ç¨‹åºæ¥è¯´\n\n  \n\nNettyå¤„ç†å¼•å¯¼çš„æ–¹å¼**ä½¿ä½ çš„åº”ç”¨ç¨‹åºå’Œç½‘ç»œå±‚ç›¸éš”ç¦»**ï¼Œæ— è®ºå®ƒæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨\n\n  \n\n# BootStrapç±»\n\nå¼•å¯¼ç±»çš„å±‚æ¬¡ç»“æ„åŒ…æ‹¬ä¸€ä¸ªæŠ½è±¡çš„çˆ¶ç±»å’Œä¸¤ä¸ªå…·ä½“çš„å¼•å¯¼å­ç±»\n\n![](statistic/asynccode-699.png)\n\nç›¸å¯¹äºå°†å…·ä½“çš„å¼•å¯¼ç±»åˆ†åˆ«çœ‹ä½œç”¨äºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„å¼•å¯¼æ¥è¯´ï¼Œè®°ä½å®ƒä»¬çš„æœ¬æ„æ˜¯ç”¨æ¥æ”¯æ’‘ä¸åŒçš„åº”ç”¨ç¨‹åºçš„åŠŸèƒ½çš„å°†æœ‰æ‰€è£¨ç›Šã€‚\n\n- æœåŠ¡å™¨è‡´åŠ›äºä½¿ç”¨ä¸€ä¸ªçˆ¶ Channel æ¥æ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¹¶åˆ›å»ºå­ Channel ä»¥ç”¨äºå®ƒä»¬ä¹‹é—´çš„é€šä¿¡\n    \n- è€Œå®¢æˆ·ç«¯å°†æœ€å¯èƒ½åªéœ€è¦ä¸€ä¸ªå•ç‹¬çš„ã€æ²¡æœ‰çˆ¶ Channel çš„ Channel æ¥ç”¨äºæ‰€æœ‰çš„ç½‘ç»œäº¤äº’\n    \n\n  \n\nä¸¤ç§åº”ç”¨ç¨‹åºç±»å‹ä¹‹é—´é€šç”¨çš„å¼•å¯¼æ­¥éª¤ç”± AbstractBootstrap å¤„ç†ï¼Œè€Œç‰¹å®šäºå®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨çš„å¼•å¯¼æ­¥éª¤åˆ™åˆ†åˆ«ç”± Bootstrap æˆ– ServerBootstrap å¤„ç†\n\n  \n\nAbstractBootstrap ç±»çš„å®Œæ•´å£°æ˜æ˜¯ï¼š\n\n```Go\npublic abstract class AbstractBootstrap \u003cB extends AbstractBootstrap\u003cB,C\u003e,C extends Channel\u003e\n```\n\nåœ¨è¿™ä¸ªç­¾åä¸­ï¼Œå­ç±»å‹ B æ˜¯å…¶çˆ¶ç±»å‹çš„ä¸€ä¸ªç±»å‹å‚æ•°ï¼Œ**å› æ­¤å¯ä»¥è¿”å›åˆ°è¿è¡Œæ—¶å®ä¾‹çš„å¼•ç”¨ä»¥æ”¯æŒæ–¹æ³•çš„é“¾å¼è°ƒç”¨**\n\nå…¶å­ç±»çš„å£°æ˜å¦‚ä¸‹ï¼š\n\n```Go\npublic class Bootstrap extends AbstractBootstrap\u003cBootstrap,Channel\u003e\n\npublic class ServerBootstrap extends AbstractBootstrap\u003cServerBootstrap,ServerChannel\u003e\n```\n\n  \n\n# å¼•å¯¼å®¢æˆ·ç«¯å’Œæ— è¿æ¥åè®®\n\n**Bootstrap ç±»è¢«ç”¨äºå®¢æˆ·ç«¯æˆ–è€…ä½¿ç”¨äº†æ— è¿æ¥åè®®çš„åº”ç”¨ç¨‹åºä¸­**\n\n![](statistic/asynccode-732.png)\n\n![](statistic/asynccode-708.png)\n\n## BootStrap\n\nBootstrap ç±»è´Ÿè´£ä¸ºå®¢æˆ·ç«¯å’Œä½¿ç”¨æ— è¿æ¥åè®®çš„åº”ç”¨ç¨‹åºåˆ›å»º Channel\n\n![](statistic/asynccode-709.png)\n\n![](statistic/asynccode-734.png)\n\n![](statistic/asynccode-703.png)\n\n## Channel å’Œ EventLoopGroup çš„å…¼å®¹æ€§\n\nä½ å¯ä»¥ä»åŒ…åä»¥åŠä¸å…¶ç›¸å¯¹åº” çš„ç±»åçš„å‰ç¼€çœ‹åˆ°ï¼Œå¯¹äº NIO ä»¥åŠ OIO ä¼ è¾“ä¸¤è€…æ¥è¯´ï¼Œéƒ½æœ‰ç›¸å…³çš„ EventLoopGroup å’ŒChannel å®ç°ã€‚\n\n![](statistic/asynccode-733.png)\n\nä¸èƒ½æ··ç”¨å…·æœ‰ä¸åŒå‰ç¼€çš„ç»„ä»¶ï¼Œå¦‚ NioEventLoopGroup å’Œ OioSocketChannelï¼Œä¼šå¯¼è‡´ IllegalStateExceptionï¼Œ\n\n![](statistic/asynccode-710.png)\n\n# å¼•å¯¼æœåŠ¡ç«¯\n\n  \n\n## ServerBootStrap\n\n  \n\n![](statistic/asynccode-702.png)\n\nåˆ—å‡ºäº†ä¸€äº›bootStrapä¸å­˜åœ¨çš„æ–¹æ³•ï¼šchildHandler()ã€ childAttr()å’Œ childOption()ã€‚è¿™äº›è°ƒç”¨æ”¯æŒç‰¹åˆ«ç”¨äºæœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„æ“ä½œã€‚å…·ä½“æ¥è¯´ï¼Œ **ServerChannel çš„å®ç°è´Ÿè´£åˆ›å»ºå­ Channelï¼Œè¿™äº›å­ Channel ä»£è¡¨äº†å·²è¢«æ¥å—çš„è¿æ¥ã€‚**è´Ÿè´£å¼•å¯¼ ServerChannel çš„ ServerBootstrap æä¾›äº†è¿™äº›æ–¹æ³•ï¼Œä»¥ç®€åŒ–å°†è®¾ç½®åº”ç”¨åˆ°å·²è¢«æ¥å—çš„å­ Channel çš„ ChannelConfig çš„ä»»åŠ¡\n\n- ServerBootstrap åœ¨ bind()æ–¹æ³•è¢«è°ƒç”¨æ—¶åˆ›å»ºäº†ä¸€ä¸ª ServerChannelï¼Œ ä¸”è¯¥ ServerChannel ç®¡ç†äº†å¤šä¸ªå­ Channelã€‚\n    \n\n![](statistic/asynccode-704.png)\n\n![](statistic/asynccode-700.png)\n\n  \n\n# ä»Channelå¼•å¯¼å®¢æˆ·ç«¯\n\næˆ‘ä»¬éƒ½åœ¨å¼•å¯¼çš„è¿‡ç¨‹ä¸­è°ƒç”¨äº† handler()æˆ–è€… childHandler()æ–¹æ³•æ¥æ·»åŠ å•ä¸ªçš„ ChannelHandlerã€‚\n\né€šè¿‡åœ¨ ChannelPipeline ä¸­å°†å®ƒä»¬é“¾æ¥åœ¨ä¸€èµ·æ¥éƒ¨ç½²å°½å¯èƒ½å¤šçš„ ChannelHandlerã€‚\n\n![](statistic/asynccode-707.png)\n\n![](statistic/asynccode-706.png)\n\n  \n\n# ä½¿ç”¨Nettyçš„ChannelOptionå±æ€§\n\nå¯ä»¥ä½¿ç”¨ option()æ–¹æ³•æ¥å°† ChannelOption åº”ç”¨åˆ°å¼•\n\nåœ¨æŸäº›å¸¸ç”¨çš„å±æ€§å’Œæ•°æ®ä¸å¯ç”¨æ—¶ï¼ŒNetty æä¾›äº† AttributeMap æŠ½è±¡ï¼ˆä¸€ä¸ªç”± Channel å’Œå¼•å¯¼ç±»æä¾›çš„é›†åˆï¼‰ä»¥åŠ `AttributeKey\u003cT\u003e`ï¼ˆä¸€ ä¸ªç”¨äºæ’å…¥å’Œè·å–å±æ€§å€¼çš„æ³›å‹ç±»ï¼‰ã€‚\n\nä½¿ç”¨è¿™äº›å·¥å…·ï¼Œä¾¿å¯ä»¥å®‰å…¨åœ°å°†ä»»ä½•ç±»å‹çš„æ•°æ®é¡¹ä¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ Channelï¼ˆåŒ…å« ServerChannel çš„å­ Channelï¼‰ç›¸å…³è”äº†ã€‚\n\n![](statistic/asynccode-705.png)\n\n# å¼•å¯¼DataGramChannel\n\nNetty æä¾›äº†å„ç§ DatagramChannel çš„å®ç°ã€‚å”¯ä¸€åŒºåˆ«å°±æ˜¯ï¼Œ**ä¸å†è°ƒç”¨ connect()æ–¹æ³•ï¼Œè€Œæ˜¯åªè°ƒç”¨ bind()æ–¹æ³•**\n\n![](statistic/asynccode-701.png)\n\n# å…³é—­\n\n- å¼•å¯¼ä½¿ä½ çš„åº”ç”¨ç¨‹åºå¯åŠ¨å¹¶ä¸”è¿è¡Œèµ·æ¥ï¼Œä½†æ˜¯è¿Ÿæ—©ä½ éƒ½éœ€è¦ä¼˜é›…åœ°å°†å®ƒå…³é—­\n    \n- æœ€é‡è¦çš„æ˜¯ï¼Œä½ éœ€è¦å…³é—­ EventLoopGroupï¼Œå®ƒå°†å¤„ç†ä»»ä½•æŒ‚èµ·çš„äº‹ä»¶å’Œä»»åŠ¡ï¼Œå¹¶ä¸”éšåé‡Šæ”¾æ‰€æœ‰æ´»åŠ¨çš„çº¿ç¨‹ã€‚\n    \n- è¿™å°±æ˜¯è°ƒç”¨ EventLoopGroup.shutdownGracefully()æ–¹æ³•çš„ä½œç”¨ã€‚\n    \n\n![](statistic/asynccode-729.png)","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/netty/ByteBuf":{"title":"ByteBuf","content":"ç½‘ç»œæ•°æ®çš„åŸºæœ¬å•ä½æ€»æ˜¯å­—èŠ‚ã€‚Java NIO æä¾›äº† ByteBuffer ä½œä¸ºå®ƒçš„å­—èŠ‚å®¹å™¨ï¼Œä½†æ˜¯è¿™ä¸ªç±»ä½¿ç”¨èµ·æ¥è¿‡äºå¤æ‚ï¼Œè€Œä¸”ä¹Ÿæœ‰äº›ç¹çã€‚\n\nNetty çš„ ByteBuffer æ›¿ä»£å“æ˜¯ ByteBufï¼Œä¸€ä¸ªå¼ºå¤§çš„å®ç°ï¼Œæ—¢è§£å†³äº† JDK API çš„å±€é™æ€§ï¼Œåˆä¸ºç½‘ç»œåº”ç”¨ç¨‹åºçš„å¼€å‘è€…æä¾›äº†æ›´å¥½çš„ APIã€‚\n\n# ByteBuf çš„ä¼˜ç‚¹\n\nNetty çš„æ•°æ®å¤„ç† API é€šè¿‡ä¸¤ä¸ªç»„ä»¶æš´éœ²â€”â€”abstract class ByteBuf å’Œ interface ByteBufHolderã€‚\n\nä¸‹é¢æ˜¯ä¸€äº› ByteBuf API çš„ä¼˜ç‚¹ï¼š\n\nï® å®ƒå¯ä»¥è¢«ç”¨æˆ·è‡ªå®šä¹‰çš„ç¼“å†²åŒºç±»å‹æ‰©å±•ï¼›\n\nï® é€šè¿‡å†…ç½®çš„å¤åˆç¼“å†²åŒºç±»å‹å®ç°äº†é€æ˜çš„é›¶æ‹·è´ï¼›\n\nï® å®¹é‡å¯ä»¥æŒ‰éœ€å¢é•¿ï¼ˆç±»ä¼¼äº JDK çš„ StringBuilderï¼‰ï¼›\n\nï® åœ¨è¯»å’Œå†™è¿™ä¸¤ç§æ¨¡å¼ä¹‹é—´åˆ‡æ¢ä¸éœ€è¦è°ƒç”¨ ByteBuffer çš„ flip()æ–¹æ³•ï¼›\n\nï® è¯»å’Œå†™ä½¿ç”¨äº†ä¸åŒçš„ç´¢å¼•ï¼›\n\nï® æ”¯æŒæ–¹æ³•çš„é“¾å¼è°ƒç”¨ï¼›\n\n# ByteBuf å¦‚ä½•å·¥ä½œ\n\n**ByteBuf ç»´æŠ¤äº†ä¸¤ä¸ªä¸åŒçš„ç´¢å¼•ï¼šä¸€ä¸ªç”¨äºè¯»å–ï¼Œä¸€ä¸ªç”¨äºå†™å…¥**ã€‚å½“ä½ ä» ByteBuf è¯»å–æ—¶ï¼Œ å®ƒçš„ readerIndex å°†ä¼šè¢«é€’å¢å·²ç»è¢«è¯»å–çš„å­—èŠ‚æ•°ã€‚åŒæ ·åœ°ï¼Œå½“ä½ å†™å…¥ ByteBuf æ—¶ï¼Œå®ƒçš„ writerIndex ä¹Ÿä¼šè¢«é€’å¢ã€‚\n\n![](statistic/asynccode-671.png)\n\nreaderIndex è¾¾åˆ° å’Œ writerIndex åŒæ ·çš„å€¼æ—¶, è¯•å›¾è¯»å–è¶…å‡ºè¯¥ç‚¹çš„æ•°æ®å°†ä¼šè§¦å‘ä¸€ä¸ª IndexOutOfBoundsExceptionã€‚\n\n  \n\n# ByteBuf çš„ä½¿ç”¨æ¨¡å¼\n\n## å †ç¼“å†²åŒº\n\næœ€å¸¸ç”¨çš„ ByteBuf æ¨¡å¼æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨ **JVM çš„å †ç©ºé—´**ä¸­ï¼Œè¿™ç§æ¨¡å¼è¢«ç§°ä¸º**æ”¯æ’‘æ•°ç»„** ï¼ˆbacking arrayï¼‰ï¼Œå®ƒèƒ½åœ¨**æ²¡æœ‰ä½¿ç”¨æ± åŒ–çš„æƒ…å†µä¸‹æä¾›å¿«é€Ÿçš„åˆ†é…å’Œé‡Šæ”¾**\n\n![](statistic/asynccode-673.png)\n\n## ç›´æ¥ç¼“å†²åŒº\n\nNIO åœ¨ JDK 1.4 ä¸­å¼•å…¥çš„ ByteBuffer ç±»å…è®¸ JVM å®ç°é€šè¿‡æœ¬åœ°è°ƒ ç”¨æ¥åˆ†é…å†…å­˜ã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº†é¿**å…åœ¨æ¯æ¬¡è°ƒç”¨æœ¬åœ° I/O æ“ä½œä¹‹å‰ï¼ˆæˆ–è€…ä¹‹åï¼‰å°†ç¼“å†²åŒºçš„å†…å®¹å¤ åˆ¶åˆ°ä¸€ä¸ªä¸­é—´ç¼“å†²åŒºï¼ˆæˆ–è€…ä»ä¸­é—´ç¼“å†²åŒºæŠŠå†…å®¹å¤åˆ¶åˆ°ç¼“å†²åŒºï¼‰ã€‚**\n\nç›´æ¥ç¼“å†²åŒºçš„ä¸»è¦ç¼ºç‚¹æ˜¯ï¼Œç›¸å¯¹äºåŸºäºå †çš„ç¼“å†²åŒºï¼Œ**å®ƒä»¬çš„åˆ†é…å’Œé‡Šæ”¾éƒ½è¾ƒä¸ºæ˜‚è´µã€‚**\n\n![](statistic/asynccode-679.png)\n\n## ç¬¦åˆç¼“å†²åŒº\n\nå®ƒä¸º**å¤šä¸ª ByteBuf æä¾›ä¸€ä¸ªèšåˆè§†å›¾ã€‚**åœ¨è¿™é‡Œä½ å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æˆ–è€…åˆ é™¤ ByteBuf å®ä¾‹ï¼Œè¿™æ˜¯ä¸€ä¸ª JDK çš„ ByteBuffer å®ç°å®Œå…¨ç¼ºå¤±çš„ç‰¹æ€§ã€‚\n\nNetty é€šè¿‡ä¸€ä¸ª ByteBuf å­ç±»â€”â€”**CompositeByteBufâ€”â€”å®ç°äº†è¿™ä¸ªæ¨¡å¼**ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå°†å¤šä¸ª**ç¼“å†²åŒºè¡¨ç¤ºä¸ºå•ä¸ªåˆå¹¶ç¼“å†²åŒºçš„è™šæ‹Ÿè¡¨ç¤º**ã€‚\n\nä¸ºäº†ä¸¾ä¾‹è¯´æ˜ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹ä¸€ä¸ªç”±ä¸¤éƒ¨åˆ†â€”â€”å¤´éƒ¨å’Œä¸»ä½“â€”â€”ç»„æˆçš„å°†é€šè¿‡ HTTP åè®® ä¼ è¾“çš„æ¶ˆæ¯ã€‚**è¿™ä¸¤éƒ¨åˆ†ç”±åº”ç”¨ç¨‹åºçš„ä¸åŒæ¨¡å—äº§ç”Ÿï¼Œå°†ä¼šåœ¨æ¶ˆæ¯è¢«å‘é€çš„æ—¶å€™ç»„è£…**ã€‚è¯¥åº”ç”¨ç¨‹åº å¯ä»¥é€‰æ‹©ä¸ºå¤šä¸ªæ¶ˆæ¯é‡ç”¨ç›¸åŒçš„æ¶ˆæ¯ä¸»ä½“ã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œå¯¹äºæ¯ä¸ªæ¶ˆæ¯éƒ½å°†ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¤´éƒ¨ã€‚\n\n![](statistic/asynccode-683.png)\n\n- ä½¿ç”¨ByteBuffer çš„ç¬¦åˆç¼“å†²åŒºæ¨¡å¼\n    \n\n![](statistic/asynccode-684.png)\n\n- ä½¿ç”¨ **CompositeByteBuf** çš„å¤åˆç¼“å†²åŒºæ¨¡å¼\n    \n\n![](statistic/asynccode-684.png)\n\n- è®¿é—® **CompositeByteBuf** ä¸­çš„æ•°æ®\n    \n\n![](statistic/asynccode-687.png)\n\n  \n\n# å­—èŠ‚çº§æ“ä½œ\n\n## éšæœºè®¿é—®ç´¢å¼•\n\n![](statistic/asynccode-672.png)\n\né‚£äº›éœ€è¦ä¸€ä¸ªç´¢å¼•å€¼å‚æ•°çš„æ–¹æ³•ï¼ˆçš„å…¶ä¸­ï¼‰ä¹‹ä¸€æ¥è®¿é—®æ•°æ®æ—¢ä¸ä¼šæ”¹å˜readerIndex ä¹Ÿä¸ä¼šæ”¹å˜ writerIndexã€‚\n\n  \n\n## é¡ºåºè®¿é—®ç´¢å¼•\n\nè™½ç„¶ ByteBuf åŒæ—¶å…·æœ‰è¯»ç´¢å¼•å’Œå†™ç´¢å¼•ï¼Œ\n\n![](statistic/asynccode-677.png)\n\n## å¯ä¸¢å¼ƒå­—èŠ‚\n\nè®°ä¸ºå¯ä¸¢å¼ƒå­—èŠ‚çš„åˆ†æ®µåŒ…å«äº†å·²ç»è¢«è¯»è¿‡çš„å­—èŠ‚ã€‚é€šè¿‡è°ƒç”¨ discardReadBytes()æ–¹æ³•ï¼Œå¯ä»¥ä¸¢å¼ƒå®ƒä»¬å¹¶å›æ”¶ç©ºé—´\n\n  \n\n## å¯è¯»å­—èŠ‚\n\nByteBuf çš„å¯è¯»å­—èŠ‚åˆ†æ®µå­˜å‚¨äº†å®é™…æ•°æ®ã€‚æ–°åˆ†é…çš„ã€åŒ…è£…çš„æˆ–è€…å¤åˆ¶çš„ç¼“å†²åŒºçš„é»˜è®¤çš„\n\nreaderIndex å€¼ä¸º 0ã€‚ä»»ä½•åç§°ä»¥ read æˆ–è€… skip å¼€å¤´çš„æ“ä½œéƒ½å°†æ£€ç´¢æˆ–è€…è·³è¿‡ä½äºå½“å‰\n\nreaderIndex çš„æ•°æ®ï¼Œå¹¶ä¸”å°†å®ƒå¢åŠ å·²è¯»å­—èŠ‚æ•°ã€‚\n\n  \n\n## å¯å†™å­—èŠ‚\n\nå¯å†™å­—èŠ‚åˆ†æ®µæ˜¯æŒ‡ä¸€ä¸ªæ‹¥æœ‰æœªå®šä¹‰å†…å®¹çš„ã€å†™å…¥å°±ç»ªçš„å†…å­˜åŒºåŸŸã€‚æ–°åˆ†é…çš„ç¼“å†²åŒºçš„ writerIndex çš„é»˜è®¤å€¼ä¸º 0ã€‚ä»»ä½•åç§°ä»¥ write å¼€å¤´çš„æ“ä½œéƒ½å°†ä»å½“å‰çš„ writerIndex å¤„ å¼€å§‹å†™æ•°æ®ï¼Œå¹¶å°†å®ƒå¢åŠ å·²ç»å†™å…¥çš„å­—èŠ‚æ•°ã€‚å¦‚æœå†™æ“ä½œçš„ç›®æ ‡ä¹Ÿæ˜¯ ByteBufï¼Œå¹¶ä¸”æ²¡æœ‰æŒ‡å®šæºç´¢å¼•çš„å€¼ï¼Œåˆ™æºç¼“å†²åŒºçš„ readerIndex ä¹ŸåŒæ ·ä¼šè¢«å¢åŠ ç›¸åŒçš„å¤§å°ã€‚è¿™ä¸ªè°ƒç”¨å¦‚ä¸‹æ‰€ç¤ºï¼š\n\nwriteBytes(ByteBuf dest);\n\n  \n\n## è¯»å†™æ“ä½œ\n\næ­£å¦‚æˆ‘ä»¬æ‰€æåˆ°è¿‡çš„ï¼Œæœ‰ä¸¤ç§ç±»åˆ«çš„è¯»/å†™æ“ä½œï¼š\n\nï® get()å’Œ set()æ“ä½œï¼Œä»ç»™å®šçš„ç´¢å¼•å¼€å§‹ï¼Œå¹¶ä¸”ä¿æŒç´¢å¼•ä¸å˜ï¼›\n\nï® read()å’Œ write()æ“ä½œï¼Œä»ç»™å®šçš„ç´¢å¼•å¼€å§‹ï¼Œå¹¶ä¸”ä¼šæ ¹æ®å·²ç»è®¿é—®è¿‡çš„å­—èŠ‚æ•°å¯¹ç´¢\n\nå¼•è¿›è¡Œè°ƒæ•´\n\n![](statistic/asynccode-685.png)\n\n![](statistic/asynccode-675.png)\n\n![](statistic/asynccode-680.png)\n\n![](statistic/asynccode-686.png)\n\n## å…¶ä»–æ“ä½œ\n\n![](statistic/asynccode-674.png)\n\n![](statistic/asynccode-681.png)\n\n  \n\n# ByteBufHolder\n\n- é™¤äº†å®é™…çš„æ•°æ®è´Ÿè½½ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦**å­˜å‚¨å„ç§å±æ€§å€¼**ã€‚ ä¸ºäº†å¤„ç†è¿™ç§å¸¸è§çš„ç”¨ä¾‹ï¼ŒNetty æä¾›äº† ByteBufHolder\n    \n- ByteBufHolder ä¹Ÿä¸º Netty çš„ é«˜çº§ç‰¹æ€§æä¾›äº†æ”¯æŒï¼Œå¦‚ç¼“å†²åŒºæ± åŒ–ï¼Œå…¶ä¸­å¯ä»¥ä»æ± ä¸­å€Ÿç”¨ ByteBufï¼Œå¹¶ä¸”åœ¨éœ€è¦æ—¶è‡ªåŠ¨é‡Šæ”¾\n    \n- ByteBufHolder åªæœ‰å‡ ç§ç”¨äºè®¿é—®åº•å±‚æ•°æ®å’Œå¼•ç”¨è®¡æ•°çš„æ–¹æ³•\n    \n\n![](statistic/asynccode-676.png)\n\n  \n\n# ByteBufåˆ†é…\n\n## æŒ‰éœ€åˆ†é…ByteBufAllocator\n\nï¼ŒNetty é€šè¿‡ interface ByteBufAllocator å®ç°äº† ï¼ˆByteBuf çš„ï¼‰**æ± åŒ–**ï¼Œå®ƒå¯ä»¥ç”¨æ¥åˆ†é…æˆ‘ä»¬æ‰€æè¿°è¿‡çš„ä»»æ„ç±»å‹çš„ ByteBuf å®ä¾‹\n\n![](statistic/asynccode-682.png)\n\nå¯ä»¥é€šè¿‡ Channelï¼ˆæ¯ä¸ªéƒ½å¯ä»¥æœ‰ä¸€ä¸ªä¸åŒçš„ ByteBufAllocator å®ä¾‹ï¼‰æˆ–è€…ç»‘å®šåˆ° ChannelHandler çš„ ChannelHandlerContext è·å–ä¸€ä¸ªåˆ° ByteBufAllocator çš„å¼•ç”¨ã€‚\n\n![](statistic/asynccode-686.png)\n\nNettyæä¾›äº†ä¸¤ç§ByteBufAllocatorçš„å®ç°ï¼šPooledByteBufAllocatorå’ŒUnpooledByteBufAllocatorã€‚\n\n- PooledByteBufAllocatorï¼Œæ± åŒ–äº†ByteBufçš„å®ä¾‹ä»¥æé«˜æ€§èƒ½å¹¶æœ€å¤§é™åº¦åœ°å‡å°‘å†…å­˜ç¢ç‰‡\n    \n- UnpooledByteBufAllocatorï¼Œéæ± åŒ–ByteBufå®ä¾‹ï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡å®ƒè¢«è°ƒç”¨æ—¶éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹\n    \n\n**Nettyé»˜è®¤ä½¿ç”¨äº†PooledByteBufAllocator**ï¼Œä½†è¿™å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡ChannelConfig APIæˆ–è€…åœ¨å¼•å¯¼ä½ çš„åº”ç”¨ç¨‹åºæ—¶æŒ‡å®šä¸€ä¸ªä¸åŒçš„åˆ†é…å™¨æ¥æ›´æ”¹\n\n  \n\n## Unpooled ç¼“å†²åŒº\n\nä½ æœªèƒ½è·å–ä¸€ä¸ªåˆ° ByteBufAllocator çš„å¼•ç”¨ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼ŒNetty æä¾›äº†ä¸€ä¸ªç®€å•çš„ç§°ä¸º Unpooled çš„å·¥å…·ç±»ï¼Œå®ƒæä¾›äº†é™æ€çš„è¾…åŠ©æ–¹æ³•æ¥åˆ›å»ºæœªæ± åŒ–çš„ ByteBuf å®ä¾‹ã€‚\n\n![](statistic/asynccode-678.png)\n\n## ByteBufUtil\n\nByteBufUtil æä¾›äº†ç”¨äºæ“ä½œ ByteBuf çš„é™æ€çš„è¾…åŠ©æ–¹æ³•ã€‚å› ä¸ºè¿™ä¸ª API æ˜¯é€šç”¨çš„ï¼Œå¹¶\n\nä¸”å’Œæ± åŒ–æ— å…³ï¼Œæ‰€ä»¥è¿™äº›æ–¹æ³•å·²ç„¶åœ¨åˆ†é…ç±»çš„å¤–éƒ¨å®ç°\n\n  \n\n# å¼•ç”¨è®¡æ•°\n\nNetty åœ¨ç¬¬ 4 ç‰ˆä¸­ä¸º ByteBuf å’Œ ByteBufHolder å¼•å…¥äº†å¼•ç”¨è®¡æ•°æŠ€æœ¯ï¼Œå®ƒä»¬éƒ½å®ç°äº† interface ReferenceCountedã€‚\n\nå®ƒä¸»è¦æ¶‰åŠè·Ÿè¸ªåˆ°æŸä¸ªç‰¹å®šå¯¹è±¡çš„æ´»åŠ¨å¼•ç”¨çš„æ•°é‡ã€‚ä¸€ä¸ª ReferenceCounted å®ç°çš„å®ä¾‹å°†é€šå¸¸ä»¥æ´»åŠ¨çš„å¼•ç”¨è®¡æ•°ä¸º 1 ä½œä¸ºå¼€å§‹ã€‚\n\nåªè¦å¼•ç”¨è®¡æ•°å¤§äº 0ï¼Œå°±èƒ½ä¿è¯å¯¹è±¡ä¸ä¼šè¢«é‡Šæ”¾ã€‚å½“æ´»åŠ¨å¼•ç”¨çš„æ•°é‡å‡å°‘åˆ° 0 æ—¶ï¼Œè¯¥å®ä¾‹å°±ä¼šè¢«é‡Šæ”¾\n\nå¼•ç”¨è®¡æ•°å¯¹äºæ± åŒ–å®ç°ï¼ˆå¦‚ PooledByteBufAllocatorï¼‰æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ï¼Œå®ƒé™ä½äº†å†…å­˜åˆ†é…çš„å¼€é”€ã€‚","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/netty/ChannelHandlerChannelPipelineChannelContext":{"title":"ChannelHandlerã€ChannelPipelineã€ChannelContext","content":"å½“æˆ‘ä»¬åœ¨æœ¬ç« ä¸­æ¢è®¨ Netty çš„æ•°æ®æµä»¥åŠå¤„ç†ç»„ä»¶\n\nåœ¨ ChannelPipeline ä¸­å°† ChannelHandler é“¾æ¥åœ¨ä¸€èµ·ä»¥ç»„ç»‡å¤„ç†é€»è¾‘ã€‚æˆ‘ä»¬å°†ä¼šç ”ç©¶æ¶‰åŠè¿™äº›ç±»çš„å„ç§ç”¨ä¾‹ï¼Œä»¥åŠä¸€ä¸ªé‡è¦çš„å…³ç³»â€”ChannelHandlerContext\n\n  \n\n# ChannelHandler\n\n  \n\n## Channel çš„ç”Ÿå‘½å‘¨æœŸ\n\n![](statistic/asynccode-731.png)\n\n![](statistic/asynccode-731.png)\n\n![](statistic/asynccode-689.png)\n\n  \n\nChannelHandlerçš„ç”Ÿå‘½å‘¨æœŸ\n\n![](statistic/asynccode-731.png)\n\n  \n\nNettyå®šä¹‰äº†ä¸¤ä¸ªé‡è¦çš„ChannelHandler\n\n- ï® ChannelInboundHandlerâ€”â€”å¤„ç†å…¥ç«™æ•°æ®ä»¥åŠå„ç§çŠ¶æ€å˜åŒ–ï¼›\n    \n- ï® ChannelOutboundHandlerâ€”â€”å¤„ç†å‡ºç«™æ•°æ®å¹¶ä¸”å…è®¸æ‹¦æˆªæ‰€æœ‰çš„æ“ä½œã€‚\n    \n\n  \n\n## ChannelInBoundHandleræ¥å£\n\nChannelInBoundHandlerçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å°†ä¼šåœ¨æ•°æ®è¢«æ¥æ”¶æ—¶æˆ–è€…ä¸å…¶å¯¹åº”çš„ Channel çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶è¢«è°ƒç”¨ã€‚\n\n![](statistic/asynccode-721.png)\n\nå½“æŸä¸ª ChannelInboundHandler çš„å®ç°é‡å†™ channelRead()æ–¹æ³•æ—¶ï¼Œå®ƒå°†è´Ÿè´£æ˜¾å¼åœ°é‡Šæ”¾ä¸æ± åŒ–çš„ ByteBuf å®ä¾‹ç›¸å…³çš„å†…å­˜ã€‚Netty ä¸ºæ­¤æä¾›äº†ä¸€ä¸ªå®ç”¨æ–¹æ³• ReferenceCountUtil.release()\n\n![](statistic/asynccode-711.png)\n\nä¸€ä¸ªæ›´åŠ ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ SimpleChannelInboundHandler\n\n![](statistic/asynccode-722.png)\n\nç”±äº SimpleChannelInboundHandler ä¼šè‡ªåŠ¨é‡Šæ”¾èµ„æºï¼Œæ‰€ä»¥ä½ ä¸åº”è¯¥å­˜å‚¨æŒ‡å‘ä»»ä½•æ¶ˆ æ¯çš„å¼•ç”¨ä¾›å°†æ¥ä½¿ç”¨\n\n## ChannelOutboundHandler\n\nå‡ºç«™æ“ä½œå’Œæ•°æ®å°†ç”± ChannelOutboundHandler å¤„ç†ã€‚å®ƒçš„æ–¹æ³•å°†è¢« Channelã€ChannelPipeline ä»¥åŠ ChannelHandlerContext è°ƒç”¨ã€‚\n\nChannelOutboundHandler çš„ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½**æ˜¯å¯ä»¥æŒ‰éœ€æ¨è¿Ÿæ“ä½œæˆ–è€…äº‹ä»¶**ï¼Œè¿™ä½¿å¾—å¯ä»¥é€šè¿‡ä¸€äº›å¤æ‚çš„æ–¹æ³•æ¥å¤„ç†è¯·æ±‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåˆ°è¿œç¨‹èŠ‚ç‚¹çš„å†™å…¥è¢«æš‚åœäº†ï¼Œé‚£ä¹ˆä½ å¯ä»¥æ¨è¿Ÿå†²åˆ·æ“ä½œå¹¶åœ¨ç¨åç»§ç»­\n\n![](statistic/asynccode-714.png)\n\n  \n\n\u003e **ChannelPromise**ä¸**ChannelFuture** ChannelOutboundHandlerä¸­çš„å¤§éƒ¨åˆ†æ–¹æ³•éƒ½éœ€è¦ä¸€ä¸ª\n\u003e \n\u003e ChannelPromiseå‚æ•°ï¼Œä»¥ä¾¿åœ¨æ“ä½œå®Œæˆæ—¶å¾—åˆ°é€šçŸ¥ã€‚ChannelPromiseæ˜¯ChannelFutureçš„ä¸€ä¸ª\n\u003e \n\u003e å­ç±»ï¼Œå…¶å®šä¹‰äº†ä¸€äº›å¯å†™çš„æ–¹æ³•ï¼Œå¦‚setSuccess()å’ŒsetFailure()ï¼Œä»è€Œä½¿ChannelFutureä¸\n\u003e \n\u003e å¯å˜\n\n  \n\n## é€‚é…å™¨\n\n![](statistic/asynccode-723.png)\n\n## èµ„æºç®¡ç†\n\n- æ¯å½“é€šè¿‡è°ƒç”¨ ChannelInboundHandler.channelRead()æˆ–è€… ChannelOutboundHandler.write()æ–¹æ³•æ¥å¤„ç†æ•°æ®æ—¶ï¼Œä½ éƒ½éœ€è¦ç¡®ä¿æ²¡æœ‰ä»»ä½•çš„èµ„æºæ³„æ¼ã€‚\n    \n- Netty ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥å¤„ç†æ± åŒ–çš„ ByteBufã€‚æ‰€ä»¥åœ¨å®Œå…¨ä½¿ç”¨å®ŒæŸä¸ªByteBuf åï¼Œ**è°ƒæ•´å…¶å¼•ç”¨è®¡æ•°æ˜¯å¾ˆé‡è¦çš„**\n    \n\n  \n\nNettyæä¾›äº†class ResourceLeakDetectorâ‘ ï¼Œå®ƒå°†å¯¹ä½ åº”ç”¨ç¨‹åºçš„ç¼“å†²åŒºåˆ†é…åšå¤§çº¦ 1%çš„é‡‡æ ·æ¥æ£€æµ‹å†…å­˜æ³„éœ²\n\nNettyçš„æ³„éœ²çº§åˆ«\n\n![](statistic/asynccode-713.png)\n\næ¶ˆè´¹å¹¶é‡Šæ”¾å…¥ç«™æ¶ˆæ¯\n\n![](statistic/asynccode-737.png)\n\nä¸¢å¼ƒå¹¶é‡Šæ”¾å‡ºç«™æ¶ˆæ¯\n\n![](statistic/asynccode-731.png)\n\n  \n\n# ChannelPipeline\n\n\u003e - ChannelPipeline ä¿å­˜äº†ä¸ Channel ç›¸å…³è”çš„ ChannelHandlerï¼›\n\u003e     \n\u003e - ChannelPipeline å¯ä»¥æ ¹æ®éœ€è¦ï¼Œé€šè¿‡æ·»åŠ æˆ–è€…åˆ é™¤ ChannelHandler æ¥åŠ¨æ€åœ°ä¿®æ”¹ï¼›\n\u003e     \n\u003e - ChannelPipeline æœ‰ç€ä¸°å¯Œçš„ API ç”¨ä»¥è¢«è°ƒç”¨ï¼Œä»¥å“åº”å…¥ç«™å’Œå‡ºç«™äº‹ä»¶ã€‚\n\u003e     \n\n  \n\n- æ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„ Channel éƒ½å°†ä¼šè¢«åˆ†é…ä¸€ä¸ªæ–°çš„ ChannelPipelineã€‚è¿™é¡¹å…³è”æ˜¯æ°¸ä¹…æ€§çš„ï¼›\n    \n- Channel æ—¢ä¸èƒ½é™„åŠ å¦å¤–ä¸€ä¸ª ChannelPipelineï¼Œä¹Ÿä¸èƒ½åˆ†ç¦»å…¶å½“å‰çš„\n    \n- æ ¹æ®äº‹ä»¶çš„èµ·æºï¼Œäº‹ä»¶å°†ä¼šè¢« ChannelInboundHandler æˆ–è€… ChannelOutboundHandlerå¤„ç†ï¼Œéšåï¼Œé€šè¿‡è°ƒç”¨ ChannelHandlerContext å®ç°ï¼Œå®ƒå°†è¢«è½¬å‘ç»™åŒä¸€è¶…ç±»å‹çš„ä¸‹ä¸€ä¸ª ChannelHandler\n    \n\n  \n\n\u003e ChannelHandlerContextä½¿å¾—ChannelHandlerèƒ½å¤Ÿå’Œå®ƒçš„ChannelPipelineä»¥åŠå…¶ä»–çš„ChannelHandler äº¤äº’ï¼Œ\n\u003e \n\u003e - ChannelHandler å¯ä»¥é€šçŸ¥å…¶æ‰€å±çš„ ChannelPipeline ä¸­çš„ä¸‹ä¸€ ä¸ªChannelHandlerï¼Œ\n\u003e     \n\u003e - ç”šè‡³å¯ä»¥åŠ¨æ€ä¿®æ”¹å®ƒæ‰€å±çš„ChannelPipeline\n\u003e     \n\n  \n\näº†ä¸€ä¸ªå…¸å‹çš„åŒæ—¶å…·æœ‰å…¥ç«™å’Œå‡ºç«™ ChannelHandler çš„ ChannelPipeline çš„å¸ƒ å±€ï¼Œå¹¶ä¸”å°è¯äº†æˆ‘ä»¬ä¹‹å‰çš„å…³äº ChannelPipeline ä¸»è¦ç”±ä¸€ç³»åˆ—çš„ ChannelHandler æ‰€ç»„æˆçš„è¯´æ³•ã€‚\n\n  \n\n![](statistic/asynccode-718.png)\n\n- ChannelPipeline è¿˜æä¾›äº†é€šè¿‡ ChannelPipeline æœ¬èº«ä¼ æ’­äº‹ä»¶çš„æ–¹æ³•ã€‚\n    \n    - å¦‚æœä¸€ä¸ªå…¥ç«™äº‹ä»¶è¢«è§¦å‘ï¼Œå®ƒå°†è¢«ä» ChannelPipeline çš„å¤´éƒ¨å¼€å§‹ä¸€ç›´è¢«ä¼ æ’­åˆ° Channel Pipeline çš„å°¾ç«¯\n        \n    - ä¸€ä¸ªå‡ºç«™ I/O äº‹ä»¶å°†ä» ChannelPipeline çš„æœ€å³è¾¹å¼€å§‹ï¼Œç„¶åå‘å·¦ä¼ æ’­ã€‚\n        \n- åœ¨ ChannelPipeline ä¼ æ’­äº‹ä»¶æ—¶ï¼Œå®ƒä¼šæµ‹è¯• ChannelPipeline ä¸­çš„ä¸‹ä¸€ä¸ª ChannelHandler çš„ç±»å‹æ˜¯å¦å’Œäº‹ä»¶çš„è¿åŠ¨æ–¹å‘ç›¸åŒ¹é…ã€‚\n    \n    - å¦‚æœä¸åŒ¹é…ï¼ŒChannelPipeline å°†è·³è¿‡è¯¥ChannelHandler å¹¶å‰è¿›åˆ°ä¸‹ä¸€ä¸ªï¼Œç›´åˆ°å®ƒæ‰¾åˆ°å’Œè¯¥äº‹ä»¶æ‰€æœŸæœ›çš„æ–¹å‘ç›¸åŒ¹é…çš„ä¸ºæ­¢ã€‚\n        \n\n  \n\n## ä¿®æ”¹ChannelPipeline\n\nChannelHandler å¯ä»¥é€šè¿‡æ·»åŠ ã€åˆ é™¤æˆ–è€…æ›¿æ¢å…¶ä»–çš„ ChannelHandler æ¥å®æ—¶åœ°ä¿®æ”¹ChannelPipeline çš„å¸ƒå±€ã€‚\n\n![](statistic/asynccode-697.png)\n\n![](statistic/asynccode-749.png)\n\n  \n\n## ChannelHandler çš„é˜»å¡å’Œæ‰§è¡Œ\n\n- é€šå¸¸ ChannelPipeline ä¸­çš„æ¯ä¸€ä¸ª ChannelHandler éƒ½æ˜¯é€šè¿‡å®ƒçš„ EventLoopï¼ˆI/O çº¿ç¨‹ï¼‰æ¥å¤„ ç†ä¼ é€’ç»™å®ƒçš„äº‹ä»¶çš„ã€‚æ‰€ä»¥**è‡³å…³é‡è¦çš„æ˜¯ä¸è¦é˜»å¡è¿™ä¸ªçº¿ç¨‹**ï¼Œå› ä¸ºè¿™ä¼šå¯¹æ•´ä½“çš„ I/O å¤„ç†äº§ç”Ÿè´Ÿé¢çš„å½±å“ã€‚\n    \n- ä½†æœ‰æ—¶å¯èƒ½éœ€è¦ä¸é‚£äº›ä½¿ç”¨é˜»å¡ API çš„é—ç•™ä»£ç è¿›è¡Œäº¤äº’ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼ŒChannelPipeline æœ‰ä¸€äº›æ¥å—ä¸€ä¸ª EventExecutorGroup çš„ add()æ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªäº‹ä»¶è¢«ä¼ é€’ç»™ä¸€ä¸ªè‡ªå®šä¹‰çš„ EventExecutorGroupï¼Œå®ƒå°†è¢«åŒ…å«åœ¨è¿™ä¸ª EventExecutorGroup ä¸­çš„æŸä¸ª **EventExecutor** æ‰€å¤„ç†ï¼Œ**ä»è€Œè¢«ä»è¯¥ Channel æœ¬èº«çš„ EventLoop ä¸­ç§»é™¤**ã€‚å¯¹äºè¿™ç§ç”¨ä¾‹ï¼ŒNetty æä¾›äº†ä¸€ä¸ªå« DefaultEventExecutorGroup çš„é»˜è®¤å®ç°ã€‚\n    \n\n## å…¶ä»–è·å–ChannelHandlerçš„æ–¹æ³•\n\nè¿˜æœ‰åˆ«çš„é€šè¿‡ç±»å‹æˆ–è€…åç§°æ¥è®¿é—® ChannelHandler çš„æ–¹æ³•\n\n![](statistic/asynccode-731.png)\n\n## è§¦å‘äº‹ä»¶\n\nå…¥ç«™æ“ä½œï¼Œç”¨äºé€šçŸ¥ ChannelInboundHandler åœ¨ ChannelPipeline ä¸­æ‰€å‘ç”Ÿçš„äº‹ä»¶\n\n![](statistic/asynccode-712.png)\n\nChannelPipeline API çš„å‡ºç«™æ“ä½œã€‚\n\n![](statistic/asynccode-719.png)\n\n  \n\n# ChannelHandlerContext\n\n- ChannelHandlerContext ä»£è¡¨äº† ChannelHandler å’Œ ChannelPipeline ä¹‹é—´çš„å…³è”ï¼Œæ¯å½“æœ‰ ChannelHandler æ·»åŠ åˆ° ChannelPipeline ä¸­æ—¶ï¼Œéƒ½ä¼šåˆ›å»º ChannelHandlerContext\n    \n- ChannelHandlerContext çš„ä¸»è¦åŠŸèƒ½æ˜¯ç®¡ç†å®ƒæ‰€å…³è”çš„ ChannelHandler å’Œåœ¨ åŒä¸€ä¸ª ChannelPipeline ä¸­çš„å…¶ä»– ChannelHandler ä¹‹é—´çš„äº¤äº’\n    \n\n  \n\nChannelHandlerContext æœ‰å¾ˆå¤šçš„æ–¹æ³•ï¼Œå…¶ä¸­ä¸€äº›æ–¹æ³•ä¹Ÿå­˜åœ¨äº Channel å’Œ ChannelPipeline æœ¬èº«ä¸Šï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹é‡è¦çš„ä¸åŒã€‚\n\n- å¦‚æœè°ƒç”¨ Channel æˆ–è€… ChannelPipeline ä¸Šçš„è¿™äº›æ–¹æ³•ï¼Œå®ƒä»¬å°†æ²¿ç€æ•´ä¸ª ChannelPipeline è¿›è¡Œä¼ æ’­\n    \n- è€Œè°ƒç”¨ä½äº ChannelHandlerContext ä¸Šçš„ç›¸åŒæ–¹æ³•ï¼Œåˆ™å°†ä»å½“å‰æ‰€å…³è”çš„ ChannelHandler å¼€å§‹ï¼Œå¹¶ä¸”**åªä¼šä¼ æ’­ç»™ä½äºè¯¥ ChannelPipeline ä¸­çš„ä¸‹ä¸€ä¸ªèƒ½å¤Ÿå¤„ç†è¯¥äº‹ä»¶çš„ ChannelHandler**\n    \n\n![](statistic/asynccode-698.png)\n\n![](statistic/asynccode-731.png)\n\nå½“ä½¿ç”¨ ChannelHandlerContext çš„ API çš„æ—¶å€™ï¼Œè¯·ç‰¢è®°ä»¥ä¸‹ä¸¤ç‚¹ï¼š\n\n- ï® ChannelHandlerContext å’Œ ChannelHandler ä¹‹é—´çš„å…³è”ï¼ˆç»‘å®šï¼‰æ˜¯æ°¸è¿œä¸ä¼šæ”¹å˜çš„ï¼Œæ‰€ä»¥ç¼“å­˜å¯¹å®ƒçš„å¼•ç”¨æ˜¯å®‰å…¨çš„ï¼›\n    \n- ï® å¦‚åŒæˆ‘ä»¬åœ¨æœ¬èŠ‚å¼€å¤´æ‰€è§£é‡Šçš„ä¸€æ ·ï¼Œç›¸å¯¹äºå…¶ä»–ç±»çš„åŒåæ–¹æ³•ï¼ŒChannelHandleContext çš„æ–¹æ³•å°†äº§ç”Ÿæ›´çŸ­çš„äº‹ä»¶æµï¼Œåº”è¯¥å°½å¯èƒ½åœ°åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥è·å¾—æœ€å¤§çš„æ€§èƒ½\n    \n\n## ä½¿ç”¨\n\n![](statistic/asynccode-730.png)\n\n  \n\n### **ChannelHandlerContext** è®¿é—® **Channel**\n\n![](statistic/asynccode-741.png)\n\n### é€šè¿‡ **ChannelHandlerContext** è®¿é—® **ChannelPipeline**\n\n![](statistic/asynccode-715.png)\n\n- è™½ç„¶è¢«è°ƒç”¨çš„ Channel æˆ– ChannelPipeline ä¸Šçš„ write()æ–¹æ³•å°†**ä¸€ç›´ä¼ æ’­äº‹ä»¶é€šè¿‡æ•´ä¸ª ChannelPipeline**ï¼Œ\n    \n- ä½†æ˜¯åœ¨ ChannelHandler çš„çº§åˆ«ä¸Šï¼Œäº‹ä»¶ä»ä¸€ä¸ª ChannelHandler åˆ°ä¸‹ä¸€ä¸ª ChannelHandler çš„ç§»åŠ¨æ˜¯ç”±ChannelHandlerContext ä¸Šçš„è°ƒç”¨å®Œæˆçš„\n    \n\n![](statistic/asynccode-716.png)\n\n### è°ƒç”¨ **ChannelHandlerContext** çš„ **write()**æ–¹æ³•\n\n![](statistic/asynccode-731.png)\n\næ¶ˆæ¯å°†ä»ä¸‹ä¸€ä¸ª ChannelHandler å¼€å§‹æµç» ChannelPipelineï¼Œç»•è¿‡äº†æ‰€æœ‰å‰é¢çš„ ChannelHandler\n\n![](statistic/asynccode-736.png)\n\n### å¯å…±äº«çš„ChannelHandler\n\n![](statistic/asynccode-738.png)\n\n  \n\n# å¼‚å¸¸å¤„ç†\n\n## å¤„ç†å…¥ç«™ç‚¹å¼‚å¸¸\n\n- å¦‚æœåœ¨å¤„ç†å…¥ç«™äº‹ä»¶çš„è¿‡ç¨‹ä¸­æœ‰å¼‚å¸¸è¢«æŠ›å‡ºï¼Œé‚£ä¹ˆå®ƒå°†ä»å®ƒåœ¨ ChannelInboundHandleré‡Œè¢«è§¦å‘çš„é‚£ä¸€ç‚¹å¼€å§‹æµç» ChannelPipeline\n    \n- è¦æƒ³å¤„ç†è¿™ç§ç±»å‹çš„å…¥ç«™å¼‚å¸¸ï¼Œä½ éœ€è¦åœ¨ä½ çš„ ChannelInboundHandler å®ç°ä¸­é‡å†™ä¸‹é¢çš„æ–¹æ³•\n    \n\n![](statistic/asynccode-742.png)\n\n- ChannelHandler.exceptionCaught()çš„é»˜è®¤å®ç°æ˜¯ç®€å•åœ°å°†å½“å‰å¼‚å¸¸è½¬å‘ç»™ ChannelPipeline ä¸­çš„ä¸‹ä¸€ä¸ª ChannelHandlerï¼›\n    \n- å¦‚æœå¼‚å¸¸åˆ°è¾¾äº† ChannelPipeline çš„å°¾ç«¯ï¼Œå®ƒå°†ä¼šè¢«è®°å½•ä¸ºæœªè¢«å¤„ç†ï¼›\n    \n- è¦æƒ³å®šä¹‰è‡ªå®šä¹‰çš„å¤„ç†é€»è¾‘ï¼Œä½ éœ€è¦é‡å†™ exceptionCaught()æ–¹æ³•ã€‚ç„¶åä½ éœ€è¦å†³å®šæ˜¯å¦éœ€è¦å°†è¯¥å¼‚å¸¸ä¼ æ’­å‡ºå»ã€‚\n    \n\n  \n\n## å¤„ç†å‡ºç«™å¼‚å¸¸\n\nç”¨äºå¤„ç†å‡ºç«™æ“ä½œä¸­çš„æ­£å¸¸å®Œæˆä»¥åŠå¼‚å¸¸çš„é€‰é¡¹ï¼Œéƒ½åŸºäºä»¥ä¸‹çš„é€šçŸ¥æœºåˆ¶ã€‚\n\n- æ¯ä¸ªå‡ºç«™æ“ä½œéƒ½å°†è¿”å›ä¸€ä¸ª ChannelFutureã€‚æ³¨å†Œåˆ° ChannelFuture çš„ ChannelFutureListener å°†åœ¨æ“ä½œå®Œæˆæ—¶è¢«é€šçŸ¥è¯¥æ“ä½œæ˜¯æˆåŠŸäº†è¿˜æ˜¯å‡ºé”™äº†\n    \n\n![](statistic/asynccode-720.png)\n\n- å‡ ä¹æ‰€æœ‰çš„ ChannelOutboundHandler ä¸Šçš„æ–¹æ³•éƒ½ä¼šä¼ å…¥ä¸€ä¸ª ChannelPromise çš„å®ä¾‹ã€‚ä½œä¸º ChannelFuture çš„å­ç±»ï¼ŒChannelPromise ä¹Ÿå¯ä»¥è¢«åˆ†é…ç”¨äºå¼‚æ­¥é€šçŸ¥çš„ç›‘å¬å™¨ã€‚ä½†æ˜¯ï¼ŒChannelPromise è¿˜å…·æœ‰æä¾›ç«‹å³é€šçŸ¥çš„å¯å†™æ–¹æ³•ï¼š\n    \n    - ChannelPromise setSuccess();\n        \n    - ChannelPromise setFailure(Throwable cause)\n        \n\n![](statistic/asynccode-690.png)","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/netty/EventLoop-%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B":{"title":"EventLoop å’Œçº¿ç¨‹æ¨¡å‹","content":"# å¸¸è§çš„çº¿ç¨‹æ¨¡å‹\n\nåŸºæœ¬çš„çº¿ç¨‹æ± åŒ–æ¨¡å¼\n\n- ä»æ± çš„ç©ºé—²çº¿ç¨‹åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ª Threadï¼Œå¹¶ä¸”æŒ‡æ´¾å®ƒå»è¿è¡Œä¸€ä¸ªå·²æäº¤çš„ä»»åŠ¡ï¼ˆä¸€ä¸ª Runnable çš„å®ç°ï¼‰ï¼›\n    \n- å½“ä»»åŠ¡å®Œæˆæ—¶ï¼Œå°†è¯¥ Thread è¿”å›ç»™è¯¥åˆ—è¡¨ï¼Œä½¿å…¶å¯è¢«é‡ç”¨\n    \n\n![](statistic/asynccode-717.png)\n\nè™½ç„¶æ± åŒ–å’Œé‡ç”¨çº¿ç¨‹ç›¸å¯¹äºç®€å•åœ°ä¸ºæ¯ä¸ªä»»åŠ¡éƒ½åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ˜¯ä¸€ç§è¿›æ­¥ï¼Œä½†æ˜¯å®ƒå¹¶ä¸èƒ½æ¶ˆé™¤ç”±ä¸Šä¸‹æ–‡åˆ‡æ¢æ‰€å¸¦æ¥çš„å¼€é”€\n\n# EventLoop\n\nè¿è¡Œä»»åŠ¡æ¥**å¤„ç†åœ¨è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸå†…å‘ç”Ÿçš„äº‹ä»¶æ˜¯ä»»ä½•ç½‘ç»œæ¡†æ¶çš„åŸºæœ¬åŠŸèƒ½**ã€‚ä¸ä¹‹ç›¸åº”çš„ç¼–ç¨‹ä¸Šçš„æ„é€ é€šå¸¸è¢«ç§°ä¸º**äº‹ä»¶å¾ªç¯**â€”ä¸€ä¸ª Netty ä½¿ç”¨äº† interface io.netty.channel.EventLoop æ¥é€‚é…çš„æœ¯è¯­ã€‚\n\n  \n\nNetty çš„ EventLoop æ˜¯ååŒè®¾è®¡çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒé‡‡ç”¨äº†ä¸¤ä¸ªåŸºæœ¬çš„ APIï¼šå¹¶å‘å’Œç½‘ç»œç¼–ç¨‹ã€‚\n\n- é¦–å…ˆï¼Œio.netty.util.concurrent åŒ…æ„å»ºåœ¨ JDK çš„ java.util.concurrent åŒ…ä¸Šï¼Œç”¨æ¥æä¾›çº¿ç¨‹æ‰§è¡Œå™¨ã€‚\n    \n- å…¶æ¬¡ï¼Œio.netty.channel åŒ…ä¸­çš„ç±»ï¼Œä¸ºäº†ä¸ Channel çš„äº‹ä»¶è¿›è¡Œäº¤äº’ï¼Œæ‰©å±•äº†è¿™äº›æ¥å£/ç±»\n    \n\n![](statistic/asynccode-691.png)\n\nçº¿ç¨‹çš„å…³ç³»\n\n- åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œä¸€ä¸ª EventLoop å°†ç”±ä¸€ä¸ªæ°¸è¿œéƒ½ä¸ä¼šæ”¹å˜çš„ Thread é©±åŠ¨\n    \n- åŒæ—¶ä»»åŠ¡ ï¼ˆRunnable æˆ–è€… Callableï¼‰å¯ä»¥ç›´æ¥æäº¤ç»™ EventLoop å®ç°ï¼Œä»¥ç«‹å³æ‰§è¡Œæˆ–è€…è°ƒåº¦æ‰§è¡Œã€‚\n    \n- æ ¹æ®é…ç½®å’Œå¯ç”¨æ ¸å¿ƒçš„ä¸åŒï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤šä¸ª EventLoop å®ä¾‹ç”¨ä»¥ä¼˜åŒ–èµ„æºçš„ä½¿ç”¨ï¼Œ\n    \n- å¹¶ä¸”å•ä¸ª EventLoop å¯èƒ½ä¼šè¢«æŒ‡æ´¾ç”¨äºæœåŠ¡å¤šä¸ª Channel\n    \n- nettyçš„EventLoopåœ¨ç»§æ‰¿äº†ScheduledExecutorServiceçš„åŒæ—¶ï¼Œåªå®š ä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼Œparent(),ç”¨äºè¿”å›åˆ°å½“å‰EventLoopGroupçš„å¼•ç”¨ã€‚\n    \n\n```Go\npublic interface EventLoop extends EventExecutor, EventLoopGroup { \n    @Override \n    EventLoopGroup parent(); \n}\n```\n\n  \n\n## Netty4 ä¸­çš„I/Oå’Œäº‹ä»¶å¤„ç†\n\nI/O æ“ä½œè§¦å‘çš„äº‹ä»¶å°†æµç»å®‰è£…äº†ä¸€ä¸ªæˆ–è€…å¤šä¸ª ChannelHandler çš„ ChannelPipelineã€‚**ä¼ æ’­è¿™äº›äº‹ä»¶çš„æ–¹æ³•è°ƒç”¨å¯ä»¥éšåè¢« ChannelHandler æ‰€æ‹¦æˆªï¼Œå¹¶ä¸”å¯ä»¥æŒ‰éœ€åœ°å¤„ç†äº‹ä»¶**\n\n- åœ¨Netty 4 ä¸­ï¼Œæ‰€æœ‰çš„I/Oæ“ä½œå’Œäº‹ä»¶éƒ½ç”±å·²ç»è¢«åˆ†é…ç»™äº†EventLoopçš„é‚£ä¸ªThreadæ¥å¤„ç†\n    \n\nä¸åŒäº Netty 3 ä¸­æ‰€ä½¿ç”¨çš„æ¨¡å‹\n\n  \n\n## Netty3 ä¸­çš„I/Oæ“ä½œ\n\nåœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­\n\n- æ‰€ä½¿ç”¨çš„çº¿ç¨‹æ¨¡å‹åªä¿è¯äº†å…¥ç«™ï¼ˆä¹‹å‰ç§°ä¸ºä¸Šæ¸¸ï¼‰äº‹ä»¶ä¼šåœ¨æ‰€è°“çš„ I/O çº¿ç¨‹ï¼ˆå¯¹åº”äº Netty 4 ä¸­çš„ EventLoopï¼‰ä¸­æ‰§è¡Œã€‚\n    \n- æ‰€æœ‰çš„å‡ºç«™ï¼ˆä¸‹æ¸¸ï¼‰äº‹ä»¶éƒ½ç”±è°ƒç”¨çº¿ç¨‹å¤„ç†ï¼Œå…¶å¯èƒ½æ˜¯ I/O çº¿ç¨‹ä¹Ÿå¯èƒ½æ˜¯åˆ«çš„çº¿ç¨‹\n    \n\n  \n\nå·²ç»è¢«å‘ç°**æ˜¯æœ‰é—®é¢˜çš„**ï¼Œ **å› ä¸ºéœ€è¦åœ¨ ChannelHandler ä¸­å¯¹å‡ºç«™äº‹ä»¶è¿›è¡Œä»”ç»†çš„åŒæ­¥ã€‚ç®€è€Œè¨€ä¹‹ï¼Œä¸å¯èƒ½ä¿è¯å¤šä¸ªçº¿ç¨‹ä¸ä¼šåœ¨åŒä¸€æ—¶åˆ»å°è¯•è®¿é—®å‡ºç«™äº‹ä»¶**\n\n  \n\nNetty 4 ä¸­æ‰€é‡‡ç”¨çš„çº¿ç¨‹æ¨¡å‹ï¼Œé€šè¿‡åœ¨**åŒä¸€ä¸ªçº¿ç¨‹ä¸­å¤„ç†æŸä¸ªç»™å®šçš„ EventLoop ä¸­æ‰€äº§ç”Ÿçš„æ‰€æœ‰äº‹ä»¶**ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚è¿™æä¾›äº†ä¸€ä¸ªæ›´åŠ ç®€å•çš„æ‰§è¡Œä½“ç³»æ¶æ„ï¼Œå¹¶ä¸”æ¶ˆé™¤äº†åœ¨å¤šä¸ª ChannelHandler ä¸­è¿›è¡ŒåŒæ­¥çš„éœ€è¦ï¼ˆé™¤äº†ä»»ä½•å¯èƒ½éœ€è¦åœ¨å¤šä¸ª Channel ä¸­å…±äº«çš„ï¼‰\n\n  \n\n# ä»»åŠ¡è°ƒåº¦\n\n  \n\nå¶å°”ï¼Œä½ å°†éœ€è¦è°ƒåº¦ä¸€ä¸ªä»»åŠ¡**ä»¥ä¾¿ç¨åï¼ˆå»¶è¿Ÿï¼‰æ‰§è¡Œæˆ–è€…å‘¨æœŸæ€§åœ°æ‰§è¡Œ**ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦æ³¨å†Œä¸€ä¸ªåœ¨å®¢æˆ·ç«¯å·²ç»**è¿æ¥äº† 5 åˆ†é’Ÿä¹‹åè§¦å‘çš„ä»»åŠ¡ã€‚**\n\n  \n\nJDK çš„ä»»åŠ¡è°ƒåº¦\n\n- åœ¨ Java 5 ä¹‹å‰ï¼Œä»»åŠ¡è°ƒåº¦æ˜¯å»ºç«‹åœ¨ java.util.Timer ç±»ä¹‹ä¸Šçš„ï¼Œå…¶ä½¿ç”¨äº†ä¸€ä¸ªåå° Threadï¼Œå¹¶ä¸”å…·æœ‰ä¸æ ‡å‡†çº¿ç¨‹ç›¸åŒçš„é™åˆ¶ã€‚ã€\n    \n- éšåï¼ŒJDK æä¾›äº† java.util.concurrent åŒ…ï¼Œå®ƒå®šä¹‰äº† interface ScheduledExecutorServiceã€‚è¡¨ 7-1 å±•ç¤ºäº† java.util.concurrent.Executorsçš„ç›¸å…³å·¥å‚æ–¹æ³•ã€‚\n    \n\n![](statistic/asynccode-724.png)\n\n![](statistic/asynccode-746.png)\n\n  \n\n## EventLoopè°ƒåº¦ä»»åŠ¡\n\nNetty é€š è¿‡ Channel çš„ EventLoop å®ç°ä»»åŠ¡è°ƒåº¦è§£å†³äº†è¿™ä¸€é—®é¢˜\n\n  \n\n- ä½¿ç”¨EventLoopè°ƒåº¦ä»»åŠ¡\n    \n\n![](statistic/asynccode-692.png)\n\n- ä½¿ç”¨ **EventLoop** è°ƒåº¦å‘¨æœŸæ€§çš„ä»»åŠ¡\n    \n\n![](statistic/asynccode-695.png)\n\n- ä½¿ç”¨ **ScheduledFuture** å–æ¶ˆä»»åŠ¡\n    \n\n![](statistic/asynccode-725.png)\n\n  \n\n# å®ç°ç»†èŠ‚\n\n## çº¿ç¨‹ç®¡ç†\n\nNettyçº¿ç¨‹æ¨¡å‹çš„å“è¶Šæ€§èƒ½å–å†³äºå¯¹äºå½“å‰æ‰§è¡Œçš„Threadçš„èº«ä»½çš„ç¡®å®š ï¼Œ**å®ƒæ˜¯å¦æ˜¯åˆ†é…ç»™å½“å‰Channelä»¥åŠå®ƒçš„EventLoopçš„é‚£ä¸€ä¸ªçº¿ç¨‹ï¼Œ**\n\n- å¦‚æœï¼ˆå½“å‰ï¼‰è°ƒç”¨çº¿ç¨‹æ­£æ˜¯æ”¯æ’‘ EventLoop çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆæ‰€æäº¤çš„ä»£ç å—å°†ä¼šè¢«ï¼ˆç›´æ¥æ‰§è¡Œï¼‰\n    \n- å¦åˆ™ï¼ŒEventLoop å°†è°ƒåº¦è¯¥ä»»åŠ¡ä»¥ä¾¿ç¨åæ‰§è¡Œï¼Œ**å¹¶å°†å®ƒæ”¾å…¥åˆ°å†…éƒ¨é˜Ÿåˆ—ä¸­**ã€‚å½“ EventLoop ä¸‹æ¬¡å¤„ç†å®ƒçš„äº‹ä»¶æ—¶ï¼Œå®ƒä¼šæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„é‚£äº›ä»»åŠ¡/äº‹ä»¶ã€‚è¿™ä¹Ÿå°±è§£é‡Šäº†ä»»ä½•çš„\n    \n\n![](statistic/asynccode-696.png)\n\n  \n\n- æ¯ä¸ª EventLoop éƒ½æœ‰å®ƒè‡ªå·²çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œç‹¬ç«‹äºä»»ä½•å…¶ä»–çš„ EventLoop\n    \n- â€œæ°¸ è¿œä¸è¦å°†ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡æ”¾å…¥åˆ°æ‰§è¡Œé˜Ÿåˆ—ä¸­ï¼Œå› ä¸ºå®ƒå°†é˜»å¡éœ€è¦åœ¨åŒä¸€çº¿ç¨‹ä¸Šæ‰§è¡Œçš„ä»»ä½•å…¶ä»–ä»»åŠ¡ã€‚â€å¦‚æœå¿…é¡»è¦è¿›è¡Œé˜»å¡è°ƒç”¨æˆ–è€…æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ä¸€ä¸ªä¸“é—¨çš„EventExecutor\n    \n\n## EventLoopçº¿ç¨‹çš„åˆ†é…\n\næœåŠ¡äº Channel çš„ I/O å’Œäº‹ä»¶çš„ EventLoop åŒ…å«åœ¨ EventLoopGroup ä¸­ã€‚æ ¹æ®ä¸åŒçš„ä¼ è¾“å®ç°ï¼ŒEventLoop çš„åˆ›å»ºå’Œåˆ†é…æ–¹å¼ä¹Ÿä¸åŒ\n\n#### å¼‚æ­¥ä¼ è¾“\n\nå¼‚æ­¥ä¼ è¾“å®ç°**åªä½¿ç”¨äº†å°‘é‡çš„ EventLoop**ï¼ˆä»¥åŠå’Œå®ƒä»¬ç›¸å…³è”çš„ Threadï¼‰ï¼Œè€Œä¸”åœ¨å½“å‰çš„çº¿ç¨‹æ¨¡å‹ä¸­ï¼Œ**å®ƒä»¬å¯èƒ½ä¼šè¢«å¤šä¸ª Channel æ‰€å…±äº«**ï¼Œè¿™ä½¿å¾—å¯ä»¥é€šè¿‡**å°½å¯èƒ½å°‘é‡çš„ Thread æ¥æ”¯æ’‘å¤§é‡çš„ Channel**ï¼Œè€Œä¸æ˜¯æ¯ä¸ª Channel åˆ†é…ä¸€ä¸ª Thread\n\n![](statistic/asynccode-693.png)\n\n- EventLoopGroup è´Ÿè´£ä¸º**æ¯ä¸ªæ–°åˆ›å»ºçš„ Channel åˆ†é…ä¸€ä¸ª EventLoop**ã€‚\n    \n    - åœ¨å½“å‰å®ç°ä¸­ï¼Œä½¿ç”¨é¡ºåºå¾ªç¯ï¼ˆround-robinï¼‰çš„æ–¹å¼è¿›è¡Œåˆ†é…ä»¥è·å–ä¸€ä¸ªå‡è¡¡çš„åˆ†å¸ƒï¼Œå¹¶ä¸”ç›¸åŒçš„ **EventLoopå¯èƒ½ä¼šè¢«åˆ†é…ç»™å¤šä¸ª Channelã€‚**ï¼ˆè¿™ä¸€ç‚¹åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šæ”¹å˜ã€‚ï¼‰\n        \n- ä¸€æ—¦ä¸€ä¸ª Channel è¢«åˆ†é…ç»™ä¸€ä¸ª EventLoopï¼Œå®ƒå°†åœ¨å®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­éƒ½ä½¿ç”¨è¿™ä¸ª EventLoopï¼ˆä»¥åŠç›¸å…³è”çš„ Threadï¼‰\n    \n- EventLoop çš„åˆ†é…æ–¹å¼å¯¹ ThreadLocal çš„ä½¿ç”¨çš„å½±å“ã€‚å› ä¸ºä¸€ä¸ªEventLoop é€šå¸¸ä¼šè¢«ç”¨äºæ”¯æ’‘å¤šä¸ª Channelï¼Œæ‰€ä»¥å¯¹äºæ‰€æœ‰ç›¸å…³è”çš„ Channel æ¥è¯´ï¼Œ ThreadLocal éƒ½å°†æ˜¯ä¸€æ ·çš„\n    \n\n  \n\n#### é˜»å¡ä¼ è¾“\n\nç”¨äºåƒ OIOï¼ˆæ—§çš„é˜»å¡ I/Oï¼‰è¿™æ ·çš„å…¶ä»–ä¼ è¾“çš„è®¾è®¡ç•¥æœ‰ä¸åŒ\n\n![](statistic/asynccode-694.png)\n\nè¿™é‡Œæ¯ä¸€ä¸ª Channel éƒ½å°†è¢«åˆ†é…ç»™ä¸€ä¸ª EventLoopï¼ˆä»¥åŠå®ƒçš„ Threadï¼‰ã€‚å¦‚æœä½ å¼€å‘çš„åº”ç”¨ç¨‹åºä½¿ç”¨è¿‡ java.io åŒ…ä¸­çš„é˜»å¡ I/O å®ç°ï¼Œä½ å¯èƒ½å°±é‡åˆ°è¿‡è¿™ç§æ¨¡å‹\n\nä½†æ˜¯ï¼Œæ­£å¦‚åŒä¹‹å‰ä¸€æ ·ï¼Œå¾—åˆ°çš„ä¿è¯æ˜¯**æ¯ä¸ª Channel çš„ I/O äº‹ä»¶éƒ½å°†åªä¼šè¢«ä¸€ä¸ª Thread** ï¼ˆç”¨äºæ”¯æ’‘è¯¥ Channel çš„ EventLoop çš„é‚£ä¸ª Threadï¼‰å¤„ç†ã€‚","lastmodified":"2023-08-07T15:43:17.93576939Z","tags":[]},"/spring/Spring-cloud/spring-cloud-alibaba":{"title":"spring cloud alibaba","content":"* å®˜ç½‘  [spring cloud alibaba ](https://sca.aliyun.com/zh-cn/)\n* ","lastmodified":"2023-08-07T15:43:17.939769467Z","tags":[]},"/statistic/%E5%BA%94%E7%94%A8%E5%B1%82.png":{"title":"åº”ç”¨å±‚.png","content":"","lastmodified":"2023-08-07T15:43:18.523780685Z","tags":[]},"/statistic/%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3%E5%B1%82.png":{"title":"ç½‘ç»œæ¥å£å±‚.png","content":"","lastmodified":"2023-08-07T15:43:18.699784066Z","tags":[]}}