<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="nil åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡æŒ‡å‘çš„åœ°å€ä¸€æ ·ï¼Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  func main() { var s1 []int s2 := make([]int, 0) s3 := make([]int, 0) data1 := (*reflect."><meta property="og:title" content="Slice"><meta property="og:description" content="nil åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡æŒ‡å‘çš„åœ°å€ä¸€æ ·ï¼Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  func main() { var s1 []int s2 := make([]int, 0) s3 := make([]int, 0) data1 := (*reflect."><meta property="og:type" content="website"><meta property="og:image" content="https://googoo-s.github.io/icon.png"><meta property="og:url" content="https://googoo-s.github.io/GO/%E5%85%AB%E8%82%A1%E6%96%87/Slice/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content="Slice"><meta name=twitter:description content="nil åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡æŒ‡å‘çš„åœ°å€ä¸€æ ·ï¼Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  func main() { var s1 []int s2 := make([]int, 0) s3 := make([]int, 0) data1 := (*reflect."><meta name=twitter:image content="https://googoo-s.github.io/icon.png"><title>Slice</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://googoo-s.github.io//icon.png><link href=https://googoo-s.github.io/styles.19109a40042e9f0e72e952fda4442a34.min.css rel=stylesheet><link href=https://googoo-s.github.io/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://googoo-s.github.io/js/darkmode.953af745b0f9342644d632fc167f3727.min.js></script>
<script src=https://googoo-s.github.io/js/util.00639692264b21bc3ee219733d38a8be.min.js></script>
<link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script defer src=https://googoo-s.github.io/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://googoo-s.github.io/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://googoo-s.github.io/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://googoo-s.github.io/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://googoo-s.github.io/",fetchData=Promise.all([fetch("https://googoo-s.github.io/indices/linkIndex.3bfb24158f5e9d4aff66ae07a3a8bd0d.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://googoo-s.github.io/indices/contentIndex.7e7b176f3dc5e31fceeff574620ae38a.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://googoo-s.github.io",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!0;drawGraph("https://googoo-s.github.io",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/googoo-s.github.io\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=googoo-s.github.io src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://googoo-s.github.io/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://googoo-s.github.io/>googoo-s ğŸ˜„ğŸ˜¸ğŸ˜</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Slice</h1><p class=meta>Last updated
Feb 25, 2024</p><ul class=tags><li><a href=https://googoo-s.github.io/tags/GO/%E5%85%AB%E8%82%A1%E6%96%87/>Go å…«è‚¡æ–‡</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#nil-åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡æŒ‡å‘çš„åœ°å€ä¸€æ ·>nil åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡æŒ‡å‘çš„åœ°å€ä¸€æ ·ï¼Ÿ</a></li><li><a href=#æ‹·è´å¤§åˆ‡ç‰‡ä¸€å®šæ¯”å°åˆ‡ç‰‡ä»£ä»·å¤§å—>æ‹·è´å¤§åˆ‡ç‰‡ä¸€å®šæ¯”å°åˆ‡ç‰‡ä»£ä»·å¤§å—ï¼Ÿ</a></li><li><a href=#json-åº“å¯¹-nil-slice-å’Œç©º-slice-çš„å¤„ç†æ˜¯ä¸€è‡´çš„å—>json åº“å¯¹ nil slice å’Œç©º slice çš„å¤„ç†æ˜¯ä¸€è‡´çš„å—ï¼Ÿ</a></li><li><a href=#golang-åˆ‡ç‰‡å¦‚ä½•åˆ é™¤æ•°æ®>Golang åˆ‡ç‰‡å¦‚ä½•åˆ é™¤æ•°æ®</a></li><li><a href=#æ‰©å®¹å‰åçš„-slice-æ˜¯å¦ç›¸åŒ>æ‰©å®¹å‰åçš„ Slice æ˜¯å¦ç›¸åŒ?</a></li><li><a href=#ä½¿ç”¨å€¼ä¸º-nil-çš„-slicemap-ä¼šå‘ç”Ÿå•¥>ä½¿ç”¨å€¼ä¸º nil çš„ sliceã€map ä¼šå‘ç”Ÿå•¥</a></li><li><a href=#slice-åˆ†é…åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Š>slice åˆ†é…åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Š</a></li><li><a href=#slice-åˆ‡ç‰‡çš„æˆªå–>slice åˆ‡ç‰‡çš„æˆªå–</a></li><li><a href=#go-ä¸­å¦‚æœ-new-ä¸€ä¸ªåˆ‡ç‰‡ä¼šæ€ä¹ˆæ ·>Go ä¸­å¦‚æœ new ä¸€ä¸ªåˆ‡ç‰‡ä¼šæ€ä¹ˆæ ·</a></li><li><a href=#æ•´å‹åˆ‡ç‰‡å¦‚ä½•åˆå§‹åŒ–>æ•´å‹åˆ‡ç‰‡å¦‚ä½•åˆå§‹åŒ–ï¼Ÿ</a></li><li><a href=#æ•°ç»„æ€ä¹ˆè½¬é›†åˆ->æ•°ç»„æ€ä¹ˆè½¬é›†åˆ ?</a></li><li><a href=#æ•°ç»„æ˜¯å¦‚ä½•å®ç°æ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®æ•°ç»„å…ƒç´ çš„å—>æ•°ç»„æ˜¯å¦‚ä½•å®ç°æ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®æ•°ç»„å…ƒç´ çš„å—ï¼Ÿ</a></li><li><a href=#ä¸€ä¸ªå‡½æ•°ä¼ å‚ä¸€ä¸ª-sliceå…ˆ-append-å†èµ‹å€¼å’Œå¦ä¸€ä¸ªå‡½æ•°å…ˆèµ‹å€¼å†-appendå“ªä¸ªä¼šå‘ç”Ÿå˜åŒ–>ä¸€ä¸ªå‡½æ•°ä¼ å‚ä¸€ä¸ª sliceï¼Œå…ˆ append å†èµ‹å€¼å’Œå¦ä¸€ä¸ªå‡½æ•°å…ˆèµ‹å€¼å† appendï¼Œå“ªä¸ªä¼šå‘ç”Ÿå˜åŒ–ï¼Ÿ</a></li><li><a href=#ä¸€ä¸ªå¯¹è±¡æ•°ç»„ä¸ç”¨-delete-ä½¿ç”¨-delete-æœ‰ä»€ä¹ˆå½±å“>ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œä¸ç”¨ delete[] ä½¿ç”¨ delete æœ‰ä»€ä¹ˆå½±å“</a></li><li><a href=#go-slice-çš„åº•å±‚å®ç°åŸç†>Go slice çš„åº•å±‚å®ç°åŸç†?</a></li><li><a href=#go-array-å’Œ-slice-çš„åŒºåˆ«>Go array å’Œ slice çš„åŒºåˆ«ï¼Ÿ</a></li><li><a href=#go-slice-æ·±æ‹·è´å’Œæµ…æ‹·è´>Go slice æ·±æ‹·è´å’Œæµ…æ‹·è´</a></li><li><a href=#go-slice-æ‰©å®¹æœºåˆ¶>Go slice æ‰©å®¹æœºåˆ¶ï¼Ÿ</a></li><li><a href=#go-slice-ä¸ºä»€ä¹ˆä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„>Go slice ä¸ºä»€ä¹ˆä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</a></li></ol></nav></details></aside><a href=#nil-åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡æŒ‡å‘çš„åœ°å€ä¸€æ ·><h1 id=nil-åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡æŒ‡å‘çš„åœ°å€ä¸€æ ·><span class=hanchor arialabel=Anchor># </span>nil åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡æŒ‡å‘çš„åœ°å€ä¸€æ ·ï¼Ÿ</h1></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func main() {
</span></span><span class=line><span class=cl>    var s1 []int
</span></span><span class=line><span class=cl>    s2 := make([]int, 0)
</span></span><span class=line><span class=cl>    s3 := make([]int, 0)
</span></span><span class=line><span class=cl>    data1 := (*reflect.SliceHeader)(unsafe.Pointer(&amp;s1)).Data
</span></span><span class=line><span class=cl>    data2 := (*reflect.SliceHeader)(unsafe.Pointer(&amp;s2)).Data
</span></span><span class=line><span class=cl>    data3 := (*reflect.SliceHeader)(unsafe.Pointer(&amp;s3)).Data
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    fmt.Printf(&#34;s1 data:%+v\n&#34;, data1)
</span></span><span class=line><span class=cl>    fmt.Printf(&#34;s2 data:%+v\n&#34;, data2)
</span></span><span class=line><span class=cl>    fmt.Printf(&#34;s3 data:%+v\n&#34;, data3)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    fmt.Printf(&#34;s1:s2=&gt;%t\n&#34;, data1 == data2)
</span></span><span class=line><span class=cl>    fmt.Printf(&#34;s2:s3=&gt;%t\n&#34;, data2 == data3)
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>//è¾“å‡º
</span></span><span class=line><span class=cl>s1 data:0
</span></span><span class=line><span class=cl>s2 data:824634859200
</span></span><span class=line><span class=cl>s3 data:824634859200
</span></span><span class=line><span class=cl>s1:s2=&gt;false
</span></span><span class=line><span class=cl>s2:s3=&gt;true
</span></span></code></pre></td></tr></table></div></div><p>Nil åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡æŒ‡å‘çš„åœ°å€ä¸ä¸€æ ·ã€‚</p><p>Nil åˆ‡ç‰‡å¼•ç”¨æ•°ç»„æŒ‡é’ˆåœ°å€ä¸º 0ï¼ˆæ— æŒ‡å‘ä»»ä½•å®é™…åœ°å€ï¼‰</p><p>ç©ºåˆ‡ç‰‡çš„å¼•ç”¨æ•°ç»„æŒ‡é’ˆåœ°å€æ˜¯æœ‰çš„ï¼Œä¸”å›ºå®šä¸ºä¸€ä¸ªå€¼ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>//åˆ‡ç‰‡çš„æ•°æ®ç»“æ„
</span></span><span class=line><span class=cl>type SliceHeader struct {
</span></span><span class=line><span class=cl>    Data uintptr //å¼•ç”¨æ•°ç»„æŒ‡é’ˆåœ°å€
</span></span><span class=line><span class=cl>    Len  int
</span></span><span class=line><span class=cl>    Cap  int
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Nil åˆ‡ç‰‡å’Œç©ºåˆ‡ç‰‡æœ€å¤§çš„åŒºåˆ«åœ¨äºæŒ‡å‘çš„æ•°ç»„å¼•ç”¨åœ°å€æ˜¯ä¸ä¸€æ ·çš„</p><a href=#æ‹·è´å¤§åˆ‡ç‰‡ä¸€å®šæ¯”å°åˆ‡ç‰‡ä»£ä»·å¤§å—><h1 id=æ‹·è´å¤§åˆ‡ç‰‡ä¸€å®šæ¯”å°åˆ‡ç‰‡ä»£ä»·å¤§å—><span class=hanchor arialabel=Anchor># </span>æ‹·è´å¤§åˆ‡ç‰‡ä¸€å®šæ¯”å°åˆ‡ç‰‡ä»£ä»·å¤§å—ï¼Ÿ</h1></a><p>å¹¶ä¸æ˜¯ï¼Œæ‰€æœ‰åˆ‡ç‰‡çš„å¤§å°ç›¸åŒï¼›ä¸‰ä¸ªå­—æ®µï¼ˆä¸€ä¸ª uintptrï¼Œä¸¤ä¸ª intï¼‰ã€‚åˆ‡ç‰‡ä¸­çš„ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯æŒ‡å‘åˆ‡ç‰‡åº•å±‚æ•°ç»„çš„æŒ‡é’ˆï¼Œè¿™æ˜¯åˆ‡ç‰‡çš„å­˜å‚¨ç©ºé—´ï¼Œç¬¬äºŒä¸ªå­—æ®µæ˜¯åˆ‡ç‰‡çš„é•¿åº¦ï¼Œç¬¬ä¸‰ä¸ªå­—æ®µæ˜¯å®¹é‡ã€‚å°†ä¸€ä¸ª slice å˜é‡åˆ†é…ç»™å¦ä¸€ä¸ªå˜é‡åªä¼šå¤åˆ¶ä¸‰ä¸ªæœºå™¨å­—ã€‚æ‰€ä»¥æ‹·è´å¤§åˆ‡ç‰‡è·Ÿå°åˆ‡ç‰‡çš„ä»£ä»·åº”è¯¥æ˜¯ä¸€æ ·çš„ã€‚</p><p>SliceHeader æ˜¯åˆ‡ç‰‡åœ¨ go çš„åº•å±‚ç»“æ„ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>type SliceHeader struct {
</span></span><span class=line><span class=cl>    Data uintptr
</span></span><span class=line><span class=cl>    Len  int
</span></span><span class=line><span class=cl>    Cap  int
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>å¤§åˆ‡ç‰‡è·Ÿå°åˆ‡ç‰‡çš„åŒºåˆ«æ— éå°±æ˜¯ Len å’Œ Cap çš„å€¼æ¯”å°åˆ‡ç‰‡çš„è¿™ä¸¤ä¸ªå€¼å¤§ä¸€äº›ï¼Œå¦‚æœå‘ç”Ÿæ‹·è´ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æ‹·è´ä¸Šé¢çš„ä¸‰ä¸ªå­—æ®µã€‚</p><a href=#json-åº“å¯¹-nil-slice-å’Œç©º-slice-çš„å¤„ç†æ˜¯ä¸€è‡´çš„å—><h1 id=json-åº“å¯¹-nil-slice-å’Œç©º-slice-çš„å¤„ç†æ˜¯ä¸€è‡´çš„å—><span class=hanchor arialabel=Anchor># </span>json åº“å¯¹ nil slice å’Œç©º slice çš„å¤„ç†æ˜¯ä¸€è‡´çš„å—ï¼Ÿ</h1></a><p>Json åº“å¯¹ nil slice å’Œç©º slice çš„å¤„ç†æ˜¯ä¸ä¸€è‡´çš„ï¼Œ</p><p>å› ä¸º nil slice åªæ˜¯å£°æ˜äº† sliceï¼Œå´æ²¡æœ‰ç»™å®ä¾‹åŒ–çš„å¯¹è±¡ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>	var f1 []string
</span></span><span class=line><span class=cl>    f2 := make([]string, 0)
</span></span><span class=line><span class=cl>    json1, _ := json.Marshal(Person{f1})
</span></span><span class=line><span class=cl>    json2, _ := json.Marshal(Person{f2})
</span></span><span class=line><span class=cl>    fmt.Printf(&#34;%s\n&#34;, string(json1))
</span></span><span class=line><span class=cl>    fmt.Printf(&#34;%s\n&#34;, string(json2))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>//è¾“å‡º
</span></span><span class=line><span class=cl>{&#34;Friends&#34;:null}
</span></span><span class=line><span class=cl>{&#34;Friends&#34;:[]}
</span></span></code></pre></td></tr></table></div></div><p>Json åº“å¯¹ nil slice ç¼–ç ä¸º null, json åº“å¯¹ç©º slice ç¼–ç ä¸º[]ã€‚</p><a href=#golang-åˆ‡ç‰‡å¦‚ä½•åˆ é™¤æ•°æ®><h1 id=golang-åˆ‡ç‰‡å¦‚ä½•åˆ é™¤æ•°æ®><span class=hanchor arialabel=Anchor># </span>Golang åˆ‡ç‰‡å¦‚ä½•åˆ é™¤æ•°æ®</h1></a><p>Go è¯­è¨€åˆ é™¤åˆ‡ç‰‡å…ƒç´ çš„æ–¹æ³•ï¼š<br>1ã€æŒ‡å®šåˆ é™¤ä½ç½®ï¼Œå¦‚ã€index := 1ã€‘;<br>2ã€æŸ¥çœ‹åˆ é™¤ä½ç½®ä¹‹å‰çš„å…ƒç´ å’Œä¹‹åçš„å…ƒç´ ;<br>3ã€å°†åˆ é™¤ç‚¹å‰åçš„å…ƒç´ è¿æ¥èµ·æ¥å³å¯ã€‚<br>Go è¯­è¨€å¹¶æ²¡æœ‰å¯¹åˆ é™¤åˆ‡ç‰‡å…ƒç´ æä¾›ä¸“ç”¨çš„è¯­æ³•æˆ–è€…æ¥å£ï¼Œéœ€è¦ä½¿ç”¨åˆ‡ç‰‡æœ¬èº«çš„ç‰¹æ€§æ¥åˆ é™¤å…ƒç´ ã€‚<br>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>str := []string{&#34;a&#34;,&#34;b&#34;,&#34;c&#34;}
</span></span><span class=line><span class=cl>   // step 1
</span></span><span class=line><span class=cl>   index := 1
</span></span><span class=line><span class=cl>   // step 2
</span></span><span class=line><span class=cl>   fmt.Println(str[:index], str[index+1])
</span></span><span class=line><span class=cl>   // step 3
</span></span><span class=line><span class=cl>   str = append(str[:index], str[index+1]...)
</span></span><span class=line><span class=cl>   // res
</span></span><span class=line><span class=cl>   fmt.Println(str)
</span></span></code></pre></td></tr></table></div></div><a href=#æ‰©å®¹å‰åçš„-slice-æ˜¯å¦ç›¸åŒ><h1 id=æ‰©å®¹å‰åçš„-slice-æ˜¯å¦ç›¸åŒ><span class=hanchor arialabel=Anchor># </span>æ‰©å®¹å‰åçš„ Slice æ˜¯å¦ç›¸åŒ?</h1></a><p>æƒ…å†µä¸€ï¼šåŸæ•°ç»„è¿˜æœ‰å®¹é‡å¯ä»¥æ‰©å®¹ï¼ˆå®é™…å®¹é‡æ²¡æœ‰å¡«å……å®Œï¼‰ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæ‰©å®¹ä»¥åçš„æ•°ç»„è¿˜æ˜¯æŒ‡å‘åŸæ¥çš„æ•°ç»„ï¼Œå¯¹ä¸€ä¸ªåˆ‡ç‰‡çš„æ“ä½œå¯èƒ½å½±å“å¤šä¸ªæŒ‡é’ˆæŒ‡å‘ç›¸åŒåœ°å€çš„ sliceã€‚</p><p>æƒ…å†µäºŒï¼šåŸæ¥æ•°ç»„çš„å®¹é‡å·²ç»è¾¾åˆ°äº†æœ€å¤§å€¼ï¼Œå†æƒ³æ‰©å®¹ï¼Œgo é»˜è®¤ä¼šå…ˆå¼€ä¸€ç‰‡å†…å­˜åŒºåŸŸï¼ŒæŠŠåŸæ¥çš„å€¼æ‹·è´è¿‡æ¥ï¼Œç„¶åå†æ‰§è¡Œ append ()æ“ä½œã€‚è¿™ç§æƒ…å†µä¸æ¯«ä¸å½±å“åŸæ•°ç»„ã€‚è¦å¤åˆ¶ä¸€ä¸ª sliceï¼Œæœ€å¥½ä½¿ç”¨ copy å‡½æ•°ã€‚</p><p><img src=https://googoo-s.oss-cn-chengdu.aliyuncs.com/statisticimage-20230906170544338.png width=auto alt=image-20230906170544338></p><p><strong>è¾“å‡ºï¼š</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>å‡½æ•°å†…s=[1,2]
</span></span><span class=line><span class=cl>ä¸»å‡½æ•°å†…s=[1]
</span></span></code></pre></td></tr></table></div></div><a href=#ä½¿ç”¨å€¼ä¸º-nil-çš„-slicemap-ä¼šå‘ç”Ÿå•¥><h1 id=ä½¿ç”¨å€¼ä¸º-nil-çš„-slicemap-ä¼šå‘ç”Ÿå•¥><span class=hanchor arialabel=Anchor># </span>ä½¿ç”¨å€¼ä¸º nil çš„ sliceã€map ä¼šå‘ç”Ÿå•¥</h1></a><p>å…è®¸å¯¹å€¼ä¸º nil çš„ slice æ·»åŠ å…ƒç´ ï¼Œä½†å¯¹å€¼ä¸º nil çš„ map æ·»åŠ å…ƒç´ ï¼Œåˆ™ä¼šé€ æˆè¿è¡Œæ—¶ panicã€‚</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12</td><td>// map é”™è¯¯ç¤ºä¾‹<br>func main () {<br>var m map[string]int<br>m[&ldquo;one&rdquo;] = 1 // error: panic: assignment to entry in nil map<br>// m := make (map[string]int)// map çš„æ­£ç¡®å£°æ˜ï¼Œåˆ†é…äº†å®é™…çš„å†…å­˜<br>}<br><br>// slice æ­£ç¡®ç¤ºä¾‹<br>func main () {<br>var s []int<br>s = append (s, 1)<br>}</td></tr></tbody></table><p>å¦‚æœå…ˆä½¿ç”¨ <code>make()</code>,é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>m["one"]=1</code>,å› ä¸ºåˆ†é…äº†å†…å­˜ã€‚</p><a href=#slice-åˆ†é…åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Š><h1 id=slice-åˆ†é…åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Š><span class=hanchor arialabel=Anchor># </span>slice åˆ†é…åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Š</h1></a><p>æœ‰å¯èƒ½åˆ†é…åˆ°æ ˆä¸Šï¼Œä¹Ÿæœ‰å¯èƒ½åˆ†é…åˆ°æ ˆä¸Šã€‚å½“å¼€è¾Ÿåˆ‡ç‰‡ç©ºé—´è¾ƒå¤§æ—¶ï¼Œä¼šé€ƒé€¸åˆ°å †ä¸Šã€‚</p><p>é€šè¿‡å‘½ä»¤ <code>go build -gcflags "-m -l" xxx.go</code> è§‚å¯Ÿ golang æ˜¯å¦‚ä½•è¿›è¡Œé€ƒé€¸åˆ†æçš„</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>// map é”™è¯¯ç¤ºä¾‹
</span></span><span class=line><span class=cl>func main() {
</span></span><span class=line><span class=cl>    var m map[string]int
</span></span><span class=line><span class=cl>    m[&#34;one&#34;] = 1  // error: panic: assignment to entry in nil map
</span></span><span class=line><span class=cl>    // m := make(map[string]int)// map çš„æ­£ç¡®å£°æ˜ï¼Œåˆ†é…äº†å®é™…çš„å†…å­˜
</span></span><span class=line><span class=cl>}    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// slice æ­£ç¡®ç¤ºä¾‹
</span></span><span class=line><span class=cl>func main() {
</span></span><span class=line><span class=cl> var s []int
</span></span><span class=line><span class=cl> s = append(s, 1)
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><a href=#slice-åˆ‡ç‰‡çš„æˆªå–><h1 id=slice-åˆ‡ç‰‡çš„æˆªå–><span class=hanchor arialabel=Anchor># </span>slice åˆ‡ç‰‡çš„æˆªå–</h1></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> x := make([]int, 2, 10)
</span></span><span class=line><span class=cl> _ = x[6:10]
</span></span><span class=line><span class=cl> _ = x[6:]
</span></span><span class=line><span class=cl> _ = x[2:]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>//_ = x[6:] è¿™â¼€â¾ä¼šå‘â½£panic, æˆªå–ç¬¦å· [i:j]ï¼Œ
</span></span><span class=line><span class=cl>//å¦‚æœ j çœç•¥ï¼Œé»˜è®¤æ˜¯åŸåˆ‡â½šæˆ–è€…æ•°ç»„çš„â»“åº¦ï¼Œx çš„â»“åº¦æ˜¯ 2ï¼Œâ¼©äºèµ·å§‹ä¸‹æ ‡ 6 ï¼Œæ‰€ä»¥ panic
</span></span></code></pre></td></tr></table></div></div><a href=#go-ä¸­å¦‚æœ-new-ä¸€ä¸ªåˆ‡ç‰‡ä¼šæ€ä¹ˆæ ·><h1 id=go-ä¸­å¦‚æœ-new-ä¸€ä¸ªåˆ‡ç‰‡ä¼šæ€ä¹ˆæ ·><span class=hanchor arialabel=Anchor># </span>Go ä¸­å¦‚æœ new ä¸€ä¸ªåˆ‡ç‰‡ä¼šæ€ä¹ˆæ ·</h1></a><p><img src=https://googoo-s.oss-cn-chengdu.aliyuncs.com/statisticimage-20230724165822059.png width=auto alt=image-20230724165822059></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>list</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>([]</span><span class=kt>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// ç¼–è¯‘é”™è¯¯
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// new([]int) ä¹‹åçš„ list æ˜¯â¼€ä¸ªæœªè®¾ç½®â»“åº¦çš„ *[]int ç±»å‹çš„æŒ‡é’ˆ
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// ä¸èƒ½å¯¹æœªè®¾ç½®â»“åº¦çš„æŒ‡é’ˆæ‰§â¾ append æ“ä½œã€‚
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=o>*</span><span class=nx>list</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=o>*</span><span class=nx>list</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=o>*</span><span class=nx>list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>s1</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>s2</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// ç¼–è¯‘é”™è¯¯ï¼Œs2éœ€è¦å±•å¼€
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>s1</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>s1</span><span class=p>,</span> <span class=nx>s2</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>s1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=c1>//æ­£ç¡®å†™æ³•
</span></span></span></code></pre></td></tr></table></div></div><a href=#æ•´å‹åˆ‡ç‰‡å¦‚ä½•åˆå§‹åŒ–><h1 id=æ•´å‹åˆ‡ç‰‡å¦‚ä½•åˆå§‹åŒ–><span class=hanchor arialabel=Anchor># </span>æ•´å‹åˆ‡ç‰‡å¦‚ä½•åˆå§‹åŒ–ï¼Ÿ</h1></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>//æ•°ç»„åˆå§‹åŒ–
</span></span><span class=line><span class=cl>arr1 := [3]int{1, 2, 3}
</span></span><span class=line><span class=cl>arr2 := [...]int{1, 2, 3}
</span></span><span class=line><span class=cl>arr3 := [3]int{0:3,1:4}
</span></span></code></pre></td></tr></table></div></div><a href=#æ•°ç»„æ€ä¹ˆè½¬é›†åˆ-><h1 id=æ•°ç»„æ€ä¹ˆè½¬é›†åˆ-><span class=hanchor arialabel=Anchor># </span>æ•°ç»„æ€ä¹ˆè½¬é›†åˆ ?</h1></a><p>å¯ä»¥ä½¿ç”¨æ•°ç»„çš„ç´¢å¼•ä½œä¸º map çš„ keyï¼Œæ•°ç»„çš„å€¼ä½œä¸º map çš„å€¼ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>//æ•°ç»„åˆå§‹åŒ–
</span></span><span class=line><span class=cl>arr1 := [3]int{1, 2, 3}
</span></span><span class=line><span class=cl>arr2 := [...]int{1, 2, 3}
</span></span><span class=line><span class=cl>arr3 := [3]int{0:3,1:4}
</span></span></code></pre></td></tr></table></div></div><a href=#æ•°ç»„æ˜¯å¦‚ä½•å®ç°æ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®æ•°ç»„å…ƒç´ çš„å—><h1 id=æ•°ç»„æ˜¯å¦‚ä½•å®ç°æ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®æ•°ç»„å…ƒç´ çš„å—><span class=hanchor arialabel=Anchor># </span>æ•°ç»„æ˜¯å¦‚ä½•å®ç°æ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®æ•°ç»„å…ƒç´ çš„å—ï¼Ÿ</h1></a><p>ä¾‹å¦‚ï¼š a := [10]int{0}</p><ul><li>è®¡ç®—æœºç»™æ•°ç»„ aï¼Œåˆ†é…äº†ä¸€ç»„è¿ç»­çš„å†…å­˜ç©ºé—´ã€‚</li><li>æ¯”å¦‚å†…å­˜å—çš„é¦–åœ°å€ä¸º base_address=1000ã€‚</li><li>å½“è®¡ç®—ç»™æ¯ä¸ªå†…å­˜å•å…ƒåˆ†é…ä¸€ä¸ªåœ°å€ï¼Œè®¡ç®—æœºé€šè¿‡åœ°å€æ¥è®¿é—®æ•°æ®ã€‚å½“è®¡ç®—æœºéœ€è¦è®¿é—®æ•°ç»„çš„æŸä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ä¸€ä¸ªå¯»å€å…¬å¼æ¥è®¡ç®—å­˜å‚¨çš„å†…å­˜åœ°å€ã€‚</li></ul><a href=#ä¸€ä¸ªå‡½æ•°ä¼ å‚ä¸€ä¸ª-sliceå…ˆ-append-å†èµ‹å€¼å’Œå¦ä¸€ä¸ªå‡½æ•°å…ˆèµ‹å€¼å†-appendå“ªä¸ªä¼šå‘ç”Ÿå˜åŒ–><h1 id=ä¸€ä¸ªå‡½æ•°ä¼ å‚ä¸€ä¸ª-sliceå…ˆ-append-å†èµ‹å€¼å’Œå¦ä¸€ä¸ªå‡½æ•°å…ˆèµ‹å€¼å†-appendå“ªä¸ªä¼šå‘ç”Ÿå˜åŒ–><span class=hanchor arialabel=Anchor># </span>ä¸€ä¸ªå‡½æ•°ä¼ å‚ä¸€ä¸ª sliceï¼Œå…ˆ append å†èµ‹å€¼å’Œå¦ä¸€ä¸ªå‡½æ•°å…ˆèµ‹å€¼å† appendï¼Œå“ªä¸ªä¼šå‘ç”Ÿå˜åŒ–ï¼Ÿ</h1></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>BeforeAppend</span><span class=p>(</span><span class=nx>s</span> <span class=p>[]</span><span class=kt>int</span><span class=p>)</span> <span class=p>[]</span><span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>s</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>s</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>s</span> <span class=p>=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>s</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>AfterAppend</span><span class=p>(</span><span class=nx>s</span> <span class=p>[]</span><span class=kt>int</span><span class=p>)</span> <span class=p>[]</span><span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>s</span> <span class=p>=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>s</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>s</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>s</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>s</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>int</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>BeforeAppend</span><span class=p>(</span><span class=nx>s</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nf>AfterAppend</span><span class=p>(</span><span class=nx>s</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><a href=#ä¸€ä¸ªå¯¹è±¡æ•°ç»„ä¸ç”¨-delete-ä½¿ç”¨-delete-æœ‰ä»€ä¹ˆå½±å“><h1 id=ä¸€ä¸ªå¯¹è±¡æ•°ç»„ä¸ç”¨-delete-ä½¿ç”¨-delete-æœ‰ä»€ä¹ˆå½±å“><span class=hanchor arialabel=Anchor># </span>ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œä¸ç”¨ delete[] ä½¿ç”¨ delete æœ‰ä»€ä¹ˆå½±å“</h1></a><p>1ã€é’ˆå¯¹ç®€å•ç±»å‹ä½¿ç”¨ new åˆ†é…åçš„ä¸ç®¡æ˜¯æ•°ç»„è¿˜æ˜¯éæ•°ç»„å½¢å¼å†…å­˜ç©ºé—´ç”¨ä¸¤ç§æ–¹å¼å‡å¯å¦‚ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>int *a = new int[10];   
</span></span><span class=line><span class=cl>delete a;   
</span></span><span class=line><span class=cl>delete [] a; 
</span></span></code></pre></td></tr></table></div></div><p>æ­¤ç§æƒ…å†µä¸­çš„é‡Šæ”¾æ•ˆæœç›¸åŒï¼ŒåŸå› åœ¨äºï¼šåˆ†é…ç®€å•ç±»å‹å†…å­˜æ—¶ï¼Œå†…å­˜å¤§å°å·²ç»ç¡®å®šï¼Œç³»ç»Ÿå¯ä»¥è®°å¿†å¹¶ä¸”è¿›è¡Œç®¡ç†ï¼Œåœ¨ææ„æ—¶ï¼Œç³»ç»Ÿå¹¶ä¸ä¼šè°ƒç”¨ææ„å‡½æ•°ï¼Œå®ƒç›´æ¥é€šè¿‡æŒ‡é’ˆå¯ä»¥è·å–å®é™…åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œå“ªæ€•æ˜¯ä¸€ä¸ªæ•°ç»„å†…å­˜ç©ºé—´ (åœ¨åˆ†é…è¿‡ç¨‹ä¸­ç³»ç»Ÿä¼šè®°å½•åˆ†é…å†…å­˜çš„å¤§å°ç­‰ä¿¡æ¯ï¼Œæ­¤ä¿¡æ¯ä¿å­˜åœ¨ç»“æ„ä½“_CrtMemBlockHeader ä¸­ï¼Œå…·ä½“æƒ…å†µå¯å‚çœ‹ VC å®‰è£…ç›®å½•ä¸‹ CRTSRCDBGDEL. Cpp)</p><p>2ã€é’ˆå¯¹ç±» Classï¼Œä¸¤ç§æ–¹å¼ä½“ç°å‡ºå…·ä½“å·®å¼‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>class A
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>    private:
</span></span><span class=line><span class=cl>        char *m_cBuffer;
</span></span><span class=line><span class=cl>        int m_nLen;
</span></span><span class=line><span class=cl>    public:
</span></span><span class=line><span class=cl>        A(){ m_cBuffer = new char[m_nLen]; }
</span></span><span class=line><span class=cl>        ~A() { delete [] m_cBuffer; }
</span></span><span class=line><span class=cl>};
</span></span><span class=line><span class=cl>A *a = new A[10];
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// ä»…é‡Šæ”¾äº†aæŒ‡é’ˆæŒ‡å‘çš„å…¨éƒ¨å†…å­˜ç©ºé—´ ä½†æ˜¯åªè°ƒç”¨äº†a[0]å¯¹è±¡çš„ææ„å‡½æ•° å‰©ä¸‹çš„ä»a[1]åˆ°a[9]è¿™9ä¸ªç”¨æˆ·è‡ªè¡Œåˆ†é…çš„m_cBufferå¯¹åº”å†…å­˜ç©ºé—´å°†ä¸èƒ½é‡Šæ”¾ ä»è€Œé€ æˆå†…å­˜æ³„æ¼
</span></span><span class=line><span class=cl>delete a;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// è°ƒç”¨ä½¿ç”¨ç±»å¯¹è±¡çš„ææ„å‡½æ•°é‡Šæ”¾ç”¨æˆ·è‡ªå·±åˆ†é…å†…å­˜ç©ºé—´å¹¶ä¸”   é‡Šæ”¾äº†aæŒ‡é’ˆæŒ‡å‘çš„å…¨éƒ¨å†…å­˜ç©ºé—´
</span></span><span class=line><span class=cl>delete [] a;
</span></span></code></pre></td></tr></table></div></div><p>æ‰€ä»¥æ€»ç»“ä¸‹å°±æ˜¯ï¼Œå¦‚æœ ptr ä»£è¡¨ä¸€ä¸ªç”¨ new ç”³è¯·çš„å†…å­˜è¿”å›çš„å†…å­˜ç©ºé—´åœ°å€ï¼Œå³æ‰€è°“çš„æŒ‡é’ˆï¼Œé‚£ä¹ˆï¼š</p><p>Delete ptr â€“ ä»£è¡¨ç”¨æ¥é‡Šæ”¾å†…å­˜ï¼Œä¸”åªç”¨æ¥é‡Šæ”¾ ptr æŒ‡å‘çš„å†…å­˜ã€‚<br>Delete[] rg â€“ ç”¨æ¥é‡Šæ”¾ rg æŒ‡å‘çš„å†…å­˜ï¼Œï¼ï¼è¿˜é€ä¸€è°ƒç”¨æ•°ç»„ä¸­æ¯ä¸ªå¯¹è±¡çš„ destructorï¼ï¼<br>å¯¹äºåƒ int/char/long/int*/struct ç­‰ç­‰ç®€å•æ•°æ®ç±»å‹ï¼Œç”±äºå¯¹è±¡æ²¡æœ‰ destructorï¼Œæ‰€ä»¥ç”¨ delete å’Œ delete [] æ˜¯ä¸€æ ·çš„ï¼ä½†æ˜¯å¦‚æœæ˜¯ C++ å¯¹è±¡æ•°ç»„å°±ä¸åŒäº†ï¼</p><a href=#go-slice-çš„åº•å±‚å®ç°åŸç†><h1 id=go-slice-çš„åº•å±‚å®ç°åŸç†><span class=hanchor arialabel=Anchor># </span>Go slice çš„åº•å±‚å®ç°åŸç†?</h1></a><p>åˆ‡ç‰‡æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œå®ƒçš„åº•å±‚æ˜¯æ•°ç»„ï¼Œå¯ä»¥ç†è§£ä¸ºå¯¹åº•å±‚æ•°ç»„çš„æŠ½è±¡ã€‚</p><p>æºç åŒ…ä¸­ src/runtime/slice. Go å®šä¹‰äº† slice çš„æ•°æ®ç»“æ„ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>type slice struct {
</span></span><span class=line><span class=cl>    array unsafe.Pointer
</span></span><span class=line><span class=cl>    len   int
</span></span><span class=line><span class=cl>    cap   int
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Slice å ç”¨ 24 ä¸ªå­—èŠ‚</p><ul><li><p>Array: æŒ‡å‘åº•å±‚æ•°ç»„çš„æŒ‡é’ˆï¼Œå ç”¨ 8 ä¸ªå­—èŠ‚</p></li><li><p>Len: åˆ‡ç‰‡çš„é•¿åº¦ï¼Œå ç”¨ 8 ä¸ªå­—èŠ‚</p></li><li><p>Cap: åˆ‡ç‰‡çš„å®¹é‡ï¼Œcap æ€»æ˜¯å¤§äºç­‰äº len çš„ï¼Œå ç”¨ 8 ä¸ªå­—èŠ‚</p></li></ul><p>Slice æœ‰ 4 ç§åˆå§‹åŒ–æ–¹å¼</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>// åˆå§‹åŒ–æ–¹å¼1ï¼šç›´æ¥å£°æ˜
</span></span><span class=line><span class=cl>var slice1 []int
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// åˆå§‹åŒ–æ–¹å¼2ï¼šä½¿ç”¨å­—é¢é‡
</span></span><span class=line><span class=cl>slice2 := []int{1, 2, 3, 4}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// åˆå§‹åŒ–æ–¹å¼3ï¼šä½¿ç”¨makeåˆ›å»ºslice
</span></span><span class=line><span class=cl>slice3 := make([]int, 3, 5)         
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// åˆå§‹åŒ–æ–¹å¼4: ä»åˆ‡ç‰‡æˆ–æ•°ç»„â€œæˆªå–â€
</span></span><span class=line><span class=cl>slcie4 := arr[1:3]
</span></span></code></pre></td></tr></table></div></div><p>é€šè¿‡ä¸€ä¸ªç®€å•ç¨‹åºï¼Œçœ‹ä¸‹ slice åˆå§‹åŒ–è°ƒç”¨çš„åº•å±‚å‡½æ•°</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>slice</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>int</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>slice</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>slice</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>slice</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>slice</span><span class=p>),</span> <span class=nb>cap</span><span class=p>(</span><span class=nx>slice</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>é€šè¿‡Â <code>go tool compile -S test.go | grep CALL</code>Â å¾—åˆ°æ±‡ç¼–ä»£ç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>0x0042 00066 (test.go:6)        CALL    runtime.makeslice(SB)
</span></span><span class=line><span class=cl>0x006d 00109 (test.go:7)        CALL    runtime.growslice(SB)
</span></span><span class=line><span class=cl>0x00a4 00164 (test.go:8)        CALL    runtime.convTslice(SB)
</span></span><span class=line><span class=cl>0x00c0 00192 (test.go:8)        CALL    runtime.convT64(SB)
</span></span><span class=line><span class=cl>0x00d8 00216 (test.go:8)        CALL    runtime.convT64(SB)
</span></span><span class=line><span class=cl>0x0166 00358 ($GOROOT/src/fmt/print.go:274)     CALL    fmt.Fprintln(SB)
</span></span><span class=line><span class=cl>0x0180 00384 (test.go:5)        CALL    runtime.morestack_noctxt(SB)
</span></span><span class=line><span class=cl>0x0079 00121 (&lt;autogenerated&gt;:1)        CALL    runtime.efaceeq(SB)
</span></span><span class=line><span class=cl>0x00a0 00160 (&lt;autogenerated&gt;:1)        CALL    runtime.morestack_noctxt(SB)
</span></span></code></pre></td></tr></table></div></div><p>åˆå§‹åŒ– slice è°ƒç”¨çš„æ˜¯ runtime. Makesliceï¼Œmakeslice å‡½æ•°çš„å·¥ä½œä¸»è¦å°±æ˜¯è®¡ç®— slice æ‰€éœ€å†…å­˜å¤§å°ï¼Œç„¶åè°ƒç”¨ mallocgc è¿›è¡Œå†…å­˜çš„åˆ†é…</p><p>æ‰€éœ€å†…å­˜å¤§å° = åˆ‡ç‰‡ä¸­å…ƒç´ å¤§å° * åˆ‡ç‰‡çš„å®¹é‡</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func makeslice(et *_type, len, cap int) unsafe.Pointer {
</span></span><span class=line><span class=cl>    mem, overflow := math.MulUintptr(et.size, uintptr(cap))
</span></span><span class=line><span class=cl>    if overflow || mem &gt; maxAlloc || len &lt; 0 || len &gt; cap {
</span></span><span class=line><span class=cl>        // NOTE: Produce a &#39;len out of range&#39; error instead of a
</span></span><span class=line><span class=cl>        // &#39;cap out of range&#39; error when someone does make([]T, bignumber).
</span></span><span class=line><span class=cl>        // &#39;cap out of range&#39; is true too, but since the cap is only being
</span></span><span class=line><span class=cl>        // supplied implicitly, saying len is clearer.
</span></span><span class=line><span class=cl>        // See golang.org/issue/4085.
</span></span><span class=line><span class=cl>        mem, overflow := math.MulUintptr(et.size, uintptr(len))
</span></span><span class=line><span class=cl>        if overflow || mem &gt; maxAlloc || len &lt; 0 {
</span></span><span class=line><span class=cl>            panicmakeslicelen()
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        panicmakeslicecap()
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return mallocgc(mem, et, true)
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><a href=#go-array-å’Œ-slice-çš„åŒºåˆ«><h1 id=go-array-å’Œ-slice-çš„åŒºåˆ«><span class=hanchor arialabel=Anchor># </span>Go array å’Œ slice çš„åŒºåˆ«ï¼Ÿ</h1></a><p><strong>1ï¼‰æ•°ç»„é•¿åº¦ä¸åŒ</strong></p><p>æ•°ç»„åˆå§‹åŒ–å¿…é¡»æŒ‡å®šé•¿åº¦ï¼Œå¹¶ä¸”é•¿åº¦å°±æ˜¯å›ºå®šçš„</p><p>åˆ‡ç‰‡çš„é•¿åº¦æ˜¯ä¸å›ºå®šçš„ï¼Œå¯ä»¥è¿½åŠ å…ƒç´ ï¼Œåœ¨è¿½åŠ æ—¶å¯èƒ½ä½¿åˆ‡ç‰‡çš„å®¹é‡å¢å¤§</p><p><strong>2ï¼‰å‡½æ•°ä¼ å‚ä¸åŒ</strong></p><p>æ•°ç»„æ˜¯å€¼ç±»å‹ï¼Œå°†ä¸€ä¸ªæ•°ç»„èµ‹å€¼ç»™å¦ä¸€ä¸ªæ•°ç»„æ—¶ï¼Œä¼ é€’çš„æ˜¯ä¸€ä»½æ·±æ‹·è´ï¼Œå‡½æ•°ä¼ å‚æ“ä½œéƒ½ä¼šå¤åˆ¶æ•´ä¸ªæ•°ç»„æ•°æ®ï¼Œä¼šå ç”¨é¢å¤–çš„å†…å­˜ï¼Œå‡½æ•°å†…å¯¹æ•°ç»„å…ƒç´ å€¼çš„<strong>ä¿®æ”¹</strong>ï¼Œä¸ä¼šä¿®æ”¹åŸæ•°ç»„å†…å®¹ã€‚</p><p>åˆ‡ç‰‡æ˜¯å¼•ç”¨ç±»å‹ï¼Œå°†ä¸€ä¸ªåˆ‡ç‰‡èµ‹å€¼ç»™å¦ä¸€ä¸ªåˆ‡ç‰‡æ—¶ï¼Œä¼ é€’çš„æ˜¯ä¸€ä»½æµ…æ‹·è´ï¼Œå‡½æ•°ä¼ å‚æ“ä½œä¸ä¼šæ‹·è´æ•´ä¸ªåˆ‡ç‰‡ï¼Œåªä¼šå¤åˆ¶ len å’Œ capï¼Œåº•å±‚å…±ç”¨åŒä¸€ä¸ªæ•°ç»„ï¼Œä¸ä¼šå ç”¨é¢å¤–çš„å†…å­˜ï¼Œå‡½æ•°å†…å¯¹æ•°ç»„å…ƒç´ å€¼çš„<strong>ä¿®æ”¹</strong>ï¼Œä¼šä¿®æ”¹åŸæ•°ç»„å†…å®¹ã€‚</p><p><strong>3ï¼‰è®¡ç®—æ•°ç»„é•¿åº¦æ–¹å¼ä¸åŒ</strong></p><p>æ•°ç»„éœ€è¦éå†è®¡ç®—æ•°ç»„é•¿åº¦ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O (n)</p><p>åˆ‡ç‰‡åº•å±‚åŒ…å« len å­—æ®µï¼Œå¯ä»¥é€šè¿‡ len ()è®¡ç®—åˆ‡ç‰‡é•¿åº¦ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)</p><a href=#go-slice-æ·±æ‹·è´å’Œæµ…æ‹·è´><h1 id=go-slice-æ·±æ‹·è´å’Œæµ…æ‹·è´><span class=hanchor arialabel=Anchor># </span>Go slice æ·±æ‹·è´å’Œæµ…æ‹·è´</h1></a><p>æ·±æ‹·è´ï¼šæ‹·è´çš„æ˜¯æ•°æ®æœ¬èº«ï¼Œåˆ›é€ ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ–°åˆ›å»ºçš„å¯¹è±¡ä¸åŸå¯¹è±¡ä¸å…±äº«å†…å­˜ï¼Œæ–°åˆ›å»ºçš„å¯¹è±¡åœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªæ–°çš„å†…å­˜åœ°å€ï¼Œæ–°å¯¹è±¡å€¼ä¿®æ”¹æ—¶ä¸ä¼šå½±å“åŸå¯¹è±¡å€¼</p><p>å®ç°æ·±æ‹·è´çš„æ–¹å¼ï¼š</p><ol><li>Copy (slice 2, slice 1)</li><li>éå† append èµ‹å€¼</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func main() {
</span></span><span class=line><span class=cl>    slice1 := []int{1, 2, 3, 4, 5}
</span></span><span class=line><span class=cl>    slice2 := make([]int, 5, 5)
</span></span><span class=line><span class=cl>    fmt.Printf(&#34;slice1: %v, %p\n&#34;, slice1, slice1)
</span></span><span class=line><span class=cl>    copy(slice2, slice1)
</span></span><span class=line><span class=cl>    fmt.Printf(&#34;slice2: %v, %p\n&#34;, slice2, slice2)
</span></span><span class=line><span class=cl>    slice3 := make([]int, 0, 5)
</span></span><span class=line><span class=cl>    for _, v := range slice1 {
</span></span><span class=line><span class=cl>        slice3 = append(slice3, v)
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    fmt.Printf(&#34;slice3: %v, %p\n&#34;, slice3, slice3)
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>slice1: [1 2 3 4 5], 0xc0000b0030
</span></span><span class=line><span class=cl>slice2: [1 2 3 4 5], 0xc0000b0060
</span></span><span class=line><span class=cl>slice3: [1 2 3 4 5], 0xc0000b0090
</span></span></code></pre></td></tr></table></div></div><p>æµ…æ‹·è´ï¼šæ‹·è´çš„æ˜¯æ•°æ®åœ°å€ï¼Œåªå¤åˆ¶æŒ‡å‘çš„å¯¹è±¡çš„æŒ‡é’ˆï¼Œæ­¤æ—¶æ–°å¯¹è±¡å’Œè€å¯¹è±¡æŒ‡å‘çš„å†…å­˜åœ°å€æ˜¯ä¸€æ ·çš„ï¼Œæ–°å¯¹è±¡å€¼ä¿®æ”¹æ—¶è€å¯¹è±¡ä¹Ÿä¼šå˜åŒ–</p><p>å®ç°æµ…æ‹·è´çš„æ–¹å¼ï¼š</p><p>å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œé»˜è®¤èµ‹å€¼æ“ä½œå°±æ˜¯æµ…æ‹·è´</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func main() {
</span></span><span class=line><span class=cl>    slice1 := []int{1, 2, 3, 4, 5}
</span></span><span class=line><span class=cl>    fmt.Printf(&#34;slice1: %v, %p\n&#34;, slice1, slice1)
</span></span><span class=line><span class=cl>    slice2 := slice1
</span></span><span class=line><span class=cl>    fmt.Printf(&#34;slice2: %v, %p\n&#34;, slice2, slice2)
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>slice1: [1 2 3 4 5], 0xc00001a120
</span></span><span class=line><span class=cl>slice2: [1 2 3 4 5], 0xc00001a120
</span></span></code></pre></td></tr></table></div></div><a href=#go-slice-æ‰©å®¹æœºåˆ¶><h1 id=go-slice-æ‰©å®¹æœºåˆ¶><span class=hanchor arialabel=Anchor># </span>Go slice æ‰©å®¹æœºåˆ¶ï¼Ÿ</h1></a><p>æ‰©å®¹ä¼šå‘ç”Ÿåœ¨ slice append çš„æ—¶å€™ï¼Œå½“ slice çš„ cap ä¸è¶³ä»¥å®¹çº³æ–°å…ƒç´ ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹è§„åˆ™å¦‚ä¸‹</p><ul><li>å¦‚æœåŸæœ‰ slice é•¿åº¦å°äº 1024ï¼Œé‚£ä¹ˆæ¯æ¬¡å°±æ‰©å®¹ä¸ºåŸæ¥çš„ 2 å€</li><li>å¦‚æœåŸ slice é•¿åº¦å¤§äºç­‰äº 1024ï¼Œé‚£ä¹ˆæ¯æ¬¡æ‰©å®¹å°±æ‰©ä¸ºåŸæ¥çš„ 1.25 å€</li></ul><p><strong>è¡¥å……</strong></p><p>å¦‚æœ go 1.18+ï¼ŒåŸæ¥çš„ slice å®¹é‡ oldcap å°äº 256 çš„æ—¶å€™ï¼Œæ–° slice çš„å®¹é‡ newcap æ˜¯ oldcap çš„ 2 å€ï¼›å½“ oldcap å®¹é‡å¤§äºç­‰äº 256 çš„æ—¶å€™ï¼Œnewcap ä¼šæœ‰ä¸ªè®¡ç®—å…¬å¼ï¼šnewcap += (newcap +3 threshold) / 4 å†å¯¹ newcap ä½œäº†ä¸€ä¸ªå†…å­˜å¯¹é½ï¼Œè¿™ä¸ªå’Œå†…å­˜åˆ†é…ç­–ç•¥ç›¸å…³ã€‚è¿›è¡Œå†…å­˜å¯¹é½ä¹‹åï¼Œæ–° slice çš„å®¹é‡æ˜¯è¦å¤§äºç­‰äºæŒ‰ç…§å‰åŠéƒ¨åˆ†ç”Ÿæˆçš„ newcapã€‚</p><a href=#go-slice-ä¸ºä»€ä¹ˆä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„><h1 id=go-slice-ä¸ºä»€ä¹ˆä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„><span class=hanchor arialabel=Anchor># </span>Go slice ä¸ºä»€ä¹ˆä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</h1></a><p><strong>å…ˆçœ‹ä¸‹çº¿ç¨‹å®‰å…¨çš„å®šä¹‰</strong>ï¼š</p><p>å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºéƒ½å¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>è‹¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œå†™æ“ä½œï¼Œä¸€èˆ¬éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œå¦åˆ™çš„è¯å°±å¯èƒ½å½±å“çº¿ç¨‹å®‰å…¨ã€‚</p><p><strong>å†çœ‹ Go è¯­è¨€å®ç°çº¿ç¨‹å®‰å…¨å¸¸ç”¨çš„å‡ ç§æ–¹å¼</strong>ï¼š</p><ol><li>äº’æ–¥é”</li><li>è¯»å†™é”</li><li>åŸå­æ“ä½œ</li><li>Sync. Once</li><li>Sync. Atomic</li><li>Channel</li></ol><p>Slice åº•å±‚ç»“æ„å¹¶æ²¡æœ‰ä½¿ç”¨åŠ é”ç­‰æ–¹å¼ï¼Œä¸æ”¯æŒå¹¶å‘è¯»å†™ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½¿ç”¨å¤šä¸ª goroutine å¯¹ç±»å‹ä¸º slice çš„å˜é‡è¿›è¡Œæ“ä½œï¼Œæ¯æ¬¡è¾“å‡ºçš„å€¼å¤§æ¦‚ç‡éƒ½ä¸ä¼šä¸€æ ·ï¼Œä¸é¢„æœŸå€¼ä¸ä¸€è‡´; slice åœ¨å¹¶å‘æ‰§è¡Œä¸­ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯æ•°æ®ä¼šä¸¢å¤±</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/**
</span></span><span class=line><span class=cl>* åˆ‡ç‰‡éå¹¶å‘å®‰å…¨
</span></span><span class=line><span class=cl>* å¤šæ¬¡æ‰§è¡Œï¼Œæ¯æ¬¡å¾—åˆ°çš„ç»“æœéƒ½ä¸ä¸€æ ·
</span></span><span class=line><span class=cl>* å¯ä»¥è€ƒè™‘ä½¿ç”¨ channel æœ¬èº«çš„ç‰¹æ€§ (é˜»å¡) æ¥å®ç°å®‰å…¨çš„å¹¶å‘è¯»å†™
</span></span><span class=line><span class=cl> */
</span></span><span class=line><span class=cl>func TestSliceConcurrencySafe(t *testing.T) {
</span></span><span class=line><span class=cl> a := make([]int, 0)
</span></span><span class=line><span class=cl> var wg sync.WaitGroup
</span></span><span class=line><span class=cl> for i := 0; i &lt; 10000; i++ {
</span></span><span class=line><span class=cl>  wg.Add(1)
</span></span><span class=line><span class=cl>  go func(i int) {
</span></span><span class=line><span class=cl>   a = append(a, i)
</span></span><span class=line><span class=cl>   wg.Done()
</span></span><span class=line><span class=cl>  }(i)
</span></span><span class=line><span class=cl> }
</span></span><span class=line><span class=cl> wg.Wait()
</span></span><span class=line><span class=cl> t.Log(len(a)) 
</span></span><span class=line><span class=cl> // not equal 10000
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://googoo-s.github.io/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by googoo-s using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2024</p><ul><li><a href=https://googoo-s.github.io/>Home</a></li><li><a href=https://github.com/googoo-s>GitHub</a></li></ul></footer></div></div></body></html>